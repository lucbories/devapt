/*!
 * jQuery JavaScript Library v2.1.3
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-12-18T15:11Z
 */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(a){var b=a.length,c=_.type(a);return"function"===c||_.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}function d(a,b,c){if(_.isFunction(b))return _.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return _.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(hb.test(b))return _.filter(b,a,c);b=_.filter(b,a)}return _.grep(a,function(a){return U.call(b,a)>=0!==c})}function e(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function f(a){var b=ob[a]={};return _.each(a.match(nb)||[],function(a,c){b[c]=!0}),b}function g(){Z.removeEventListener("DOMContentLoaded",g,!1),a.removeEventListener("load",g,!1),_.ready()}function h(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=_.expando+h.uid++}function i(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(ub,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:tb.test(c)?_.parseJSON(c):c}catch(e){}sb.set(a,b,c)}else c=void 0;return c}function j(){return!0}function k(){return!1}function l(){try{return Z.activeElement}catch(a){}}function m(a,b){return _.nodeName(a,"table")&&_.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function n(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function o(a){var b=Kb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function p(a,b){for(var c=0,d=a.length;d>c;c++)rb.set(a[c],"globalEval",!b||rb.get(b[c],"globalEval"))}function q(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(rb.hasData(a)&&(f=rb.access(a),g=rb.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)_.event.add(b,e,j[e][c])}sb.hasData(a)&&(h=sb.access(a),i=_.extend({},h),sb.set(b,i))}}function r(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&_.nodeName(a,b)?_.merge([a],c):c}function s(a,b){var c=b.nodeName.toLowerCase();"input"===c&&yb.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}function t(b,c){var d,e=_(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:_.css(e[0],"display");return e.detach(),f}function u(a){var b=Z,c=Ob[a];return c||(c=t(a,b),"none"!==c&&c||(Nb=(Nb||_("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=Nb[0].contentDocument,b.write(),b.close(),c=t(a,b),Nb.detach()),Ob[a]=c),c}function v(a,b,c){var d,e,f,g,h=a.style;return c=c||Rb(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||_.contains(a.ownerDocument,a)||(g=_.style(a,b)),Qb.test(g)&&Pb.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function w(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}function x(a,b){if(b in a)return b;for(var c=b[0].toUpperCase()+b.slice(1),d=b,e=Xb.length;e--;)if(b=Xb[e]+c,b in a)return b;return d}function y(a,b,c){var d=Tb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function z(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=_.css(a,c+wb[f],!0,e)),d?("content"===c&&(g-=_.css(a,"padding"+wb[f],!0,e)),"margin"!==c&&(g-=_.css(a,"border"+wb[f]+"Width",!0,e))):(g+=_.css(a,"padding"+wb[f],!0,e),"padding"!==c&&(g+=_.css(a,"border"+wb[f]+"Width",!0,e)));return g}function A(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Rb(a),g="border-box"===_.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=v(a,b,f),(0>e||null==e)&&(e=a.style[b]),Qb.test(e))return e;d=g&&(Y.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+z(a,b,c||(g?"border":"content"),d,f)+"px"}function B(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=rb.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&xb(d)&&(f[g]=rb.access(d,"olddisplay",u(d.nodeName)))):(e=xb(d),"none"===c&&e||rb.set(d,"olddisplay",e?c:_.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function C(a,b,c,d,e){return new C.prototype.init(a,b,c,d,e)}function D(){return setTimeout(function(){Yb=void 0}),Yb=_.now()}function E(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=wb[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function F(a,b,c){for(var d,e=(cc[b]||[]).concat(cc["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function G(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},n=a.style,o=a.nodeType&&xb(a),p=rb.get(a,"fxshow");c.queue||(h=_._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,_.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[n.overflow,n.overflowX,n.overflowY],j=_.css(a,"display"),k="none"===j?rb.get(a,"olddisplay")||u(a.nodeName):j,"inline"===k&&"none"===_.css(a,"float")&&(n.display="inline-block")),c.overflow&&(n.overflow="hidden",l.always(function(){n.overflow=c.overflow[0],n.overflowX=c.overflow[1],n.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],$b.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(o?"hide":"show")){if("show"!==e||!p||void 0===p[d])continue;o=!0}m[d]=p&&p[d]||_.style(a,d)}else j=void 0;if(_.isEmptyObject(m))"inline"===("none"===j?u(a.nodeName):j)&&(n.display=j);else{p?"hidden"in p&&(o=p.hidden):p=rb.access(a,"fxshow",{}),f&&(p.hidden=!o),o?_(a).show():l.done(function(){_(a).hide()}),l.done(function(){var b;rb.remove(a,"fxshow");for(b in m)_.style(a,b,m[b])});for(d in m)g=F(o?p[d]:0,d,l),d in p||(p[d]=g.start,o&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function H(a,b){var c,d,e,f,g;for(c in a)if(d=_.camelCase(c),e=b[d],f=a[c],_.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=_.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function I(a,b,c){var d,e,f=0,g=bc.length,h=_.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Yb||D(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:_.extend({},b),opts:_.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Yb||D(),duration:c.duration,tweens:[],createTween:function(b,c){var d=_.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(H(k,j.opts.specialEasing);g>f;f++)if(d=bc[f].call(j,a,k,j.opts))return d;return _.map(k,F,j),_.isFunction(j.opts.start)&&j.opts.start.call(a,j),_.fx.timer(_.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function J(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(nb)||[];if(_.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function K(a,b,c,d){function e(h){var i;return f[h]=!0,_.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===tc;return e(b.dataTypes[0])||!f["*"]&&e("*")}function L(a,b){var c,d,e=_.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&_.extend(!0,a,d),a}function M(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function N(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function O(a,b,c,d){var e;if(_.isArray(b))_.each(b,function(b,e){c||yc.test(a)?d(a,e):O(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==_.type(b))d(a,b);else for(e in b)O(a+"["+e+"]",b[e],c,d)}function P(a){return _.isWindow(a)?a:9===a.nodeType&&a.defaultView}var Q=[],R=Q.slice,S=Q.concat,T=Q.push,U=Q.indexOf,V={},W=V.toString,X=V.hasOwnProperty,Y={},Z=a.document,$="2.1.3",_=function(a,b){return new _.fn.init(a,b)},ab=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,bb=/^-ms-/,cb=/-([\da-z])/gi,db=function(a,b){return b.toUpperCase()};_.fn=_.prototype={jquery:$,constructor:_,selector:"",length:0,toArray:function(){return R.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:R.call(this)},pushStack:function(a){var b=_.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return _.each(this,a,b)},map:function(a){return this.pushStack(_.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(R.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:T,sort:Q.sort,splice:Q.splice},_.extend=_.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||_.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(_.isPlainObject(d)||(e=_.isArray(d)))?(e?(e=!1,f=c&&_.isArray(c)?c:[]):f=c&&_.isPlainObject(c)?c:{},g[b]=_.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},_.extend({expando:"jQuery"+($+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===_.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!_.isArray(a)&&a-parseFloat(a)+1>=0},isPlainObject:function(a){return"object"!==_.type(a)||a.nodeType||_.isWindow(a)?!1:a.constructor&&!X.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?V[W.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=_.trim(a),a&&(1===a.indexOf("use strict")?(b=Z.createElement("script"),b.text=a,Z.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(bb,"ms-").replace(cb,db)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;g>f&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;g>f&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(ab,"")},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?_.merge(d,"string"==typeof a?[a]:a):T.call(d,a)),d},inArray:function(a,b,c){return null==b?-1:U.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;g>f;f++)e=b(a[f],f,d),null!=e&&i.push(e);else for(f in a)e=b(a[f],f,d),null!=e&&i.push(e);return S.apply([],i)},guid:1,proxy:function(a,b){var c,d,e;return"string"==typeof b&&(c=a[b],b=a,a=c),_.isFunction(a)?(d=R.call(arguments,2),e=function(){return a.apply(b||this,d.concat(R.call(arguments)))},e.guid=a.guid=a.guid||_.guid++,e):void 0},now:Date.now,support:Y}),_.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){V["[object "+b+"]"]=b.toLowerCase()});var eb=/*!
 * Sizzle CSS Selector Engine v2.2.0-pre
 * http://sizzlejs.com/
 *
 * Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-12-16
 */
function(a){function b(a,b,c,d){var e,f,g,h,i,j,l,n,o,p;if((b?b.ownerDocument||b:O)!==G&&F(b),b=b||G,c=c||[],h=b.nodeType,"string"!=typeof a||!a||1!==h&&9!==h&&11!==h)return c;if(!d&&I){if(11!==h&&(e=sb.exec(a)))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&M(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return $.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&v.getElementsByClassName)return $.apply(c,b.getElementsByClassName(g)),c}if(v.qsa&&(!J||!J.test(a))){if(n=l=N,o=b,p=1!==h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=z(a),(l=b.getAttribute("id"))?n=l.replace(ub,"\\$&"):b.setAttribute("id",n),n="[id='"+n+"'] ",i=j.length;i--;)j[i]=n+m(j[i]);o=tb.test(a)&&k(b.parentNode)||b,p=j.join(",")}if(p)try{return $.apply(c,o.querySelectorAll(p)),c}catch(q){}finally{l||b.removeAttribute("id")}}}return B(a.replace(ib,"$1"),b,c,d)}function c(){function a(c,d){return b.push(c+" ")>w.cacheLength&&delete a[b.shift()],a[c+" "]=d}var b=[];return a}function d(a){return a[N]=!0,a}function e(a){var b=G.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function f(a,b){for(var c=a.split("|"),d=a.length;d--;)w.attrHandle[c[d]]=b}function g(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||V)-(~a.sourceIndex||V);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function h(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function i(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function j(a){return d(function(b){return b=+b,d(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function k(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}function l(){}function m(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function n(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=Q++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[P,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if(i=b[N]||(b[N]={}),(h=i[d])&&h[0]===P&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function o(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function p(a,c,d){for(var e=0,f=c.length;f>e;e++)b(a,c[e],d);return d}function q(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function r(a,b,c,e,f,g){return e&&!e[N]&&(e=r(e)),f&&!f[N]&&(f=r(f,g)),d(function(d,g,h,i){var j,k,l,m=[],n=[],o=g.length,r=d||p(b||"*",h.nodeType?[h]:h,[]),s=!a||!d&&b?r:q(r,m,a,h,i),t=c?f||(d?a:o||e)?[]:g:s;if(c&&c(s,t,h,i),e)for(j=q(t,n),e(j,[],h,i),k=j.length;k--;)(l=j[k])&&(t[n[k]]=!(s[n[k]]=l));if(d){if(f||a){if(f){for(j=[],k=t.length;k--;)(l=t[k])&&j.push(s[k]=l);f(null,t=[],j,i)}for(k=t.length;k--;)(l=t[k])&&(j=f?ab(d,l):m[k])>-1&&(d[j]=!(g[j]=l))}}else t=q(t===g?t.splice(o,t.length):t),f?f(null,g,t,i):$.apply(g,t)})}function s(a){for(var b,c,d,e=a.length,f=w.relative[a[0].type],g=f||w.relative[" "],h=f?1:0,i=n(function(a){return a===b},g,!0),j=n(function(a){return ab(b,a)>-1},g,!0),k=[function(a,c,d){var e=!f&&(d||c!==C)||((b=c).nodeType?i(a,c,d):j(a,c,d));return b=null,e}];e>h;h++)if(c=w.relative[a[h].type])k=[n(o(k),c)];else{if(c=w.filter[a[h].type].apply(null,a[h].matches),c[N]){for(d=++h;e>d&&!w.relative[a[d].type];d++);return r(h>1&&o(k),h>1&&m(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ib,"$1"),c,d>h&&s(a.slice(h,d)),e>d&&s(a=a.slice(d)),e>d&&m(a))}k.push(c)}return o(k)}function t(a,c){var e=c.length>0,f=a.length>0,g=function(d,g,h,i,j){var k,l,m,n=0,o="0",p=d&&[],r=[],s=C,t=d||f&&w.find.TAG("*",j),u=P+=null==s?1:Math.random()||.1,v=t.length;for(j&&(C=g!==G&&g);o!==v&&null!=(k=t[o]);o++){if(f&&k){for(l=0;m=a[l++];)if(m(k,g,h)){i.push(k);break}j&&(P=u)}e&&((k=!m&&k)&&n--,d&&p.push(k))}if(n+=o,e&&o!==n){for(l=0;m=c[l++];)m(p,r,g,h);if(d){if(n>0)for(;o--;)p[o]||r[o]||(r[o]=Y.call(i));r=q(r)}$.apply(i,r),j&&!d&&r.length>0&&n+c.length>1&&b.uniqueSort(i)}return j&&(P=u,C=s),p};return e?d(g):g}var u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N="sizzle"+1*new Date,O=a.document,P=0,Q=0,R=c(),S=c(),T=c(),U=function(a,b){return a===b&&(E=!0),0},V=1<<31,W={}.hasOwnProperty,X=[],Y=X.pop,Z=X.push,$=X.push,_=X.slice,ab=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},bb="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",cb="[\\x20\\t\\r\\n\\f]",db="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",eb=db.replace("w","w#"),fb="\\["+cb+"*("+db+")(?:"+cb+"*([*^$|!~]?=)"+cb+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+eb+"))|)"+cb+"*\\]",gb=":("+db+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+fb+")*)|.*)\\)|)",hb=new RegExp(cb+"+","g"),ib=new RegExp("^"+cb+"+|((?:^|[^\\\\])(?:\\\\.)*)"+cb+"+$","g"),jb=new RegExp("^"+cb+"*,"+cb+"*"),kb=new RegExp("^"+cb+"*([>+~]|"+cb+")"+cb+"*"),lb=new RegExp("="+cb+"*([^\\]'\"]*?)"+cb+"*\\]","g"),mb=new RegExp(gb),nb=new RegExp("^"+eb+"$"),ob={ID:new RegExp("^#("+db+")"),CLASS:new RegExp("^\\.("+db+")"),TAG:new RegExp("^("+db.replace("w","w*")+")"),ATTR:new RegExp("^"+fb),PSEUDO:new RegExp("^"+gb),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+cb+"*(even|odd|(([+-]|)(\\d*)n|)"+cb+"*(?:([+-]|)"+cb+"*(\\d+)|))"+cb+"*\\)|)","i"),bool:new RegExp("^(?:"+bb+")$","i"),needsContext:new RegExp("^"+cb+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+cb+"*((?:-\\d)?\\d*)"+cb+"*\\)|)(?=[^-]|$)","i")},pb=/^(?:input|select|textarea|button)$/i,qb=/^h\d$/i,rb=/^[^{]+\{\s*\[native \w/,sb=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tb=/[+~]/,ub=/'|\\/g,vb=new RegExp("\\\\([\\da-f]{1,6}"+cb+"?|("+cb+")|.)","ig"),wb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},xb=function(){F()};try{$.apply(X=_.call(O.childNodes),O.childNodes),X[O.childNodes.length].nodeType}catch(yb){$={apply:X.length?function(a,b){Z.apply(a,_.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}v=b.support={},y=b.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},F=b.setDocument=function(a){var b,c,d=a?a.ownerDocument||a:O;return d!==G&&9===d.nodeType&&d.documentElement?(G=d,H=d.documentElement,c=d.defaultView,c&&c!==c.top&&(c.addEventListener?c.addEventListener("unload",xb,!1):c.attachEvent&&c.attachEvent("onunload",xb)),I=!y(d),v.attributes=e(function(a){return a.className="i",!a.getAttribute("className")}),v.getElementsByTagName=e(function(a){return a.appendChild(d.createComment("")),!a.getElementsByTagName("*").length}),v.getElementsByClassName=rb.test(d.getElementsByClassName),v.getById=e(function(a){return H.appendChild(a).id=N,!d.getElementsByName||!d.getElementsByName(N).length}),v.getById?(w.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&I){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},w.filter.ID=function(a){var b=a.replace(vb,wb);return function(a){return a.getAttribute("id")===b}}):(delete w.find.ID,w.filter.ID=function(a){var b=a.replace(vb,wb);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),w.find.TAG=v.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):v.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},w.find.CLASS=v.getElementsByClassName&&function(a,b){return I?b.getElementsByClassName(a):void 0},K=[],J=[],(v.qsa=rb.test(d.querySelectorAll))&&(e(function(a){H.appendChild(a).innerHTML="<a id='"+N+"'></a><select id='"+N+"-\f]' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&J.push("[*^$]="+cb+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||J.push("\\["+cb+"*(?:value|"+bb+")"),a.querySelectorAll("[id~="+N+"-]").length||J.push("~="),a.querySelectorAll(":checked").length||J.push(":checked"),a.querySelectorAll("a#"+N+"+*").length||J.push(".#.+[+~]")}),e(function(a){var b=d.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&J.push("name"+cb+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||J.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),J.push(",.*:")})),(v.matchesSelector=rb.test(L=H.matches||H.webkitMatchesSelector||H.mozMatchesSelector||H.oMatchesSelector||H.msMatchesSelector))&&e(function(a){v.disconnectedMatch=L.call(a,"div"),L.call(a,"[s!='']:x"),K.push("!=",gb)}),J=J.length&&new RegExp(J.join("|")),K=K.length&&new RegExp(K.join("|")),b=rb.test(H.compareDocumentPosition),M=b||rb.test(H.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},U=b?function(a,b){if(a===b)return E=!0,0;var c=!a.compareDocumentPosition-!b.compareDocumentPosition;return c?c:(c=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&c||!v.sortDetached&&b.compareDocumentPosition(a)===c?a===d||a.ownerDocument===O&&M(O,a)?-1:b===d||b.ownerDocument===O&&M(O,b)?1:D?ab(D,a)-ab(D,b):0:4&c?-1:1)}:function(a,b){if(a===b)return E=!0,0;var c,e=0,f=a.parentNode,h=b.parentNode,i=[a],j=[b];if(!f||!h)return a===d?-1:b===d?1:f?-1:h?1:D?ab(D,a)-ab(D,b):0;if(f===h)return g(a,b);for(c=a;c=c.parentNode;)i.unshift(c);for(c=b;c=c.parentNode;)j.unshift(c);for(;i[e]===j[e];)e++;return e?g(i[e],j[e]):i[e]===O?-1:j[e]===O?1:0},d):G},b.matches=function(a,c){return b(a,null,null,c)},b.matchesSelector=function(a,c){if((a.ownerDocument||a)!==G&&F(a),c=c.replace(lb,"='$1']"),!(!v.matchesSelector||!I||K&&K.test(c)||J&&J.test(c)))try{var d=L.call(a,c);if(d||v.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return b(c,G,null,[a]).length>0},b.contains=function(a,b){return(a.ownerDocument||a)!==G&&F(a),M(a,b)},b.attr=function(a,b){(a.ownerDocument||a)!==G&&F(a);var c=w.attrHandle[b.toLowerCase()],d=c&&W.call(w.attrHandle,b.toLowerCase())?c(a,b,!I):void 0;return void 0!==d?d:v.attributes||!I?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null},b.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},b.uniqueSort=function(a){var b,c=[],d=0,e=0;if(E=!v.detectDuplicates,D=!v.sortStable&&a.slice(0),a.sort(U),E){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return D=null,a},x=b.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=x(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=x(b);return c},w=b.selectors={cacheLength:50,createPseudo:d,match:ob,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(vb,wb),a[3]=(a[3]||a[4]||a[5]||"").replace(vb,wb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||b.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&b.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return ob.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&mb.test(c)&&(b=z(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(vb,wb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=R[a+" "];return b||(b=new RegExp("(^|"+cb+")"+a+"("+cb+"|$)"))&&R(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,c,d){return function(e){var f=b.attr(e,a);return null==f?"!="===c:c?(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&f.indexOf(d)>-1:"$="===c?d&&f.slice(-d.length)===d:"~="===c?(" "+f.replace(hb," ")+" ").indexOf(d)>-1:"|="===c?f===d||f.slice(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[N]||(q[N]={}),j=k[a]||[],n=j[0]===P&&j[1],m=j[0]===P&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[P,n,m];break}}else if(s&&(j=(b[N]||(b[N]={}))[a])&&j[0]===P)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[N]||(l[N]={}))[a]=[P,m]),l!==b)););return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,c){var e,f=w.pseudos[a]||w.setFilters[a.toLowerCase()]||b.error("unsupported pseudo: "+a);return f[N]?f(c):f.length>1?(e=[a,a,"",c],w.setFilters.hasOwnProperty(a.toLowerCase())?d(function(a,b){for(var d,e=f(a,c),g=e.length;g--;)d=ab(a,e[g]),a[d]=!(b[d]=e[g])}):function(a){return f(a,0,e)}):f}},pseudos:{not:d(function(a){var b=[],c=[],e=A(a.replace(ib,"$1"));return e[N]?d(function(a,b,c,d){for(var f,g=e(a,null,d,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,d,f){return b[0]=a,e(b,null,f,c),b[0]=null,!c.pop()}}),has:d(function(a){return function(c){return b(a,c).length>0}}),contains:d(function(a){return a=a.replace(vb,wb),function(b){return(b.textContent||b.innerText||x(b)).indexOf(a)>-1}}),lang:d(function(a){return nb.test(a||"")||b.error("unsupported lang: "+a),a=a.replace(vb,wb).toLowerCase(),function(b){var c;do if(c=I?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===H},focus:function(a){return a===G.activeElement&&(!G.hasFocus||G.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!w.pseudos.empty(a)},header:function(a){return qb.test(a.nodeName)},input:function(a){return pb.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:j(function(){return[0]}),last:j(function(a,b){return[b-1]}),eq:j(function(a,b,c){return[0>c?c+b:c]}),even:j(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:j(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:j(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:j(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},w.pseudos.nth=w.pseudos.eq;for(u in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[u]=h(u);for(u in{submit:!0,reset:!0})w.pseudos[u]=i(u);return l.prototype=w.filters=w.pseudos,w.setFilters=new l,z=b.tokenize=function(a,c){var d,e,f,g,h,i,j,k=S[a+" "];if(k)return c?0:k.slice(0);for(h=a,i=[],j=w.preFilter;h;){(!d||(e=jb.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=kb.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ib," ")}),h=h.slice(d.length));for(g in w.filter)!(e=ob[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return c?h.length:h?b.error(a):S(a,i).slice(0)},A=b.compile=function(a,b){var c,d=[],e=[],f=T[a+" "];if(!f){for(b||(b=z(a)),c=b.length;c--;)f=s(b[c]),f[N]?d.push(f):e.push(f);f=T(a,t(e,d)),f.selector=a}return f},B=b.select=function(a,b,c,d){var e,f,g,h,i,j="function"==typeof a&&a,l=!d&&z(a=j.selector||a);if(c=c||[],1===l.length){if(f=l[0]=l[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&v.getById&&9===b.nodeType&&I&&w.relative[f[1].type]){if(b=(w.find.ID(g.matches[0].replace(vb,wb),b)||[])[0],!b)return c;j&&(b=b.parentNode),a=a.slice(f.shift().value.length)}for(e=ob.needsContext.test(a)?0:f.length;e--&&(g=f[e],!w.relative[h=g.type]);)if((i=w.find[h])&&(d=i(g.matches[0].replace(vb,wb),tb.test(f[0].type)&&k(b.parentNode)||b))){if(f.splice(e,1),a=d.length&&m(f),!a)return $.apply(c,d),c;break}}return(j||A(a,l))(d,b,!I,c,tb.test(a)&&k(b.parentNode)||b),c},v.sortStable=N.split("").sort(U).join("")===N,v.detectDuplicates=!!E,F(),v.sortDetached=e(function(a){return 1&a.compareDocumentPosition(G.createElement("div"))}),e(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||f("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),v.attributes&&e(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||f("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),e(function(a){return null==a.getAttribute("disabled")})||f(bb,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),b}(a);_.find=eb,_.expr=eb.selectors,_.expr[":"]=_.expr.pseudos,_.unique=eb.uniqueSort,_.text=eb.getText,_.isXMLDoc=eb.isXML,_.contains=eb.contains;var fb=_.expr.match.needsContext,gb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,hb=/^.[^:#\[\.,]*$/;_.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?_.find.matchesSelector(d,a)?[d]:[]:_.find.matches(a,_.grep(b,function(a){return 1===a.nodeType}))},_.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(_(a).filter(function(){for(b=0;c>b;b++)if(_.contains(e[b],this))return!0}));for(b=0;c>b;b++)_.find(a,e[b],d);return d=this.pushStack(c>1?_.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(d(this,a||[],!1))},not:function(a){return this.pushStack(d(this,a||[],!0))},is:function(a){return!!d(this,"string"==typeof a&&fb.test(a)?_(a):a||[],!1).length}});var ib,jb=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,kb=_.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:jb.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||ib).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof _?b[0]:b,_.merge(this,_.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:Z,!0)),gb.test(c[1])&&_.isPlainObject(b))for(c in b)_.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=Z.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=Z,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):_.isFunction(a)?"undefined"!=typeof ib.ready?ib.ready(a):a(_):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),_.makeArray(a,this))};kb.prototype=_.fn,ib=_(Z);var lb=/^(?:parents|prev(?:Until|All))/,mb={children:!0,contents:!0,next:!0,prev:!0};_.extend({dir:function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&_(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),_.fn.extend({has:function(a){var b=_(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(_.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=fb.test(a)||"string"!=typeof a?_(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&_.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?_.unique(f):f)},index:function(a){return a?"string"==typeof a?U.call(_(a),this[0]):U.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(_.unique(_.merge(this.get(),_(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),_.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return _.dir(a,"parentNode")},parentsUntil:function(a,b,c){return _.dir(a,"parentNode",c)},next:function(a){return e(a,"nextSibling")},prev:function(a){return e(a,"previousSibling")},nextAll:function(a){return _.dir(a,"nextSibling")},prevAll:function(a){return _.dir(a,"previousSibling")},nextUntil:function(a,b,c){return _.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return _.dir(a,"previousSibling",c)},siblings:function(a){return _.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return _.sibling(a.firstChild)},contents:function(a){return a.contentDocument||_.merge([],a.childNodes)}},function(a,b){_.fn[a]=function(c,d){var e=_.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=_.filter(d,e)),this.length>1&&(mb[a]||_.unique(e),lb.test(a)&&e.reverse()),this.pushStack(e)}});var nb=/\S+/g,ob={};_.Callbacks=function(a){a="string"==typeof a?ob[a]||f(a):_.extend({},a);var b,c,d,e,g,h,i=[],j=!a.once&&[],k=function(f){for(b=a.memory&&f,c=!0,h=e||0,e=0,g=i.length,d=!0;i&&g>h;h++)if(i[h].apply(f[0],f[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,i&&(j?j.length&&k(j.shift()):b?i=[]:l.disable())},l={add:function(){if(i){var c=i.length;!function f(b){_.each(b,function(b,c){var d=_.type(c);"function"===d?a.unique&&l.has(c)||i.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),d?g=i.length:b&&(e=c,k(b))}return this},remove:function(){return i&&_.each(arguments,function(a,b){for(var c;(c=_.inArray(b,i,c))>-1;)i.splice(c,1),d&&(g>=c&&g--,h>=c&&h--)}),this},has:function(a){return a?_.inArray(a,i)>-1:!(!i||!i.length)},empty:function(){return i=[],g=0,this},disable:function(){return i=j=b=void 0,this},disabled:function(){return!i},lock:function(){return j=void 0,b||l.disable(),this},locked:function(){return!j},fireWith:function(a,b){return!i||c&&!j||(b=b||[],b=[a,b.slice?b.slice():b],d?j.push(b):k(b)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!c}};return l},_.extend({Deferred:function(a){var b=[["resolve","done",_.Callbacks("once memory"),"resolved"],["reject","fail",_.Callbacks("once memory"),"rejected"],["notify","progress",_.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return _.Deferred(function(c){_.each(b,function(b,f){var g=_.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&_.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?_.extend(a,d):d}},e={};return d.pipe=d.then,_.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=R.call(arguments),g=f.length,h=1!==g||a&&_.isFunction(a.promise)?g:0,i=1===h?a:_.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?R.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&_.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}});var pb;_.fn.ready=function(a){return _.ready.promise().done(a),this},_.extend({isReady:!1,readyWait:1,holdReady:function(a){a?_.readyWait++:_.ready(!0)},ready:function(a){(a===!0?--_.readyWait:_.isReady)||(_.isReady=!0,a!==!0&&--_.readyWait>0||(pb.resolveWith(Z,[_]),_.fn.triggerHandler&&(_(Z).triggerHandler("ready"),_(Z).off("ready"))))}}),_.ready.promise=function(b){return pb||(pb=_.Deferred(),"complete"===Z.readyState?setTimeout(_.ready):(Z.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1))),pb.promise(b)},_.ready.promise();var qb=_.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===_.type(c)){e=!0;for(h in c)_.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,_.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(_(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};_.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType},h.uid=1,h.accepts=_.acceptData,h.prototype={key:function(a){if(!h.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=h.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,_.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(_.isEmptyObject(f))_.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,_.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{_.isArray(b)?d=b.concat(b.map(_.camelCase)):(e=_.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(nb)||[])),c=d.length;for(;c--;)delete g[d[c]]}},hasData:function(a){return!_.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var rb=new h,sb=new h,tb=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ub=/([A-Z])/g;_.extend({hasData:function(a){return sb.hasData(a)||rb.hasData(a)},data:function(a,b,c){return sb.access(a,b,c)},removeData:function(a,b){sb.remove(a,b)},_data:function(a,b,c){return rb.access(a,b,c)},_removeData:function(a,b){rb.remove(a,b)}}),_.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=sb.get(f),1===f.nodeType&&!rb.get(f,"hasDataAttrs"))){for(c=g.length;c--;)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=_.camelCase(d.slice(5)),i(f,d,e[d])));rb.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){sb.set(this,a)}):qb(this,function(b){var c,d=_.camelCase(a);if(f&&void 0===b){if(c=sb.get(f,a),void 0!==c)return c;if(c=sb.get(f,d),void 0!==c)return c;if(c=i(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=sb.get(this,d);sb.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&sb.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){sb.remove(this,a)})}}),_.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=rb.get(a,b),c&&(!d||_.isArray(c)?d=rb.access(a,b,_.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=_.queue(a,b),d=c.length,e=c.shift(),f=_._queueHooks(a,b),g=function(){_.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return rb.get(a,c)||rb.access(a,c,{empty:_.Callbacks("once memory").add(function(){rb.remove(a,[b+"queue",c])})})}}),_.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?_.queue(this[0],a):void 0===b?this:this.each(function(){var c=_.queue(this,a,b);_._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&_.dequeue(this,a)})},dequeue:function(a){return this.each(function(){_.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=_.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)c=rb.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var vb=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,wb=["Top","Right","Bottom","Left"],xb=function(a,b){return a=b||a,"none"===_.css(a,"display")||!_.contains(a.ownerDocument,a)},yb=/^(?:checkbox|radio)$/i;!function(){var a=Z.createDocumentFragment(),b=a.appendChild(Z.createElement("div")),c=Z.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),Y.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",Y.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var zb="undefined";Y.focusinBubbles="onfocusin"in a;var Ab=/^key/,Bb=/^(?:mouse|pointer|contextmenu)|click/,Cb=/^(?:focusinfocus|focusoutblur)$/,Db=/^([^.]*)(?:\.(.+)|)$/;_.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=rb.get(a);if(q)for(c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=_.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return typeof _!==zb&&_.event.triggered!==b.type?_.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(nb)||[""],j=b.length;j--;)h=Db.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=_.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=_.event.special[n]||{},k=_.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&_.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,o,g)!==!1||a.addEventListener&&a.addEventListener(n,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),_.event.global[n]=!0)},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=rb.hasData(a)&&rb.get(a);if(q&&(i=q.events)){for(b=(b||"").match(nb)||[""],j=b.length;j--;)if(h=Db.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=_.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||_.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)_.event.remove(a,n+b[j],c,d,!0);_.isEmptyObject(i)&&(delete q.handle,rb.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,j,k,l,m=[d||Z],n=X.call(b,"type")?b.type:b,o=X.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||Z,3!==d.nodeType&&8!==d.nodeType&&!Cb.test(n+_.event.triggered)&&(n.indexOf(".")>=0&&(o=n.split("."),n=o.shift(),o.sort()),j=n.indexOf(":")<0&&"on"+n,b=b[_.expando]?b:new _.Event(n,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=o.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:_.makeArray(c,[b]),l=_.event.special[n]||{},e||!l.trigger||l.trigger.apply(d,c)!==!1)){if(!e&&!l.noBubble&&!_.isWindow(d)){for(i=l.delegateType||n,Cb.test(i+n)||(g=g.parentNode);g;g=g.parentNode)m.push(g),h=g;
h===(d.ownerDocument||Z)&&m.push(h.defaultView||h.parentWindow||a)}for(f=0;(g=m[f++])&&!b.isPropagationStopped();)b.type=f>1?i:l.bindType||n,k=(rb.get(g,"events")||{})[b.type]&&rb.get(g,"handle"),k&&k.apply(g,c),k=j&&g[j],k&&k.apply&&_.acceptData(g)&&(b.result=k.apply(g,c),b.result===!1&&b.preventDefault());return b.type=n,e||b.isDefaultPrevented()||l._default&&l._default.apply(m.pop(),c)!==!1||!_.acceptData(d)||j&&_.isFunction(d[n])&&!_.isWindow(d)&&(h=d[j],h&&(d[j]=null),_.event.triggered=n,d[n](),_.event.triggered=void 0,h&&(d[j]=h)),b.result}},dispatch:function(a){a=_.event.fix(a);var b,c,d,e,f,g=[],h=R.call(arguments),i=(rb.get(this,"events")||{})[a.type]||[],j=_.event.special[a.type]||{};if(h[0]=a,a.delegateTarget=this,!j.preDispatch||j.preDispatch.call(this,a)!==!1){for(g=_.event.handlers.call(this,a,i),b=0;(e=g[b++])&&!a.isPropagationStopped();)for(a.currentTarget=e.elem,c=0;(f=e.handlers[c++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(f.namespace))&&(a.handleObj=f,a.data=f.data,d=((_.event.special[f.origType]||{}).handle||f.handler).apply(e.elem,h),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()));return j.postDispatch&&j.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?_(e,this).index(i)>=0:_.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||Z,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[_.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Bb.test(e)?this.mouseHooks:Ab.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new _.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=Z),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==l()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===l()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&_.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return _.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=_.extend(new _.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?_.event.trigger(e,null,b):_.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},_.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},_.Event=function(a,b){return this instanceof _.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?j:k):this.type=a,b&&_.extend(this,b),this.timeStamp=a&&a.timeStamp||_.now(),void(this[_.expando]=!0)):new _.Event(a,b)},_.Event.prototype={isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=j,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=j,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=j,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},_.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){_.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!_.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),Y.focusinBubbles||_.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){_.event.simulate(b,a.target,_.event.fix(a),!0)};_.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=rb.access(d,b);e||d.addEventListener(a,c,!0),rb.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=rb.access(d,b)-1;e?rb.access(d,b,e):(d.removeEventListener(a,c,!0),rb.remove(d,b))}}}),_.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=k;else if(!d)return this;return 1===e&&(f=d,d=function(a){return _().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=_.guid++)),this.each(function(){_.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,_(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=k),this.each(function(){_.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){_.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?_.event.trigger(a,b,c,!0):void 0}});var Eb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Fb=/<([\w:]+)/,Gb=/<|&#?\w+;/,Hb=/<(?:script|style|link)/i,Ib=/checked\s*(?:[^=]|=\s*.checked.)/i,Jb=/^$|\/(?:java|ecma)script/i,Kb=/^true\/(.*)/,Lb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Mb={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Mb.optgroup=Mb.option,Mb.tbody=Mb.tfoot=Mb.colgroup=Mb.caption=Mb.thead,Mb.th=Mb.td,_.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=_.contains(a.ownerDocument,a);if(!(Y.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||_.isXMLDoc(a)))for(g=r(h),f=r(a),d=0,e=f.length;e>d;d++)s(f[d],g[d]);if(b)if(c)for(f=f||r(a),g=g||r(h),d=0,e=f.length;e>d;d++)q(f[d],g[d]);else q(a,h);return g=r(h,"script"),g.length>0&&p(g,!i&&r(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,n=a.length;n>m;m++)if(e=a[m],e||0===e)if("object"===_.type(e))_.merge(l,e.nodeType?[e]:e);else if(Gb.test(e)){for(f=f||k.appendChild(b.createElement("div")),g=(Fb.exec(e)||["",""])[1].toLowerCase(),h=Mb[g]||Mb._default,f.innerHTML=h[1]+e.replace(Eb,"<$1></$2>")+h[2],j=h[0];j--;)f=f.lastChild;_.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));for(k.textContent="",m=0;e=l[m++];)if((!d||-1===_.inArray(e,d))&&(i=_.contains(e.ownerDocument,e),f=r(k.appendChild(e),"script"),i&&p(f),c))for(j=0;e=f[j++];)Jb.test(e.type||"")&&c.push(e);return k},cleanData:function(a){for(var b,c,d,e,f=_.event.special,g=0;void 0!==(c=a[g]);g++){if(_.acceptData(c)&&(e=c[rb.expando],e&&(b=rb.cache[e]))){if(b.events)for(d in b.events)f[d]?_.event.remove(c,d):_.removeEvent(c,d,b.handle);rb.cache[e]&&delete rb.cache[e]}delete sb.cache[c[sb.expando]]}}}),_.fn.extend({text:function(a){return qb(this,function(a){return void 0===a?_.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=m(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=m(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?_.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||_.cleanData(r(c)),c.parentNode&&(b&&_.contains(c.ownerDocument,c)&&p(r(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(_.cleanData(r(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return _.clone(this,a,b)})},html:function(a){return qb(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!Hb.test(a)&&!Mb[(Fb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Eb,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(_.cleanData(r(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,_.cleanData(r(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=S.apply([],a);var c,d,e,f,g,h,i=0,j=this.length,k=this,l=j-1,m=a[0],p=_.isFunction(m);if(p||j>1&&"string"==typeof m&&!Y.checkClone&&Ib.test(m))return this.each(function(c){var d=k.eq(c);p&&(a[0]=m.call(this,c,d.html())),d.domManip(a,b)});if(j&&(c=_.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(e=_.map(r(c,"script"),n),f=e.length;j>i;i++)g=c,i!==l&&(g=_.clone(g,!0,!0),f&&_.merge(e,r(g,"script"))),b.call(this[i],g,i);if(f)for(h=e[e.length-1].ownerDocument,_.map(e,o),i=0;f>i;i++)g=e[i],Jb.test(g.type||"")&&!rb.access(g,"globalEval")&&_.contains(h,g)&&(g.src?_._evalUrl&&_._evalUrl(g.src):_.globalEval(g.textContent.replace(Lb,"")))}return this}}),_.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){_.fn[a]=function(a){for(var c,d=[],e=_(a),f=e.length-1,g=0;f>=g;g++)c=g===f?this:this.clone(!0),_(e[g])[b](c),T.apply(d,c.get());return this.pushStack(d)}});var Nb,Ob={},Pb=/^margin/,Qb=new RegExp("^("+vb+")(?!px)[a-z%]+$","i"),Rb=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)};!function(){function b(){g.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",g.innerHTML="",e.appendChild(f);var b=a.getComputedStyle(g,null);c="1%"!==b.top,d="4px"===b.width,e.removeChild(f)}var c,d,e=Z.documentElement,f=Z.createElement("div"),g=Z.createElement("div");g.style&&(g.style.backgroundClip="content-box",g.cloneNode(!0).style.backgroundClip="",Y.clearCloneStyle="content-box"===g.style.backgroundClip,f.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",f.appendChild(g),a.getComputedStyle&&_.extend(Y,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return null==d&&b(),d},reliableMarginRight:function(){var b,c=g.appendChild(Z.createElement("div"));return c.style.cssText=g.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",g.style.width="1px",e.appendChild(f),b=!parseFloat(a.getComputedStyle(c,null).marginRight),e.removeChild(f),g.removeChild(c),b}}))}(),_.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Sb=/^(none|table(?!-c[ea]).+)/,Tb=new RegExp("^("+vb+")(.*)$","i"),Ub=new RegExp("^([+-])=("+vb+")","i"),Vb={position:"absolute",visibility:"hidden",display:"block"},Wb={letterSpacing:"0",fontWeight:"400"},Xb=["Webkit","O","Moz","ms"];_.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=v(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=_.camelCase(b),i=a.style;return b=_.cssProps[h]||(_.cssProps[h]=x(i,h)),g=_.cssHooks[b]||_.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Ub.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(_.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||_.cssNumber[h]||(c+="px"),Y.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=_.camelCase(b);return b=_.cssProps[h]||(_.cssProps[h]=x(a.style,h)),g=_.cssHooks[b]||_.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=v(a,b,d)),"normal"===e&&b in Wb&&(e=Wb[b]),""===c||c?(f=parseFloat(e),c===!0||_.isNumeric(f)?f||0:e):e}}),_.each(["height","width"],function(a,b){_.cssHooks[b]={get:function(a,c,d){return c?Sb.test(_.css(a,"display"))&&0===a.offsetWidth?_.swap(a,Vb,function(){return A(a,b,d)}):A(a,b,d):void 0},set:function(a,c,d){var e=d&&Rb(a);return y(a,c,d?z(a,b,d,"border-box"===_.css(a,"boxSizing",!1,e),e):0)}}}),_.cssHooks.marginRight=w(Y.reliableMarginRight,function(a,b){return b?_.swap(a,{display:"inline-block"},v,[a,"marginRight"]):void 0}),_.each({margin:"",padding:"",border:"Width"},function(a,b){_.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+wb[d]+b]=f[d]||f[d-2]||f[0];return e}},Pb.test(a)||(_.cssHooks[a+b].set=y)}),_.fn.extend({css:function(a,b){return qb(this,function(a,b,c){var d,e,f={},g=0;if(_.isArray(b)){for(d=Rb(a),e=b.length;e>g;g++)f[b[g]]=_.css(a,b[g],!1,d);return f}return void 0!==c?_.style(a,b,c):_.css(a,b)},a,b,arguments.length>1)},show:function(){return B(this,!0)},hide:function(){return B(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){xb(this)?_(this).show():_(this).hide()})}}),_.Tween=C,C.prototype={constructor:C,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(_.cssNumber[c]?"":"px")},cur:function(){var a=C.propHooks[this.prop];return a&&a.get?a.get(this):C.propHooks._default.get(this)},run:function(a){var b,c=C.propHooks[this.prop];return this.pos=b=this.options.duration?_.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):C.propHooks._default.set(this),this}},C.prototype.init.prototype=C.prototype,C.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=_.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){_.fx.step[a.prop]?_.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[_.cssProps[a.prop]]||_.cssHooks[a.prop])?_.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},C.propHooks.scrollTop=C.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},_.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},_.fx=C.prototype.init,_.fx.step={};var Yb,Zb,$b=/^(?:toggle|show|hide)$/,_b=new RegExp("^(?:([+-])=|)("+vb+")([a-z%]*)$","i"),ac=/queueHooks$/,bc=[G],cc={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=_b.exec(b),f=e&&e[3]||(_.cssNumber[a]?"":"px"),g=(_.cssNumber[a]||"px"!==f&&+d)&&_b.exec(_.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,_.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};_.Animation=_.extend(I,{tweener:function(a,b){_.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],cc[c]=cc[c]||[],cc[c].unshift(b)},prefilter:function(a,b){b?bc.unshift(a):bc.push(a)}}),_.speed=function(a,b,c){var d=a&&"object"==typeof a?_.extend({},a):{complete:c||!c&&b||_.isFunction(a)&&a,duration:a,easing:c&&b||b&&!_.isFunction(b)&&b};return d.duration=_.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in _.fx.speeds?_.fx.speeds[d.duration]:_.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){_.isFunction(d.old)&&d.old.call(this),d.queue&&_.dequeue(this,d.queue)},d},_.fn.extend({fadeTo:function(a,b,c,d){return this.filter(xb).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=_.isEmptyObject(a),f=_.speed(b,c,d),g=function(){var b=I(this,_.extend({},a),f);(e||rb.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=_.timers,g=rb.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&ac.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&_.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=rb.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=_.timers,g=d?d.length:0;for(c.finish=!0,_.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),_.each(["toggle","show","hide"],function(a,b){var c=_.fn[b];_.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(E(b,!0),a,d,e)}}),_.each({slideDown:E("show"),slideUp:E("hide"),slideToggle:E("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){_.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),_.timers=[],_.fx.tick=function(){var a,b=0,c=_.timers;for(Yb=_.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||_.fx.stop(),Yb=void 0},_.fx.timer=function(a){_.timers.push(a),a()?_.fx.start():_.timers.pop()},_.fx.interval=13,_.fx.start=function(){Zb||(Zb=setInterval(_.fx.tick,_.fx.interval))},_.fx.stop=function(){clearInterval(Zb),Zb=null},_.fx.speeds={slow:600,fast:200,_default:400},_.fn.delay=function(a,b){return a=_.fx?_.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=Z.createElement("input"),b=Z.createElement("select"),c=b.appendChild(Z.createElement("option"));a.type="checkbox",Y.checkOn=""!==a.value,Y.optSelected=c.selected,b.disabled=!0,Y.optDisabled=!c.disabled,a=Z.createElement("input"),a.value="t",a.type="radio",Y.radioValue="t"===a.value}();var dc,ec,fc=_.expr.attrHandle;_.fn.extend({attr:function(a,b){return qb(this,_.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){_.removeAttr(this,a)})}}),_.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===zb?_.prop(a,b,c):(1===f&&_.isXMLDoc(a)||(b=b.toLowerCase(),d=_.attrHooks[b]||(_.expr.match.bool.test(b)?ec:dc)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=_.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void _.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(nb);if(f&&1===a.nodeType)for(;c=f[e++];)d=_.propFix[c]||c,_.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!Y.radioValue&&"radio"===b&&_.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),ec={set:function(a,b,c){return b===!1?_.removeAttr(a,c):a.setAttribute(c,c),c}},_.each(_.expr.match.bool.source.match(/\w+/g),function(a,b){var c=fc[b]||_.find.attr;fc[b]=function(a,b,d){var e,f;return d||(f=fc[b],fc[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,fc[b]=f),e}});var gc=/^(?:input|select|textarea|button)$/i;_.fn.extend({prop:function(a,b){return qb(this,_.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[_.propFix[a]||a]})}}),_.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!_.isXMLDoc(a),f&&(b=_.propFix[b]||b,e=_.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||gc.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),Y.optSelected||(_.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),_.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){_.propFix[this.toLowerCase()]=this});var hc=/[\t\r\n\f]/g;_.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(_.isFunction(a))return this.each(function(b){_(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(nb)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(hc," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=_.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(_.isFunction(a))return this.each(function(b){_(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(nb)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(hc," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");g=a?_.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(_.isFunction(a)?function(c){_(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c)for(var b,d=0,e=_(this),f=a.match(nb)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else(c===zb||"boolean"===c)&&(this.className&&rb.set(this,"__className__",this.className),this.className=this.className||a===!1?"":rb.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(hc," ").indexOf(b)>=0)return!0;return!1}});var ic=/\r/g;_.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=_.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,_(this).val()):a,null==e?e="":"number"==typeof e?e+="":_.isArray(e)&&(e=_.map(e,function(a){return null==a?"":a+""})),b=_.valHooks[this.type]||_.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=_.valHooks[e.type]||_.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(ic,""):null==c?"":c)}}}),_.extend({valHooks:{option:{get:function(a){var b=_.find.attr(a,"value");return null!=b?b:_.trim(_.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(Y.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&_.nodeName(c.parentNode,"optgroup"))){if(b=_(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=_.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=_.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),_.each(["radio","checkbox"],function(){_.valHooks[this]={set:function(a,b){return _.isArray(b)?a.checked=_.inArray(_(a).val(),b)>=0:void 0}},Y.checkOn||(_.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),_.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){_.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),_.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var jc=_.now(),kc=/\?/;_.parseJSON=function(a){return JSON.parse(a+"")},_.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&_.error("Invalid XML: "+a),b};var lc=/#.*$/,mc=/([?&])_=[^&]*/,nc=/^(.*?):[ \t]*([^\r\n]*)$/gm,oc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,pc=/^(?:GET|HEAD)$/,qc=/^\/\//,rc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,sc={},tc={},uc="*/".concat("*"),vc=a.location.href,wc=rc.exec(vc.toLowerCase())||[];_.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:vc,type:"GET",isLocal:oc.test(wc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":uc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":_.parseJSON,"text xml":_.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?L(L(a,_.ajaxSettings),b):L(_.ajaxSettings,a)},ajaxPrefilter:J(sc),ajaxTransport:J(tc),ajax:function(a,b){function c(a,b,c,g){var i,k,r,s,u,w=b;2!==t&&(t=2,h&&clearTimeout(h),d=void 0,f=g||"",v.readyState=a>0?4:0,i=a>=200&&300>a||304===a,c&&(s=M(l,v,c)),s=N(l,s,v,i),i?(l.ifModified&&(u=v.getResponseHeader("Last-Modified"),u&&(_.lastModified[e]=u),u=v.getResponseHeader("etag"),u&&(_.etag[e]=u)),204===a||"HEAD"===l.type?w="nocontent":304===a?w="notmodified":(w=s.state,k=s.data,r=s.error,i=!r)):(r=w,(a||!w)&&(w="error",0>a&&(a=0))),v.status=a,v.statusText=(b||w)+"",i?o.resolveWith(m,[k,w,v]):o.rejectWith(m,[v,w,r]),v.statusCode(q),q=void 0,j&&n.trigger(i?"ajaxSuccess":"ajaxError",[v,l,i?k:r]),p.fireWith(m,[v,w]),j&&(n.trigger("ajaxComplete",[v,l]),--_.active||_.event.trigger("ajaxStop")))}"object"==typeof a&&(b=a,a=void 0),b=b||{};var d,e,f,g,h,i,j,k,l=_.ajaxSetup({},b),m=l.context||l,n=l.context&&(m.nodeType||m.jquery)?_(m):_.event,o=_.Deferred(),p=_.Callbacks("once memory"),q=l.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!g)for(g={};b=nc.exec(f);)g[b[1].toLowerCase()]=b[2];b=g[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return d&&d.abort(b),c(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,l.url=((a||l.url||vc)+"").replace(lc,"").replace(qc,wc[1]+"//"),l.type=b.method||b.type||l.method||l.type,l.dataTypes=_.trim(l.dataType||"*").toLowerCase().match(nb)||[""],null==l.crossDomain&&(i=rc.exec(l.url.toLowerCase()),l.crossDomain=!(!i||i[1]===wc[1]&&i[2]===wc[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(wc[3]||("http:"===wc[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=_.param(l.data,l.traditional)),K(sc,l,b,v),2===t)return v;j=_.event&&l.global,j&&0===_.active++&&_.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!pc.test(l.type),e=l.url,l.hasContent||(l.data&&(e=l.url+=(kc.test(e)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=mc.test(e)?e.replace(mc,"$1_="+jc++):e+(kc.test(e)?"&":"?")+"_="+jc++)),l.ifModified&&(_.lastModified[e]&&v.setRequestHeader("If-Modified-Since",_.lastModified[e]),_.etag[e]&&v.setRequestHeader("If-None-Match",_.etag[e])),(l.data&&l.hasContent&&l.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",l.contentType),v.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+uc+"; q=0.01":""):l.accepts["*"]);for(k in l.headers)v.setRequestHeader(k,l.headers[k]);if(l.beforeSend&&(l.beforeSend.call(m,v,l)===!1||2===t))return v.abort();u="abort";for(k in{success:1,error:1,complete:1})v[k](l[k]);if(d=K(tc,l,b,v)){v.readyState=1,j&&n.trigger("ajaxSend",[v,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){v.abort("timeout")},l.timeout));try{t=1,d.send(r,c)}catch(w){if(!(2>t))throw w;c(-1,w)}}else c(-1,"No Transport");return v},getJSON:function(a,b,c){return _.get(a,b,c,"json")},getScript:function(a,b){return _.get(a,void 0,b,"script")}}),_.each(["get","post"],function(a,b){_[b]=function(a,c,d,e){return _.isFunction(c)&&(e=e||d,d=c,c=void 0),_.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),_._evalUrl=function(a){return _.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},_.fn.extend({wrapAll:function(a){var b;return _.isFunction(a)?this.each(function(b){_(this).wrapAll(a.call(this,b))}):(this[0]&&(b=_(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(_.isFunction(a)?function(b){_(this).wrapInner(a.call(this,b))}:function(){var b=_(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=_.isFunction(a);return this.each(function(c){_(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){_.nodeName(this,"body")||_(this).replaceWith(this.childNodes)}).end()}}),_.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},_.expr.filters.visible=function(a){return!_.expr.filters.hidden(a)};var xc=/%20/g,yc=/\[\]$/,zc=/\r?\n/g,Ac=/^(?:submit|button|image|reset|file)$/i,Bc=/^(?:input|select|textarea|keygen)/i;_.param=function(a,b){var c,d=[],e=function(a,b){b=_.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=_.ajaxSettings&&_.ajaxSettings.traditional),_.isArray(a)||a.jquery&&!_.isPlainObject(a))_.each(a,function(){e(this.name,this.value)});else for(c in a)O(c,a[c],b,e);
return d.join("&").replace(xc,"+")},_.fn.extend({serialize:function(){return _.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=_.prop(this,"elements");return a?_.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!_(this).is(":disabled")&&Bc.test(this.nodeName)&&!Ac.test(a)&&(this.checked||!yb.test(a))}).map(function(a,b){var c=_(this).val();return null==c?null:_.isArray(c)?_.map(c,function(a){return{name:b.name,value:a.replace(zc,"\r\n")}}):{name:b.name,value:c.replace(zc,"\r\n")}}).get()}}),_.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Cc=0,Dc={},Ec={0:200,1223:204},Fc=_.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in Dc)Dc[a]()}),Y.cors=!!Fc&&"withCredentials"in Fc,Y.ajax=Fc=!!Fc,_.ajaxTransport(function(a){var b;return Y.cors||Fc&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Cc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Dc[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Ec[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Dc[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}:void 0}),_.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return _.globalEval(a),a}}}),_.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),_.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=_("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),Z.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Gc=[],Hc=/(=)\?(?=&|$)|\?\?/;_.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Gc.pop()||_.expando+"_"+jc++;return this[a]=!0,a}}),_.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Hc.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=_.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Hc,"$1"+e):b.jsonp!==!1&&(b.url+=(kc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||_.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Gc.push(e)),g&&_.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),_.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||Z;var d=gb.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=_.buildFragment([a],b,e),e&&e.length&&_(e).remove(),_.merge([],d.childNodes))};var Ic=_.fn.load;_.fn.load=function(a,b,c){if("string"!=typeof a&&Ic)return Ic.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=_.trim(a.slice(h)),a=a.slice(0,h)),_.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&_.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?_("<div>").append(_.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},_.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){_.fn[b]=function(a){return this.on(b,a)}}),_.expr.filters.animated=function(a){return _.grep(_.timers,function(b){return a===b.elem}).length};var Jc=a.document.documentElement;_.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=_.css(a,"position"),l=_(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=_.css(a,"top"),i=_.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),_.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},_.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){_.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,_.contains(b,d)?(typeof d.getBoundingClientRect!==zb&&(e=d.getBoundingClientRect()),c=P(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===_.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),_.nodeName(a[0],"html")||(d=a.offset()),d.top+=_.css(a[0],"borderTopWidth",!0),d.left+=_.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-_.css(c,"marginTop",!0),left:b.left-d.left-_.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||Jc;a&&!_.nodeName(a,"html")&&"static"===_.css(a,"position");)a=a.offsetParent;return a||Jc})}}),_.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;_.fn[b]=function(e){return qb(this,function(b,e,f){var g=P(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),_.each(["top","left"],function(a,b){_.cssHooks[b]=w(Y.pixelPosition,function(a,c){return c?(c=v(a,b),Qb.test(c)?_(a).position()[b]+"px":c):void 0})}),_.each({Height:"height",Width:"width"},function(a,b){_.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){_.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return qb(this,function(b,c,d){var e;return _.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?_.css(b,c,g):_.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),_.fn.size=function(){return this.length},_.fn.andSelf=_.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return _});var Kc=a.jQuery,Lc=a.$;return _.noConflict=function(b){return a.$===_&&(a.$=Lc),b&&a.jQuery===_&&(a.jQuery=Kc),_},typeof b===zb&&(a.jQuery=a.$=_),_});

/**
 * @file        core/init.js
 * @desc        Devapt static init features
 * @ingroup     DEVAPT_CORE
 * @date        2013-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */

define( /* [ no depds ], */ 'core/init',[],function()
{
	/**
	 * @memberof	DevaptInit
	 * @public
	 * @class
	 * @desc		Devapt init features container
	 */
	var DevaptInit = function() {};
	
	/**
	 * @memberof			DevaptInit
	 * @public
	 * @static
	 * @desc				Array of resources init callbacks
	 */
	DevaptInit.init_resources_by_index	= [];

	/**
	 * @memberof			DevaptInit
	 * @public
	 * @static
	 * @desc				Associative array of resources init callbacks by name
	 */
	DevaptInit.init_resources_by_name	= {};

	/**
	 * @memberof			DevaptInit
	 * @public
	 * @static
	 * @desc				Array of resources after init callbacks
	 */
	DevaptInit.init_after_resources		= [];


	/**
	 * @memberof			DevaptInit
	 * @public
	 * @static
	 * @method				DevaptInit.init_resource(arg_init_name, arg_init_cb)
	 * @desc				Register a callback to init some resource at the end of the page loading
	 * @param {string}		arg_init_name			name of the init operation
	 * @param {function}	arg_init_cb				resource init callback
	 * @return {nothing}
	 */
	DevaptInit.init_resource = function(arg_init_name, arg_init_cb)
	{
		console.log('DevaptInit.init_resource [' + arg_init_name + ']');
		
		if ( DevaptInit.init_resources_by_name[arg_init_name] )
		{
			return;
		}
		
		DevaptInit.init_resources_by_name[arg_init_name] = arg_init_cb;
		DevaptInit.init_resources_by_index.push(arg_init_cb);
	}


	/**
	 * @memberof			DevaptInit
	 * @public
	 * @static
	 * @method				DevaptInit.after_resource(arg_init_name, arg_init_cb)
	 * @desc				Register a callback to execute after the resources init at the end of the page loading
	 * @param {string}		arg_init_name			name of the init operation
	 * @param {function}	arg_init_cb				resource init callback
	 * @return {nothing}
	 */
	DevaptInit.after_resource = function(arg_init_name, arg_init_cb)
	{
		console.log('DevaptInit.after_resource [' + arg_init_name + ']');
		
		DevaptInit.init_after_resources.push(arg_init_cb);
	}


	/**
	 * @memberof			DevaptInit
	 * @public
	 * @static
	 * @method				DevaptInit.init()
	 * @desc				Execute the registered callbacks at the end of the page loading
	 * @return {nothing}
	 */
	DevaptInit.init = function()
	{
		console.info('DevaptInit: init');
		
		console.info('DevaptInit: Executing resources init functions');
		var resource_index = null;
		for(resource_index in DevaptInit.init_resources_by_index)
		{
			var init_cb = DevaptInit.init_resources_by_index[resource_index];
			init_cb();
		}
		
		console.info('DevaptInit: Executing last init functions');
		for(after_index in DevaptInit.init_after_resources)
		{
			var init_cb = DevaptInit.init_after_resources[after_index];
			init_cb();
		}
	}

	return DevaptInit;
} );
/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
var CryptoJS=CryptoJS||function(s,p){var m={},l=m.lib={},n=function(){},r=l.Base={extend:function(b){n.prototype=this;var h=new n;b&&h.mixIn(b);h.hasOwnProperty("init")||(h.init=function(){h.$super.init.apply(this,arguments)});h.init.prototype=h;h.$super=this;return h},create:function(){var b=this.extend();b.init.apply(b,arguments);return b},init:function(){},mixIn:function(b){for(var h in b)b.hasOwnProperty(h)&&(this[h]=b[h]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},
q=l.WordArray=r.extend({init:function(b,h){b=this.words=b||[];this.sigBytes=h!=p?h:4*b.length},toString:function(b){return(b||t).stringify(this)},concat:function(b){var h=this.words,a=b.words,j=this.sigBytes;b=b.sigBytes;this.clamp();if(j%4)for(var g=0;g<b;g++)h[j+g>>>2]|=(a[g>>>2]>>>24-8*(g%4)&255)<<24-8*((j+g)%4);else if(65535<a.length)for(g=0;g<b;g+=4)h[j+g>>>2]=a[g>>>2];else h.push.apply(h,a);this.sigBytes+=b;return this},clamp:function(){var b=this.words,h=this.sigBytes;b[h>>>2]&=4294967295<<
32-8*(h%4);b.length=s.ceil(h/4)},clone:function(){var b=r.clone.call(this);b.words=this.words.slice(0);return b},random:function(b){for(var h=[],a=0;a<b;a+=4)h.push(4294967296*s.random()|0);return new q.init(h,b)}}),v=m.enc={},t=v.Hex={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;j<b;j++){var k=a[j>>>2]>>>24-8*(j%4)&255;g.push((k>>>4).toString(16));g.push((k&15).toString(16))}return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;j<a;j+=2)g[j>>>3]|=parseInt(b.substr(j,
2),16)<<24-4*(j%8);return new q.init(g,a/2)}},a=v.Latin1={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;j<b;j++)g.push(String.fromCharCode(a[j>>>2]>>>24-8*(j%4)&255));return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;j<a;j++)g[j>>>2]|=(b.charCodeAt(j)&255)<<24-8*(j%4);return new q.init(g,a)}},u=v.Utf8={stringify:function(b){try{return decodeURIComponent(escape(a.stringify(b)))}catch(g){throw Error("Malformed UTF-8 data");}},parse:function(b){return a.parse(unescape(encodeURIComponent(b)))}},
g=l.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new q.init;this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=u.parse(b));this._data.concat(b);this._nDataBytes+=b.sigBytes},_process:function(b){var a=this._data,g=a.words,j=a.sigBytes,k=this.blockSize,m=j/(4*k),m=b?s.ceil(m):s.max((m|0)-this._minBufferSize,0);b=m*k;j=s.min(4*b,j);if(b){for(var l=0;l<b;l+=k)this._doProcessBlock(g,l);l=g.splice(0,b);a.sigBytes-=j}return new q.init(l,j)},clone:function(){var b=r.clone.call(this);
b._data=this._data.clone();return b},_minBufferSize:0});l.Hasher=g.extend({cfg:r.extend(),init:function(b){this.cfg=this.cfg.extend(b);this.reset()},reset:function(){g.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);return this._doFinalize()},blockSize:16,_createHelper:function(b){return function(a,g){return(new b.init(g)).finalize(a)}},_createHmacHelper:function(b){return function(a,g){return(new k.HMAC.init(b,
g)).finalize(a)}}});var k=m.algo={};return m}(Math);
(function(s){function p(a,k,b,h,l,j,m){a=a+(k&b|~k&h)+l+m;return(a<<j|a>>>32-j)+k}function m(a,k,b,h,l,j,m){a=a+(k&h|b&~h)+l+m;return(a<<j|a>>>32-j)+k}function l(a,k,b,h,l,j,m){a=a+(k^b^h)+l+m;return(a<<j|a>>>32-j)+k}function n(a,k,b,h,l,j,m){a=a+(b^(k|~h))+l+m;return(a<<j|a>>>32-j)+k}for(var r=CryptoJS,q=r.lib,v=q.WordArray,t=q.Hasher,q=r.algo,a=[],u=0;64>u;u++)a[u]=4294967296*s.abs(s.sin(u+1))|0;q=q.MD5=t.extend({_doReset:function(){this._hash=new v.init([1732584193,4023233417,2562383102,271733878])},
_doProcessBlock:function(g,k){for(var b=0;16>b;b++){var h=k+b,w=g[h];g[h]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360}var b=this._hash.words,h=g[k+0],w=g[k+1],j=g[k+2],q=g[k+3],r=g[k+4],s=g[k+5],t=g[k+6],u=g[k+7],v=g[k+8],x=g[k+9],y=g[k+10],z=g[k+11],A=g[k+12],B=g[k+13],C=g[k+14],D=g[k+15],c=b[0],d=b[1],e=b[2],f=b[3],c=p(c,d,e,f,h,7,a[0]),f=p(f,c,d,e,w,12,a[1]),e=p(e,f,c,d,j,17,a[2]),d=p(d,e,f,c,q,22,a[3]),c=p(c,d,e,f,r,7,a[4]),f=p(f,c,d,e,s,12,a[5]),e=p(e,f,c,d,t,17,a[6]),d=p(d,e,f,c,u,22,a[7]),
c=p(c,d,e,f,v,7,a[8]),f=p(f,c,d,e,x,12,a[9]),e=p(e,f,c,d,y,17,a[10]),d=p(d,e,f,c,z,22,a[11]),c=p(c,d,e,f,A,7,a[12]),f=p(f,c,d,e,B,12,a[13]),e=p(e,f,c,d,C,17,a[14]),d=p(d,e,f,c,D,22,a[15]),c=m(c,d,e,f,w,5,a[16]),f=m(f,c,d,e,t,9,a[17]),e=m(e,f,c,d,z,14,a[18]),d=m(d,e,f,c,h,20,a[19]),c=m(c,d,e,f,s,5,a[20]),f=m(f,c,d,e,y,9,a[21]),e=m(e,f,c,d,D,14,a[22]),d=m(d,e,f,c,r,20,a[23]),c=m(c,d,e,f,x,5,a[24]),f=m(f,c,d,e,C,9,a[25]),e=m(e,f,c,d,q,14,a[26]),d=m(d,e,f,c,v,20,a[27]),c=m(c,d,e,f,B,5,a[28]),f=m(f,c,
d,e,j,9,a[29]),e=m(e,f,c,d,u,14,a[30]),d=m(d,e,f,c,A,20,a[31]),c=l(c,d,e,f,s,4,a[32]),f=l(f,c,d,e,v,11,a[33]),e=l(e,f,c,d,z,16,a[34]),d=l(d,e,f,c,C,23,a[35]),c=l(c,d,e,f,w,4,a[36]),f=l(f,c,d,e,r,11,a[37]),e=l(e,f,c,d,u,16,a[38]),d=l(d,e,f,c,y,23,a[39]),c=l(c,d,e,f,B,4,a[40]),f=l(f,c,d,e,h,11,a[41]),e=l(e,f,c,d,q,16,a[42]),d=l(d,e,f,c,t,23,a[43]),c=l(c,d,e,f,x,4,a[44]),f=l(f,c,d,e,A,11,a[45]),e=l(e,f,c,d,D,16,a[46]),d=l(d,e,f,c,j,23,a[47]),c=n(c,d,e,f,h,6,a[48]),f=n(f,c,d,e,u,10,a[49]),e=n(e,f,c,d,
C,15,a[50]),d=n(d,e,f,c,s,21,a[51]),c=n(c,d,e,f,A,6,a[52]),f=n(f,c,d,e,q,10,a[53]),e=n(e,f,c,d,y,15,a[54]),d=n(d,e,f,c,w,21,a[55]),c=n(c,d,e,f,v,6,a[56]),f=n(f,c,d,e,D,10,a[57]),e=n(e,f,c,d,t,15,a[58]),d=n(d,e,f,c,B,21,a[59]),c=n(c,d,e,f,r,6,a[60]),f=n(f,c,d,e,z,10,a[61]),e=n(e,f,c,d,j,15,a[62]),d=n(d,e,f,c,x,21,a[63]);b[0]=b[0]+c|0;b[1]=b[1]+d|0;b[2]=b[2]+e|0;b[3]=b[3]+f|0},_doFinalize:function(){var a=this._data,k=a.words,b=8*this._nDataBytes,h=8*a.sigBytes;k[h>>>5]|=128<<24-h%32;var l=s.floor(b/
4294967296);k[(h+64>>>9<<4)+15]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360;k[(h+64>>>9<<4)+14]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360;a.sigBytes=4*(k.length+1);this._process();a=this._hash;k=a.words;for(b=0;4>b;b++)h=k[b],k[b]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360;return a},clone:function(){var a=t.clone.call(this);a._hash=this._hash.clone();return a}});r.MD5=t._createHelper(q);r.HmacMD5=t._createHmacHelper(q)})(Math);

define("md5", function(){});

/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
var CryptoJS=CryptoJS||function(e,m){var p={},j=p.lib={},l=function(){},f=j.Base={extend:function(a){l.prototype=this;var c=new l;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
n=j.WordArray=f.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=m?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var c=this.words,q=a.words,d=this.sigBytes;a=a.sigBytes;this.clamp();if(d%4)for(var b=0;b<a;b++)c[d+b>>>2]|=(q[b>>>2]>>>24-8*(b%4)&255)<<24-8*((d+b)%4);else if(65535<q.length)for(b=0;b<a;b+=4)c[d+b>>>2]=q[b>>>2];else c.push.apply(c,q);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<
32-8*(c%4);a.length=e.ceil(c/4)},clone:function(){var a=f.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*e.random()|0);return new n.init(c,a)}}),b=p.enc={},h=b.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++){var f=c[d>>>2]>>>24-8*(d%4)&255;b.push((f>>>4).toString(16));b.push((f&15).toString(16))}return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d+=2)b[d>>>3]|=parseInt(a.substr(d,
2),16)<<24-4*(d%8);return new n.init(b,c/2)}},g=b.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++)b.push(String.fromCharCode(c[d>>>2]>>>24-8*(d%4)&255));return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d++)b[d>>>2]|=(a.charCodeAt(d)&255)<<24-8*(d%4);return new n.init(b,c)}},r=b.Utf8={stringify:function(a){try{return decodeURIComponent(escape(g.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return g.parse(unescape(encodeURIComponent(a)))}},
k=j.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new n.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=r.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,b=c.words,d=c.sigBytes,f=this.blockSize,h=d/(4*f),h=a?e.ceil(h):e.max((h|0)-this._minBufferSize,0);a=h*f;d=e.min(4*a,d);if(a){for(var g=0;g<a;g+=f)this._doProcessBlock(b,g);g=b.splice(0,a);c.sigBytes-=d}return new n.init(g,d)},clone:function(){var a=f.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});j.Hasher=k.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){k.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,b){return(new a.init(b)).finalize(c)}},_createHmacHelper:function(a){return function(b,f){return(new s.HMAC.init(a,
f)).finalize(b)}}});var s=p.algo={};return p}(Math);
(function(){var e=CryptoJS,m=e.lib,p=m.WordArray,j=m.Hasher,l=[],m=e.algo.SHA1=j.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(f,n){for(var b=this._hash.words,h=b[0],g=b[1],e=b[2],k=b[3],j=b[4],a=0;80>a;a++){if(16>a)l[a]=f[n+a]|0;else{var c=l[a-3]^l[a-8]^l[a-14]^l[a-16];l[a]=c<<1|c>>>31}c=(h<<5|h>>>27)+j+l[a];c=20>a?c+((g&e|~g&k)+1518500249):40>a?c+((g^e^k)+1859775393):60>a?c+((g&e|g&k|e&k)-1894007588):c+((g^e^
k)-899497514);j=k;k=e;e=g<<30|g>>>2;g=h;h=c}b[0]=b[0]+h|0;b[1]=b[1]+g|0;b[2]=b[2]+e|0;b[3]=b[3]+k|0;b[4]=b[4]+j|0},_doFinalize:function(){var f=this._data,e=f.words,b=8*this._nDataBytes,h=8*f.sigBytes;e[h>>>5]|=128<<24-h%32;e[(h+64>>>9<<4)+14]=Math.floor(b/4294967296);e[(h+64>>>9<<4)+15]=b;f.sigBytes=4*e.length;this._process();return this._hash},clone:function(){var e=j.clone.call(this);e._hash=this._hash.clone();return e}});e.SHA1=j._createHelper(m);e.HmacSHA1=j._createHmacHelper(m)})();

define("sha1", function(){});

// vim:ts=4:sts=4:sw=4:
/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

(function (definition) {
    "use strict";

    // This file will function properly as a <script> tag, or a module
    // using CommonJS and NodeJS or RequireJS module formats.  In
    // Common/Node/RequireJS, the module exports the Q API and when
    // executed as a simple <script>, it creates a Q global instead.

    // Montage Require
    if (typeof bootstrap === "function") {
        bootstrap("promise", definition);

    // CommonJS
    } else if (typeof exports === "object" && typeof module === "object") {
        module.exports = definition();

    // RequireJS
    } else if (typeof define === "function" && define.amd) {
        define('Q',definition);

    // SES (Secure EcmaScript)
    } else if (typeof ses !== "undefined") {
        if (!ses.ok()) {
            return;
        } else {
            ses.makeQ = definition;
        }

    // <script>
    } else if (typeof self !== "undefined") {
        self.Q = definition();

    } else {
        throw new Error("This environment was not anticiapted by Q. Please file a bug.");
    }

})(function () {
"use strict";

var hasStacks = false;
try {
    throw new Error();
} catch (e) {
    hasStacks = !!e.stack;
}

// All code after this point will be filtered from stack traces reported
// by Q.
var qStartingLine = captureLine();
var qFileName;

// shims

// used for fallback in "allResolved"
var noop = function () {};

// Use the fastest possible means to execute a task in a future turn
// of the event loop.
var nextTick =(function () {
    // linked list of tasks (single, with head node)
    var head = {task: void 0, next: null};
    var tail = head;
    var flushing = false;
    var requestTick = void 0;
    var isNodeJS = false;

    function flush() {
        /* jshint loopfunc: true */

        while (head.next) {
            head = head.next;
            var task = head.task;
            head.task = void 0;
            var domain = head.domain;

            if (domain) {
                head.domain = void 0;
                domain.enter();
            }

            try {
                task();

            } catch (e) {
                if (isNodeJS) {
                    // In node, uncaught exceptions are considered fatal errors.
                    // Re-throw them synchronously to interrupt flushing!

                    // Ensure continuation if the uncaught exception is suppressed
                    // listening "uncaughtException" events (as domains does).
                    // Continue in next event to avoid tick recursion.
                    if (domain) {
                        domain.exit();
                    }
                    setTimeout(flush, 0);
                    if (domain) {
                        domain.enter();
                    }

                    throw e;

                } else {
                    // In browsers, uncaught exceptions are not fatal.
                    // Re-throw them asynchronously to avoid slow-downs.
                    setTimeout(function() {
                       throw e;
                    }, 0);
                }
            }

            if (domain) {
                domain.exit();
            }
        }

        flushing = false;
    }

    nextTick = function (task) {
        tail = tail.next = {
            task: task,
            domain: isNodeJS && process.domain,
            next: null
        };

        if (!flushing) {
            flushing = true;
            requestTick();
        }
    };

    if (typeof process !== "undefined" && process.nextTick) {
        // Node.js before 0.9. Note that some fake-Node environments, like the
        // Mocha test runner, introduce a `process` global without a `nextTick`.
        isNodeJS = true;

        requestTick = function () {
            process.nextTick(flush);
        };

    } else if (typeof setImmediate === "function") {
        // In IE10, Node.js 0.9+, or https://github.com/NobleJS/setImmediate
        if (typeof window !== "undefined") {
            requestTick = setImmediate.bind(window, flush);
        } else {
            requestTick = function () {
                setImmediate(flush);
            };
        }

    } else if (typeof MessageChannel !== "undefined") {
        // modern browsers
        // http://www.nonblocking.io/2011/06/windownexttick.html
        var channel = new MessageChannel();
        // At least Safari Version 6.0.5 (8536.30.1) intermittently cannot create
        // working message ports the first time a page loads.
        channel.port1.onmessage = function () {
            requestTick = requestPortTick;
            channel.port1.onmessage = flush;
            flush();
        };
        var requestPortTick = function () {
            // Opera requires us to provide a message payload, regardless of
            // whether we use it.
            channel.port2.postMessage(0);
        };
        requestTick = function () {
            setTimeout(flush, 0);
            requestPortTick();
        };

    } else {
        // old browsers
        requestTick = function () {
            setTimeout(flush, 0);
        };
    }

    return nextTick;
})();

// Attempt to make generics safe in the face of downstream
// modifications.
// There is no situation where this is necessary.
// If you need a security guarantee, these primordials need to be
// deeply frozen anyway, and if you dont need a security guarantee,
// this is just plain paranoid.
// However, this **might** have the nice side-effect of reducing the size of
// the minified code by reducing x.call() to merely x()
// See Mark Millers explanation of what this does.
// http://wiki.ecmascript.org/doku.php?id=conventions:safe_meta_programming
var call = Function.call;
function uncurryThis(f) {
    return function () {
        return call.apply(f, arguments);
    };
}
// This is equivalent, but slower:
// uncurryThis = Function_bind.bind(Function_bind.call);
// http://jsperf.com/uncurrythis

var array_slice = uncurryThis(Array.prototype.slice);

var array_reduce = uncurryThis(
    Array.prototype.reduce || function (callback, basis) {
        var index = 0,
            length = this.length;
        // concerning the initial value, if one is not provided
        if (arguments.length === 1) {
            // seek to the first value in the array, accounting
            // for the possibility that is is a sparse array
            do {
                if (index in this) {
                    basis = this[index++];
                    break;
                }
                if (++index >= length) {
                    throw new TypeError();
                }
            } while (1);
        }
        // reduce
        for (; index < length; index++) {
            // account for the possibility that the array is sparse
            if (index in this) {
                basis = callback(basis, this[index], index);
            }
        }
        return basis;
    }
);

var array_indexOf = uncurryThis(
    Array.prototype.indexOf || function (value) {
        // not a very good shim, but good enough for our one use of it
        for (var i = 0; i < this.length; i++) {
            if (this[i] === value) {
                return i;
            }
        }
        return -1;
    }
);

var array_map = uncurryThis(
    Array.prototype.map || function (callback, thisp) {
        var self = this;
        var collect = [];
        array_reduce(self, function (undefined, value, index) {
            collect.push(callback.call(thisp, value, index, self));
        }, void 0);
        return collect;
    }
);

var object_create = Object.create || function (prototype) {
    function Type() { }
    Type.prototype = prototype;
    return new Type();
};

var object_hasOwnProperty = uncurryThis(Object.prototype.hasOwnProperty);

var object_keys = Object.keys || function (object) {
    var keys = [];
    for (var key in object) {
        if (object_hasOwnProperty(object, key)) {
            keys.push(key);
        }
    }
    return keys;
};

var object_toString = uncurryThis(Object.prototype.toString);

function isObject(value) {
    return value === Object(value);
}

// generator related shims

// FIXME: Remove this function once ES6 generators are in SpiderMonkey.
function isStopIteration(exception) {
    return (
        object_toString(exception) === "[object StopIteration]" ||
        exception instanceof QReturnValue
    );
}

// FIXME: Remove this helper and Q.return once ES6 generators are in
// SpiderMonkey.
var QReturnValue;
if (typeof ReturnValue !== "undefined") {
    QReturnValue = ReturnValue;
} else {
    QReturnValue = function (value) {
        this.value = value;
    };
}

// long stack traces

var STACK_JUMP_SEPARATOR = "From previous event:";

function makeStackTraceLong(error, promise) {
    // If possible, transform the error stack trace by removing Node and Q
    // cruft, then concatenating with the stack trace of `promise`. See #57.
    if (hasStacks &&
        promise.stack &&
        typeof error === "object" &&
        error !== null &&
        error.stack &&
        error.stack.indexOf(STACK_JUMP_SEPARATOR) === -1
    ) {
        var stacks = [];
        for (var p = promise; !!p; p = p.source) {
            if (p.stack) {
                stacks.unshift(p.stack);
            }
        }
        stacks.unshift(error.stack);

        var concatedStacks = stacks.join("\n" + STACK_JUMP_SEPARATOR + "\n");
        error.stack = filterStackString(concatedStacks);
    }
}

function filterStackString(stackString) {
    var lines = stackString.split("\n");
    var desiredLines = [];
    for (var i = 0; i < lines.length; ++i) {
        var line = lines[i];

        if (!isInternalFrame(line) && !isNodeFrame(line) && line) {
            desiredLines.push(line);
        }
    }
    return desiredLines.join("\n");
}

function isNodeFrame(stackLine) {
    return stackLine.indexOf("(module.js:") !== -1 ||
           stackLine.indexOf("(node.js:") !== -1;
}

function getFileNameAndLineNumber(stackLine) {
    // Named functions: "at functionName (filename:lineNumber:columnNumber)"
    // In IE10 function name can have spaces ("Anonymous function") O_o
    var attempt1 = /at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);
    if (attempt1) {
        return [attempt1[1], Number(attempt1[2])];
    }

    // Anonymous functions: "at filename:lineNumber:columnNumber"
    var attempt2 = /at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);
    if (attempt2) {
        return [attempt2[1], Number(attempt2[2])];
    }

    // Firefox style: "function@filename:lineNumber or @filename:lineNumber"
    var attempt3 = /.*@(.+):(\d+)$/.exec(stackLine);
    if (attempt3) {
        return [attempt3[1], Number(attempt3[2])];
    }
}

function isInternalFrame(stackLine) {
    var fileNameAndLineNumber = getFileNameAndLineNumber(stackLine);

    if (!fileNameAndLineNumber) {
        return false;
    }

    var fileName = fileNameAndLineNumber[0];
    var lineNumber = fileNameAndLineNumber[1];

    return fileName === qFileName &&
        lineNumber >= qStartingLine &&
        lineNumber <= qEndingLine;
}

// discover own file name and line number range for filtering stack
// traces
function captureLine() {
    if (!hasStacks) {
        return;
    }

    try {
        throw new Error();
    } catch (e) {
        var lines = e.stack.split("\n");
        var firstLine = lines[0].indexOf("@") > 0 ? lines[1] : lines[2];
        var fileNameAndLineNumber = getFileNameAndLineNumber(firstLine);
        if (!fileNameAndLineNumber) {
            return;
        }

        qFileName = fileNameAndLineNumber[0];
        return fileNameAndLineNumber[1];
    }
}

function deprecate(callback, name, alternative) {
    return function () {
        if (typeof console !== "undefined" &&
            typeof console.warn === "function") {
            console.warn(name + " is deprecated, use " + alternative +
                         " instead.", new Error("").stack);
        }
        return callback.apply(callback, arguments);
    };
}

// end of shims
// beginning of real work

/**
 * Constructs a promise for an immediate reference, passes promises through, or
 * coerces promises from different systems.
 * @param value immediate reference or promise
 */
function Q(value) {
    // If the object is already a Promise, return it directly.  This enables
    // the resolve function to both be used to created references from objects,
    // but to tolerably coerce non-promises to promises.
    if (value instanceof Promise) {
        return value;
    }

    // assimilate thenables
    if (isPromiseAlike(value)) {
        return coerce(value);
    } else {
        return fulfill(value);
    }
}
Q.resolve = Q;

/**
 * Performs a task in a future turn of the event loop.
 * @param {Function} task
 */
Q.nextTick = nextTick;

/**
 * Controls whether or not long stack traces will be on
 */
Q.longStackSupport = false;

// enable long stacks if Q_DEBUG is set
if (typeof process === "object" && process && process.env && process.env.Q_DEBUG) {
    Q.longStackSupport = true;
}

/**
 * Constructs a {promise, resolve, reject} object.
 *
 * `resolve` is a callback to invoke with a more resolved value for the
 * promise. To fulfill the promise, invoke `resolve` with any value that is
 * not a thenable. To reject the promise, invoke `resolve` with a rejected
 * thenable, or invoke `reject` with the reason directly. To resolve the
 * promise to another thenable, thus putting it in the same state, invoke
 * `resolve` with that other thenable.
 */
Q.defer = defer;
function defer() {
    // if "messages" is an "Array", that indicates that the promise has not yet
    // been resolved.  If it is "undefined", it has been resolved.  Each
    // element of the messages array is itself an array of complete arguments to
    // forward to the resolved promise.  We coerce the resolution value to a
    // promise using the `resolve` function because it handles both fully
    // non-thenable values and other thenables gracefully.
    var messages = [], progressListeners = [], resolvedPromise;

    var deferred = object_create(defer.prototype);
    var promise = object_create(Promise.prototype);

    promise.promiseDispatch = function (resolve, op, operands) {
        var args = array_slice(arguments);
        if (messages) {
            messages.push(args);
            if (op === "when" && operands[1]) { // progress operand
                progressListeners.push(operands[1]);
            }
        } else {
            Q.nextTick(function () {
                resolvedPromise.promiseDispatch.apply(resolvedPromise, args);
            });
        }
    };

    // XXX deprecated
    promise.valueOf = function () {
        if (messages) {
            return promise;
        }
        var nearerValue = nearer(resolvedPromise);
        if (isPromise(nearerValue)) {
            resolvedPromise = nearerValue; // shorten chain
        }
        return nearerValue;
    };

    promise.inspect = function () {
        if (!resolvedPromise) {
            return { state: "pending" };
        }
        return resolvedPromise.inspect();
    };

    if (Q.longStackSupport && hasStacks) {
        try {
            throw new Error();
        } catch (e) {
            // NOTE: don't try to use `Error.captureStackTrace` or transfer the
            // accessor around; that causes memory leaks as per GH-111. Just
            // reify the stack trace as a string ASAP.
            //
            // At the same time, cut off the first line; it's always just
            // "[object Promise]\n", as per the `toString`.
            promise.stack = e.stack.substring(e.stack.indexOf("\n") + 1);
        }
    }

    // NOTE: we do the checks for `resolvedPromise` in each method, instead of
    // consolidating them into `become`, since otherwise we'd create new
    // promises with the lines `become(whatever(value))`. See e.g. GH-252.

    function become(newPromise) {
        resolvedPromise = newPromise;
        promise.source = newPromise;

        array_reduce(messages, function (undefined, message) {
            Q.nextTick(function () {
                newPromise.promiseDispatch.apply(newPromise, message);
            });
        }, void 0);

        messages = void 0;
        progressListeners = void 0;
    }

    deferred.promise = promise;
    deferred.resolve = function (value) {
        if (resolvedPromise) {
            return;
        }

        become(Q(value));
    };

    deferred.fulfill = function (value) {
        if (resolvedPromise) {
            return;
        }

        become(fulfill(value));
    };
    deferred.reject = function (reason) {
        if (resolvedPromise) {
            return;
        }

        become(reject(reason));
    };
    deferred.notify = function (progress) {
        if (resolvedPromise) {
            return;
        }

        array_reduce(progressListeners, function (undefined, progressListener) {
            Q.nextTick(function () {
                progressListener(progress);
            });
        }, void 0);
    };

    return deferred;
}

/**
 * Creates a Node-style callback that will resolve or reject the deferred
 * promise.
 * @returns a nodeback
 */
defer.prototype.makeNodeResolver = function () {
    var self = this;
    return function (error, value) {
        if (error) {
            self.reject(error);
        } else if (arguments.length > 2) {
            self.resolve(array_slice(arguments, 1));
        } else {
            self.resolve(value);
        }
    };
};

/**
 * @param resolver {Function} a function that returns nothing and accepts
 * the resolve, reject, and notify functions for a deferred.
 * @returns a promise that may be resolved with the given resolve and reject
 * functions, or rejected by a thrown exception in resolver
 */
Q.Promise = promise; // ES6
Q.promise = promise;
function promise(resolver) {
    if (typeof resolver !== "function") {
        throw new TypeError("resolver must be a function.");
    }
    var deferred = defer();
    try {
        resolver(deferred.resolve, deferred.reject, deferred.notify);
    } catch (reason) {
        deferred.reject(reason);
    }
    return deferred.promise;
}

promise.race = race; // ES6
promise.all = all; // ES6
promise.reject = reject; // ES6
promise.resolve = Q; // ES6

// XXX experimental.  This method is a way to denote that a local value is
// serializable and should be immediately dispatched to a remote upon request,
// instead of passing a reference.
Q.passByCopy = function (object) {
    //freeze(object);
    //passByCopies.set(object, true);
    return object;
};

Promise.prototype.passByCopy = function () {
    //freeze(object);
    //passByCopies.set(object, true);
    return this;
};

/**
 * If two promises eventually fulfill to the same value, promises that value,
 * but otherwise rejects.
 * @param x {Any*}
 * @param y {Any*}
 * @returns {Any*} a promise for x and y if they are the same, but a rejection
 * otherwise.
 *
 */
Q.join = function (x, y) {
    return Q(x).join(y);
};

Promise.prototype.join = function (that) {
    return Q([this, that]).spread(function (x, y) {
        if (x === y) {
            // TODO: "===" should be Object.is or equiv
            return x;
        } else {
            throw new Error("Can't join: not the same: " + x + " " + y);
        }
    });
};

/**
 * Returns a promise for the first of an array of promises to become settled.
 * @param answers {Array[Any*]} promises to race
 * @returns {Any*} the first promise to be settled
 */
Q.race = race;
function race(answerPs) {
    return promise(function(resolve, reject) {
        // Switch to this once we can assume at least ES5
        // answerPs.forEach(function(answerP) {
        //     Q(answerP).then(resolve, reject);
        // });
        // Use this in the meantime
        for (var i = 0, len = answerPs.length; i < len; i++) {
            Q(answerPs[i]).then(resolve, reject);
        }
    });
}

Promise.prototype.race = function () {
    return this.then(Q.race);
};

/**
 * Constructs a Promise with a promise descriptor object and optional fallback
 * function.  The descriptor contains methods like when(rejected), get(name),
 * set(name, value), post(name, args), and delete(name), which all
 * return either a value, a promise for a value, or a rejection.  The fallback
 * accepts the operation name, a resolver, and any further arguments that would
 * have been forwarded to the appropriate method above had a method been
 * provided with the proper name.  The API makes no guarantees about the nature
 * of the returned object, apart from that it is usable whereever promises are
 * bought and sold.
 */
Q.makePromise = Promise;
function Promise(descriptor, fallback, inspect) {
    if (fallback === void 0) {
        fallback = function (op) {
            return reject(new Error(
                "Promise does not support operation: " + op
            ));
        };
    }
    if (inspect === void 0) {
        inspect = function () {
            return {state: "unknown"};
        };
    }

    var promise = object_create(Promise.prototype);

    promise.promiseDispatch = function (resolve, op, args) {
        var result;
        try {
            if (descriptor[op]) {
                result = descriptor[op].apply(promise, args);
            } else {
                result = fallback.call(promise, op, args);
            }
        } catch (exception) {
            result = reject(exception);
        }
        if (resolve) {
            resolve(result);
        }
    };

    promise.inspect = inspect;

    // XXX deprecated `valueOf` and `exception` support
    if (inspect) {
        var inspected = inspect();
        if (inspected.state === "rejected") {
            promise.exception = inspected.reason;
        }

        promise.valueOf = function () {
            var inspected = inspect();
            if (inspected.state === "pending" ||
                inspected.state === "rejected") {
                return promise;
            }
            return inspected.value;
        };
    }

    return promise;
}

Promise.prototype.toString = function () {
    return "[object Promise]";
};

Promise.prototype.then = function (fulfilled, rejected, progressed) {
    var self = this;
    var deferred = defer();
    var done = false;   // ensure the untrusted promise makes at most a
                        // single call to one of the callbacks

    function _fulfilled(value) {
        try {
            return typeof fulfilled === "function" ? fulfilled(value) : value;
        } catch (exception) {
            return reject(exception);
        }
    }

    function _rejected(exception) {
        if (typeof rejected === "function") {
            makeStackTraceLong(exception, self);
            try {
                return rejected(exception);
            } catch (newException) {
                return reject(newException);
            }
        }
        return reject(exception);
    }

    function _progressed(value) {
        return typeof progressed === "function" ? progressed(value) : value;
    }

    Q.nextTick(function () {
        self.promiseDispatch(function (value) {
            if (done) {
                return;
            }
            done = true;

            deferred.resolve(_fulfilled(value));
        }, "when", [function (exception) {
            if (done) {
                return;
            }
            done = true;

            deferred.resolve(_rejected(exception));
        }]);
    });

    // Progress propagator need to be attached in the current tick.
    self.promiseDispatch(void 0, "when", [void 0, function (value) {
        var newValue;
        var threw = false;
        try {
            newValue = _progressed(value);
        } catch (e) {
            threw = true;
            if (Q.onerror) {
                Q.onerror(e);
            } else {
                throw e;
            }
        }

        if (!threw) {
            deferred.notify(newValue);
        }
    }]);

    return deferred.promise;
};

Q.tap = function (promise, callback) {
    return Q(promise).tap(callback);
};

/**
 * Works almost like "finally", but not called for rejections.
 * Original resolution value is passed through callback unaffected.
 * Callback may return a promise that will be awaited for.
 * @param {Function} callback
 * @returns {Q.Promise}
 * @example
 * doSomething()
 *   .then(...)
 *   .tap(console.log)
 *   .then(...);
 */
Promise.prototype.tap = function (callback) {
    callback = Q(callback);

    return this.then(function (value) {
        return callback.fcall(value).thenResolve(value);
    });
};

/**
 * Registers an observer on a promise.
 *
 * Guarantees:
 *
 * 1. that fulfilled and rejected will be called only once.
 * 2. that either the fulfilled callback or the rejected callback will be
 *    called, but not both.
 * 3. that fulfilled and rejected will not be called in this turn.
 *
 * @param value      promise or immediate reference to observe
 * @param fulfilled  function to be called with the fulfilled value
 * @param rejected   function to be called with the rejection exception
 * @param progressed function to be called on any progress notifications
 * @return promise for the return value from the invoked callback
 */
Q.when = when;
function when(value, fulfilled, rejected, progressed) {
    return Q(value).then(fulfilled, rejected, progressed);
}

Promise.prototype.thenResolve = function (value) {
    return this.then(function () { return value; });
};

Q.thenResolve = function (promise, value) {
    return Q(promise).thenResolve(value);
};

Promise.prototype.thenReject = function (reason) {
    return this.then(function () { throw reason; });
};

Q.thenReject = function (promise, reason) {
    return Q(promise).thenReject(reason);
};

/**
 * If an object is not a promise, it is as "near" as possible.
 * If a promise is rejected, it is as "near" as possible too.
 * If its a fulfilled promise, the fulfillment value is nearer.
 * If its a deferred promise and the deferred has been resolved, the
 * resolution is "nearer".
 * @param object
 * @returns most resolved (nearest) form of the object
 */

// XXX should we re-do this?
Q.nearer = nearer;
function nearer(value) {
    if (isPromise(value)) {
        var inspected = value.inspect();
        if (inspected.state === "fulfilled") {
            return inspected.value;
        }
    }
    return value;
}

/**
 * @returns whether the given object is a promise.
 * Otherwise it is a fulfilled value.
 */
Q.isPromise = isPromise;
function isPromise(object) {
    return object instanceof Promise;
}

Q.isPromiseAlike = isPromiseAlike;
function isPromiseAlike(object) {
    return isObject(object) && typeof object.then === "function";
}

/**
 * @returns whether the given object is a pending promise, meaning not
 * fulfilled or rejected.
 */
Q.isPending = isPending;
function isPending(object) {
    return isPromise(object) && object.inspect().state === "pending";
}

Promise.prototype.isPending = function () {
    return this.inspect().state === "pending";
};

/**
 * @returns whether the given object is a value or fulfilled
 * promise.
 */
Q.isFulfilled = isFulfilled;
function isFulfilled(object) {
    return !isPromise(object) || object.inspect().state === "fulfilled";
}

Promise.prototype.isFulfilled = function () {
    return this.inspect().state === "fulfilled";
};

/**
 * @returns whether the given object is a rejected promise.
 */
Q.isRejected = isRejected;
function isRejected(object) {
    return isPromise(object) && object.inspect().state === "rejected";
}

Promise.prototype.isRejected = function () {
    return this.inspect().state === "rejected";
};

//// BEGIN UNHANDLED REJECTION TRACKING

// This promise library consumes exceptions thrown in handlers so they can be
// handled by a subsequent promise.  The exceptions get added to this array when
// they are created, and removed when they are handled.  Note that in ES6 or
// shimmed environments, this would naturally be a `Set`.
var unhandledReasons = [];
var unhandledRejections = [];
var trackUnhandledRejections = true;

function resetUnhandledRejections() {
    unhandledReasons.length = 0;
    unhandledRejections.length = 0;

    if (!trackUnhandledRejections) {
        trackUnhandledRejections = true;
    }
}

function trackRejection(promise, reason) {
    if (!trackUnhandledRejections) {
        return;
    }

    unhandledRejections.push(promise);
    if (reason && typeof reason.stack !== "undefined") {
        unhandledReasons.push(reason.stack);
    } else {
        unhandledReasons.push("(no stack) " + reason);
    }
}

function untrackRejection(promise) {
    if (!trackUnhandledRejections) {
        return;
    }

    var at = array_indexOf(unhandledRejections, promise);
    if (at !== -1) {
        unhandledRejections.splice(at, 1);
        unhandledReasons.splice(at, 1);
    }
}

Q.resetUnhandledRejections = resetUnhandledRejections;

Q.getUnhandledReasons = function () {
    // Make a copy so that consumers can't interfere with our internal state.
    return unhandledReasons.slice();
};

Q.stopUnhandledRejectionTracking = function () {
    resetUnhandledRejections();
    trackUnhandledRejections = false;
};

resetUnhandledRejections();

//// END UNHANDLED REJECTION TRACKING

/**
 * Constructs a rejected promise.
 * @param reason value describing the failure
 */
Q.reject = reject;
function reject(reason) {
    var rejection = Promise({
        "when": function (rejected) {
            // note that the error has been handled
            if (rejected) {
                untrackRejection(this);
            }
            return rejected ? rejected(reason) : this;
        }
    }, function fallback() {
        return this;
    }, function inspect() {
        return { state: "rejected", reason: reason };
    });

    // Note that the reason has not been handled.
    trackRejection(rejection, reason);

    return rejection;
}

/**
 * Constructs a fulfilled promise for an immediate reference.
 * @param value immediate reference
 */
Q.fulfill = fulfill;
function fulfill(value) {
    return Promise({
        "when": function () {
            return value;
        },
        "get": function (name) {
            return value[name];
        },
        "set": function (name, rhs) {
            value[name] = rhs;
        },
        "delete": function (name) {
            delete value[name];
        },
        "post": function (name, args) {
            // Mark Miller proposes that post with no name should apply a
            // promised function.
            if (name === null || name === void 0) {
                return value.apply(void 0, args);
            } else {
                return value[name].apply(value, args);
            }
        },
        "apply": function (thisp, args) {
            return value.apply(thisp, args);
        },
        "keys": function () {
            return object_keys(value);
        }
    }, void 0, function inspect() {
        return { state: "fulfilled", value: value };
    });
}

/**
 * Converts thenables to Q promises.
 * @param promise thenable promise
 * @returns a Q promise
 */
function coerce(promise) {
    var deferred = defer();
    Q.nextTick(function () {
        try {
            promise.then(deferred.resolve, deferred.reject, deferred.notify);
        } catch (exception) {
            deferred.reject(exception);
        }
    });
    return deferred.promise;
}

/**
 * Annotates an object such that it will never be
 * transferred away from this process over any promise
 * communication channel.
 * @param object
 * @returns promise a wrapping of that object that
 * additionally responds to the "isDef" message
 * without a rejection.
 */
Q.master = master;
function master(object) {
    return Promise({
        "isDef": function () {}
    }, function fallback(op, args) {
        return dispatch(object, op, args);
    }, function () {
        return Q(object).inspect();
    });
}

/**
 * Spreads the values of a promised array of arguments into the
 * fulfillment callback.
 * @param fulfilled callback that receives variadic arguments from the
 * promised array
 * @param rejected callback that receives the exception if the promise
 * is rejected.
 * @returns a promise for the return value or thrown exception of
 * either callback.
 */
Q.spread = spread;
function spread(value, fulfilled, rejected) {
    return Q(value).spread(fulfilled, rejected);
}

Promise.prototype.spread = function (fulfilled, rejected) {
    return this.all().then(function (array) {
        return fulfilled.apply(void 0, array);
    }, rejected);
};

/**
 * The async function is a decorator for generator functions, turning
 * them into asynchronous generators.  Although generators are only part
 * of the newest ECMAScript 6 drafts, this code does not cause syntax
 * errors in older engines.  This code should continue to work and will
 * in fact improve over time as the language improves.
 *
 * ES6 generators are currently part of V8 version 3.19 with the
 * --harmony-generators runtime flag enabled.  SpiderMonkey has had them
 * for longer, but under an older Python-inspired form.  This function
 * works on both kinds of generators.
 *
 * Decorates a generator function such that:
 *  - it may yield promises
 *  - execution will continue when that promise is fulfilled
 *  - the value of the yield expression will be the fulfilled value
 *  - it returns a promise for the return value (when the generator
 *    stops iterating)
 *  - the decorated function returns a promise for the return value
 *    of the generator or the first rejected promise among those
 *    yielded.
 *  - if an error is thrown in the generator, it propagates through
 *    every following yield until it is caught, or until it escapes
 *    the generator function altogether, and is translated into a
 *    rejection for the promise returned by the decorated generator.
 */
Q.async = async;
function async(makeGenerator) {
    return function () {
        // when verb is "send", arg is a value
        // when verb is "throw", arg is an exception
        function continuer(verb, arg) {
            var result;

            // Until V8 3.19 / Chromium 29 is released, SpiderMonkey is the only
            // engine that has a deployed base of browsers that support generators.
            // However, SM's generators use the Python-inspired semantics of
            // outdated ES6 drafts.  We would like to support ES6, but we'd also
            // like to make it possible to use generators in deployed browsers, so
            // we also support Python-style generators.  At some point we can remove
            // this block.

            if (typeof StopIteration === "undefined") {
                // ES6 Generators
                try {
                    result = generator[verb](arg);
                } catch (exception) {
                    return reject(exception);
                }
                if (result.done) {
                    return Q(result.value);
                } else {
                    return when(result.value, callback, errback);
                }
            } else {
                // SpiderMonkey Generators
                // FIXME: Remove this case when SM does ES6 generators.
                try {
                    result = generator[verb](arg);
                } catch (exception) {
                    if (isStopIteration(exception)) {
                        return Q(exception.value);
                    } else {
                        return reject(exception);
                    }
                }
                return when(result, callback, errback);
            }
        }
        var generator = makeGenerator.apply(this, arguments);
        var callback = continuer.bind(continuer, "next");
        var errback = continuer.bind(continuer, "throw");
        return callback();
    };
}

/**
 * The spawn function is a small wrapper around async that immediately
 * calls the generator and also ends the promise chain, so that any
 * unhandled errors are thrown instead of forwarded to the error
 * handler. This is useful because it's extremely common to run
 * generators at the top-level to work with libraries.
 */
Q.spawn = spawn;
function spawn(makeGenerator) {
    Q.done(Q.async(makeGenerator)());
}

// FIXME: Remove this interface once ES6 generators are in SpiderMonkey.
/**
 * Throws a ReturnValue exception to stop an asynchronous generator.
 *
 * This interface is a stop-gap measure to support generator return
 * values in older Firefox/SpiderMonkey.  In browsers that support ES6
 * generators like Chromium 29, just use "return" in your generator
 * functions.
 *
 * @param value the return value for the surrounding generator
 * @throws ReturnValue exception with the value.
 * @example
 * // ES6 style
 * Q.async(function* () {
 *      var foo = yield getFooPromise();
 *      var bar = yield getBarPromise();
 *      return foo + bar;
 * })
 * // Older SpiderMonkey style
 * Q.async(function () {
 *      var foo = yield getFooPromise();
 *      var bar = yield getBarPromise();
 *      Q.return(foo + bar);
 * })
 */
Q["return"] = _return;
function _return(value) {
    throw new QReturnValue(value);
}

/**
 * The promised function decorator ensures that any promise arguments
 * are settled and passed as values (`this` is also settled and passed
 * as a value).  It will also ensure that the result of a function is
 * always a promise.
 *
 * @example
 * var add = Q.promised(function (a, b) {
 *     return a + b;
 * });
 * add(Q(a), Q(B));
 *
 * @param {function} callback The function to decorate
 * @returns {function} a function that has been decorated.
 */
Q.promised = promised;
function promised(callback) {
    return function () {
        return spread([this, all(arguments)], function (self, args) {
            return callback.apply(self, args);
        });
    };
}

/**
 * sends a message to a value in a future turn
 * @param object* the recipient
 * @param op the name of the message operation, e.g., "when",
 * @param args further arguments to be forwarded to the operation
 * @returns result {Promise} a promise for the result of the operation
 */
Q.dispatch = dispatch;
function dispatch(object, op, args) {
    return Q(object).dispatch(op, args);
}

Promise.prototype.dispatch = function (op, args) {
    var self = this;
    var deferred = defer();
    Q.nextTick(function () {
        self.promiseDispatch(deferred.resolve, op, args);
    });
    return deferred.promise;
};

/**
 * Gets the value of a property in a future turn.
 * @param object    promise or immediate reference for target object
 * @param name      name of property to get
 * @return promise for the property value
 */
Q.get = function (object, key) {
    return Q(object).dispatch("get", [key]);
};

Promise.prototype.get = function (key) {
    return this.dispatch("get", [key]);
};

/**
 * Sets the value of a property in a future turn.
 * @param object    promise or immediate reference for object object
 * @param name      name of property to set
 * @param value     new value of property
 * @return promise for the return value
 */
Q.set = function (object, key, value) {
    return Q(object).dispatch("set", [key, value]);
};

Promise.prototype.set = function (key, value) {
    return this.dispatch("set", [key, value]);
};

/**
 * Deletes a property in a future turn.
 * @param object    promise or immediate reference for target object
 * @param name      name of property to delete
 * @return promise for the return value
 */
Q.del = // XXX legacy
Q["delete"] = function (object, key) {
    return Q(object).dispatch("delete", [key]);
};

Promise.prototype.del = // XXX legacy
Promise.prototype["delete"] = function (key) {
    return this.dispatch("delete", [key]);
};

/**
 * Invokes a method in a future turn.
 * @param object    promise or immediate reference for target object
 * @param name      name of method to invoke
 * @param value     a value to post, typically an array of
 *                  invocation arguments for promises that
 *                  are ultimately backed with `resolve` values,
 *                  as opposed to those backed with URLs
 *                  wherein the posted value can be any
 *                  JSON serializable object.
 * @return promise for the return value
 */
// bound locally because it is used by other methods
Q.mapply = // XXX As proposed by "Redsandro"
Q.post = function (object, name, args) {
    return Q(object).dispatch("post", [name, args]);
};

Promise.prototype.mapply = // XXX As proposed by "Redsandro"
Promise.prototype.post = function (name, args) {
    return this.dispatch("post", [name, args]);
};

/**
 * Invokes a method in a future turn.
 * @param object    promise or immediate reference for target object
 * @param name      name of method to invoke
 * @param ...args   array of invocation arguments
 * @return promise for the return value
 */
Q.send = // XXX Mark Miller's proposed parlance
Q.mcall = // XXX As proposed by "Redsandro"
Q.invoke = function (object, name /*...args*/) {
    return Q(object).dispatch("post", [name, array_slice(arguments, 2)]);
};

Promise.prototype.send = // XXX Mark Miller's proposed parlance
Promise.prototype.mcall = // XXX As proposed by "Redsandro"
Promise.prototype.invoke = function (name /*...args*/) {
    return this.dispatch("post", [name, array_slice(arguments, 1)]);
};

/**
 * Applies the promised function in a future turn.
 * @param object    promise or immediate reference for target function
 * @param args      array of application arguments
 */
Q.fapply = function (object, args) {
    return Q(object).dispatch("apply", [void 0, args]);
};

Promise.prototype.fapply = function (args) {
    return this.dispatch("apply", [void 0, args]);
};

/**
 * Calls the promised function in a future turn.
 * @param object    promise or immediate reference for target function
 * @param ...args   array of application arguments
 */
Q["try"] =
Q.fcall = function (object /* ...args*/) {
    return Q(object).dispatch("apply", [void 0, array_slice(arguments, 1)]);
};

Promise.prototype.fcall = function (/*...args*/) {
    return this.dispatch("apply", [void 0, array_slice(arguments)]);
};

/**
 * Binds the promised function, transforming return values into a fulfilled
 * promise and thrown errors into a rejected one.
 * @param object    promise or immediate reference for target function
 * @param ...args   array of application arguments
 */
Q.fbind = function (object /*...args*/) {
    var promise = Q(object);
    var args = array_slice(arguments, 1);
    return function fbound() {
        return promise.dispatch("apply", [
            this,
            args.concat(array_slice(arguments))
        ]);
    };
};
Promise.prototype.fbind = function (/*...args*/) {
    var promise = this;
    var args = array_slice(arguments);
    return function fbound() {
        return promise.dispatch("apply", [
            this,
            args.concat(array_slice(arguments))
        ]);
    };
};

/**
 * Requests the names of the owned properties of a promised
 * object in a future turn.
 * @param object    promise or immediate reference for target object
 * @return promise for the keys of the eventually settled object
 */
Q.keys = function (object) {
    return Q(object).dispatch("keys", []);
};

Promise.prototype.keys = function () {
    return this.dispatch("keys", []);
};

/**
 * Turns an array of promises into a promise for an array.  If any of
 * the promises gets rejected, the whole array is rejected immediately.
 * @param {Array*} an array (or promise for an array) of values (or
 * promises for values)
 * @returns a promise for an array of the corresponding values
 */
// By Mark Miller
// http://wiki.ecmascript.org/doku.php?id=strawman:concurrency&rev=1308776521#allfulfilled
Q.all = all;
function all(promises) {
    return when(promises, function (promises) {
        var countDown = 0;
        var deferred = defer();
        array_reduce(promises, function (undefined, promise, index) {
            var snapshot;
            if (
                isPromise(promise) &&
                (snapshot = promise.inspect()).state === "fulfilled"
            ) {
                promises[index] = snapshot.value;
            } else {
                ++countDown;
                when(
                    promise,
                    function (value) {
                        promises[index] = value;
                        if (--countDown === 0) {
                            deferred.resolve(promises);
                        }
                    },
                    deferred.reject,
                    function (progress) {
                        deferred.notify({ index: index, value: progress });
                    }
                );
            }
        }, void 0);
        if (countDown === 0) {
            deferred.resolve(promises);
        }
        return deferred.promise;
    });
}

Promise.prototype.all = function () {
    return all(this);
};

/**
 * Waits for all promises to be settled, either fulfilled or
 * rejected.  This is distinct from `all` since that would stop
 * waiting at the first rejection.  The promise returned by
 * `allResolved` will never be rejected.
 * @param promises a promise for an array (or an array) of promises
 * (or values)
 * @return a promise for an array of promises
 */
Q.allResolved = deprecate(allResolved, "allResolved", "allSettled");
function allResolved(promises) {
    return when(promises, function (promises) {
        promises = array_map(promises, Q);
        return when(all(array_map(promises, function (promise) {
            return when(promise, noop, noop);
        })), function () {
            return promises;
        });
    });
}

Promise.prototype.allResolved = function () {
    return allResolved(this);
};

/**
 * @see Promise#allSettled
 */
Q.allSettled = allSettled;
function allSettled(promises) {
    return Q(promises).allSettled();
}

/**
 * Turns an array of promises into a promise for an array of their states (as
 * returned by `inspect`) when they have all settled.
 * @param {Array[Any*]} values an array (or promise for an array) of values (or
 * promises for values)
 * @returns {Array[State]} an array of states for the respective values.
 */
Promise.prototype.allSettled = function () {
    return this.then(function (promises) {
        return all(array_map(promises, function (promise) {
            promise = Q(promise);
            function regardless() {
                return promise.inspect();
            }
            return promise.then(regardless, regardless);
        }));
    });
};

/**
 * Captures the failure of a promise, giving an oportunity to recover
 * with a callback.  If the given promise is fulfilled, the returned
 * promise is fulfilled.
 * @param {Any*} promise for something
 * @param {Function} callback to fulfill the returned promise if the
 * given promise is rejected
 * @returns a promise for the return value of the callback
 */
Q.fail = // XXX legacy
Q["catch"] = function (object, rejected) {
    return Q(object).then(void 0, rejected);
};

Promise.prototype.fail = // XXX legacy
Promise.prototype["catch"] = function (rejected) {
    return this.then(void 0, rejected);
};

/**
 * Attaches a listener that can respond to progress notifications from a
 * promise's originating deferred. This listener receives the exact arguments
 * passed to ``deferred.notify``.
 * @param {Any*} promise for something
 * @param {Function} callback to receive any progress notifications
 * @returns the given promise, unchanged
 */
Q.progress = progress;
function progress(object, progressed) {
    return Q(object).then(void 0, void 0, progressed);
}

Promise.prototype.progress = function (progressed) {
    return this.then(void 0, void 0, progressed);
};

/**
 * Provides an opportunity to observe the settling of a promise,
 * regardless of whether the promise is fulfilled or rejected.  Forwards
 * the resolution to the returned promise when the callback is done.
 * The callback can return a promise to defer completion.
 * @param {Any*} promise
 * @param {Function} callback to observe the resolution of the given
 * promise, takes no arguments.
 * @returns a promise for the resolution of the given promise when
 * ``fin`` is done.
 */
Q.fin = // XXX legacy
Q["finally"] = function (object, callback) {
    return Q(object)["finally"](callback);
};

Promise.prototype.fin = // XXX legacy
Promise.prototype["finally"] = function (callback) {
    callback = Q(callback);
    return this.then(function (value) {
        return callback.fcall().then(function () {
            return value;
        });
    }, function (reason) {
        // TODO attempt to recycle the rejection with "this".
        return callback.fcall().then(function () {
            throw reason;
        });
    });
};

/**
 * Terminates a chain of promises, forcing rejections to be
 * thrown as exceptions.
 * @param {Any*} promise at the end of a chain of promises
 * @returns nothing
 */
Q.done = function (object, fulfilled, rejected, progress) {
    return Q(object).done(fulfilled, rejected, progress);
};

Promise.prototype.done = function (fulfilled, rejected, progress) {
    var onUnhandledError = function (error) {
        // forward to a future turn so that ``when``
        // does not catch it and turn it into a rejection.
        Q.nextTick(function () {
            makeStackTraceLong(error, promise);
            if (Q.onerror) {
                Q.onerror(error);
            } else {
                throw error;
            }
        });
    };

    // Avoid unnecessary `nextTick`ing via an unnecessary `when`.
    var promise = fulfilled || rejected || progress ?
        this.then(fulfilled, rejected, progress) :
        this;

    if (typeof process === "object" && process && process.domain) {
        onUnhandledError = process.domain.bind(onUnhandledError);
    }

    promise.then(void 0, onUnhandledError);
};

/**
 * Causes a promise to be rejected if it does not get fulfilled before
 * some milliseconds time out.
 * @param {Any*} promise
 * @param {Number} milliseconds timeout
 * @param {Any*} custom error message or Error object (optional)
 * @returns a promise for the resolution of the given promise if it is
 * fulfilled before the timeout, otherwise rejected.
 */
Q.timeout = function (object, ms, error) {
    return Q(object).timeout(ms, error);
};

Promise.prototype.timeout = function (ms, error) {
    var deferred = defer();
    var timeoutId = setTimeout(function () {
        if (!error || "string" === typeof error) {
            error = new Error(error || "Timed out after " + ms + " ms");
            error.code = "ETIMEDOUT";
        }
        deferred.reject(error);
    }, ms);

    this.then(function (value) {
        clearTimeout(timeoutId);
        deferred.resolve(value);
    }, function (exception) {
        clearTimeout(timeoutId);
        deferred.reject(exception);
    }, deferred.notify);

    return deferred.promise;
};

/**
 * Returns a promise for the given value (or promised value), some
 * milliseconds after it resolved. Passes rejections immediately.
 * @param {Any*} promise
 * @param {Number} milliseconds
 * @returns a promise for the resolution of the given promise after milliseconds
 * time has elapsed since the resolution of the given promise.
 * If the given promise rejects, that is passed immediately.
 */
Q.delay = function (object, timeout) {
    if (timeout === void 0) {
        timeout = object;
        object = void 0;
    }
    return Q(object).delay(timeout);
};

Promise.prototype.delay = function (timeout) {
    return this.then(function (value) {
        var deferred = defer();
        setTimeout(function () {
            deferred.resolve(value);
        }, timeout);
        return deferred.promise;
    });
};

/**
 * Passes a continuation to a Node function, which is called with the given
 * arguments provided as an array, and returns a promise.
 *
 *      Q.nfapply(FS.readFile, [__filename])
 *      .then(function (content) {
 *      })
 *
 */
Q.nfapply = function (callback, args) {
    return Q(callback).nfapply(args);
};

Promise.prototype.nfapply = function (args) {
    var deferred = defer();
    var nodeArgs = array_slice(args);
    nodeArgs.push(deferred.makeNodeResolver());
    this.fapply(nodeArgs).fail(deferred.reject);
    return deferred.promise;
};

/**
 * Passes a continuation to a Node function, which is called with the given
 * arguments provided individually, and returns a promise.
 * @example
 * Q.nfcall(FS.readFile, __filename)
 * .then(function (content) {
 * })
 *
 */
Q.nfcall = function (callback /*...args*/) {
    var args = array_slice(arguments, 1);
    return Q(callback).nfapply(args);
};

Promise.prototype.nfcall = function (/*...args*/) {
    var nodeArgs = array_slice(arguments);
    var deferred = defer();
    nodeArgs.push(deferred.makeNodeResolver());
    this.fapply(nodeArgs).fail(deferred.reject);
    return deferred.promise;
};

/**
 * Wraps a NodeJS continuation passing function and returns an equivalent
 * version that returns a promise.
 * @example
 * Q.nfbind(FS.readFile, __filename)("utf-8")
 * .then(console.log)
 * .done()
 */
Q.nfbind =
Q.denodeify = function (callback /*...args*/) {
    var baseArgs = array_slice(arguments, 1);
    return function () {
        var nodeArgs = baseArgs.concat(array_slice(arguments));
        var deferred = defer();
        nodeArgs.push(deferred.makeNodeResolver());
        Q(callback).fapply(nodeArgs).fail(deferred.reject);
        return deferred.promise;
    };
};

Promise.prototype.nfbind =
Promise.prototype.denodeify = function (/*...args*/) {
    var args = array_slice(arguments);
    args.unshift(this);
    return Q.denodeify.apply(void 0, args);
};

Q.nbind = function (callback, thisp /*...args*/) {
    var baseArgs = array_slice(arguments, 2);
    return function () {
        var nodeArgs = baseArgs.concat(array_slice(arguments));
        var deferred = defer();
        nodeArgs.push(deferred.makeNodeResolver());
        function bound() {
            return callback.apply(thisp, arguments);
        }
        Q(bound).fapply(nodeArgs).fail(deferred.reject);
        return deferred.promise;
    };
};

Promise.prototype.nbind = function (/*thisp, ...args*/) {
    var args = array_slice(arguments, 0);
    args.unshift(this);
    return Q.nbind.apply(void 0, args);
};

/**
 * Calls a method of a Node-style object that accepts a Node-style
 * callback with a given array of arguments, plus a provided callback.
 * @param object an object that has the named method
 * @param {String} name name of the method of object
 * @param {Array} args arguments to pass to the method; the callback
 * will be provided by Q and appended to these arguments.
 * @returns a promise for the value or error
 */
Q.nmapply = // XXX As proposed by "Redsandro"
Q.npost = function (object, name, args) {
    return Q(object).npost(name, args);
};

Promise.prototype.nmapply = // XXX As proposed by "Redsandro"
Promise.prototype.npost = function (name, args) {
    var nodeArgs = array_slice(args || []);
    var deferred = defer();
    nodeArgs.push(deferred.makeNodeResolver());
    this.dispatch("post", [name, nodeArgs]).fail(deferred.reject);
    return deferred.promise;
};

/**
 * Calls a method of a Node-style object that accepts a Node-style
 * callback, forwarding the given variadic arguments, plus a provided
 * callback argument.
 * @param object an object that has the named method
 * @param {String} name name of the method of object
 * @param ...args arguments to pass to the method; the callback will
 * be provided by Q and appended to these arguments.
 * @returns a promise for the value or error
 */
Q.nsend = // XXX Based on Mark Miller's proposed "send"
Q.nmcall = // XXX Based on "Redsandro's" proposal
Q.ninvoke = function (object, name /*...args*/) {
    var nodeArgs = array_slice(arguments, 2);
    var deferred = defer();
    nodeArgs.push(deferred.makeNodeResolver());
    Q(object).dispatch("post", [name, nodeArgs]).fail(deferred.reject);
    return deferred.promise;
};

Promise.prototype.nsend = // XXX Based on Mark Miller's proposed "send"
Promise.prototype.nmcall = // XXX Based on "Redsandro's" proposal
Promise.prototype.ninvoke = function (name /*...args*/) {
    var nodeArgs = array_slice(arguments, 1);
    var deferred = defer();
    nodeArgs.push(deferred.makeNodeResolver());
    this.dispatch("post", [name, nodeArgs]).fail(deferred.reject);
    return deferred.promise;
};

/**
 * If a function would like to support both Node continuation-passing-style and
 * promise-returning-style, it can end its internal promise chain with
 * `nodeify(nodeback)`, forwarding the optional nodeback argument.  If the user
 * elects to use a nodeback, the result will be sent there.  If they do not
 * pass a nodeback, they will receive the result promise.
 * @param object a result (or a promise for a result)
 * @param {Function} nodeback a Node.js-style callback
 * @returns either the promise or nothing
 */
Q.nodeify = nodeify;
function nodeify(object, nodeback) {
    return Q(object).nodeify(nodeback);
}

Promise.prototype.nodeify = function (nodeback) {
    if (nodeback) {
        this.then(function (value) {
            Q.nextTick(function () {
                nodeback(null, value);
            });
        }, function (error) {
            Q.nextTick(function () {
                nodeback(error);
            });
        });
    } else {
        return this;
    }
};

// All code before this point will be filtered from stack traces.
var qEndingLine = captureLine();

return Q;

});

/**
 * @file        core/types-is.js
 * @desc        Devapt static common features: Devapt static types operations
 * 				API
 * 					...
 * 					is_not_empty_array_or_object(value): (boolean)
 * 					...
 * 					
 * @ingroup     DEVAPT_CORE
 * @date        2013-05-16
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('core/types-is',[/*'Devapt', */'core/traces'], function(/*Devapt, */DevaptTraces)
{
	/**
	 * @memberof	DevaptTypes
	 * @public
	 * @class
	 * @desc		Devapt types features container
	 */
	var DevaptTypes = function() {};
	
	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.type_of(arg_value)
	 * @desc				Get the type of a value
	 * @param {anything}	arg_value		value to get the type
	 * @return {string}		type name
	 */
	DevaptTypes.type_of = function(arg_value)
	{
		// THE VALUE IS NULL
		if (arg_value === null)
		{
			return 'null';
		}
		
		// THE VALUE HAS A SIMPLE TYPE
		var type = typeof(arg_value);
		if (type === 'undefined' || type === 'string' || type === 'number' || type === 'boolean')
		{
			return type;
		}
		
		// THE VALUE IS A FUNCTION
		if (type === 'function') {
			return 'function';
		}
		
		// THE VALUE HAS AN STANDARD OBJECT
		var type_str = Object.prototype.toString.apply(arg_value);
		switch(type_str)
		{
			case '[object Array]':		return 'array';
			case '[object Date]':		return 'date';
			case '[object Boolean]':	return 'boolean';
			case '[object Number]':		return 'number';
			case '[object RegExp]':		return 'regexp';
		}
		
		// THE VALUE IS AN OTHER OBJECT
		if (type === 'object')
		{
			return 'object';
		}
		
		DevaptTraces.error( { source: 'DevaptTypes.type_of', text: 'unknow type of [' + arg_value + ']' } );
		return null;
	}
	
	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_array(arg_value)
	 * @desc				Test if the value is an array
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_array = function(arg_value)
	{
		return Object.prototype.toString.apply(arg_value) === '[object Array]';
	}
	
	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_null(arg_value)
	 * @desc				Test if the value is an null or undefined
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_null = function(arg_value)
	{
		return arg_value == null || typeof arg_value === 'undefined';
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.are_null(arg_values)
	 * @desc				Test if an array of value are null or undefined
	 * @param {array}		arg_values			values to test
	 * @return {boolean}
	 */
	DevaptTypes.are_null = function(arg_values)
	{
		if ( DevaptTypes.is_array(arg_values) && arg_values.length > 0 )
		{
			return arg_values.every( DevaptTypes.is_null );
		}
		return DevaptTypes.is_null(arg_values);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_not_null(arg_value)
	 * @desc				Test if the value is a not null and not undefined
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_not_null = function(arg_value)
	{
		return ! DevaptTypes.is_null(arg_value);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.are_not_null(arg_values)
	 * @desc				Test if an array of value are not null and not undefined
	 * @param {array}		arg_values			values to test
	 * @return {boolean}
	 */
	DevaptTypes.are_not_null = function(arg_values)
	{
		if ( DevaptTypes.is_array(arg_values) )
		{
			return arg_values.length > 0 ? arg_values.every( DevaptTypes.is_not_null ) : false;
		}
		return DevaptTypes.is_not_null(arg_values);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @method				DevaptTypes.is_undefined(arg_value)
	 * @desc				Test if the value is undefined
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_undefined = function(arg_value)
	{
		return typeof arg_value === 'undefined';
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_object(arg_value)
	 * @desc				Test if the value is an object
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_object = function(arg_value)
	{
		return (! DevaptTypes.is_null(arg_value) ) && typeof arg_value === 'object';
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_empty_object(arg_value)
	 * @desc				Test if the value is an object without members
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_empty_object = function(arg_value)
	{
		return DevaptTypes.is_object(arg_value) && $.isEmptyObject(arg_value);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_not_empty_object(arg_value)
	 * @desc				Test if the value is a not empty object without members
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_not_empty_object = function(arg_value)
	{
		return DevaptTypes.is_object(arg_value) && ! $.isEmptyObject(arg_value);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_plain_object(arg_value)
	 * @desc				Test if the value is a plain object (created with {} or with new Object)
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_plain_object = function(arg_value)
	{
		return $.isPlainObject(arg_value);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.are_objectg(arg_values)
	 * @desc				Test if an array of value are object
	 * @param {array}		arg_values			values to test
	 * @return {boolean}
	 */
	DevaptTypes.are_object = function(arg_values)
	{
		if ( DevaptTypes.is_array(arg_values) )
		{
			return arg_values.length > 0 ? arg_values.every( DevaptTypes.is_object ) : false;
		}
		return DevaptTypes.is_object(arg_values);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_object_with(arg_value,arg_attributes_array)
	 * @desc				Test if the value is an object and has all given attributes names
	 * @param {object}		arg_value				value to test
	 * @param {array}		arg_attributes_array	array of attributes names
	 * @return {boolean}
	 */
	DevaptTypes.is_object_with = function(arg_value, arg_attributes_array)
	{
		var cb_has_attribute = function(attr_name) { return arg_value[attr_name] !== undefined; };
		return DevaptTypes.is_object(arg_value) && DevaptTypes.is_array(arg_attributes_array) && arg_attributes_array.every(cb_has_attribute);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.are_object_with(arg_values,arg_attributes_array)
	 * @desc				Test if an array of values are object and have all given attributes names
	 * @param {array}		arg_values			values to test
	 * @param {array}		arg_attributes_array	array of attributes names
	 * @return {boolean}
	 */
	DevaptTypes.are_object_with = function(arg_values, arg_attributes_array)
	{
		if ( DevaptTypes.is_array(arg_values) )
		{
			var cb_is_object_with = function(obj)
				{
					var cb_has_attribute = function(attr_name) { return obj[attr_name] !== undefined; };
					return arg_attributes_array.every(cb_has_attribute);
				};
			return arg_values.length > 0 ? arg_values.every(cb_is_object_with) : false;
		}
		return DevaptTypes.is_object_with(arg_values);
	}
	
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_string(arg_value)
	 * @desc				Test if the value is a string
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_string = function(arg_value)
	{
		return typeof arg_value === 'string' || typeof arg_value === 'String';
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.are_string(arg_values)
	 * @desc				Test if an array of value are string
	 * @param {array}		arg_values			values to test
	 * @return {boolean}
	 */
	DevaptTypes.are_string = function(arg_values)
	{
		if ( DevaptTypes.is_array(arg_values) )
		{
			return arg_values.length > 0 ? arg_values.every( DevaptTypes.is_string ) : false;
		}
		return DevaptTypes.is_string(arg_values);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_boolean(arg_value)
	 * @desc				Test if the value is a boolean
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_boolean = function(arg_value)
	{
		return typeof arg_value == 'boolean' || typeof arg_value == 'Boolean';
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.are_boolean(arg_values)
	 * @desc				Test if an array of value are boolean
	 * @param {array}		arg_values			values to test
	 * @return {boolean}
	 */
	DevaptTypes.are_boolean = function(arg_values)
	{
		if ( DevaptTypes.is_array(arg_values) )
		{
			return arg_values.length > 0 ? arg_values.every( DevaptTypes.is_boolean ) : false;
		}
		return DevaptTypes.is_boolean(arg_values);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @method				DevaptTypes.is_numeric(arg_value)
	 * @desc				Test if the value is a number
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_numeric = function(arg_value)
	{
		return typeof arg_value == 'number' || typeof arg_value == 'Number';
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_number(arg_value)
	 * @desc				Test if the value is a number
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_number = function(arg_value)
	{
		return typeof arg_value === 'number' || typeof arg_value === 'Number';
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.are_number(arg_values)
	 * @desc				Test if an array of value are number
	 * @param {array}		arg_values			values to test
	 * @return {boolean}
	 */
	DevaptTypes.are_number = function(arg_values)
	{
		if ( DevaptTypes.is_array(arg_values) )
		{
			return arg_values.length > 0 ? arg_values.every( DevaptTypes.is_number ) : false;
		}
		return DevaptTypes.is_number(arg_values);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_integer(arg_value)
	 * @desc				Test if the value is a integer
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_integer = function(arg_value)
	{
		if ( DevaptTypes.is_number(arg_value) || DevaptTypes.is_string(arg_value) )
		{
			var value = parseInt(arg_value) ;
			return (! isNaN(value) && value  == arg_value) ? true : false;
		}
		return false;
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.are_integer(arg_values)
	 * @desc				Test if an array of value are integers
	 * @param {array}		arg_values			values to test
	 * @return {boolean}
	 */
	DevaptTypes.are_integer = function(arg_values)
	{
		if ( DevaptTypes.is_array(arg_values) )
		{
			return arg_values.length > 0 ? arg_values.every( DevaptTypes.is_integer ) : false;
		}
		return DevaptTypes.is_integer(arg_values);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_float(arg_value)
	 * @desc				Test if the value is a float
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_float = function(arg_value)
	{
		if ( DevaptTypes.is_number(arg_value) || DevaptTypes.is_string(arg_value) )
		{
			return ! isNaN( parseFloat(arg_value) );
		}
		return false;
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.are_float(arg_values)
	 * @desc				Test if an array of value are floats
	 * @param {array}		arg_values			values to test
	 * @return {boolean}
	 */
	DevaptTypes.are_float = function(arg_values)
	{
		if ( DevaptTypes.is_array(arg_values) )
		{
			return arg_values.length > 0 ? arg_values.every( DevaptTypes.is_float ) : false;
		}
		return DevaptTypes.is_float(arg_values);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @method				DevaptTypes.is_function(arg_value)
	 * @desc				Test if the value is a function
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_function = function(arg_value)
	{
		return typeof arg_value === 'function';
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.function(arg_values)
	 * @desc				Test if an array of value are function
	 * @param {array}		arg_values			values to test
	 * @return {boolean}
	 */
	DevaptTypes.are_function = function(arg_values)
	{
		if ( DevaptTypes.is_array(arg_values) )
		{
			return arg_values.length > 0 ? arg_values.every( DevaptTypes.is_function ) : false;
		}
		return DevaptTypes.is_function(arg_values);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_function(arg_value)
	 * @desc				Test if the value is a callback (a function or a object/function array.
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_callback = function(arg_value)
	{
		if ( Object.prototype.toString.apply(arg_value) === '[object Array]' )
		{
			if (arg_value.length < 2)
			{
				return false;
			}
			if ( ! DevaptTypes.is_object(arg_value[0]) && ! DevaptTypes.is_function(arg_value[0]) )
			{
				return false;
			}
			if ( ! DevaptTypes.is_function(arg_value[1]) )
			{
				return false;
			}
			return true;
		}
		return DevaptTypes.is_function(arg_value);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.DevaptTypes.is_empty_array_or_null(arg_value)
	 * @desc				Test if the value is an empty array
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_empty_array = function(arg_value)
	{
		return DevaptTypes.is_array(arg_value) && (arg_value.length === 0);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_empty_array_or_null(arg_value)
	 * @desc				Test if the value is an empty array or null or undefined
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_empty_array_or_null = function(arg_value)
	{
		return DevaptTypes.is_null(arg_value) || ( DevaptTypes.is_array(arg_value) && (arg_value.length === 0) );
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_not_empty_array(arg_value)
	 * @desc				Test if the value is a not empty array
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_not_empty_array = function(arg_value)
	{
		return DevaptTypes.is_array(arg_value) && (arg_value.length > 0);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_not_empty_array_or_object(arg_value)
	 * @desc				Test if the value is a not empty array
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_not_empty_array_or_object = function(arg_value)
	{
		return DevaptTypes.is_not_empty_array(arg_value)
			|| DevaptTypes.is_not_empty_object(arg_value);
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_empty_str_or_null(arg_value)
	 * @desc				Test if the value is an empty string
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_empty_str = function(arg_value)
	{
		return DevaptTypes.is_string(arg_value) && arg_value === '';
	}
	DevaptTypes.is_empty_string = DevaptTypes.is_empty_str;

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_empty_str_or_null(arg_value)
	 * @desc				Test if the value is an empty string or null or undefined
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_empty_str_or_null = function(arg_value)
	{
		return DevaptTypes.is_null(arg_value) || ( DevaptTypes.is_string(arg_value) && arg_value === '' );
	}
	DevaptTypes.is_empty_string_or_null = DevaptTypes.is_empty_str_or_null;
	
	/**
	 * @memberof		Devapt
	 * @public
	 * @static
	 * @method				DevaptTypes.is_not_empty_str(arg_value)
	 * @desc				Test if the value is a not empty string
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_not_empty_str = function(arg_value)
	{
		return DevaptTypes.is_string(arg_value) && arg_value !== '' && arg_value.length > 0;
	}
	DevaptTypes.is_not_empty_string = DevaptTypes.is_not_empty_str;

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_empty_int(arg_value)
	 * @desc				Test if the value is an empty integer
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_empty_int = function(arg_value)
	{
		return DevaptTypes.is_number(arg_value) && arg_value === 0;
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_empty_int(arg_value)
	 * @desc				Test if the value is an empty integer or null or undefined
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_empty_int_or_null = function(arg_value)
	{
		return DevaptTypes.is_null(arg_value) || ( DevaptTypes.is_number(arg_value) && arg_value === 0 );
	}
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.is_date(arg_value)
	 * @desc				Test if the value is a float
	 * @param {anything}	arg_value			value to test
	 * @return {boolean}
	 */
	DevaptTypes.is_date = function(arg_value)
	{
		if ( DevaptTypes.is_object(arg_value) && arg_value instanceof Date )
		{
			return true;
		}
		return false;
	}

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.are_date(arg_values)
	 * @desc				Test if an array of value are dates
	 * @param {array}		arg_values			values to test
	 * @return {boolean}
	 */
	DevaptTypes.are_date = function(arg_values)
	{
		if ( DevaptTypes.is_array(arg_values) )
		{
			return arg_values.length > 0 ? arg_values.every( DevaptTypes.is_date ) : false;
		}
		return DevaptTypes.is_date(arg_values);
	}
	
	
	return DevaptTypes;
} );
/**
 * @file        core/types-to.js
 * @desc        Devapt static common features: Devapt static types operations
 * @ingroup     DEVAPT_CORE
 * @date        2013-05-16
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('core/types-to',[/*'Devapt', */'core/traces', 'core/types-is'], function(/*Devapt, */DevaptTraces, DevaptTypes)
{
	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.get_value_str(arg_value)
	 * @desc				Dump a value into a string
	 * @param {anything}	arg_value			value to dump
	 * @param {anything}	arg_stack_count		stack calls count
	 * @return {string}
	 */
	DevaptTypes.get_value_str = function(arg_value, arg_stack_count)
	{
		var max_calls = 10;
		
		// INIT STACK COUNTER
		if (arg_stack_count === undefined)
		{
			arg_stack_count = 0;
		}
		
		// CHECK STACK MAX CALLS
		if (arg_stack_count > max_calls)
		{
			return 'more than ' + max_calls + ' calls stack';
		}
		
		// NULL VALUE
		if ( DevaptTypes.is_null(arg_value) )
		{
			return 'null';
		}
		
		// FUNCTIONS
		if ( DevaptTypes.is_function(arg_value) )
		{
			return 'function:' + arg_value.name;
		}
		
		// ARRAYS
		if ( DevaptTypes.is_array(arg_value) )
		{
			var str = '[';
			for(var key in arg_value)
			{
				str += (str === '[' ? '' : ',') + key + '=' + DevaptTypes.get_value_str( arg_value[key], arg_stack_count + 1);
			}
			return str + ']';
		}
		
		// OBJECTS
		if ( DevaptTypes.is_object(arg_value) )
		{
			var str = '{';
			if ( DevaptTypes.is_function(arg_value.to_string) )
			{
				str += arg_value.to_string();
				return str + '}';
			}
			
			if ( DevaptTypes.is_not_empty_str(arg_value['jquery']) )
			{
				str += 'a jqo object}';
				return str;
			}
			
			if ( arg_value.selector )
			{
				str += 'a jqo object(selector)}';
				return str;
			}
			
			if ( DevaptTypes.is_string(arg_value.tagName) )
			{
				str += 'a jqo object(' + arg_value.tagName + ')}';
				return str;
			}
			
//			if ( arg_value._class && DevaptTypes.is_not_empty_str(arg_value.class_name) )
//			{
//				
//			}
			
			for(var key in arg_value)
			{
				// ATTRIBUTE IS A JQO OBJECT
				var right_4 = key.substring(key.length - 4, key.length);
				if ( right_4 === '_jqo' )
				{
					str += '\n  ' + key + '= a jqo object';
					continue;
				}
				
				var member = arg_value[key];
				if ( ! DevaptTypes.is_function(member) )
				{
					str += '\n  ' + key + '=' + DevaptTypes.get_value_str(member, arg_stack_count + 1);
				}
			}
			return str + (str === '{' ? '' : '\n') + '}';
		}
		
		// BOOLEAN
		if ( DevaptTypes.is_boolean(arg_value) )
		{
			return arg_value;
		}
		
		// NUMBER
		if ( DevaptTypes.is_number(arg_value) )
		{
			return arg_value;
		}
		
		// STRINGS
		if ( DevaptTypes.is_not_empty_str(arg_value) )
		{
			return arg_value;
		}
		
		return arg_value;
	}
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_string(arg_value, arg_default_value)
	 * @desc				Convert the value to a string
	 * @param {anything}	arg_value			value to convert
	 * @param {string}		arg_default_value	default value
	 * @return {string}
	 */
	DevaptTypes.to_string = function(arg_value, arg_default_value)
	{
		return ( DevaptTypes.is_string(arg_value) && arg_value !== '' ) ? arg_value : arg_default_value;
	}
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_list_item(arg_value, arg_list_items, arg_default_value)
	 * @desc				Test if the given value is part of the values list and return it or default value
	 * @param {anything}	arg_value			value to convert
	 * @param {anything}	arg_list_items		all items values
	 * @param {anything}	arg_default_value	default value
	 * @return {anything}
	 */
	DevaptTypes.to_list_item = function(arg_value, arg_list_items, arg_default_value)
	{
		if (! arg_value)
		{
			return arg_default_value;
		}
		if ( DevaptTypes.is_array(arg_list_items) )
		{
			return arg_value.lastIndexOf(arg_value) >= 0 ? arg_value : arg_default_value;
		}
		
		if ( DevaptTypes.is_object(arg_list_items) )
		{
			return arg_value in arg_list_items ? arg_value : arg_default_value;
		}
		
		return arg_value === arg_list_items ? arg_value : arg_default_value;
	}
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_boolean(arg_value, arg_default_value)
	 * @desc				Convert the value to a boolean
	 * @param {anything}	arg_value			value to convert
	 * @param {boolean}		arg_default_value	default value
	 * @return {boolean}
	 */
	DevaptTypes.to_boolean = function(arg_value, arg_default_value)
	{
		var default_value = DevaptTypes.is_undefined(arg_default_value) ? false : arg_default_value;
		
		if ( DevaptTypes.is_boolean(arg_value) )
		{
			return arg_value;
		}
		if ( DevaptTypes.is_number(arg_value) )
		{
			return arg_value > 0;
		}
		if ( DevaptTypes.is_string(arg_value) )
		{
			var str_value = arg_value.toLowerCase();
			if (str_value === 'true' || str_value === 'on' || str_value === '1' || str_value === 'y' || str_value === 'yes')
			{
				return new Boolean(true).valueOf();
			}
			return new Boolean(false).valueOf();
		}
		
		return new Boolean(default_value).valueOf();
	}
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_number(arg_value, arg_default_value)
	 * @desc				Convert the value to a number
	 * @param {anything}	arg_value			value to convert
	 * @param {number}		arg_default_value	default value
	 * @return {number}
	 */
	DevaptTypes.to_number = function(arg_value, arg_default_value)
	{
		var default_value = DevaptTypes.is_undefined(arg_default_value) ? 0 : arg_default_value;
		
		if ( DevaptTypes.is_number(arg_value) )
		{
			return arg_value;
		}
		if ( DevaptTypes.is_boolean(arg_value) )
		{
			return arg_value ? 1 : 0;
		}
		if ( DevaptTypes.is_string(arg_value) )
		{
			try
			{
				var str_value = arg_value.toLowerCase();
				var value = eval(str_value);
				if ( DevaptTypes.is_number(value) )
				{
					return value;
				}
			} catch(e)
			{
				return default_value;
			}
		}
		
		return default_value;
	}
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_integer(arg_value, arg_default_value)
	 * @desc				Convert the value to a integer
	 * @param {anything}	arg_value			value to convert
	 * @param {integer}		arg_default_value	default value
	 * @return {integer}
	 */
	DevaptTypes.to_integer = function(arg_value, arg_default_value)
	{
		var default_value = DevaptTypes.is_undefined(arg_default_value) ? 0 : arg_default_value;
		
		if ( DevaptTypes.is_boolean(arg_value) )
		{
			return arg_value ? 1 : 0;
		}
		
		if ( DevaptTypes.is_number(arg_value) )
		{
			try
			{
				var value = parseInt(arg_value);
				return isNaN(value) ? default_value : value;
			} catch(e)
			{
				return default_value;
			}
		}
		
		if ( DevaptTypes.is_string(arg_value) )
		{
			try
			{
				var value = parseInt(arg_value);
				return isNaN(value) ? default_value : value;
			} catch(e)
			{
				return default_value;
			}
			return value;
		}
		
		return default_value;
	}
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_float(arg_value, arg_default_value)
	 * @desc				Convert the value to a float
	 * @param {anything}	arg_value			value to convert
	 * @param {float}		arg_default_value	default value
	 * @return {float}
	 */
	DevaptTypes.to_float = function(arg_value, arg_default_value)
	{
		var default_value = DevaptTypes.is_undefined(arg_default_value) ? 0.0 : arg_default_value;
		
		var value = default_value;
		if ( DevaptTypes.is_string(arg_value) || DevaptTypes.is_number(arg_value) )
		{
			try
			{
				value = parseFloat(arg_value);
				return isNaN(value) ? default_value : value;
			} catch(e)
			{
				return default_value;
			}
		}
		
		return value;
	}
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_date(arg_value, arg_default_value)
	 * @desc				Convert the value to a date
	 * @param {anything}	arg_value			value to convert
	 * @param {date}		arg_default_value	default value
	 * @return {date}
	 */
	DevaptTypes.to_date = function(arg_value, arg_default_value)
	{
		// INIT DEFAULT VALUE
		var default_value = DevaptTypes.is_null(arg_default_value) ? new Date().toLocaleDateString() : arg_default_value;
		
		// ARG VALUE IS A STRING
		if ( DevaptTypes.is_string(arg_value) )
		{
			if (arg_value === '')
			{
				return default_value;
			}
			
			try
			{
				value_int = Date.parse(arg_value);
				if ( isNaN(value_int) )
				{
					return default_value;
				}
				
				value = new Date(value);
				return DevaptTypes.is_date(value) ? value.toLocaleDateString() : default_value;
			}
			catch(e)
			{
				return default_value;
			}
		}
		
		// ARG VALUE IS A NUMBER
		if ( DevaptTypes.is_number(arg_value) )
		{
			value = new Date(arg_value);
			return value ? value.toLocaleDateString() : default_value;
		}
		
		// ARG VALUE IS NULL OR UNDEFINED OR OTHER CASES
		return default_value;
	}
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_time(arg_value, arg_default_value)
	 * @desc				Convert the value to a time
	 * @param {anything}	arg_value			value to convert
	 * @param {time}		arg_default_value	default value
	 * @return {time}
	 */
	DevaptTypes.to_time = function(arg_value, arg_default_value)
	{
		var default_value = DevaptTypes.is_undefined(arg_default_value) ? new Date() : arg_default_value;
		
		var value = default_value;
		if ( DevaptTypes.is_string(arg_value) )
		{
			value = new Date( Date.parse(arg_value) );
			
		}
		else if ( DevaptTypes.is_number(arg_value) )
		{
			value = new Date(arg_value);
		}
		if ( DevaptTypes.is_null(value) )
		{
			value = default_value;
		}
		else
		{
			value = value.toLocaleTimeString();
		}
		
		return value;
	}
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_datetime(arg_value, arg_default_value)
	 * @desc				Convert the value to a datetime
	 * @param {anything}	arg_value			value to convert
	 * @param {datetime}	arg_default_value	default value
	 * @return {datetime}
	 */
	DevaptTypes.to_datetime = function(arg_value, arg_default_value)
	{
		var default_value = DevaptTypes.is_undefined(arg_default_value) ? new Date() : arg_default_value;
		
		var value = default_value;
		if ( DevaptTypes.is_string(arg_value) )
		{
			value = new Date( Date.parse(arg_value) );
			
		}
		else if ( DevaptTypes.is_number(arg_value) )
		{
			value = new Date(arg_value);
		}
		
		if ( DevaptTypes.is_null(value) )
		{
			value = default_value;
		}
		else
		{
			value = value.toLocaleString();
		}
		
		return value;
	}


	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_string(arg_value, arg_default_value)
	 * @desc				Convert the value to a string
	 * @param {anything}	arg_value			value to convert
	 * @param {string}		arg_default_value	default value
	 * @return {string}
	 */
	DevaptTypes.to_string = function(arg_value, arg_default_value)
	{
		var default_value = DevaptTypes.is_undefined(arg_default_value) ? '' : arg_default_value;
		
		if ( DevaptTypes.is_string(arg_value) )
		{
			return arg_value;
		}
		
		return default_value;
	}


	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_array(arg_value, arg_default_value)
	 * @desc				Convert the value to an array
	 * @param {anything}	arg_value				value to convert
	 * @param {array}		arg_default_value		default value
	 * @param {string}		arg_items_separator		items separator of array string (default=',')
	 * @todo check array items types if a valid type is given
	 * @return {array}
	 */
	DevaptTypes.to_array = function(arg_value, arg_default_value, arg_items_separator)
	{
		var default_value = DevaptTypes.is_array(arg_default_value) ? arg_default_value : [];
		
		var value = null;
		
		if ( DevaptTypes.is_array(arg_value) )
		{
			value = arg_value;
		}
		else if ( DevaptTypes.is_string(arg_value) )
		{
			arg_items_separator	= DevaptTypes.is_not_empty_str(arg_items_separator) ? arg_items_separator : ',';
			
			value = arg_value.split(arg_items_separator);
		}
		else if ( DevaptTypes.is_object(arg_value) )
		{
			// value = Object.values(arg_value);
			// TODO Object.values()
			var values_array = [];
			for(var attr_key in arg_value)
			{
				values_array.push( arg_value[attr_key] );
			}
			value = values_array;
		}
		
		if ( ! DevaptTypes.is_array(value) )
		{
			value = default_value;
		}
		
		return value;
	}


	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_object(arg_value, arg_default_value)
	 * @desc				Convert the value to an object
	 * @param {anything}	arg_value					value to convert
	 * @param {array}		arg_default_value			object template and default value
	 * @param {string}		arg_attributes_separator	attributes separator of object string (default=',')
	 * @param {string}		arg_name_value_separator	attributes name/value separator of object string (default='=')
	 * @return {array}
	 */
	DevaptTypes.to_object = function(arg_value, arg_default_value, arg_attributes_separator, arg_name_value_separator)
	{
		var default_value = DevaptTypes.is_object(arg_default_value) ? arg_default_value : {};
		
		var value = default_value;
		
		if ( DevaptTypes.is_object(arg_value) )
		{
			value = arg_value;
		}
		else if ( DevaptTypes.is_string(arg_value) )
		{
			arg_attributes_separator	= DevaptTypes.is_not_empty_str(arg_attributes_separator) ? arg_attributes_separator : ',';
			arg_name_value_separator	= DevaptTypes.is_not_empty_str(arg_name_value_separator) ? arg_name_value_separator : '=';
			
			var attributes = arg_value.split(arg_attributes_separator);
			if ( DevaptTypes.is_array(attributes) )
			{
				value = {};
				for(var attr_index = 0 ; attr_index < attributes.length ; attr_index++)
				{
					var attribute = attributes[attr_index].split(arg_name_value_separator);
					if ( DevaptTypes.is_array(attribute) && attribute.length == 2 )
					{
						var attr_key	= attribute[0];
						var attr_value	= attribute[1];
						value[attr_key]	= attr_value;
					}
				}
			}
		}
		
		// CHECK VALUE
		if ( ! DevaptTypes.is_object(value) )
		{
			value = default_value;
		}
		
		// APPEND MISSING ATTRIBUTES
		if ( DevaptTypes.is_object(value) && DevaptTypes.is_object(default_value) && value !== default_value )
		{
			for(var loop_key in default_value)
			{
				var loop_default_value = default_value[loop_key];
				var loop_value = value[loop_key];
				if ( DevaptTypes.is_null(loop_value) )
				{
					value[loop_key] = loop_default_value;
				}
			}
		}
		
		return value;
	}


	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.to_callback(arg_value, arg_default_value)
	 * @desc				Convert the value to a callback
	 * @param {anything}		arg_value			value to convert
	 * @param {function|array}	arg_default_value	default value
	 * @return {function|array}
	 */
	DevaptTypes.to_callback = function(arg_value, arg_default_value)
	{
		var default_value = DevaptTypes.is_undefined(arg_default_value) ? null : arg_default_value;
		
		// CALLBACK IS A FUNCTION
		if ( DevaptTypes.is_function(arg_value) )
		{
			return arg_value;
		}
		
		// CALLBACK IS A METHOD CALL
		if ( DevaptTypes.is_array(arg_value) && arg_value.length >= 2 && DevaptTypes.is_object(arg_value[0]) && DevaptTypes.is_function(arg_value[1]) )
		{
			return arg_value;
		}
		
		// CALLBACK IS A FUNCTION CONTENT
		if ( DevaptTypes.is_string(arg_value) )
		{
			var cb = function()
				{
					eval(arg_value);
				};
			return cb;
		}
		
		return default_value;
	}
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.convert_value(arg_value, arg_default_value, arg_target_type)
	 * @desc				Convert a value to the given type if needed and returns default value if null or undefined
	 * @param {anything}	arg_value			value to convert
	 * @param {anything}	arg_default_value	default value
	 * @param {anything}	arg_target_type		target value type
	 * @param {anything}	arg_items_sep		items separator string (optional, ',' as default)
	 * @param {anything}	arg_field_def		field definition string (optional, '=' as default)
	 * @return {anything}
	 */
	DevaptTypes.convert_value = function(arg_value, arg_default_value, arg_target_type, arg_items_sep, arg_field_def)
	{
		if (!arg_target_type)
		{
			return null;
		}
		
		var target_type = arg_target_type.toLocaleLowerCase();
		var target_value = arg_default_value;
		
		switch(target_type)
		{
			case 'boolean':		return DevaptTypes.to_boolean(arg_value, arg_default_value);
			case 'integer':		return DevaptTypes.to_integer(arg_value, arg_default_value);
			case 'float':		return DevaptTypes.to_float(arg_value, arg_default_value);
			case 'date':		return DevaptTypes.to_date(arg_value, arg_default_value);
			case 'time':		return DevaptTypes.to_time(arg_value, arg_default_value);
			case 'datetime':	return DevaptTypes.to_datetime(arg_value, arg_default_value);
			case 'callback':	return DevaptTypes.to_callback(arg_value, arg_default_value);
			case 'string':		return DevaptTypes.to_string(arg_value, arg_default_value);
			case 'function':	return DevaptTypes.to_string(arg_value, arg_default_value);
			case 'object':		return DevaptTypes.to_object(arg_value, arg_default_value, (arg_items_sep ? arg_items_sep : ','), (arg_field_def ? arg_field_def : '=') );
			case 'array':		return DevaptTypes.to_array(arg_value, arg_default_value, (arg_items_sep ? arg_items_sep : ',') );
		}
		
		return target_value;
	}
	
	
	return DevaptTypes;
} );
/**
 * @file        core/types.js
 * @desc        Devapt static common features: Devapt static types operations
 * @ingroup     DEVAPT_CORE
 * @date        2013-05-16
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('core/types',[/*'Devapt', */'core/traces', 'core/types-to'],
function(/*Devapt, */DevaptTraces, DevaptTypes)
{
	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.in_array(arg_array, arg_needle, arg_strict)
	 * @desc				Test a value is contained in an array
	 *
	 * Examples :
	 *	var myArray = new Array('test1', 'test3', 4);
	 *	in_array(myArray, '4'); // true
	 *	in_array(myArray, '4', true); // false
	 *	in_array(myArray, 4, true); // true
	 * 
	 * @param {array}		arg_array	array of values
	 * @param {string}		arg_needle	value to search in the array
	 * @param {boolean}		arg_strict	strict equality (===) if true, else simple equality (==)
	 * @return {boolean}
	 */
	DevaptTypes.in_array = function(arg_array, arg_needle, arg_strict)
	{
		arg_strict = !!arg_strict || false;

		for(var key in arg_array)
		{
			if (arg_strict)
			{
			
				if (arg_array[key] === arg_needle)
				{
				
					return true;
				}
			}
			else if (arg_array[key] == arg_needle)
			{
			
				return true;
			}
		}
		return false;
	}

	// BUG ???
	// Array.prototype.contains = function(thDevaptTypes.is_array, value)
	// {
		// return in_array(thDevaptTypes.is_array, value);
	// }
	
	
	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.lpad(arg_padding_str, arg_padding_length)
	 * @desc				Append padding string at the left of the self string if needed
	 * @param {string}		arg_padding_str			padding string
	 * @param {integer}		arg_padding_length		padding length
	 * @return {string}
	 */
	String.prototype.lpad = function(arg_padding_str, arg_padding_length)
	{
		var str = this;
		while (str.length < arg_padding_length)
		{
			str = arg_padding_str + str;
		}
		return str;
	}


	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.rpad(arg_padding_str, arg_padding_length)
	 * @desc				Append padding string at the right of the self string if needed
	 * @param {string}		arg_padding_str			padding string
	 * @param {integer}		arg_padding_length		padding length
	 * @return {string}
	 */
	String.prototype.rpad = function(arg_padding_str, arg_padding_length)
	{
		var str = this;
		while (str.length < arg_padding_length)
		{
			str += arg_padding_str;
		}
		return str;
	}
	

	/**
	 * @memberof			DevaptTypes
	 * @public
	 * @static
	 * @method				DevaptTypes.get_value(arg_value, arg_default_value)
	 * @desc				Get a value or default value if null or undefined
	 * @param {anything}	arg_value			value to convert
	 * @param {anything}	arg_default_value	default value
	 * @return {anything}
	 */
	DevaptTypes.get_value = function(arg_value, arg_default_value)
	{
		return ( DevaptTypes.is_undefined(arg_value) || DevaptTypes.is_null(arg_value) ) ? arg_default_value : arg_value;
	}
	
	
	/**
	 * @memberof				DevaptTypes
	 * @public
	 * @method					clone_object(arg_object_to_clone)
	 * @desc					Duplicate an existing object
	 * @param {object}			arg_object_to_clone		Object to clone
	 * @return {object}			Clone
	 */
	DevaptTypes.clone_object = function(arg_object_to_clone)
	{
		// console.log(arg_object_to_clone, 'DevaptTypes.arg_object_to_clone');
		
		// NULL OR SIMPLE TYPE (NOT OBJECT)
		if (arg_object_to_clone === null || arg_object_to_clone === true || arg_object_to_clone === false)
		{
			// console.log(arg_object_to_clone, 'clone null or boolean');
			return arg_object_to_clone;
		}
		
		// EMPTY ARRAY
		if ( DevaptTypes.is_empty_array(arg_object_to_clone) )
		{
			// console.log(arg_object_to_clone, 'clone empty array');
			return new Array();
		}
		
		// EMPTY OBJECT
		if ( DevaptTypes.is_empty_object(arg_object_to_clone)  )
		{
			// console.log(arg_object_to_clone, 'clone empty object');
			return new Object();
		}
		
		// FUNCTION
		if ( DevaptTypes.is_function(arg_object_to_clone)  )
		{
//			console.debug(arg_object_to_clone, 'do not clone function');
			return arg_object_to_clone;
		}
		
		// STRING
		if ( DevaptTypes.is_string(arg_object_to_clone) )
		{
			// console.log(arg_object_to_clone, 'clone string');
			return arg_object_to_clone;
		}
		
		// DATE
		if ( DevaptTypes.is_date(arg_object_to_clone) )
		{
			// console.log(arg_object_to_clone, 'clone date');
			return new Date(arg_object_to_clone.getTime());
		}
		
		// NOT EMPTY ARRAY
		if ( DevaptTypes.is_array(arg_object_to_clone) )
		{
//			console.debug(arg_object_to_clone, 'clone array');
			
			var tmp = new Array();
			for(var key in arg_object_to_clone)
			{
//				console.debug(arg_object_to_clone[key], 'clone array item [' + key + ']');
				var cloned_object = DevaptTypes.clone_object(arg_object_to_clone[key]);
				tmp.push(cloned_object);
			}
			return tmp;
		}
		
		// DEVAPT OBJECT
		if ( DevaptTypes.is_object(arg_object_to_clone) && arg_object_to_clone._class && DevaptTypes.is_not_empty_str(arg_object_to_clone.class_name) )
		{
//			console.debug(arg_object_to_clone, 'do not clone Devapt object');
			
			// NOTHING TO DO
			return arg_object_to_clone;
		}
		
		// JQUERY NODE OBJECT
		if ( DevaptTypes.is_object(arg_object_to_clone) && DevaptTypes.is_not_empty_str(arg_object_to_clone.tagName) )
		{
//			console.debug(arg_object_to_clone, 'do not clone jQuery node object');
			
			// NOTHING TO DO
			return arg_object_to_clone;
		}
		
		// JQUERY SELECTOR OBJECT
		if ( DevaptTypes.is_object(arg_object_to_clone) && arg_object_to_clone.selector )
		{
//			console.debug(arg_object_to_clone, 'do not clone jQuery selector object');
			
			// NOTHING TO DO
			return arg_object_to_clone;
		}
		
		// NOT EMPTY OBJECT
		if ( DevaptTypes.is_object(arg_object_to_clone) )
		{
//			console.debug(arg_object_to_clone, 'clone object');
//			var cloned_object = jQuery.extend(true, new Object(), arg_object_to_clone);
			
			var tmp = {};
			for(var key in arg_object_to_clone)
			{
//				console.debug(arg_object_to_clone[key], 'clone object item [' + key + ']');
				
				var cloned_object = DevaptTypes.clone_object(arg_object_to_clone[key]);
				tmp[key] = cloned_object;
			}
			
			return tmp;
		}
		
//		console.debug(arg_object_to_clone, 'not cloned object');
		return arg_object_to_clone;
	}
	
	return DevaptTypes;
} );
/**
 * @file        object/classes.js
 * @desc        Devapt static classes features
 * 		API
 * 			STATIC PUBLIC ATTRIBUTES
 * 				DevaptClasses.classes_trace = true
 * 				DevaptClasses.introspect_classes_array = []
 * 				DevaptClasses.introspect_classes_by_name = {}
 * 				DevaptClasses.introspect_instances_array = []
 * 				DevaptClasses.introspect_instances_by_name = {}
 * 				
 * 			STATIC PUBLIC METHODS
 * 				DevaptClasses.get_classes_array():array
 * 				DevaptClasses.get_classes_map():object
 * 				DevaptClasses.get_instances_array():array
 * 				DevaptClasses.get_instances_map():object
 * 
 * 				DevaptClasses.add_class(arg_class_object):nothing
 * 				DevaptClasses.get_class(arg_class_name):object|null
 * 
 * 				DevaptClasses.add_instance(arg_instance_object):nothing
 * 				DevaptClasses.get_instance(arg_instance_name):object|null
 * 
 * 				DevaptClasses.new_class_uid():integer
 * 				DevaptClasses.new_instance_uid():integer
 * 			
 * @ingroup     DEVAPT_OBJECT
 * @date        2013-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('object/classes',['Devapt', 'core/traces', 'core/types'],
function(Devapt, DevaptTraces, DevaptTypes)
{
	/**
	 * @memberof	DevaptClasses
	 * @public
	 * @class
	 * @desc		Devapt classes features container
	 */
	var DevaptClasses = {};
	
	
	/**
	 * @memberof	DevaptClasses
	 * @public
	 * @static
	 * @desc		Trace flag
	 */
	DevaptClasses.classes_trace = true;
	
	
	/**
	 * @memberof	DevaptClasses
	 * @public
	 * @static
	 * @desc		Array of class objects
	 */
	DevaptClasses.introspect_classes_array = [];



	/**
	 * @memberof	DevaptClasses
	 * @public
	 * @static
	 * @desc		Associative array of class instances objects
	 */
	DevaptClasses.introspect_classes_by_name = {};
	
	
	/**
	 * @memberof	DevaptClasses
	 * @public
	 * @static
	 * @desc		Array of class instances objects
	 */
	DevaptClasses.introspect_instances_array = [];



	/**
	 * @memberof	DevaptClasses
	 * @public
	 * @static
	 * @desc		Associative array of class objects
	 */
	DevaptClasses.introspect_instances_by_name = {};



	/**
	 * @memberof	DevaptClasses
	 * @public
	 * @static
	 * @desc		Associative array of class objects filtered by type: model/view/...
	 */
	DevaptClasses.introspect_instances_by_type = {};
	DevaptClasses.introspect_instances_by_type.model = [];
	DevaptClasses.introspect_instances_by_type.view = [];
	
	
	
	/**
	 * @memberof			DevaptClasses
	 * @public
	 * @static
	 * @method				DevaptClasses.get_classes_array()
	 * @desc				Get the classes array
	 * @return {array}		Array of objects
	 */
	DevaptClasses.get_classes_array = function()
	{
		return DevaptClasses.introspect_classes_array;
	}
	
	/**
	 * @memberof			DevaptClasses
	 * @public
	 * @static
	 * @method				DevaptClasses.get_classes_map()
	 * @desc				Get the classes map
	 * @return {object}		Associative array of objects
	 */
	DevaptClasses.get_classes_map = function()
	{
		return DevaptClasses.introspect_classes_by_name;
	}
	/**
	 * @memberof			DevaptClasses
	 * @public
	 * @static
	 * @method				DevaptClasses.get_instances_array()
	 * @desc				Get the classes instances array
	 * @return {array}		Array of objects
	 */
	DevaptClasses.get_instances_array = function()
	{
		return DevaptClasses.introspect_instances_array;
	}
	
	/**
	 * @memberof			DevaptClasses
	 * @public
	 * @static
	 * @method				DevaptClasses.get_instances_map()
	 * @desc				Get the classes instances map
	 * @return {object}		Associative array of objects
	 */
	DevaptClasses.get_instances_map = function()
	{
		return DevaptClasses.introspect_instances_by_name;
	}
	
	
	/**
	 * @memberof			DevaptClasses
	 * @public
	 * @static
	 * @method				DevaptClasses.add_class(class)
	 * @desc				Add a class object
	 * @param {object}		arg_class_object		class object
	 * @return {nothing}
	 */
	DevaptClasses.add_class = function(arg_class_object)
	{
		DevaptClasses.introspect_classes_by_name[arg_class_object.infos.class_name] = arg_class_object;
		DevaptClasses.introspect_classes_array.push(arg_class_object);
	}
	
	
	/**
	 * @memberof			DevaptClasses
	 * @public
	 * @static
	 * @method				DevaptClasses.get_class(class name)
	 * @desc				Get a class object
	 * @param {string}		arg_class_name		class name
	 * @return {object|null}	class object
	 */
	DevaptClasses.get_class = function(arg_class_name)
	{
		var obj = DevaptClasses.introspect_classes_by_name[arg_class_name];
		return obj ? obj : null;
	}
	
	
	/**
	 * @memberof			DevaptClasses
	 * @public
	 * @static
	 * @method				DevaptClasses.add_instance(instance)
	 * @desc				Add a class instance object
	 * @param {object}		arg_instance_object		class instance object
	 * @return {nothing}
	 */
	DevaptClasses.add_instance = function(arg_instance_object)
	{
		DevaptClasses.introspect_instances_by_name[arg_instance_object.name] = arg_instance_object;
		DevaptClasses.introspect_instances_array.push(arg_instance_object);
		
		// INSTANCE IS A MODEL
		// console.log(arg_instance_object.is_model, arg_instance_object.name + '.is_model');
		if (arg_instance_object.is_model)
		{
			DevaptClasses.introspect_instances_by_type.model.push(arg_instance_object);
		}
		
		// INSTANCE IS A VIEW
		// console.log(arg_instance_object.is_view, arg_instance_object.name + '.is_view');
		if (arg_instance_object.is_view)
		{
			DevaptClasses.introspect_instances_by_type.view.push(arg_instance_object);
		}
	}
	
	
	/**
	 * @memberof			DevaptClasses
	 * @public
	 * @static
	 * @method				DevaptClasses.get_instance(instance name)
	 * @desc				Get an instance object
	 * @param {string}		arg_instance_name		instance name
	 * @return {object|null}	instance object
	 */
	DevaptClasses.get_instance = function(arg_instance_name)
	{
		var obj = DevaptClasses.introspect_instances_by_name[arg_instance_name];
		return obj ? obj : null;
	}
	
	
	/**
	 * @memberof			DevaptClasses
	 * @public
	 * @static
	 * @method				DevaptClasses.get_model_instances()
	 * @desc				Get all instances objects of type model
	 * @return {array}		array of instance object
	 */
	DevaptClasses.get_model_instances = function()
	{
		return DevaptClasses.introspect_instances_by_type.model;
	}
	
	
	/**
	 * @memberof			DevaptClasses
	 * @public
	 * @static
	 * @method				DevaptClasses.get_view_instances()
	 * @desc				Get all instances objects of type view
	 * @return {array}		array of instance object
	 */
	DevaptClasses.get_view_instances = function()
	{
		return DevaptClasses.introspect_instances_by_type.view;
	}
	
	
	
	/**
	 * @memberof				DevaptClasses
	 * @public
	 * @static
	 * @method					DevaptClasses.new_class_uid()
	 * @desc					
	 * @return {integer}
	 */
	DevaptClasses.new_class_uid = function()
	{
		var context = 'DevaptClasses.new_class_uid()';
		DevaptTraces.trace_enter(context, '', DevaptClasses.classes_trace);
		
		DevaptTraces.trace_leave(context, '', DevaptClasses.classes_trace);
		return DevaptClasses.introspect_classes_array.length;
	}
	
	
	
	/**
	 * @memberof				DevaptClasses
	 * @public
	 * @static
	 * @method					DevaptClasses.new_instance_uid()
	 * @desc					
	 * @return {integer}
	 */
	DevaptClasses.new_instance_uid = function()
	{
		var context = 'DevaptClasses.new_instance_uid()';
		DevaptTraces.trace_enter(context, '', DevaptClasses.classes_trace);
		
		DevaptTraces.trace_leave(context, '', DevaptClasses.classes_trace);
		return DevaptClasses.introspect_instances_array.length;
	}
	
	
	
	
	

	/**
	 * @memberof				DevaptClasses
	 * @public
	 * @static
	 * @method					DevaptClasses.get_class_name(arg_class_proto)
	 * @desc					Get a class name from a class prototype, a class object, a class name
	 * @param {object|string}	arg_class_value			A class name, a class instance, a class prototype
	 * @return {string}
	 */
/*	DevaptClasses.get_class_name = function(arg_class_value)
	{
		var context = 'DevaptClasses.get_class_name(class value)';
		DevaptTraces.trace_enter(context, '', DevaptClasses.classes_trace);
		
		
		// CHECK ARGS
		if ( DevaptTypes.is_null(arg_class_value) )
		{
			DevaptTraces.trace_leave(context, 'class value is null', DevaptClasses.classes_trace);
			return null;
		}
		
		// GET CLASS NAME FROM A STRING
		if ( DevaptTypes.is_string(arg_class_value) )
		{
			// console.log('arg_class_value:' + arg_class_value);
			DevaptTraces.trace_leave(context, 'class value is a string', DevaptClasses.classes_trace);
			return arg_class_value;
		}
		
		// GET CLASS NAME FROM A FUNCTION
		if ( DevaptTypes.is_function(arg_class_value) )
		{
			DevaptTraces.trace_step(context, 'DevaptClasses.get_class_name : from a function', DevaptClasses.classes_trace);
			
			if ( DevaptTypes.is_string(arg_class_value.name) )
			{
				DevaptTraces.trace_leave(context, 'class value is a function and its name is a string', DevaptClasses.classes_trace);
				return arg_class_value.name;
			}
			else
			{
				DevaptTraces.trace_step(context, 'DevaptClasses.get_class_name : from a function : without .name', DevaptClasses.classes_trace);
				
				if (arg_class_value.prototype.name !== undefined)
				{
					DevaptTraces.trace_leave(context, 'class value is a function and its prototype name is defined', DevaptClasses.classes_trace);
					return arg_class_value.prototype.name;
				}
				else
				{
					var func_name_regex = /function\s+(.{1,})\s*\(/;
					var src_code = arg_class_value.toString();
					var results = func_name_regex.exec(src_code);
					var class_name = (results && results.length > 1) ? results[1] : "";
					
					DevaptTraces.trace_leave(context, 'class value is a function and its prototype name is undefined', DevaptClasses.classes_trace);
					return class_name;
				}
			}
		}
		
		// GET CLASS NAME FROM A DevaptObject OR PARENT CLASS INSTANCE
		if ( DevaptTypes.is_object(arg_class_value) )
		{
			if ( DevaptTypes.is_string(arg_class_value.class_name) )
			{
				DevaptTraces.trace_leave(context, 'class value is an object and class value object name is a string', DevaptClasses.classes_trace);
				return arg_class_value.class_name;
			}
		}
		
		
		DevaptTraces.trace_leave(context, 'bad class value', DevaptClasses.classes_trace);
		return null;
	}
*/




	/**
	 * @memberof			DevaptClasses
	 * @public
	 * @static
	 * @method				DevaptClasses.register_class_record(arg_class_obj)
	 * @desc				Register a class record
	 * @param {object}		arg_classe_obj
	 * @return {nothing}
	 */
/*	DevaptClasses.register_class_record = function(arg_class_obj)
	{
		var context = 'DevaptClasses.register_class_record(class record)';
		DevaptTraces.trace_enter(context, '', DevaptClasses.classes_trace);
		DevaptTraces.trace_value(context, 'typeof class object', typeof arg_class_obj, DevaptClasses.classes_trace);
		DevaptTraces.trace_value(context, 'class object', arg_class_obj, DevaptClasses.classes_trace);
		// console.log(arg_class_obj, 'arg_class_obj');
		
		
		// CHECK CLASS RECORD
		if ( ! DevaptTypes.is_object(arg_class_obj) )
		{
			DevaptTraces.error(context + ': bad class record');
			DevaptTraces.trace_leave(context, 'bad class record', DevaptClasses.classes_trace);
			return;
		}
		
		// CHECK CLASS RECORD ATTRIBUTES
		if ( ! DevaptTypes.is_string(arg_class_obj.name) )
		{
			DevaptTraces.error(context + ': bad class record name');
			DevaptTraces.trace_leave(context, 'bad class record name', DevaptClasses.classes_trace);
			return;
		}
		if ( ! DevaptTypes.is_array(arg_class_obj.parents_array) )
		{
			DevaptTraces.error(context + ': bad class record parents');
			DevaptTraces.trace_leave(context, 'bad class record parents', DevaptClasses.classes_trace);
			return;
		}
		if ( ! DevaptTypes.is_object(arg_class_obj.parents_by_name) )
		{
			arg_class_obj.parents_by_name = {};
		}
		
		// REGISTER CLASS RECORD
		DevaptClasses.introspect_classes_array.push(arg_class_obj);
		DevaptClasses.introspect_classes_by_name[arg_class_obj.name] = arg_class_obj;
		DevaptTraces.trace_value(context, 'typeof arg_class_obj', typeof arg_class_obj, DevaptClasses.classes_trace);
		DevaptTraces.trace_value(context, 'arg_class_obj', arg_class_obj, DevaptClasses.classes_trace);
					
		// UPDATE INHERITANCES
		for(parent_index in arg_class_obj.parents_array)
		{
			var parent_value = arg_class_obj.parents_array[parent_index];
			// console.log(parent_value, 'parent_value');
			if ( DevaptTypes.is_string(parent_value) )
			{
				var class_record = DevaptClasses.introspect_classes_by_name[parent_value];
				if ( ! DevaptTypes.is_object(class_record) )
				{
					DevaptClasses.classes_trace = true;
					DevaptTraces.trace_value(context, 'typeof inherited class record', typeof class_record, DevaptClasses.classes_trace);
					DevaptTraces.trace_value(context, 'inherited class record', class_record, DevaptClasses.classes_trace);
					DevaptTraces.error(context + ': bad inherited class record [' + parent_value + ']');
					DevaptClasses.classes_trace = false;
					DevaptTraces.trace_leave(context, 'bad inherited class record', DevaptClasses.classes_trace);
					return;
				}
				
				arg_class_obj.parents_array[parent_index] = class_record;
				arg_class_obj.parents_by_name[class_record.name] = class_record;
				
				class_record.childs_array.push(arg_class_obj);
				class_record.childs_by_name[arg_class_obj.name] = arg_class_obj;
			}
		}
		
		
		DevaptTraces.trace_leave(context, 'success', DevaptClasses.classes_trace);
	}*/



	/**
	 * @memberof			DevaptClasses
	 * @public
	 * @static
	 * @method				DevaptClasses.register_class(arg_class_proto, arg_class_parents, arg_class_author, arg_class_updated, arg_class_desc)
	 * @desc				Register a class
	 * @param {object}		arg_class_proto
	 * @param {array}		arg_class_parents
	 * @param {string}		arg_class_author
	 * @param {string}		arg_class_updated
	 * @param {string}		arg_class_desc
	 * @return {nothing}
	 */
/*	DevaptClasses.register_class = function(arg_class_proto, arg_class_parents, arg_class_author, arg_class_updated, arg_class_desc)
	{
		var context = 'DevaptClasses.register_class(proto,parents,author,updated,descr)';
		DevaptTraces.trace_enter(context, '', DevaptClasses.classes_trace);
		DevaptTraces.trace_value(context, 'typeof arg_class_proto', typeof arg_class_proto, DevaptClasses.classes_trace);
		DevaptTraces.trace_value(context, 'arg_class_proto', arg_class_proto, DevaptClasses.classes_trace);
		// console.log(arg_class_proto, 'arg_class_proto');
		
		
		// CHECK CLASS NAME
		// if ( ! DevaptTypes.is_function(arg_class_proto) )
		// {
			// DevaptTraces.error(context + ': bad class prototype');
			// DevaptTraces.trace_leave(context, 'bad class prototype', DevaptClasses.classes_trace);
			// return;
		// }
		
		// CHECK CLASS PARENTS
		if ( ! DevaptTypes.is_array(arg_class_parents) )
		{
			arg_class_parents = [];
		}
		
		// CHECK CLASS AUTHOR
		if ( ! DevaptTypes.is_string(arg_class_author) || arg_class_author.length == 0 )
		{
			arg_class_author = 'Luc BORIES';
		}
		
		// CHECK CLASS UPDATE DATE
		if ( ! DevaptTypes.is_string(arg_class_updated) || arg_class_updated.length == 0 )
		{
			arg_class_updated = '2013-01-01';
		}
		
		// CHECK CLASS DESCRIPTION
		if ( ! DevaptTypes.is_string(arg_class_desc) )
		{
			arg_class_desc = '';
		}
		
		var class_record =
			{
				name: Devapt.get_prototype_name(arg_class_proto),
				proto: arg_class_proto,
				parents_array: arg_class_parents,
				parents_by_name: {},
				childs_array: [],
				childs_by_name: {},
				options_array: [],
				options_by_name: {},
				author: arg_class_author,
				updated: arg_class_updated,
				description: arg_class_desc
			};
		
		DevaptClasses.register_class_record(class_record);
		
		
		DevaptTraces.trace_leave(context, 'success', DevaptClasses.classes_trace);
	}*/
	
	
	return DevaptClasses;
} );
/**
 * @file        object/class.js
 * @desc        Devapt class introspection feature
 * 		API
 * 			ATTRIBUTES
 * 				self.infos						class informations
 * 				self.infos.proto				class instance prototype
 * 				self.infos.parent_class			"parent class" object
 * 				self.infos.parent_classes		deep "parent class" array
 * 				self.infos.children_classes		children classes objects array
 * 				self.infos.class_name			class name
 * 				self.infos.class_uid			class unique identifier
 * 				self.infos.author				class author
 * 				self.infos.created				class creation date
 * 				self.infos.updated				class last update date
 * 				self.infos.description			class description
 * 				self.infos.is_singleton			only one instance can be created (boolean)
 * 				self.infos.singleton			only one instance can be created (boolean)
 * 				
 * 				self.decorators					methods decorators records
 * 				self.decorators.all_ordered		decorators records array
 * 				self.decorators.all_map			decorators records object
 * 				self.decorators.own_ordered		decorators records array
 * 				self.decorators.own_map			decorators records object
 * 				
 * 				self.mixins						class instance mixins records
 * 				self.mixins.all_ordered			mixins records array
 * 				self.mixins.all_map				mixins records object
 * 				self.mixins.own_ordered			mixins records array
 * 				self.mixins.own_map				mixins records object
 * 				
 * 				self.methods					class instance methods records
 * 				self.methods.all_ordered		methods records array
 * 				self.methods.all_map			methods records object
 * 				self.methods.own_ordered		methods records array
 * 				self.methods.own_map			methods records object
 * 				
 * 				self.properties					class instance properties records
 * 				self.properties.all_ordered		properties records array
 * 				self.properties.all_map			properties records object
 * 				self.properties.all_alias_map	properties records object with aliases names
 * 				self.properties.own_ordered		properties records array
 * 				self.properties.own_map			properties records object
 * 
 * 			PRIVATE METHODS
 * 				fill_methods(arg_class, arg_ordered_methods, arg_map_methods, arg_new_methods)
 * 				fill_properties(arg_class, arg_ordered_properties, arg_map_properties, arg_new_properties)
 * 				build_methods(arg_class)
 * 				build_properties(arg_class)
 * 				new_method_record(arg_name, arg_method_record, arg_method_cb)
 * 				set_property_with_settings(arg_class, arg_target_object, arg_property_record, arg_settings_object)
 * 				apply_properties(arg_class, arg_class_instance, arg_instance_settings)
 * 				build_all_collectpions(arg_class)
 * 				extend_class(arg_class, arg_parent_class)
 * 				
 * 			PUBLIC METHODS
 * 				self.add_static_method(arg_name, arg_method_record, arg_method_cb)
 * 				self.add_public_method(arg_name, arg_method_record, arg_method_cb)
 * 				self.add_public_mixin(arg_mixin_class)
 * 				self.add_property_record(arg_property_record)
 * 				self.add_static_property(arg_property_type, arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_visibility, arg_aliases, itemtype, separator)
 * 				self.add_property(arg_property_type, arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_visibility, arg_aliases, itemtype, separator)
 * 				self.add_public_str_property(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases)
 * 				self.add_public_int_property(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases)
 * 				self.add_public_bool_property(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases)
 * 				self.add_public_obj_property(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases)
 * 				self.add_public_array_property(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases, itemtype, separator)
 * 				self.add_public_cb_property(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases)
 * 				self.build_class()
 * 				self.create(arg_settings)
 * 
 * 			METHOD RECORD
 * 				{
 * 					name:null,
 * 					description:null,
 * 					
 * 					visibility:'public',
 * 					is_static:false,
 * 					is_singleton:false,
 * 					
 * 					callback:null,
 * 					events:{
 * 						listen:[
 * 							{
 * 								event: (string),
 * 								method: (string)
 * 							}
 * 						]
 * 						emit: [
 * 							{
 * 								event: (string),
 * 								operands: [
 * 									{
 * 										type: (string)
 * 									}
 * 								]
 * 							}
 * 						]
 * 					}
 * 					operands:[
 * 						{
 * 							name: (string),
 * 							type: (string),
 * 							default: (anything),
 * 							mutable: (boolean)
 * 						}
 * 					],
 * 					result:{
 * 						type:'nothing',
 * 						default_value:null,
 * 						failure_value:null,
 * 						success:function(value){return value !== null},
 * 						failure:function(value){return value === null}
 * 					}
 * 				}
 * 			
 * 			PROPERTY RECORD:
 * 				{
 * 					name:'property1',
 * 					description:'a property',
 * 					aliases:[],
 * 					
 * 					visibility:'public',
 * 					is_static:false,
 * 					is_readonly:false,
 * 					is_initializable:true,
 * 					is_required:false,
 * 					
 * 					type:'string',
 * 					default_value:...,
 * 					array_separator:'...',
 * 					array_type:'...',
 * 					format:'...',
 * 					
 * 					children:[]
 * 				}
 * 
 * @ingroup     DEVAPT_OBJECT
 * @date        2014-11-24
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('object/class',['core/types', 'object/classes'],
function(DevaptTypes, DevaptClasses)
{
	var DevaptTraces = {
		trace_enter: function(context, msg, trace)
			{
				if (trace)
				{
					console.log(context + ' ENTER:' + msg);
				}
			},
		trace_leave: function(context, msg, trace)
			{
				if (trace)
				{
					console.log(context + ' LEAVE:' + msg);
				}
			},
		trace_step: function(context, msg, trace)
			{
				if (trace)
				{
					console.log(context + ' STEP:' + msg);
				}
			},
		trace_value: function(context, msg, value, trace)
			{
				if (trace)
				{
					console.log(context + ' VALUE:' + msg, value);
					// console.log(value, msg);
				}
			},
		trace_error: function(context, msg, trace)
			{
				if (trace)
				{
					console.error(context + ' ERROR:' + msg);
				}
				else
				{
					console.error(context + ' ERROR:' + msg);
				}
			},
		error: function(context, msg, trace)
			{
				if (trace)
				{
					console.error(context + ' ERROR:' + msg);
				}
				else
				{
					console.error(context + ' ERROR:' + msg);
				}
			}
	};
	
	
	
	// ------------------------------------------------ PRIVATE FUNCTION : REGISTER METHODS ------------------------------------------------
	/**
	 * @memberof				DevaptClass
	 * @private
	 * @method					fill_methods(arg_ordered_methods, arg_map_methods, arg_new_methods)
	 * @desc					Register methods records with all attributes
	 * @param {object}			arg_class				a class object
	 * @param {array}			arg_ordered_methods		an array of registered methods records
	 * @param {object}			arg_map_methods			a map of registered methods records
	 * @param {object|array}	arg_new_methods			an array or an object of methods records to register
	 * @return {nothing}
	 */
	function fill_methods(self, arg_ordered_methods, arg_map_methods, arg_new_methods)
	{
		var context = 'DevaptClass:fill_methods(ordered_methods,map_methods,new_methods)';
		DevaptTraces.trace_enter(context, '', self.trace);
		
		
		// RESET BUILD FLAG
		self.is_build = false;
		
		if ( DevaptTypes.is_array(arg_new_methods) || DevaptTypes.is_object(arg_new_methods) )
		{
			DevaptTraces.trace_step(context, 'is array or object', self.trace);
			
			for(var method_key in arg_new_methods)
			{
				DevaptTraces.trace_step(context, 'loop at key [' + method_key + ']', self.trace);
				
				// INIT DEFAULT METHOD ATTRIBUES
				var new_record = {
					name:null,
					description:null,
					
					visibility:'public',
					is_static:false,
					is_singleton:false,
					
					callback:null,
					operands:[],
					result:{
						type:'nothing',
						default_value:null,
						failure_value:null,
						success:function(value){return value !== null; },
						failure:function(value){return value === null; }
					}
				};
				
				// GET SETTINGS ATTRIBUTES
				var setting_record = arg_new_methods[method_key];
				
				// MERGE DEFAULT AND SETTINGS ATTRIBUTES
				jQuery.extend(new_record, setting_record);
				// console.log(new_record, context);
				
				// CHECK METHOD NAME
				if ( DevaptTypes.is_empty_str(new_record.name) )
				{
					console.error(new_record, 'bad method record');
					continue;
				}
				
				// REGISTER METHOD
				arg_ordered_methods.push(new_record);
				arg_map_methods[new_record.name] = new_record;
			}
		}
		
		
		DevaptTraces.trace_leave(context, '', self.trace);
	}
	
	
	
	// ------------------------------------------------ PRIVATE FUNCTION : REGISTER MIXINS ------------------------------------------------
	/**
	 * @memberof				DevaptClass
	 * @private
	 * @method					fill_mixins(arg_ordered_mixins, arg_map_mixins, arg_new_mixins)
	 * @desc					Register methods records with all attributes
	 * @param {object}			arg_class				a class object
	 * @param {array}			arg_ordered_mixins		an array of registered mixins
	 * @param {object}			arg_map_mixins			a map of registered mixins
	 * @param {object|array}	arg_new_mixins			an array or an object of mixins to register
	 * @return {nothing}
	 */
	function fill_mixins(self, arg_ordered_mixins, arg_map_mixins, arg_new_mixins)
	{
		var context = 'DevaptClass:fill_mixins(ordered_mixins,map_mixins,new_mixins)';
		DevaptTraces.trace_enter(context, self.infos.class_name, self.trace);
		
		
		// RESET BUILD FLAG
		self.is_build = false;
		
		if ( DevaptTypes.is_array(arg_new_mixins) || DevaptTypes.is_object(arg_new_mixins) )
		{
			DevaptTraces.trace_step(context, 'is array or object', self.trace);
			
			for(var mixin_key in arg_new_mixins)
			{
				DevaptTraces.trace_step(context, 'loop at key [' + mixin_key + ']', self.trace);
				
				// GET MIXIN mixin_class
				var mixin_class = arg_new_mixins[mixin_key];
				// console.log(mixin_class, 'fill_mixins');
				DevaptTraces.trace_value(context, 'loop mixin name', mixin_class.infos.class_name, self.trace);
				
				if ( DevaptTypes.is_object(mixin_class) && mixin_class.infos )
				{
					// REGISTER MIXIN
					arg_ordered_mixins.push(mixin_class);
					arg_map_mixins[mixin_class.infos.class_name] = mixin_class;
				}
			}
		}
		
		
		DevaptTraces.trace_leave(context, '', self.trace);
	}
	
	
	
	// ------------------------------------------------ PRIVATE FUNCTION : REGISTER PROPERTIES ------------------------------------------------
	/**
	 * @memberof				DevaptClass
	 * @private
	 * @method					fill_properties(arg_ordered_properties, arg_map_properties, arg_new_properties)
	 * @desc					Register properties records with all attributes
	 * @param {object}			arg_class				a class object
	 * @param {array}			arg_ordered_properties	an array of registered properties records
	 * @param {object}			arg_map_properties		a map of registered properties records
	 * @param {object|array}	arg_new_properties		an array or an object of properties records to register
	 * @return {nothing}
	 */
	function fill_properties(self, arg_ordered_properties, arg_map_properties, arg_new_properties)
	{
		var context = 'DevaptClass:fill_properties(ordered_properties,map_properties,new_properties)';
		DevaptTraces.trace_enter(context, '', self.trace);
		
		
		// RESET BUILD FLAG
		self.is_build = false;
		
		if ( DevaptTypes.is_array(arg_new_properties)|| DevaptTypes.is_object(arg_new_properties) )
		{
			DevaptTraces.trace_step(context, 'is array or object', self.trace);
			for(var property_key in arg_new_properties)
			{
				DevaptTraces.trace_step(context, 'loop at key [' + property_key + ']', self.trace);
				
				// DEFAULT PROPERTY RECORD VALUES
				var new_record = {
					name:null,
					description:null,
					aliases:[],
					
					visibility:'public',
					is_static:false,
					is_readonly:false,
					is_initializable:false,
					is_required:false,
					
					type:null,
					default_value:true,
					array_type:null,
					array_separator:null,
					format:null,
					
					children:[]
				};
				
				// CURRENT PROPERTY VALUES
				var setting_record = arg_new_properties[property_key];
				
				// SKIP STATIC AND PRIVATE PROPERTIES
				if (setting_record.is_static || setting_record.visibility === 'private')
				{
					continue;
				}
				
				// MERGE DEFAULT AND GIVEN VALUES
				jQuery.extend(new_record, setting_record);
				
				// CHECK ARGS
				if ( ! DevaptTypes.is_not_empty_str(new_record.name) )
				{
					console.error(new_record, 'bad property record (name)');
					continue;
				}
				if ( ! DevaptTypes.is_not_empty_str(new_record.type) )
				{
					console.error(new_record, 'bad property record (type)');
					continue;
				}
				new_record.type = new_record.type.toLocaleLowerCase();
				DevaptTraces.trace_value(context, 'new_record', new_record, self.trace);
				
				arg_ordered_properties.push(new_record);
				arg_map_properties[new_record.name] = new_record;
			}
		}
		
		
		DevaptTraces.trace_leave(context, '', self.trace);
	}
	
	
	
	// ------------------------------------------------ PRIVATE FUNCTION : BUILD METHODS ------------------------------------------------
	/**
	 * @memberof				DevaptClass
	 * @private
	 * @method					new_method_record(arg_name, arg_method_record, arg_method_cb)
	 * @desc					Create a method record with given method attribute
	 * @param {string}			arg_name			method name
	 * @param {object}			arg_method_record	method record
	 * @param {function}		arg_method_cb		method callback
	 * @return {object}
	 */
	function new_method_record(arg_name, arg_method_record, arg_method_cb)
	{
		// TEST ARGS
		if ( DevaptTypes.is_object(arg_name) )
		{
			var tmp = arg_method_record;
			arg_method_record = arg_name;
			arg_name = arg_method_record.name;
			arg_method_cb = tmp;
		}
		if ( DevaptTypes.is_function(arg_method_record) )
		{
			arg_method_cb = arg_method_record;
			arg_method_record = null;
		}
		if (! arg_method_record)
		{
			arg_method_record = {
				name:arg_name,
				visibility:'public'
			};
		}
		
		// SET NAME
		if (! arg_method_record.name)
		{
			arg_method_record.name = arg_name;
		}
		
		// SET CALLBACK
		var record_has_callback = DevaptTypes.is_function(arg_method_record.callback) || DevaptTypes.is_array(arg_method_record.callback);
		var cb_is_function_callback = DevaptTypes.is_function(arg_method_cb);
		var cb_is_method_callback = DevaptTypes.is_array(arg_method_cb) && arg_method_cb.length === 2 && DevaptTypes.is_function(arg_method_cb[1]);
		if (! record_has_callback)
		{
			// console.info('record has no callback');
			if (cb_is_function_callback || cb_is_method_callback)
			{
				// console.info('arg is a valid callback');
				arg_method_record.callback = arg_method_cb;
			}
		}
		// else
		// {
			// console.log(arg_method_record, 'arg_method_record');
			// console.log(arg_method_cb, 'arg_method_cb');
		// }
		
		return arg_method_record;
	}
	
	
	/**
	 * @memberof				DevaptClass
	 * @private
	 * @method					build_methods(arg_class, arg_ordered_methods)
	 * @desc					Append class methods to a class object
	 * @param {object}			arg_class				a class object
	 * @return {nothing}
	 */
	function build_methods(arg_class)
	{
		var self = arg_class;
		var context = 'DevaptClass.build_methods(class)';
		DevaptTraces.trace_enter(context, '', self.trace);
		
		
		// CHECK ARGS
		if ( ! DevaptTypes.is_object(self) )
		{
			DevaptTraces.trace_leave(context, 'failure: bad class object', self.trace);
			return;
		}
		if ( ! DevaptTypes.is_array(self.methods.all_ordered) )
		{
			DevaptTraces.trace_leave(context, 'failure: bad class methods array', self.trace);
			return;
		}
		
		
		// APPEND ALL METHODS CALLBACKS
		var arg_ordered_methods = self.methods.all_ordered;
		
		for(var index = 0 ; index < arg_ordered_methods.length ; index++)
		{
			var method_record = arg_ordered_methods[index];
			
			
			// CREATE METHOD CALLBACK
			var cb_method = (
				function(cb_self, index, arg_class_name)
				{
					return function()
					{
						var arg_method_record = cb_self.methods.all_ordered[index];
						var args_count = arguments ? arguments.length : 0;
						var cb_context = context + ': ' + arg_method_record.name + ' callback with [' + args_count + '] args:';
						// console.log(arguments, cb_context + 'arguments');
						
						
						// TEST PRIVATE CALL
						if (arg_method_record.visibility === 'private')
						{
							// CHECK PRIVATE CALL
							if ( arg_class_name !== cb_self.infos.class_name)
							{
								DevaptTraces.trace_leave(context, 'failure: bad private method call', self.trace);
								return arg_method_record.failure_value;
							}
						}
						
						// TEST PROTECTED CALL
						if (arg_method_record.visibility === 'protected')
						{
						}
						
						// TODO CHECK ARGS COUNT
						
						
						// CALL METHOD
						var result_value = null;
						if (arg_method_record.callback)
						{
							result_value = arg_method_record.callback.apply(this, arguments);
						}
						else
						{
							console.log(cb_self, 'cb_self');
							console.log(arg_class_name, 'arg_class_name');
							console.log(arg_method_record, 'arg_method_record');
							console.error(arg_method_record, 'bad callback for method record');
						}
						
						// TEST CALL RESULT
						if ( arg_method_record.result && DevaptTypes.is_function(arg_method_record.result.success) )
						{
							var is_success = arg_method_record.result.success.call([result_value]);
							if (is_success)
							{
								// TODO
							}
						}
						
						return result_value;
					}
				}
			)(self, index, self.infos.class_name);
			
			
			// STATIC METHOD
			if (method_record.is_static)
			{
				self[method_record.name] = cb_method;
				continue;
			}
			
			// NON STATIC METHOD
			self.infos.proto[method_record.name] = cb_method;
		}
		
		
		DevaptTraces.trace_leave(context, '', self.trace);
	}
	
	
	
	// ------------------------------------------------ PRIVATE FUNCTION : BUILD OR SET PROPERTIES ------------------------------------------------
	/**
	 * @memberof				DevaptClass
	 * @private
	 * @method					build_properties(arg_class)
	 * @desc					Append class properties to a class object
	 * @param {object}			arg_class		a class object
	 * @return {nothing}
	 */
	function build_properties(arg_class)
	{
		var self = arg_class;
		var context = 'DevaptClass.build_properties(class)';
		DevaptTraces.trace_enter(context, '', self.trace);
		
		
		// CHECK ARGS
		if ( ! DevaptTypes.is_object(self) )
		{
			DevaptTraces.trace_leave(context, 'failure: bad class object', self.trace);
			return;
		}
		if ( ! DevaptTypes.is_array(self.properties.all_ordered) )
		{
			DevaptTraces.trace_leave(context, 'failure: bad class properties array', self.trace);
			return;
		}
		
		// LOOP ON PROPERTIES RECORDS
		for(var index = 0 ; index < arg_class.properties.all_ordered.length ; index++)
		{
			var property_record = arg_class.properties.all_ordered[index];
			
			var setting_value = property_record.default_value;
			var setting_valus_is_devapt_object = DevaptTypes.is_object(setting_value) && DevaptTypes.is_not_empty_str(setting_value.class_name);
			if ( setting_value !== null && ! setting_valus_is_devapt_object )
			{
				// console.log(setting_value, 'clone [' + property_record.name + ']');
				setting_value = DevaptTypes.clone_object(setting_value);
			}
			
			self.infos.proto[property_record.name] = setting_value;
		}
		
		
		DevaptTraces.trace_leave(context, '', self.trace);
	}
	
	
	/**
	 * @memberof				DevaptClass
	 * @private
	 * @method					set_property_with_settings(arg_target_object, arg_property_record, arg_settings_object)
	 * @desc					Set a property value from a settings object to a target object with a property record definition
	 * @param {object}			arg_class					a class instance
	 * @param {object}			arg_target_object			target object
	 * @param {object}			arg_property_record			property record
	 * @param {object}			arg_settings_object			settings object
	 * @return {boolean}
	 */
	function set_property_with_settings(arg_class, arg_target_object, arg_property_record, arg_settings_object)
	{
		var context = 'DevaptClass:set_property_with_settings(target,property,settings)';
		DevaptTraces.trace_enter(context, '', arg_class.trace);
		DevaptTraces.trace_value(context, 'arg_property_record', arg_property_record, arg_class.trace);
		DevaptTraces.trace_value(context, 'arg_settings_object', arg_settings_object, arg_class.trace);
		
		
		// CHECK ARGS
		DevaptTraces.trace_step(context, 'check args', arg_class.trace);
		if ( ! DevaptTypes.is_object(arg_target_object) )
		{
			DevaptTraces.trace_error(context, 'bad target object', arg_class.trace);
			return;
		}
		if ( ! DevaptTypes.is_object(arg_property_record) )
		{
			DevaptTraces.trace_error(context, 'bad property record', arg_class.trace);
			return;
		}
		if ( ! DevaptTypes.is_object(arg_settings_object) )
		{
			console.log(arg_settings_object, 'arg_settings_object');
			DevaptTraces.trace_error(context, 'bad settings object', arg_class.trace);
			return;
		}
		
		
		// GET SETTING VALUE FOR PROPERTY NAME
		DevaptTraces.trace_step(context, 'get property name and value', arg_class.trace);
		var property_name = arg_property_record.name;
		var setting_value = arg_settings_object[property_name];
		// console.log(property_name, 'property_name');
		// console.log(arg_property_record.type, 'property type');
		// console.log(setting_value, 'setting_value');
		
		// GET POTENTIAL GIVEN VALUE FOR OPTION NAME AND ALIAS
		DevaptTraces.trace_step(context, 'search property alias and value', arg_class.trace);
		var property_name_alias = null;
		if (setting_value === undefined && DevaptTypes.is_not_empty_array(arg_property_record.aliases) )
		{
			for(var alias_index = 0 ; alias_index < arg_property_record.aliases.length ; alias_index++)
			{
				property_name_alias	= arg_property_record.aliases[alias_index];
				setting_value		= arg_settings_object[property_name_alias];
				if (setting_value !== undefined)
				{
					// END LOOP
					alias_index = arg_property_record.aliases.length;
				}
			}
		}
		
		
		// CHECK IF PROPERTY IS CONFIGURABLE
		DevaptTraces.trace_step(context, 'check configurable', arg_class.trace);
		if ( ! arg_property_record.is_initializable )
		{
			DevaptTraces.trace_error(context, 'property not initializable [' + property_name + '] for object [' + arg_target_object.name + ']', arg_class.trace);
			return false;
		}
		
		
		// CHECK REQUIRED PROPERTIES
		DevaptTraces.trace_step(context, 'check required', arg_class.trace);
		if (setting_value === undefined && arg_property_record.is_required)
		{
			DevaptTraces.trace_error(context, 'property is required and is not initialized [' + property_name + '] for object [' + arg_target_object.name + ']', arg_class.trace);
			return false;
		}
		
		
		// GET SETTING VALUE OR DEFAULT VALUE
		DevaptTraces.trace_step(context, 'get default value', arg_class.trace);
		var default_value	= arg_property_record.default_value;
		DevaptTraces.trace_value(context, 'default value', default_value, arg_class.trace);
		DevaptTraces.trace_value(context, 'setting value', setting_value, arg_class.trace);
		var setting_value_is_devapt_object = DevaptTypes.is_object(setting_value) && DevaptTypes.is_not_empty_str(setting_value.class_name);
		DevaptTraces.trace_value(context, 'setting_value_is_devapt_object', setting_value_is_devapt_object, arg_class.trace);
		// var setting_value_is_array = DevaptTypes.is_not_empty_array(setting_value);
		if ( ! setting_value_is_devapt_object )
		{
			setting_value = setting_value ? DevaptTypes.clone_object(setting_value) : DevaptTypes.clone_object(default_value);
		}
		// console.log(setting_value, 'value to clone for [' + property_name + ']');
		// if ( setting_value_is_devapt_object )
		// {
			// console.info('SET DEVAPT OBJECT PROPERTY [' + property_name + '] OF OBJECT [' + arg_target_object.name + ']');
			// console.log(arg_target_object);
			// console.log(setting_value);
		// }
		
		
		// SHOULD REPLACE AN EXISTING NOT NULL VALUE
		DevaptTraces.trace_step(context, 'should replace an existing value', arg_class.trace);
		var arg_force_replace = true;
		var should_replace = arg_force_replace || DevaptTypes.is_null(setting_value) || jQuery.isEmptyObject(setting_value);
		if ( ! should_replace )
		{
			DevaptTraces.trace_leave(context, 'do not replace an existing not null value', arg_class.trace);
			return true;
		}
		
		
		// SWITCH VALUE TYPE
		DevaptTraces.trace_step(context, 'switch on type [' + arg_property_record.type + '] for property [' + property_name + ']', arg_class.trace);
		switch(arg_property_record.type)
		{
			case 'boolean':		arg_target_object[property_name] = DevaptTypes.to_boolean(setting_value, default_value);
								DevaptTraces.trace_leave(context, 'success for [' + arg_property_record.type + ']', arg_class.trace);
								return true;
								
			case 'integer':		arg_target_object[property_name] = DevaptTypes.to_integer(setting_value, default_value);
								DevaptTraces.trace_leave(context, 'success for [' + arg_property_record.type + ']', arg_class.trace);
								return true;
								
			case 'float':		arg_target_object[property_name] = DevaptTypes.to_float(setting_value, default_value);
								DevaptTraces.trace_leave(context, 'success for [' + arg_property_record.type + ']', arg_class.trace);
								return true;
								
			case 'date':		arg_target_object[property_name] = DevaptTypes.to_date(setting_value, default_value);
								DevaptTraces.trace_leave(context, 'success for [' + arg_property_record.type + ']', arg_class.trace);
								return true;
								
			case 'time':		arg_target_object[property_name] = DevaptTypes.to_time(setting_value);
								DevaptTraces.trace_leave(context, 'success for [' + arg_property_record.type + ']', arg_class.trace);
								return true;
								
			case 'datetime':	arg_target_object[property_name] = DevaptTypes.to_datetime(setting_value);
								DevaptTraces.trace_leave(context, 'success for [' + arg_property_record.type + ']', arg_class.trace);
								return true;
								
			case 'callback':	arg_target_object[property_name] = DevaptTypes.to_callback(setting_value);
								DevaptTraces.trace_leave(context, 'success for [' + arg_property_record.type + ']', arg_class.trace);
								return true;
								
			case 'string':		arg_target_object[property_name] = DevaptTypes.to_string(setting_value);
								DevaptTraces.trace_leave(context, 'success for [' + arg_property_record.type + ']', arg_class.trace);
								return true;
								
			case 'function':	arg_target_object[property_name] = DevaptTypes.to_string(setting_value);
								DevaptTraces.trace_leave(context, 'success for [' + arg_property_record.type + ']', arg_class.trace);
								return true;
								
			case 'object': 	{
								// self.trace = true;
								DevaptTraces.trace_step(context, 'property type is object for [' + property_name + ']', arg_class.trace);
								
								// VALUE IS AN OBJECT
								if ( DevaptTypes.is_object(setting_value) )
								{
									DevaptTraces.trace_step(context, 'setting_value is object for [' + property_name + ']', arg_class.trace);
									
									// CHECK CHILDREN SETTINGS
									if ( DevaptTypes.is_not_empty_array(arg_property_record.children) )
									{
										DevaptTraces.trace_step(context, 'arg_property_record.children is avalid string for [' + property_name + ']', arg_class.trace);
										
										arg_target_object[property_name] = new Object();
										for(var child_key in arg_property_record.children)
										{
											DevaptTraces.trace_step(context, 'get child at [' + child_key + '] for [' + property_name + ']', arg_class.trace);
											
											var child_property_record = arg_property_record.children[child_key];
											var result = set_property_with_settings(arg_class, arg_target_object[property_name], child_property_record, setting_value);
											if ( ! result )
											{
												DevaptTraces.trace_leave(context, 'failure for [' + arg_property_record.type + '] at child [' + child_property_record.name + ']', arg_class.trace);
												return false;
											}
										}
									}
									else
									{
										arg_target_object[property_name] = setting_value;
									}
									
									DevaptTraces.trace_leave(context, 'success for Object', arg_class.trace);
									// self.trace = false;
									return true;
								}
								
								// VALUE IS A STRING
								if ( DevaptTypes.is_string(setting_value) )
								{
									DevaptTraces.trace_step(context, 'setting_value is string for [' + property_name + ']', arg_class.trace);
									
									arg_target_object[property_name] = new Object();
									
									if ( DevaptTypes.is_not_empty_array(arg_property_record.children) )
									{
										DevaptTraces.trace_step(context, 'property has children', arg_class.trace);
										
										DevaptTraces.trace_value(context, 'setting_value', setting_value, arg_class.trace);
										
										arg_attributes_separator	= ',';
										arg_name_value_separator	= '=';
										
										var attributes_values = new Object();
										var attributes = setting_value.split(arg_attributes_separator);
										DevaptTraces.trace_value(context, 'attributes', attributes, arg_class.trace);
										
										if ( DevaptTypes.is_array(attributes) )
										{
											DevaptTraces.trace_step(context, 'settings has attributes', arg_class.trace);
											
											for(var attr_index = 0 ; attr_index < attributes.length ; attr_index++)
											{
												DevaptTraces.trace_step(context, 'loop on setting child [' + attr_index + ']', arg_class.trace);
												
												var attribute = attributes[attr_index].split(arg_name_value_separator);
												
												if ( DevaptTypes.is_array(attribute) && attribute.length == 2 )
												{
													var attr_key	= attribute[0];
													var attr_value	= attribute[1];
													attributes_values[attr_key]	= attr_value;
													
													DevaptTraces.trace_step(context, property_name + '.' + attr_key + '=' + attr_value, arg_class.trace);
												}
											}
										}
										
										// CHECK CHILDREN SETTINGS
										for(var child_key in arg_property_record.children)
										{
											DevaptTraces.trace_step(context, 'loop on property child [' + child_key + ']', arg_class.trace);
											
											var child_property_record = arg_property_record.children[child_key];
											var result = set_property_with_settings(arg_class, arg_target_object[property_name], child_property_record, attributes_values);
											if ( ! result )
											{
												DevaptTraces.trace_leave(context, 'failure for [' + arg_property_record.type + '] at child [' + child_property_record.name + ']', arg_class.trace);
												return false;
											}
										}
									}
									// arg_class.trace = false;
									DevaptTraces.trace_leave(context, 'success for Object', arg_class.trace);
									return true;
								}
								
								DevaptTraces.trace_leave(context, 'failure for [' + arg_property_record.type + ']', arg_class.trace);
								return false;
							}
							
			case 'array':	{
								// setting_value = DevaptTypes.clone_object(setting_value);
//								console.log(setting_value, arg_target_object.name + ':settings.array value');
								var values_array = DevaptTypes.to_array(setting_value, default_value, arg_property_record.array_separator);
								if ( DevaptTypes.is_not_empty_str(arg_property_record.array_type) )
								{
									DevaptTraces.trace_step(context, 'array property has array type', arg_class.trace);
									DevaptTraces.trace_value(context, 'arg_property_record.array_type', arg_property_record.array_type, arg_class.trace);
									
									for(var array_key in values_array)
									{
										var value = values_array[array_key];
										// console.log(value, 'value');
										
										values_array[array_key] = DevaptTypes.convert_value(value, null, arg_property_record.array_type);
										// console.log(values_array[array_key], 'converted value');
									}
								}
								arg_target_object[property_name] = values_array;
//								console.log(values_array, context + ':values_array');
								// console.log(arg_target_object, context + ':arg_target_object');
								
								DevaptTraces.trace_leave(context, 'success for [' + arg_property_record.type + ']', arg_class.trace);
								return true;
							}
		}
		
		
		DevaptTraces.trace_leave(context, 'bad property type [' + arg_property_record.type + '] for property [' + property_name + '] of class [' + arg_class.infos.class_name + ']', arg_class.trace);
		DevaptTraces.trace_error(context, 'bad property type [' + arg_property_record.type + '] for property [' + property_name + '] of class [' + arg_class.infos.class_name + ']', arg_class.trace);
		return false;
	}
	
	
	// ------------------------------------------------ PRIVATE FUNCTION : APPLY SETTINGS TO CLASS INSTANCE PROPERTIES ------------------------------------------------
	/**
	 * @memberof				DevaptClass
	 * @public
	 * @method					init_properties(class,instance)
	 * @desc					...
	 * @param {object}			arg_class				a class object
	 * @param {object}			arg_class_instance		a class instance object
	 * @return {nothing}
	 */
	function init_properties(arg_class, arg_class_instance)
	{
		var self = arg_class;
		var context = 'DevaptClass:init_properties(class,instance)';
		DevaptTraces.trace_enter(context, '', self.trace);
		
		
		// CHECK ARGS
		if ( ! DevaptTypes.is_object(arg_class) || ! DevaptTypes.is_object(arg_class.infos) )
		{
			DevaptTraces.trace_error(context, ':bad class object', arg_class.trace);
			return;
		}
		if ( ! DevaptTypes.is_object(arg_class_instance) )
		{
			DevaptTraces.trace_error(context, ':bad class instance object', arg_class.trace);
			return;
		}
		
		
		// LOOP ON PROPERTIES
		for(var property_name in arg_class.properties.all_map)
		{
			DevaptTraces.trace_step(context, 'loop on property name [' + property_name + ']', arg_class.trace);
			
			// GET PROPERTY RECORD
			var property_record = self.properties.all_map[property_name];
			if ( ! DevaptTypes.is_object(property_record) )
			{
				DevaptTraces.trace_error(context, ':bad property record for property name [' + property_name + ']', arg_class.trace);
				return;
			}
			
			// GET SETTING VALUE FOR PROPERTY NAME
			var settings = new Object();
			settings[property_name] = property_record.default_value;
			var set_result = set_property_with_settings(arg_class, arg_class_instance, property_record, settings);
		}
		
		
		DevaptTraces.trace_leave(context, '', self.trace);
	}
	
	
	/**
	 * @memberof				DevaptClass
	 * @public
	 * @method					apply_properties(arg_settings)
	 * @desc					...
	 * @param {object}			arg_class				a class object
	 * @param {object}			arg_class_instance		a class instance object
	 * @param {object}			arg_instance_settings	class instance properties
	 * @return {nothing}
	 */
	function apply_properties(arg_class, arg_class_instance, arg_instance_settings)
	{
		var self = arg_class;
		var context = 'DevaptClass:apply_properties(class,instance,settings)';
		DevaptTraces.trace_enter(context, '', self.trace);
		
		
		// CHECK ARGS
		if ( ! DevaptTypes.is_object(arg_class) || ! DevaptTypes.is_object(arg_class.infos) )
		{
			DevaptTraces.trace_error(context, ':bad class object', arg_class.trace);
			return;
		}
		if ( ! DevaptTypes.is_object(arg_class_instance) )
		{
			DevaptTraces.trace_error(context, ':bad class instance object', arg_class.trace);
			return;
		}
		if ( ! DevaptTypes.is_object(arg_instance_settings) )
		{
			console.log(arg_class_instance, 'arg_class_instance');
			console.log(arg_instance_settings, 'arg_instance_settings');
			DevaptTraces.trace_error(context, ':bad settings object', arg_class.trace);
			return;
		}
		
		
		// LOOP ON SETTINGS
		var initialized_properties = new Object();
		for(var setting_name in arg_instance_settings)
		{
			DevaptTraces.trace_step(context, 'loop on setting name [' + setting_name + ']', arg_class.trace);
			
			// GET PROPERTY RECORD
			var property_record = arg_class.properties.all_map[setting_name];
			if ( ! DevaptTypes.is_object(property_record) )
			{
				// SEARCH PROPERTY IN ALIASES
				property_record = arg_class.properties.all_alias_map[setting_name];
				
				// NOT FOUND
				if ( ! DevaptTypes.is_object(property_record) )
				{
					console.log(arg_class.properties.all_map, 'arg_class.properties.all_map');
					console.log(arg_class.properties.all_alias_map, 'arg_class.properties.all_alias_map');
					DevaptTraces.trace_error(context, 'bad property record [' + setting_name + '] for object [' + arg_instance_settings.name + '] of class [' + arg_class.infos.class_name + ']', arg_class.trace);
					continue;
				}
			}
				
			
			// CHECK IF PROPERTY IS CONFIGURABLE
			if ( ! property_record.is_initializable )
			{
				DevaptTraces.trace_error(context, 'property not initializable [' + setting_name + '] for object [' + arg_instance_settings.name + '] of class [' + arg_class.infos.class_name + ']', arg_class.trace);
				continue;
			}
			
			
			// GET SETTING VALUE FOR PROPERTY NAME
			var set_result = set_property_with_settings(arg_class, arg_class_instance, property_record, arg_instance_settings);
			
			initialized_properties[setting_name] = set_result;
		}
		// console.log(initialized_properties, 'initialized_properties for [' + arg_class.infos.class_name + ']');
		
		
		DevaptTraces.trace_leave(context, '', self.trace);
	}
	
	
	
	// ------------------------------------------------ PRIVATE FUNCTION : INHERITS ------------------------------------------------
	/**
	 * @memberof				DevaptClass
	 * @private
	 * @method					build_all_collections_for_mixin(arg_class, arg_mixin_class)
	 * @desc					Build all deep collections of parents, methods, mixins, decorators, properties
	 * @param {object}			arg_class			a class object
	 * @param {object}			arg_mixin_class		a mixin class object
	 * @return {nothing}
	 */
	function build_all_collections_for_mixin(arg_class, arg_mixin_class)
	{
		var self = arg_class;
		var context = 'DevaptClass.build_all_collections_for_mixin(class,mixin)';
		DevaptTraces.trace_enter(context, '', self.trace);
		
		
		var mixin_class = arg_mixin_class;
		var mixin_name = arg_mixin_class.infos.class_name;
		
		// REGISTER MIXIN CLASS MIXINS
		var sub_mixin_class = null;
		var sub_mixin_name = null;
		for(var sub_mixin_name in mixin_class.mixins.all_map)
		{
			DevaptTraces.trace_value(context, 'sub_mixin_name', sub_mixin_name, self.trace);
			sub_mixin_class = mixin_class.mixins.all_map[sub_mixin_name];
			build_all_collections_for_mixin(arg_class, sub_mixin_class);
		}
		
		
		// REGISTER MIXIN CLASS
		self.mixins.all_map[mixin_name] = mixin_class;
		self.mixins.all_ordered.push(mixin_class);
		
		
		// APPEND MIXINS METHODS
		for(var method_index in mixin_class.methods.own_ordered)
		{
			// GET METHOD RECORD AND NAME
			var method_record = mixin_class.methods.own_ordered[method_index];
			var method_name = method_record.name ? method_record.name : null;
			if (! method_name)
			{
				DevaptTraces.trace_error(context, 'bad method record for mixin [' + mixin_name + ']', self.trace);
				continue;
			}
			
			DevaptTraces.trace_step(context, 'process method [' + method_name + '] for mixin [' + mixin_name + ']', self.trace);
			
			// TEST IF METHOD IS ALREADY REGISTERED
			if ( self.methods.all_map[method_name] )
			{
				DevaptTraces.trace_step(context, 'method [' + method_name + '] of mixin [' + mixin_name + '] is already registered', self.trace);
				continue;
			}
			
			// REGISTER METHOD
			self.methods.all_map[method_name] = method_record;
			self.methods.all_ordered.push(method_record);
		}
		
		
		// TODO APPEND MIXINS DECORATORS
	/*	for(method_index in mixin_class.decorators.own_ordered)
		{
			// GET METHOD RECORD AND NAME
			var method_record = mixin_class.methods.own_ordered[method_index];
			var method_name = method_record.name ? method_record.name : null;
			if (! method_name)
			{
				DevaptTraces.trace_error(context, 'bad method record for mixin [' + mixin_name + ']', self.trace);
				continue;
			}
			
			DevaptTraces.trace_step(context, 'process decorator [' + method_name + '] for mixin [' + mixin_name + ']', self.trace);
			
			// TEST IF METHOD IS ALREADY REGISTERED
			if ( self.methods.all_map[method_name] )
			{
				DevaptTraces.trace_step(context, 'method [' + method_name + '] of mixin [' + mixin_name + '] is already registered', self.trace);
				continue;
			}
			
			// REGISTER METHOD
			self.methods.all_map[method_name] = method_record;
			self.methods.all_ordered.push(method_record);
		}*/
		
		
		// APPEND MIXINS PROPERTIES
		for(var property_index in mixin_class.properties.own_ordered)
		{
			// GET PROPERTY RECORD AND NAME
			var property_record = mixin_class.properties.own_ordered[property_index];
			var property_name = property_record.name ? property_record.name : null;
			
			// console.log('process property [' + property_name + '] for mixin [' + mixin_name + ']');
			
			if (! property_name)
			{
				DevaptTraces.trace_error(context, 'bad property record for mixin [' + mixin_name + ']', self.trace);
				continue;
			}
			
			DevaptTraces.trace_step(context, 'process property [' + property_name + '] for mixin [' + mixin_name + ']', self.trace);
			
			// TEST IF PROPERTY IS ALREADY REGISTERED
			if ( self.properties.all_map[property_name] )
			{
				DevaptTraces.trace_step(context, 'property [' + property_name + '] of mixin [' + mixin_name + '] is already registered', self.trace);
				continue;
			}
			
			// REGISTER PROPERTY
			self.properties.all_map[property_name] = property_record;
			self.properties.all_ordered.push(property_record);
			
			// REGISTER PROPERTY ALIASES
			for(var property_alias_index in property_record.aliases)
			{
				// GET PROPERTY RECORD AND NAME
				var property_alias_name = property_record.aliases[property_alias_index];
				
				self.properties.all_alias_map[property_alias_name] = property_record;
			}
		}
		
		
		DevaptTraces.trace_leave(context, '', self.trace);
	}
	
	
	/**
	 * @memberof				DevaptClass
	 * @private
	 * @method					build_all_collections(arg_class)
	 * @desc					Build all deep collections of parents, methods, mixins, decorators, properties
	 * @param {object}			arg_class		a class object
	 * @return {nothing}
	 */
	function build_all_collections(arg_class)
	{
		var self = arg_class;
		var context = 'DevaptClass.build_all_collections(class)';
		DevaptTraces.trace_enter(context, '', self.trace);
		
		
		// CHECK ARGS
		if ( ! DevaptTypes.is_object(self) )
		{
			DevaptTraces.trace_leave(context, 'failure: bad class object', self.trace);
			return;
		}
		
		
		// BUILD DEEP PARENTS CLASSES COLLECTIONS
		self.infos.parent_classes = [];
		self.infos.parent_classes.push(self); // FIRST ITEM IS THE FINAL CLASS TO FACILITATE DEEP SEARCH
		var class_record = self.infos.parent_class;
		while(class_record)
		{
			self.infos.parent_classes.push(class_record);
			class_record = class_record.infos.parent_class;
		}
		
		
		// BUILD DEEP COLLECTIONS
		for(var class_index in self.infos.parent_classes)
		{
			var class_record = self.infos.parent_classes[class_index];
			var class_name = class_record.infos.class_name;
			
			// LOOP ON MIXINS
			for(var mixin_index in class_record.mixins.own_ordered)
			{
				// GET MIXIN CLASS
				var mixin_class = class_record.mixins.own_ordered[mixin_index];
				// console.log(mixin_class, 'mixin_class');
				
				var mixin_name = mixin_class.infos.class_name;
				// console.log(mixin_name, 'mixin_name');
				
				DevaptTraces.trace_step(context, 'process mixin [' + mixin_name + ']', self.trace);
				
				// TEST IF ALREADY REGISTERED
				if ( self.mixins.all_map[mixin_name] )
				{
					// console.log(self.mixins.all_map, 'self.mixins.all_map');
					DevaptTraces.trace_step(context, 'mixin [' + mixin_name + '] is already registered', self.trace);
					continue;
				}
				
				
				build_all_collections_for_mixin(self, mixin_class);
			}
			
			
			// LOOP ON METHODS
			for(var method_index in class_record.methods.own_ordered)
			{
				// GET METHOD RECORD AND NAME
				var method_record = class_record.methods.own_ordered[method_index];
				var method_name = method_record.name ? method_record.name : null;
				if (! method_name)
				{
					DevaptTraces.trace_error(context, 'bad method record for class [' + class_name + ']', self.trace);
					continue;
				}
				
				DevaptTraces.trace_step(context, 'process method [' + method_name + '] for class [' + class_name + ']', self.trace);
				
				// TEST IF METHOD IS ALREADY REGISTERED
				if ( self.methods.all_map[method_name] )
				{
					DevaptTraces.trace_step(context, 'method [' + method_name + '] of class [' + class_name + '] is already registered', self.trace);
					continue;
				}
				
				// REGISTER METHOD
				self.methods.all_map[method_name] = method_record;
				self.methods.all_ordered.push(method_record);
			}
			
			// LOOP ON DECORATORS
			for(var decorator_index in class_record.decorators.own_ordered)
			{
				// GET DECORATOR RECORD AND NAME
				var decorator_record = class_record.decorators.own_ordered[decorator_index];
				var decorator_name = decorator_record.name ? decorator_record.name : null;
				if (! decorator_name)
				{
					DevaptTraces.trace_error(context, 'bad decorator record for class [' + class_name + ']', self.trace);
					continue;
				}
				
				DevaptTraces.trace_step(context, 'process decorator [' + method_name + '] for class [' + class_name + ']', self.trace);
				
				// TEST IF DECORATOR IS ALREADY REGISTERED
				if ( self.decorators.all_map[decorator_name] )
				{
					DevaptTraces.trace_step(context, 'decorator [' + decorator_name + '] of class [' + class_name + '] is already registered', self.trace);
					continue;
				}
				
				// REGISTER DECORATOR
				self.decorators.all_map[decorator_name] = decorator_record;
				self.decorators.all_ordered.push(decorator_record);
			}
			
			// LOOP ON PROPERTIES
			for(var property_index in class_record.properties.own_ordered)
			{
				// GET PROPERTY RECORD AND NAME
				var property_record = class_record.properties.own_ordered[property_index];
				var property_name = property_record.name ? property_record.name : null;
				if (! property_name)
				{
					DevaptTraces.trace_error(context, 'bad property record for class [' + class_name + ']', self.trace);
					continue;
				}
				
				DevaptTraces.trace_step(context, 'process property [' + property_name + '] for class [' + class_name + ']', self.trace);
				
				// TEST IF PROPERTY IS ALREADY REGISTERED
				if ( self.properties.all_map[property_name] )
				{
					DevaptTraces.trace_step(context, 'property [' + property_name + '] of class [' + class_name + '] is already registered', self.trace);
					continue;
				}
				
				// REGISTER PROPERTY
				self.properties.all_map[property_name] = property_record;
				self.properties.all_ordered.push(property_record);
				
				// REGISTER PROPERTY ALIASES
				if ( DevaptTypes.is_not_empty_array(property_record.aliases) )
				{
					for(var alias_index in property_record.aliases)
					{
						var alias_name = property_record.aliases[alias_index];
						self.properties.all_alias_map[alias_name] = property_record;
					}
				}
			}
		}
		
		
		DevaptTraces.trace_leave(context, '', self.trace);
	}
	
	
	
	/**
	 * @memberof				DevaptClass
	 * @public
	 * @method					extend_class(arg_class, arg_parent_class)
	 * @desc					...
	 * @param {object}			arg_class				a class object
	 * @param {object}			arg_parent_class		parent class object
	 * @return {nothing}
	 */
	function extend_class(arg_class, arg_parent_class)
	{
		var self = arg_class;
		var context = 'DevaptClass.extend_class(class, parent class)';
		DevaptTraces.trace_enter(context, '', self.trace);
		
		
		// INIT HELPERS
		var parent_proto = arg_parent_class.infos.proto;
		var child_proto = self.infos.proto ? self.infos.proto: new Object();
		
		
		// DEFINE CONSTRUCTOR
		if ( ! self.infos.ctor )
		{
			var c = arg_parent_class;
			while(c)
			{
				if (c.infos.ctor)
				{
					self.infos.ctor = c.infos.ctor;
					break;
				}
				c = c.infos.parent_class;
			}
		}
		
		
		// DEFINE INHERITANCE
		var Surrogate = function() {};
		Surrogate.prototype = parent_proto;
		self.infos.proto = new Surrogate();
		for(var member_key in child_proto)
		{
			self.infos.proto[member_key] = child_proto[member_key];
		}
		
		
		DevaptTraces.trace_leave(context, '', self.trace);
	}
	
	
	
	// ------------------------------------------------ CLASS DEFINITION ------------------------------------------------
	/**
	 * @class				DevaptClass
	 * @desc				Class constructor
	 * @param {string}		arg_name			class name
	 * @param {object}		arg_parent			parent class (DevaptClass instance)
	 * @param {array}		arg_class_settings	class settings
	 * @return {object}
	 */
	function DevaptClass(arg_name, arg_parent, arg_class_settings)
	{
		var self = this;
		self.trace = false;
		self.is_class = true;
		self.is_build = false;
		self.is_auto_build = true;
		
		
		// ------------------------------------------------ INIT INFOS ------------------------------------------------
		// INIT INFOS OBJECT
		self.infos = new Object();
		
		// INIT PROTOTYPE
		self.infos.proto = null;
		
		// INIT PARENT
		self.infos.parent_class = arg_parent ? arg_parent : null;
		if (arg_parent && arg_parent.infos)
		{
			if (! arg_parent.infos.children_classes)
			{
				arg_parent.infos.children_classes = new Object();
			}
			arg_parent.infos.children_classes[arg_name] = self;
		}
		
		// INIT CLASS UNIQUE ATTRIBUTES
		self.infos.class_name = arg_name;
		self.infos.class_uid = null;
		
		// INIT CLASS LIFE ATTRIBUTES
		self.infos.author = null;
		self.infos.creates = null;
		self.infos.updated = null;
		self.infos.description = null;
		
		// SET GIVEN SETTINGS
		if (arg_class_settings && arg_class_settings.infos)
		{
			jQuery.extend(self.infos, arg_class_settings.infos);
		}
		
		
		// ------------------------------------------------ INIT INFOS ------------------------------------------------
		// self.instances_array=[];
		
		
		// ------------------------------------------------ INIT DECORATORS ------------------------------------------------
		self.decorators = new Object();
		self.decorators.all_ordered = [];
		self.decorators.all_map = new Object();
		self.decorators.own_ordered = [];
		self.decorators.own_map = new Object();
		// fill_decorators(self, self.decorators.own_ordered, self.decorators.own_map, arg_class_settings.decorators);
		
		// ------------------------------------------------ INIT MIXINS ------------------------------------------------
		self.mixins = new Object();
		self.mixins.all_ordered = [];
		self.mixins.all_map = new Object();
		self.mixins.own_ordered = [];
		self.mixins.own_map = new Object();
		fill_mixins(self, self.mixins.own_ordered, self.mixins.own_map, arg_class_settings.mixins);
		
		// ------------------------------------------------ INIT METHODS ------------------------------------------------
		self.methods = new Object();
		self.methods.all_ordered = [];
		self.methods.all_map = new Object();
		self.methods.own_ordered = [];
		self.methods.own_map = new Object();
		fill_methods(self, self.methods.own_ordered, self.methods.own_map, arg_class_settings.methods);
		
		// ------------------------------------------------ INIT PROPERTIES ------------------------------------------------
		self.properties = new Object();
		self.properties.all_ordered = [];
		self.properties.all_map = new Object();
		self.properties.all_alias_map = new Object();
		self.properties.own_ordered = [];
		self.properties.own_map = new Object();
		fill_properties(self, self.properties.own_ordered, self.properties.own_map, arg_class_settings.properties);
		
		
		// REGISTER CLASS
		DevaptClasses.add_class(self);
		
		
		
		// ------------------------------------------------ PUBLIC FUNCTIONS: ADD METHODS ------------------------------------------------
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_static_method(arg_name, arg_method_record, arg_method_cb)
		 * @desc					Register a public static method
		 * @param {string}			arg_name				method name
		 * @param {object}			arg_method_record		method record
		 * @param {function}		arg_method_cb			method callback
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_static_method = function(arg_name, arg_method_record, arg_method_cb)
		{
			var self = this;
			var method_record = new_method_record(arg_name, arg_method_record, arg_method_cb);
			
			method_record.visibility = 'public';
			method_record.is_static = true;
			
			fill_methods(self, self.methods.own_ordered, self.methods.own_map, [method_record]);
		}
		
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_public_method(arg_name, arg_method_record, arg_method_cb)
		 * @desc					Register a public non static method
		 * @param {string}			arg_name				method name
		 * @param {object}			arg_method_record		method record
		 * @param {function}		arg_method_cb			method callback
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_public_method = function(arg_name, arg_method_record, arg_method_cb)
		{
			var self = this;
			var method_record = new_method_record(arg_name, arg_method_record, arg_method_cb);
			
			method_record.visibility = 'public';
			method_record.is_static = false;
			
			fill_methods(self, self.methods.own_ordered, self.methods.own_map, [method_record]);
		}
		
		
		
		// ------------------------------------------------ PUBLIC FUNCTIONS: ADD MIXIN ------------------------------------------------
		
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_public_method(arg_mixin_class)
		 * @desc					Register a public non static mixin class
		 * @param {object}			arg_mixin_class		mixin class
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_public_mixin = function(arg_mixin_class)
		{
			var self = this;
			
			// TODO CHECK CLASS
			// console.log(arg_mixin_class);
			
			self.mixins.own_ordered.push(arg_mixin_class);
			self.mixins.own_map[arg_mixin_class.infos.class_name] = arg_mixin_class;
		}
		
		
		
		// ------------------------------------------------ PUBLIC FUNCTIONS: ADD PROPERTIES ------------------------------------------------
		
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_property_record(arg_property_record)
		 * @desc					Register a property
		 * @param {object}			arg_property_record		property record
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_property_record = function(arg_property_record)
		{
			var self = this;
			
			fill_properties(self, self.properties.own_ordered, self.properties.own_map, [arg_property_record]);
		}
		
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_static_property(type,name,desc,value,required,readonly,aliases)
		 * @desc					Register a public non static property
		 * @param {string}			arg_property_type		property type
		 * @param {string}			arg_property_name		property name
		 * @param {string}			arg_property_desc		property description
		 * @param {anything}		arg_property_value		property default value
		 * @param {boolean}			arg_required			property is required
		 * @param {boolean}			arg_readonly			property is read only
		 * @param {string}			arg_visibility			property visibility : public/protected/private
		 * @param {array}			arg_aliases				property aliases array
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_static_property = function(arg_property_type, arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_visibility, arg_aliases)
		{
			var self = this;
			arg_visibility = (arg_visibility in ['public', 'protected', 'private']) ? arg_visibility : 'public';
			
			var arg_property_record = {
				name:arg_property_name,
				description:arg_property_desc,
				aliases:arg_aliases ? arg_aliases : [],
				
				visibility:arg_visibility,
				is_static:true,
				is_readonly:arg_readonly ? true : false,
				is_initializable:true,
				is_required:arg_required ? true : false,
				
				type:arg_property_type ? arg_property_type : 'string',
				default_value:arg_property_value
			};
			
			fill_properties(self, self.properties.own_ordered, self.properties.own_map, [arg_property_record]);
		}
		
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_public_property(type,name,desc,value,required,readonly,aliases)
		 * @desc					Register a public non static property
		 * @param {string}			arg_property_type		property type
		 * @param {string}			arg_property_name		property name
		 * @param {string}			arg_property_desc		property description
		 * @param {anything}		arg_property_value		property default value
		 * @param {boolean}			arg_required			property is required
		 * @param {boolean}			arg_readonly			property is read only
		 * @param {string}			arg_visibility			property visibility : public/protected/private
		 * @param {array}			arg_aliases				property aliases array
		 * @param {string}			arg_array_type			property array type
		 * @param {string}			arg_array_separator		property array separator
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_property = function(arg_property_type, arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_visibility, arg_aliases, arg_array_type, arg_array_separator)
		{
			var self = this;
			arg_visibility = (arg_visibility in ['public', 'protected', 'private']) ? arg_visibility : 'public';
			
			var arg_property_record = {
				name:arg_property_name,
				description:arg_property_desc,
				aliases:arg_aliases ? arg_aliases : [],
				
				visibility:'public',
				is_static:false,
				is_readonly:arg_readonly ? true : false,
				is_initializable:true,
				is_required:arg_required ? true : false,
				
				type:arg_property_type ? arg_property_type : 'string',
				default_value:arg_property_value,
				array_type: arg_array_type ? arg_array_type : 'string',
				array_separator: arg_array_separator ? arg_array_separator : ',',
				format:''
			};
			
			fill_properties(self, self.properties.own_ordered, self.properties.own_map, [arg_property_record]);
		}
		
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_public_str_property(name,desc,value,required,readonly,aliases)
		 * @desc					Register a public non static string property
		 * @param {string}			arg_property_name		property name
		 * @param {string}			arg_property_desc		property description
		 * @param {string}			arg_property_value		property default value
		 * @param {boolean}			arg_required			property is required
		 * @param {boolean}			arg_readonly			property is read only
		 * @param {array}			arg_aliases				property aliases array
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_public_str_property = function(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases)
		{
			this.add_property('string', arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, 'public', arg_aliases);
		}
		
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_public_int_property(name,desc,value,required,readonly,aliases)
		 * @desc					Register a public non static integer property
		 * @param {string}			arg_property_name		property name
		 * @param {string}			arg_property_desc		property description
		 * @param {integer}			arg_property_value		property default value
		 * @param {boolean}			arg_required			property is required
		 * @param {boolean}			arg_readonly			property is read only
		 * @param {array}			arg_aliases				property aliases array
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_public_int_property = function(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases)
		{
			this.add_property('integer', arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, 'public', arg_aliases);
		}
		
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_public_float_property(name,desc,value,required,readonly,aliases)
		 * @desc					Register a public non static float property
		 * @param {string}			arg_property_name		property name
		 * @param {string}			arg_property_desc		property description
		 * @param {float}			arg_property_value		property default value
		 * @param {boolean}			arg_required			property is required
		 * @param {boolean}			arg_readonly			property is read only
		 * @param {array}			arg_aliases				property aliases array
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_public_float_property = function(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases)
		{
			this.add_property('float', arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, 'public', arg_aliases);
		}
		
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_public_bool_property(name,desc,value,required,readonly,aliases)
		 * @desc					Register a public non static string property
		 * @param {string}			arg_property_name		property name
		 * @param {string}			arg_property_desc		property description
		 * @param {boolean}			arg_property_value		property default value
		 * @param {boolean}			arg_required			property is required
		 * @param {boolean}			arg_readonly			property is read only
		 * @param {array}			arg_aliases				property aliases array
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_public_bool_property = function(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases)
		{
			this.add_property('boolean', arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, 'public', arg_aliases);
		}
		
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_public_obj_property(name,desc,value,required,readonly,aliases)
		 * @desc					Register a public non static string property
		 * @param {string}			arg_property_name		property name
		 * @param {string}			arg_property_desc		property description
		 * @param {boolean}			arg_property_value		property default value
		 * @param {boolean}			arg_required			property is required
		 * @param {boolean}			arg_readonly			property is read only
		 * @param {array}			arg_aliases				property aliases array
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_public_obj_property = function(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases)
		{
			this.add_property('object', arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, 'public', arg_aliases);
		}
		DevaptClass.prototype.add_public_object_property = DevaptClass.prototype.add_public_obj_property;
		
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_public_array_property(name,desc,value,required,readonly,alises,type,separator)
		 * @desc					Register a public non static string property
		 * @param {string}			arg_property_name		property name
		 * @param {string}			arg_property_desc		property description
		 * @param {boolean}			arg_property_value		property default value
		 * @param {boolean}			arg_required			property is required
		 * @param {boolean}			arg_readonly			property is read only
		 * @param {array}			arg_aliases				property aliases array
		 * @param {string}			arg_array_type			property array type
		 * @param {string}			arg_array_separator		property array separator
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_public_array_property = function(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases, arg_array_type, arg_array_separator)
		{
			this.add_property('array', arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, 'public', arg_aliases, arg_array_type, arg_array_separator);
		}
		
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					add_public_cb_property(name,desc,value,required,readonly,aliases)
		 * @desc					Register a public non static callback property
		 * @param {string}			arg_property_name		property name
		 * @param {string}			arg_property_desc		property description
		 * @param {string}			arg_property_value		property default value
		 * @param {boolean}			arg_required			property is required
		 * @param {boolean}			arg_readonly			property is read only
		 * @param {array}			arg_aliases				property aliases array
		 * @return {nothing}
		 */
		DevaptClass.prototype.add_public_cb_property = function(arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, arg_aliases)
		{
			this.add_property('callback', arg_property_name, arg_property_desc, arg_property_value, arg_required, arg_readonly, 'public', arg_aliases);
		}
		
		
		
		// ------------------------------------------------ BUILD CLASS ------------------------------------------------
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					build_class()
		 * @desc					...
		 * @return {nothing}
		 */
		DevaptClass.prototype.build_class = function()
		{
			var self = this; // self.trace = self.infos.class_name === 'DevaptContainerMixinSelectable';
			var context = 'DevaptClass.build_class()';
			DevaptTraces.trace_enter(context, '', self.trace);
			
			
			// NEED BUILD ?
			if (self.is_build)
			{	
				console.info(context, 'already build');
				DevaptTraces.trace_leave(context, 'already build', self.trace);
				return;
			}
			
			
			// CREATE PROTOTYPE AND CONSTRUCTOR
			if (self.infos.parent_class)
			{
				extend_class(self, self.infos.parent_class);
			}
			else
			{
				self.infos.proto = new Object();
			}
			if ( ! self.infos.ctor )
			{
				self.infos.ctor = function() {};
			}
			
			// DEFINE COMMON PROPERTIES
			self.add_public_str_property('class_name', 'class name', null, false, true);
			self.add_public_str_property('name', 'object name', null, false, true);
			self.add_public_bool_property('trace', 'class trace flag', false, false, false);
			self.add_public_bool_property('trace_instances', 'class instances trace flag', false, false, false);
			
			// BUILD ALL DEEP COLLECTIONS
			build_all_collections(self);
			
			// BUILD METHODS
			build_methods(self);
			
			// BUILD PROPERTIES
			build_properties(self);
			
			// BUILD IS FINISHED
			self.is_build = true;
			
			
			DevaptTraces.trace_leave(context, '', self.trace);
		}
		
		
		
		// ------------------------------------------------ CREATE CLASS INSTANCE ------------------------------------------------
		/**
		 * @memberof				DevaptClass
		 * @public
		 * @method					create(arg_instance_settings)
		 * @desc					...
		 * @param {string}			arg_instance_name		class instance settingd
		 * @param {object}			arg_instance_settings	class instance settingd
		 * @return {object}			a class instance
		 */
		DevaptClass.prototype.create = function(arg_instance_name, arg_instance_settings)
		{
			var self = this;
			// self.trace = self.infos.class_name === 'DevaptArrayStorage';
//			self.trace = true;
			var context = 'DevaptClass.create(settings)';
			DevaptTraces.trace_enter(context, '', self.trace);
			DevaptTraces.trace_value(context, 'arg_instance_name', arg_instance_name, self.trace);
			DevaptTraces.trace_value(context, 'arg_instance_settings', arg_instance_settings, self.trace);
			
			
			// CHECK ARGS
			DevaptTraces.trace_step(context, 'check args', self.trace);
			if ( DevaptTypes.is_null(arg_instance_settings) )
			{
				if ( DevaptTypes.is_object(arg_instance_name) )
				{
					arg_instance_settings = arg_instance_name;
					arg_instance_name = arg_instance_settings.name ? arg_instance_settings.name : null;
				}
			}
			if ( ! DevaptTypes.is_not_empty_str(arg_instance_name) )
			{
				console.error(arg_instance_settings, 'bad class instance name');
				DevaptTraces.trace_error(context, 'bad object name', self.trace);
				DevaptTraces.trace_leave(context, 'error bad name', self.trace);
				return null;
			}
			
			
			// NEED BUILD ?
			DevaptTraces.trace_step(context, 'build class if needed', self.trace);
			if (! self.is_build)
			{
				try
				{
					self.build_class();
				}
				catch(e)
				{
					console.error(e, context + ':build class');
				}
			}
			
			
			// TEST IF THE CLASS USE A SINGLETON
			if (self.infos.is_singleton)
			{
				DevaptTraces.trace_step(context, 'Class use a singleton', self.trace);
				if ( DevaptTypes.is_object(self.infos.singleton) && self.infos.singleton._class && self.infos.singleton._class.name === self.name )
				{
					DevaptTraces.trace_leave(context, 'singleton already exists', self.trace);
					return self.infos.singleton;
				}
				
				self.infos.singleton = null;
			}
			
			// CREATE INSTANCE AND DECLARE PROPERTIES
			DevaptTraces.trace_step(context, 'Object.create', self.trace);
			var properties = new Object();
			var instance = Object.create(self.infos.proto, properties);
			if ( ! DevaptTypes.is_object(instance) )
			{
				DevaptTraces.trace_error(context, 'bad created object', arg_class.trace);
				DevaptTraces.trace_leave(context, 'error bad created object', self.trace);
				return null;
			}
			
			
			// SET HELPERS ATTRIBUTES
			DevaptTraces.trace_step(context, 'set helpers', self.trace);
			instance.prototype = self.infos.proto;
			instance._class = self;
			instance._parent_class = self.infos.parent_class;
			
			
			// APPLY SETTINGS
			DevaptTraces.trace_step(context, 'apply settings', self.trace);
			arg_instance_settings = arg_instance_settings ? arg_instance_settings : new Object();
			arg_instance_settings.name = arg_instance_name;
			arg_instance_settings.trace = arg_instance_settings.trace ? true : false;
			arg_instance_settings.class_name = self.infos.class_name;
			// console.log(arg_instance_settings, 'class.create settings');
			init_properties(self, instance);
			try
			{
				apply_properties(self, instance, arg_instance_settings);
			}
			catch(e)
			{
				console.error(e, context + ':apply_properties');
			}
			
			
			// DEBUG INSTANCE
			// console.log(instance, 'instance[' + instance.name + ']');
			
			
			// GET ALL PARENT CLASSES
			DevaptTraces.trace_step(context, 'get all parent classes', self.trace);
			var class_records = [];
			var class_record = self;
			while (class_record)
			{
				// console.log(class_record.infos.class_name, 'mixin stack init');
				class_records.push(class_record);
				class_record = class_record.infos.parent_class;
			}
			
			
			// CALL MIXINS CONSTRUCTORS
			DevaptTraces.trace_step(context, 'call mixin constructors', self.trace);
			// console.log(self.infos.class_name, 'call mixin constructors');
			try
			{
				var init_mixins = new Object();
				for(var class_index = class_records.length - 1 ; class_index >= 0 ; class_index--)
				{
					class_record = class_records[class_index];
					if (! class_record.is_build)
					{
						// console.log(class_record.infos.class_name, 'build class_name');
						class_record.build_class();
					}
					// console.log(class_record.infos.class_name, 'class_name');
					for(var mixin_key in class_record.mixins.all_ordered)
					{
						var mixin_class = class_record.mixins.all_ordered[mixin_key];
						if (mixin_class && ! init_mixins[mixin_class.infos.class_name])
						{
							// console.log(mixin_class.infos.class_name, 'mixin stack init');
							// console.log(instance, 'mixin stack init for [' + mixin_class.infos.class_name + ']');
							mixin_class.infos.ctor(instance);
							init_mixins[mixin_class.infos.class_name] = true;
						}
					}
				}
			}
			catch(e)
			{
				console.error(e, context + ':mixins ctor');
			}
			
			
			// CALL CONSTRUCTOR
			DevaptTraces.trace_step(context, 'call class constructor', self.trace);
			try
			{
				// CALL SUPER CONSTRUCTOR
				// console.log(self.infos.class_name, 'call super constructors');
				instance._super_ctor = instance._parent_class ? instance._parent_class.infos.ctor : null;
				for(var class_index = class_records.length - 1 ; class_index > 0 ; class_index--)
				{
					var class_record = class_records[class_index];
					var ctor = class_record.infos.ctor;
					if (ctor)
					{
						// console.log(class_record.infos.class_name, 'call super constructor');
						ctor(instance);
					}
				}
				
				// CALL INSTANCE CONSTRUCTOR
				// console.log(self.infos.class_name, 'call instance constructor');
				instance._ctor = self.infos.ctor;
				instance._ctor(instance);
			}
			catch(e)
			{
				console.error(e, context + ':instance ctor');
			}
			
			
			// REGISTER CLASS INSTANCE
			DevaptClasses.add_instance(instance);
			// self.instances_array.push(instance);
			
			// SINGLETON
			if (self.infos.is_singleton)
			{
				DevaptTraces.trace_step(context, 'Class use a singleton', self.trace);
				self.infos.singleton = instance;
			}
			
			
			DevaptTraces.trace_leave(context, 'instance is created', self.trace);
			return instance;
		}
	}
	
	
	return DevaptClass;
} );
/**
 * @file        core/traces-console.js
 * @desc        Devapt static traces operations on console
 * 				API
 * 					STATIC METHODS
 * 						DevaptTracesConsole.log(log_record)
 * 						DevaptTracesConsole.debug(log_record)
 * 						DevaptTracesConsole.info(log_record)
 * 						DevaptTracesConsole.warn(log_record)
 * 						DevaptTracesConsole.error(log_record)
 * 					
 * 						DevaptTracesConsole.enable()
 * 						DevaptTracesConsole.disable()
 * 					
 * @ingroup     DEVAPT_CORE
 * @date        2015-02-18
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('core/traces-console',['core/types', 'object/class'],
function(DevaptTypes, DevaptClass)
{
	/* ------------------------------------------------------------------------- */
	/* CONSOLE LOG APPENDER */
	/* ------------------------------------------------------------------------- */
	
	/**
	 * @memberof			DevaptTracesConsole
	 * @public
	 * @desc				Console log appender
	 * @static
	 */
	var DevaptTracesConsole = {};
	
	
	
	/**
	 * @memberof			DevaptTracesConsole
	 * @public
	 * @static
	 * @method				DevaptTracesConsole.log(arg_log_obj)
	 * @desc				Trace a log message
	 * @param {object}		arg_log_obj			log attributes
	 * @param {object}		DevaptTraces		Main trace class
	 * @return {nothing}
	 */
	DevaptTracesConsole.log = function(arg_log_obj, DevaptTraces)
	{
		var msg = DevaptTracesConsole.format_msg(arg_log_obj, DevaptTraces);
		console.log(msg);
	}

	/**
	 * @memberof			DevaptTracesConsole
	 * @public
	 * @static
	 * @method				DevaptTracesConsole.debug(arg_log_obj)
	 * @desc				Trace a debug message
	 * @param {object}		arg_log_obj			log attributes
	 * @param {object}		DevaptTraces		Main trace class
	 * @return {nothing}
	 */
	DevaptTracesConsole.debug = function(arg_log_obj, DevaptTraces)
	{
		var msg = DevaptTracesConsole.format_msg(arg_log_obj, DevaptTraces);
		
		if ( DevaptTypes.is_function(console.debug) )
		{
			console.debug(msg);
		}
		else
		{
			console.log(msg);
		}
	}

	/**
	 * @memberof			DevaptTracesConsole
	 * @public
	 * @static
	 * @method				DevaptTracesConsole.warn(arg_log_obj)
	 * @desc				Trace a warn message
	 * @param {object}		arg_log_obj			log attributes
	 * @param {object}		DevaptTraces		Main trace class
	 * @return {nothing}
	 */
	DevaptTracesConsole.warn = function(arg_log_obj, DevaptTraces)
	{
		var msg = DevaptTracesConsole.format_msg(arg_log_obj, DevaptTraces);
		console.warn(msg);
	}

	/**
	 * @memberof			DevaptTracesConsole
	 * @public
	 * @static
	 * @method				DevaptTracesConsole.info(arg_log_obj)
	 * @desc				Trace a info message
	 * @param {object}		arg_log_obj			log attributes
	 * @param {object}		DevaptTraces		Main trace class
	 * @return {nothing}
	 */
	DevaptTracesConsole.info = function(arg_log_obj, DevaptTraces)
	{
		var msg = DevaptTracesConsole.format_msg(arg_log_obj, DevaptTraces);
		console.info(msg);
	}
	
	/**
	 * @memberof			DevaptTracesConsole
	 * @public
	 * @static
	 * @method				DevaptTracesConsole.error(arg_error_obj)
	 * @desc				Throw an error
	 * @param {object}		arg_error_obj		Error attributes
	 * @param {object}		DevaptTraces		Main trace class
	 * @return {nothing}
	 */
	DevaptTracesConsole.error = function(arg_error_obj, DevaptTraces)
	{
		// LOG THE ERROR
		DevaptTracesConsole.log( { level:'DEBUG', step:'', context:'', text:'!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!' }, DevaptTraces );
		
		var msg = DevaptTracesConsole.format_msg(arg_error_obj, DevaptTraces);
		console.error(msg);
		
		DevaptTracesConsole.log( { level:'DEBUG', step:'', context:'', text:'!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!' }, DevaptTraces );
	}
	
	/**
	 * @memberof			DevaptTracesConsole
	 * @public
	 * @static
	 * @method				DevaptTracesConsole.enable()
	 * @desc				Enable console log appender
	 * @return {nothing}
	 */
	DevaptTracesConsole.enable = function()
	{
		if ( ! DevaptTracesConsole.enabled )
		{
			DevaptTracesConsole.enabled = true;
		}
	}
	
	/**
	 * @memberof			DevaptTracesConsole
	 * @public
	 * @static
	 * @method				DevaptTracesConsole.disable()
	 * @desc				Disable console log appender
	 * @return {nothing}
	 */
	DevaptTracesConsole.disable = function()
	{
		if ( ! DevaptTracesConsole.enabled )
		{
			return;
		}
		
		DevaptTracesConsole.enabled = false;
	}
	
	
	/**
	 * @memberof			DevaptTracesConsole
	 * @public
	 * @static
	 * @method				DevaptTracesConsole.format_msg(arg_log_obj)
	 * @desc				Format a log message
	 * @param {object}		arg_log_obj			log attributes
	 * @param {object}		DevaptTraces		Main trace class
	 * @return {string}
	 */
	DevaptTracesConsole.format_msg = function(arg_log_obj, DevaptTraces)
	{
		var has_object = arg_log_obj.class_name && arg_log_obj.object_name && arg_log_obj.method_name;
		var content = has_object ? arg_log_obj.class_name + '[' + arg_log_obj.object_name + '].' + arg_log_obj.method_name : '';
		content += arg_log_obj.context ? arg_log_obj.context : '';
		
		var indent	= DevaptTraces.log_indent_str.rpad(' ', 10);
		var msg = arg_log_obj.level + indent + content + ' ' + arg_log_obj.step + ' ' + arg_log_obj.text;
		return msg;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// TRACE CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-02-18',
			'updated':'2015-02-18',
			'description':'Static class to log application activity (debug, info, warn, error) on console.'
		}
	};
	var DevaptTracesConsoleClass = new DevaptClass('DevaptTracesConsole', null, class_settings);
	
	// METHODS
	DevaptTracesConsoleClass.add_static_method('enable', {}, DevaptTracesConsole.enable);
	DevaptTracesConsoleClass.add_static_method('disable', {}, DevaptTracesConsole.disable);
	
	DevaptTracesConsoleClass.add_static_method('log', {}, DevaptTracesConsole.log);
	DevaptTracesConsoleClass.add_static_method('debug', {}, DevaptTracesConsole.debug);
	DevaptTracesConsoleClass.add_static_method('info', {}, DevaptTracesConsole.info);
	DevaptTracesConsoleClass.add_static_method('warn', {}, DevaptTracesConsole.warn);
	DevaptTracesConsoleClass.add_static_method('error', {}, DevaptTracesConsole.error);
	
	// PROPERTIES
	DevaptTracesConsoleClass.enabled = false;
	DevaptTracesConsoleClass.add_static_property('boolean', 'enabled', 'log appender is enabled ?', false, false, true, 'private');
	
	// BUILD CLASS
	DevaptTracesConsoleClass.build_class();
	
	
	return DevaptTracesConsoleClass;
} );
/**
 * @file        core/traces-memory.js
 * @desc        Devapt static traces operations on memory
 * 				API
 * 					STATIC METHODS
 * 						DevaptTracesMemory.log(log_record)
 * 						DevaptTracesMemory.debug(log_record)
 * 						DevaptTracesMemory.info(log_record)
 * 						DevaptTracesMemory.warn(log_record)
 * 						DevaptTracesMemory.error(log_record)
 * 					
 * 						DevaptTracesMemory.enable()
 * 						DevaptTracesMemory.disable()
 * 					
 * @ingroup     DEVAPT_CORE
 * @date        2015-02-18
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('core/traces-memory',['core/types', 'object/class'],
function(DevaptTypes, DevaptClass)
{
	/* ------------------------------------------------------------------------- */
	/* MEMORY LOG APPENDER */
	/* ------------------------------------------------------------------------- */
	
	/**
	 * @memberof			DevaptTracesMemory
	 * @public
	 * @desc				Memory log appender
	 * @static
	 */
	var DevaptTracesMemory = {};
	
	/**
	 * @memberof			DevaptTracesMemory
	 * @public
	 * @desc				Memory logs
	 * @static
	 */
	DevaptTracesMemory.logs = [];
	
	
	
	/**
	 * @memberof			DevaptTracesMemory
	 * @public
	 * @static
	 * @method				DevaptTracesMemory.log(arg_log_obj)
	 * @desc				Trace a log message
	 * @param {object}		arg_log_obj			log attributes
	 * @param {object}		DevaptTraces		Main trace class
	 * @return {nothing}
	 */
	DevaptTracesMemory.log = function(arg_log_obj, DevaptTraces)
	{
		DevaptTracesMemory.logs.push(arg_log_obj);
	}

	/**
	 * @memberof			DevaptTracesMemory
	 * @public
	 * @static
	 * @method				DevaptTracesMemory.debug(arg_log_obj)
	 * @desc				Trace a debug message
	 * @param {object}		arg_log_obj			log attributes
	 * @param {object}		DevaptTraces		Main trace class
	 * @return {nothing}
	 */
	DevaptTracesMemory.debug = function(arg_log_obj, DevaptTraces)
	{
		DevaptTracesMemory.logs.push(arg_log_obj);
	}

	/**
	 * @memberof			DevaptTracesMemory
	 * @public
	 * @static
	 * @method				DevaptTracesMemory.warn(arg_log_obj)
	 * @desc				Trace a warn message
	 * @param {object}		arg_log_obj			log attributes
	 * @param {object}		DevaptTraces		Main trace class
	 * @return {nothing}
	 */
	DevaptTracesMemory.warn = function(arg_log_obj, DevaptTraces)
	{
		DevaptTracesMemory.logs.push(arg_log_obj);
	}

	/**
	 * @memberof			DevaptTracesMemory
	 * @public
	 * @static
	 * @method				DevaptTracesMemory.info(arg_log_obj)
	 * @desc				Trace a info message
	 * @param {object}		arg_log_obj			log attributes
	 * @param {object}		DevaptTraces		Main trace class
	 * @return {nothing}
	 */
	DevaptTracesMemory.info = function(arg_log_obj, DevaptTraces)
	{
		DevaptTracesMemory.logs.push(arg_log_obj);
	}
	
	/**
	 * @memberof			DevaptTracesMemory
	 * @public
	 * @static
	 * @method				DevaptTracesMemory.error(arg_error_obj)
	 * @desc				Throw an error
	 * @param {object}		arg_error_obj		Error attributes
	 * @param {object}		DevaptTraces		Main trace class
	 * @return {nothing}
	 */
	DevaptTracesMemory.error = function(arg_error_obj, DevaptTraces)
	{
		DevaptTracesMemory.logs.push(arg_error_obj);
	}
	
	/**
	 * @memberof			DevaptTracesMemory
	 * @public
	 * @static
	 * @method				DevaptTracesMemory.enable()
	 * @desc				Enable console log appender
	 * @return {nothing}
	 */
	DevaptTracesMemory.enable = function()
	{
		if ( ! DevaptTracesMemory.enabled )
		{
			DevaptTracesMemory.enabled = true;
		}
	}
	
	/**
	 * @memberof			DevaptTracesMemory
	 * @public
	 * @static
	 * @method				DevaptTracesMemory.disable()
	 * @desc				Disable console log appender
	 * @return {nothing}
	 */
	DevaptTracesMemory.disable = function()
	{
		if ( ! DevaptTracesMemory.enabled )
		{
			return;
		}
		
		DevaptTracesMemory.enabled = false;
	}
	
	
	/**
	 * @memberof			DevaptTracesMemory
	 * @public
	 * @static
	 * @method				DevaptTracesMemory.get_logs()
	 * @desc				Get all log messages
	 * @return {array}
	 */
	DevaptTracesMemory.get_logs = function()
	{
		return DevaptTracesMemory.logs;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// TRACE CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-02-18',
			'updated':'2015-02-18',
			'description':'Static class to log application activity (debug, info, warn, error) on memory.'
		}
	};
	var DevaptTracesMemoryClass = new DevaptClass('DevaptTracesMemory', null, class_settings);
	
	// METHODS
	DevaptTracesMemoryClass.add_static_method('enable', {}, DevaptTracesMemory.enable);
	DevaptTracesMemoryClass.add_static_method('disable', {}, DevaptTracesMemory.disable);
	
	DevaptTracesMemoryClass.add_static_method('log', {}, DevaptTracesMemory.log);
	DevaptTracesMemoryClass.add_static_method('debug', {}, DevaptTracesMemory.debug);
	DevaptTracesMemoryClass.add_static_method('info', {}, DevaptTracesMemory.info);
	DevaptTracesMemoryClass.add_static_method('warn', {}, DevaptTracesMemory.warn);
	DevaptTracesMemoryClass.add_static_method('error', {}, DevaptTracesMemory.error);
	
	DevaptTracesMemoryClass.add_static_method('get_logs', {}, DevaptTracesMemory.get_logs);
	
	// PROPERTIES
	DevaptTracesMemoryClass.enabled = false;
	DevaptTracesMemoryClass.add_static_property('boolean', 'enabled', 'log appender is enabled ?', false, false, true, 'private');
	
	// BUILD CLASS
	DevaptTracesMemoryClass.build_class();
	
	
	return DevaptTracesMemoryClass;
} );
/**
 * @file        core/traces.js
 * @desc        Devapt static common features: Devapt static traces operations
 * 				API
 * 					
 * 					STATIC METHODS
 * 						DevaptTraces.log(log_record)
 * 						DevaptTraces.debug(log_record)
 * 						DevaptTraces.info(log_record)
 * 						DevaptTraces.warn(log_record)
 * 						DevaptTraces.error(log_record)
 * 					
 * 						DevaptTraces.enable(log appender class)
 * 						DevaptTraces.disable(log appender class)
 * 					
 * 					LOG RECORD FORMAT
 * 					{
 * 						level: DEBUG, INFO, WARN, ERROR
 * 						class_name: class name
 * 						object_name: class instance name
 * 						method_name: method of the trace
 * 						context: contextual infos
 * 						step: ENTER, LEAVE, STEP
 * 						text: infos
 * 					}
 * 					
 * 					LOG RECORD EXAMPLES
 * 					{ level:'DEBUG', step:'STEP', context:'DevaptHBox.contructor(view_access_users)[view_access_users]', text:'set view model'}
 * 					=> DEBUG -         DevaptHBox.contructor(view_access_users)[view_access_users] : STEP set view model
 * 					{ level:'DEBUG', class_name:'DevaptHBox', object_name:'view_access_users', method_name:'contructor', step:'STEP', text:'set view model' }
 * 					=> DEBUG -         DevaptHBox[view_access_users].contructor() : STEP set view model
 * 					
 * @ingroup     DEVAPT_CORE
 * @date        2013-05-16
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('core/traces',['core/types', 'object/class', 'core/traces-console', 'core/traces-memory'],
function(DevaptTypes, DevaptClass, DevaptTracesConsoleClass, DevaptTracesMemoryClass)
{
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @class
	 * @desc				Devapt trace features container
	 */
	var DevaptTraces = function() {};
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @desc				Flag : throw on error
	 */
	DevaptTraces.throw_on_error = true;
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @desc				Log indentation string
	 */
	DevaptTraces.log_indent_str = '';

	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @desc				Log indentation index
	 */
	DevaptTraces.log_indent_index = 0;
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @desc				Log indentation separator
	 * @static
	 */
	DevaptTraces.log_indent_sep = '-';
	
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @desc				Log appenders array
	 * @static
	 */
	DevaptTraces.appenders = [];
	
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @desc				Log appenders map
	 * @static
	 */
	DevaptTraces.appenders_map = {};
	
	
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.appender_console.enable()
	 * @desc				Enable console log appender
	 * @param {string}		arg_appender_name	appender name
	 * @param {object}		arg_appender_class	appender class
	 * @return {nothing}
	 */
	DevaptTraces.enable = function(arg_appender_name, arg_appender_class)
	{
		if ( ! arg_appender_class.enabled )
		{
			DevaptTraces.appenders.push(arg_appender_class);
			DevaptTraces.appenders_map[arg_appender_name] = arg_appender_class;
			arg_appender_class.enable();
		}
	}
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.appender_console.disable()
	 * @desc				Disable console log appender
	 * @param {string}		arg_appender_name	appender name
	 * @return {nothing}
	 */
	DevaptTraces.disable = function(arg_appender_name)
	{
//		if ( ! arg_appender_class.enabled )
//		{
//			return;
//		}
		
		// CREATE TMP ARRAY
		var tmp_array = [];
		for(var appender_name in DevaptTraces.appenders_map)
		{
			var appender = DevaptTraces.appenders_map[appender_name];
			if (appender_name && appender && appender_name !== arg_appender_name)
			{
				tmp_array.push(appender);
			}
			else
			{
				appender.disable();
				DevaptTraces.appenders_map[appender_name] = null;
				delete DevaptTraces.appenders_map[appender_name];
			}
		}
		
		delete DevaptTraces.appenders;
		DevaptTraces.appenders = tmp_array;
	}
	
	
	
	/* ------------------------------------------------------------------------- */
	/* GENERIQUE LOG APPENDER */
	/* ------------------------------------------------------------------------- */
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.log(arg_log_obj)
	 * @desc				Trace a log message
	 * @param {object}		arg_log_obj		log attributes	
	 * @return {nothing}
	 */
	DevaptTraces.log = function(arg_log_obj)
	{
		// FORMAT LOG OBJECT
		arg_log_obj = arg_log_obj || {};
		
		if ( DevaptTypes.is_string(arg_log_obj) )
		{
			arg_log_obj = { text: arg_log_obj };
		}
		
		var default_record = 
		{
			level:'LOG',
			text:''
		};
		arg_log_obj = DevaptTraces.format_log_record(arg_log_obj, default_record);
		
		// LOOP ON ALL APPENDERS
		DevaptTraces.appenders.forEach( function(appender) { appender.log(arg_log_obj, DevaptTraces); } );
	}
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.log(arg_log_obj)
	 * @desc				Trace a log message
	 * @param {object}		arg_log_obj			log attributes	
	 * @param {array}		arg_log_appenders	log appenders	
	 * @return {nothing}
	 */
	DevaptTraces.log_appenders = function(arg_log_obj, arg_log_appenders)
	{
//		console.log(arg_log_appenders, arg_log_obj, 'DevaptTraces.log_appenders');
		
		// CHECK GIVEN APPENDERS
		if (! DevaptTypes.is_array(arg_log_appenders))
		{
			DevaptTraces.log(arg_log_obj);
			return;
		}
		
		// FORMAT LOG OBJECT
		arg_log_obj = arg_log_obj || {};
		
		if ( DevaptTypes.is_string(arg_log_obj) )
		{
			arg_log_obj = { text: arg_log_obj };
		}
		
		var default_record = 
		{
			level:'LOG',
			text:''
		};
		arg_log_obj = DevaptTraces.format_log_record(arg_log_obj, default_record);
		
		// LOOP ON GIVEN APPENDERS
		for(var appender_index in arg_log_appenders)
		{
			var appender_name = arg_log_appenders[appender_index];
			if (appender_name in DevaptTraces.appenders_map)
			{
				var appender = DevaptTraces.appenders_map[appender_name];
				appender.log(arg_log_obj, DevaptTraces);
			}
		}
	}

	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.debug(arg_log_obj)
	 * @desc				Trace a debug message
	 * @param {object}		arg_log_obj		log attributes	
	 * @return {nothing}
	 */
	DevaptTraces.debug = function(arg_log_obj)
	{
		arg_log_obj = arg_log_obj || {};
		
		if ( DevaptTypes.is_string(arg_log_obj) )
		{
			arg_log_obj = { text: arg_log_obj };
		}
		
		var default_record = 
		{
			level:'DEBUG',
			text:''
		};
		arg_log_obj = DevaptTraces.format_log_record(arg_log_obj, default_record);
		
		DevaptTraces.appenders.forEach( function(appender) { appender.debug(arg_log_obj, DevaptTraces); } );
	}

	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.warn(arg_log_obj)
	 * @desc				Trace a warn message
	 * @param {object}		arg_log_obj		log attributes	
	 * @return {nothing}
	 */
	DevaptTraces.warn = function(arg_log_obj)
	{
		arg_log_obj = arg_log_obj || {};
		
		if ( DevaptTypes.is_string(arg_log_obj) )
		{
			arg_log_obj = { text: arg_log_obj };
		}
		
		var default_record = 
		{
			level:'WARN',
			text:''
		};
		arg_log_obj = DevaptTraces.format_log_record(arg_log_obj, default_record);
		
		DevaptTraces.appenders.forEach( function(appender) { appender.warn(arg_log_obj, DevaptTraces); } );
	}

	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.info(arg_log_obj)
	 * @desc				Trace a info message
	 * @param {object}		arg_log_obj		log attributes	
	 * @return {nothing}
	 */
	DevaptTraces.info = function(arg_log_obj)
	{
		arg_log_obj = arg_log_obj || {};
		
		if ( DevaptTypes.is_string(arg_log_obj) )
		{
			arg_log_obj = { text: arg_log_obj };
		}
		
		var default_record = 
		{
			level:'INFO',
			text:''
		};
		arg_log_obj = DevaptTraces.format_log_record(arg_log_obj, default_record);
		
		DevaptTraces.appenders.forEach( function(appender) { appender.info(arg_log_obj, DevaptTraces); } );
	}
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.error(arg_error_obj)
	 * @desc				Throw an error
	 * @param {object}		arg_log_obj		log attributes
	 * @return {nothing}
	 */
	DevaptTraces.error = function(arg_log_obj)
	{
		arg_log_obj = arg_log_obj || {};
		
		if ( DevaptTypes.is_string(arg_log_obj) )
		{
			arg_log_obj = { text: arg_log_obj };
		}
		
		var default_record = 
		{
			level:'ERROR',
			text:''
		};
		arg_log_obj = DevaptTraces.format_log_record(arg_log_obj, default_record);
		
		DevaptTraces.appenders.forEach( function(appender) { appender.error(arg_log_obj, DevaptTraces); } );
		
		// THROW AN EXCEPTION
		if (DevaptTraces.throw_on_error)
		{
			var error_str = 'ERROR:' + arg_log_obj.text;
			throw(error_str);
		}
	}
	
	
	
	/* ------------------------------------------------------------------------- */
	/* LOG FORMATING */
	/* ------------------------------------------------------------------------- */
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.format_log_record(arg_log_obj)
	 * @desc				Format a log record
	 * @param {object}		arg_log_obj		log attributes	
	 * @param {object}		arg_log_obj		log default (optional)	
	 * @return {object}
	 */
	DevaptTraces.format_log_record = function(arg_log_obj, arg_default)
	{
		arg_default = arg_default ? arg_default : {};
		var default_record = 
		{
			level:'DEBUG',
			class_name:null,
			object_name:null,
			method_name:null,
			step:'',
			context:null,
			text:''
		};
		
		var record = jQuery.extend({}, default_record, arg_default, arg_log_obj);
		
		// DEBUG
		// console.log(default_record, 'default_record');
		// console.log(arg_default, 'arg_default');
		// console.log(arg_log_obj, 'arg_log_obj');
		// console.log(record, 'record');
		
		return record;
	}
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.log_indent()
	 * @desc				Increment the log indentation
	 * @return				nothing
	 */
	DevaptTraces.log_indent = function()
	{
		++DevaptTraces.log_indent_index;
		DevaptTraces.log_indent_str += DevaptTraces.log_indent_sep;
	}

	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.log_unindent()
	 * @desc				Decrement the log indentation
	 * @return {nothing}
	 */
	DevaptTraces.log_unindent = function()
	{
		--DevaptTraces.log_indent_index;
		DevaptTraces.log_indent_str = DevaptTraces.log_indent_str.substring(0, DevaptTraces.log_indent_index - 1);
	}
	
	
	
	/* ------------------------------------------------------------------------- */
	/* LOG API STATIC FUNCTIONS */
	/* ------------------------------------------------------------------------- */
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.trace_info(arg_context, arg_msg, arg_trace_enabled)
	 * @desc				Trace: information message
	 * @param {string}		arg_context			trace context
	 * @param {string}		arg_msg				trace message
	 * @param {boolean}		arg_trace_enabled	trace is enabled flag
	 * @return				nothing
	 */
	DevaptTraces.trace_info = function(arg_context, arg_msg, arg_trace_enabled)
	{
		var trace_enabled = arg_trace_enabled;
		var msg = arg_msg;
		if ( DevaptTypes.is_boolean(arg_msg) && ! DevaptTypes.is_boolean(arg_trace_enabled) )
		{
			trace_enabled = arg_msg;
			msg = '';
		}
		
		if (trace_enabled)
		{
			DevaptTraces.info( { level:'INFO', step:'', context:arg_context, text:arg_msg } );
		}
		DevaptTraces.log_indent();
	}
	
	
	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.trace_warn(arg_context, arg_msg, arg_trace_enabled)
	 * @desc				Trace: warning message
	 * @param {string}		arg_context			trace context
	 * @param {string}		arg_msg				trace message
	 * @param {boolean}		arg_trace_enabled	trace is enabled flag
	 * @return				nothing
	 */
	DevaptTraces.trace_warn = function(arg_context, arg_msg, arg_trace_enabled)
	{
		var trace_enabled = arg_trace_enabled;
		var msg = arg_msg;
		if ( DevaptTypes.is_boolean(arg_msg) && ! DevaptTypes.is_boolean(arg_trace_enabled) )
		{
			trace_enabled = arg_msg;
			msg = '';
		}
		
		if (trace_enabled)
		{
			DevaptTraces.info( { level:'WARN', step:'', context:arg_context, text:arg_msg } );
		}
		DevaptTraces.log_indent();
	}


	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.trace_enter(arg_context, arg_msg, arg_trace_enabled)
	 * @desc				Trace: enter code block
	 * @param {string}		arg_context			trace context
	 * @param {string}		arg_msg				trace message
	 * @param {boolean}		arg_trace_enabled	trace is enabled flag
	 * @return				nothing
	 */
	DevaptTraces.trace_enter = function(arg_context, arg_msg, arg_trace_enabled)
	{
		var trace_enabled = arg_trace_enabled;
		var msg = arg_msg;
		if ( DevaptTypes.is_boolean(arg_msg) && ! DevaptTypes.is_boolean(arg_trace_enabled) )
		{
			trace_enabled = arg_msg;
			msg = '';
		}
		
		if (trace_enabled)
		{
			DevaptTraces.debug( { level:'DEBUG', step:'ENTER', context:arg_context, text:arg_msg } );
		}
		DevaptTraces.log_indent();
	}


	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.trace_separator(arg_trace_enabled)
	 * @desc				Trace a separator line
	 * @param {boolean}		arg_trace_enabled	trace is enabled flag
	 * @return				nothing
	 */
	DevaptTraces.trace_separator = function(arg_trace_enabled)
	{
		if (arg_trace_enabled)
		{
			DevaptTraces.log( { level:'DEBUG', step:null, context:null, text:'*****************************************************************' } );
		}
	}


	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.trace_step(arg_context, arg_msg, arg_trace_enabled)
	 * @desc				Trace a step into a code block
	 * @param {string}		arg_context			trace context
	 * @param {string}		arg_step			trace message
	 * @param {boolean}		arg_trace_enabled	trace is enabled flag
	 * @return				nothing
	 */
	DevaptTraces.trace_step = function(arg_context, arg_step, arg_trace_enabled)
	{
		if (arg_trace_enabled)
		{
			DevaptTraces.debug( { level:'DEBUG', step:'STEP', context:arg_context, text:arg_step } );
		}
	}


	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.trace_leave(arg_context, arg_msg, arg_trace_enabled)
	 * @desc				Trace: leave code block
	 * @param {string}		arg_context			trace context
	 * @param {string}		arg_msg				trace message
	 * @param {boolean}		arg_trace_enabled	trace is enabled flag
	 * @return				nothing
	 */
	DevaptTraces.trace_leave = function(arg_context, arg_msg, arg_trace_enabled)
	{
		DevaptTraces.log_unindent();
		if (arg_trace_enabled)
		{
			DevaptTraces.debug( { level:'DEBUG', step:'LEAVE', context:arg_context, text:arg_msg } );
		}
	}


	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.trace_error(arg_context, arg_msg, arg_trace_enabled)
	 * @desc				Trace: error
	 * @param {string}		arg_context			trace context
	 * @param {string}		arg_msg				trace message
	 * @param {boolean}		arg_trace_enabled	trace is enabled flag
	 * @return				nothing
	 */
	DevaptTraces.trace_error = function(arg_context, arg_msg, arg_trace_enabled)
	{
		DevaptTraces.error( { context:arg_context, text:arg_msg } );
		DevaptTraces.log_unindent();
	}


	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.trace_var(arg_context, arg_label, arg_value, arg_trace_enabled)
	 * @desc				Trace: variable
	 * @param {string}		arg_context			trace context
	 * @param {string}		arg_label			trace variable label
	 * @param {string}		arg_value			trace variable value
	 * @param {boolean}		arg_trace_enabled	trace is enabled flag
	 * @return				nothing
	 */
	DevaptTraces.trace_var = function(arg_context, arg_label, arg_value, arg_trace_enabled)
	{
		if (arg_trace_enabled)
		{
			// console.log('DevaptTraces.trace_var:'+arg_trace_enabled);
			DevaptTraces.debug( { level:'DEBUG', step:null, context:arg_context, text:arg_label + '=[' + DevaptTypes.get_value_str(arg_value) + ']' } );
		}
	}


	/**
	 * @memberof			DevaptTraces
	 * @public
	 * @static
	 * @method				DevaptTraces.trace_value(arg_context, arg_label, arg_value, arg_trace_enabled)
	 * @desc				Trace: variable
	 * @param {string}		arg_context			trace context
	 * @param {string}		arg_label			trace variable label
	 * @param {string}		arg_value			trace variable value
	 * @param {boolean}		arg_trace_enabled	trace is enabled flag
	 * @return				nothing
	 */
	DevaptTraces.trace_value = function(arg_context, arg_label, arg_value, arg_trace_enabled)
	{
		if (arg_trace_enabled)
		{
			// console.log('DevaptTraces.trace_value:'+arg_trace_enabled);
			DevaptTraces.debug( { level:'DEBUG', step:null, context:arg_context, text:arg_label + '=[' + DevaptTypes.get_value_str(arg_value) + ']' } );
		}
	}
	
	
	// ENABLE LOG APPENDER
	DevaptTraces.enable('console', DevaptTracesConsoleClass);
	DevaptTraces.enable('memory', DevaptTracesMemoryClass);
	DevaptTraces.info('console log appender enabled');
	DevaptTraces.info('memory log appender enabled');
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// TRACE MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-07-01',
			'updated':'2014-12-05',
			'description':'Static class to log application activity (debug, info, warn, error).'
		}
	};
	var DevaptTracesClass = new DevaptClass('DevaptTracesClass', null, class_settings);
	
	
	// METHODS
	DevaptTracesClass.add_static_method('enable', {}, DevaptTraces.enable);
	DevaptTracesClass.add_static_method('disable', {}, DevaptTraces.disable);
	
	DevaptTracesClass.add_static_method('log', {}, DevaptTraces.log);
	DevaptTracesClass.add_static_method('log_appenders', {}, DevaptTraces.log_appenders);
	
	DevaptTracesClass.add_static_method('debug', {}, DevaptTraces.debug);
	DevaptTracesClass.add_static_method('info', {}, DevaptTraces.info);
	DevaptTracesClass.add_static_method('warn', {}, DevaptTraces.warn);
	DevaptTracesClass.add_static_method('error', {}, DevaptTraces.error);
	
	DevaptTracesClass.add_static_method('trace_info', {}, DevaptTraces.trace_info);
	DevaptTracesClass.add_static_method('trace_warn', {}, DevaptTraces.trace_warn);
	DevaptTracesClass.add_static_method('trace_error', {}, DevaptTraces.trace_error);
	
	DevaptTracesClass.add_static_method('trace_enter', {}, DevaptTraces.trace_enter);
	DevaptTracesClass.add_static_method('trace_step', {}, DevaptTraces.trace_step);
	DevaptTracesClass.add_static_method('trace_leave', {}, DevaptTraces.trace_leave);
	
	DevaptTracesClass.add_static_method('trace_separator', {}, DevaptTraces.trace_separator);
	DevaptTracesClass.add_static_method('trace_var', {}, DevaptTraces.trace_var);
	DevaptTracesClass.add_static_method('trace_value', {}, DevaptTraces.trace_value);
	
	DevaptTracesClass.add_static_method('log_indent', {}, DevaptTraces.log_indent);
	DevaptTracesClass.add_static_method('log_unindent', {}, DevaptTraces.log_unindent);
	
	
	// PROPERTIES
	// DevaptTracesClass.add_static_property('boolean', 'throw_on_error', 'throw an exception when an error is logged', false, false, false, 'private');
	// DevaptTracesClass.add_static_property('string', 'log_indent_str', 'indentation state string', '', false, false, 'private');
	// DevaptTracesClass.add_static_property('string', 'log_indent_sep', 'indentation separator', '-', false, false, 'private');
	// DevaptTracesClass.add_static_property('integer', 'log_indent_index', 'indentation state index', 0, false, false, 'private');
	
	
	// BUILD CLASS
	DevaptTracesClass.build_class();
	
	
	return DevaptTracesClass;
} );
/**
 * @file        factory.js
 * @desc        Devapt factory
 * @ingroup     DEVAPT_CORE
 * @date        2014-06-16
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('factory',['core/traces', 'core/types'],
function(DevaptTraces, DevaptTypes)
{
	/**
	 * @memberof	DevaptFactory
	 * @public
	 * @class
	 * @desc		Devapt factory container
	 */
	var DevaptFactory = function() {};
	
	
	/**
	 * @memberof	DevaptFactory
	 * @public
	 * @static
	 * @desc		Trace flag
	 */
	DevaptFactory.factory_trace = false;
	
	
	
	/**
	 * @memberof				DevaptFactory
	 * @public
	 * @static
	 * @method					DevaptFactory.get_class_require(arg_class_name)
	 * @desc					Get resource dependencies
	 * @param {string}			arg_class_name		resource class name
	 * @param {string}			arg_backend_path	backend relative path
	 * @return {array}			array of require file paths
	 */
	DevaptFactory.get_class_require = function(arg_class_name, arg_backend_path)
	{
		var context = 'DevaptFactory.get_class_require(class name,path)';
		DevaptTraces.trace_enter(context, '', DevaptFactory.factory_trace);
		
		
		// INIT DEPENDANCIES ARRAY
		var view_requires = [];
		
		// CHECK CLASS NAME
		if ( ! DevaptTypes.is_not_empty_str(arg_class_name) )
		{
			DevaptTraces.trace_var(context, 'resource bad class name', arg_class_name, DevaptFactory.factory_trace);
			DevaptTraces.trace_leave(context, 'resource bad class name', DevaptFactory.factory_trace);
			return view_requires;
		}
		
		// SWITCH CLASS NAME
		switch(arg_class_name)
		{
			// DATAS STORAGE ENGINES
			case 'ResultSet':
			case 'DevaptResultSet':
			{
				view_requires = ['datas/storage/resultset'];
				break;
			}
			
			case 'StorageJson':
			case 'DevaptStorageJson':
			{
				view_requires = ['datas/storage/storage-json'];
				break;
			}
			
			case 'StorageArray':
			case 'DevaptStorageArray':
			{
				view_requires = ['datas/storage/storage-array'];
				break;
			}
			
			
			// DATAS PROVIDERS
			case 'LogsProvider':
			case 'DevaptLogsProvider':
			{
				view_requires = ['datas/datasource/logs_provider'];
				break;
			}
			
			case 'ResourcesProvider':
			case 'DevaptResourcesProvider':
			{
				view_requires = ['datas/datasource/resources_provider'];
				break;
			}
			
			case 'EventsProvider':
			case 'DevaptEventsProvider':
			{
				view_requires = ['datas/datasource/events_provider'];
				break;
			}
			
			case 'ClassesProvider':
			case 'DevaptClassesProvider':
			{
				view_requires = ['datas/datasource/classes_provider'];
				break;
			}
			
			case 'CrudApiProvider':
			case 'DevaptCrudApiProvider':
			{
				view_requires = ['datas/datasource/crud_api_provider'];
				break;
			}
			
			case 'ViewApiProvider':
			case 'DevaptViewApiProvider':
			{
				view_requires = ['datas/datasource/view_api_provider'];
				break;
			}
			
			case 'ResourceApiProvider':
			case 'DevaptResourceApiProvider':
			{
				view_requires = ['datas/datasource/resource_api_provider'];
				break;
			}
			
			
			// DATAS MODELS
			case 'model':
			case 'Model':
			case 'DevaptModel':
			{
				view_requires = ['datas/model/model'];
				break;
			}
			
			case 'ViewModel':
			case 'DevaptViewModel':
			{
				view_requires = ['datas/model/view_model'];
				break;
			}
			
			case 'RecordSet':
			case 'DevaptRecordSet':
			{
				view_requires = ['datas/model/recordset'];
				break;
			}
			
			
			case 'timer':
			case 'Timer':
			case 'DevaptTimer':
			{
				view_requires = ['worker/timer'];
				break;
			}
			
			
			// CORE CLASSES
			
			case 'View':
			case 'DevaptView':
			{
				view_requires = ['views/view'];
				break;
			}
			
			case 'Tree':
			case 'DevaptTree':
			{
				view_requires = ['views/tree'];
				break;
			}
			
			case 'IncludeView':
			case 'DevaptIncludeView':
			case 'TemplateView':
			case 'DevaptTemplateView':
			{
				view_requires = ['views/remote'];
				break;
			}
			
			case 'Select':
			case 'DevaptSelect':
			{
				view_requires = ['views/select'];
				break;
			}
			
			case 'Input':
			case 'DevaptInput':
			{
				view_requires = ['views/input'];
				break;
			}
			
			case 'UrlApiDetail':
			case 'DevaptUrlApiDetail':
			{
				view_requires = ['views/url_api_detail'];
				break;
			}
		}
		
		// NO BACKEND PATH
		if (! arg_backend_path || arg_backend_path.length === 0)
		{
			if (view_requires && view_requires.length > 0)
			{
				DevaptTraces.trace_leave(context, 'resource class found', DevaptFactory.factory_trace);
				return view_requires;
			}
			
			DevaptTraces.trace_leave(context, 'resource type not found', DevaptFactory.factory_trace);
			return view_requires;
		}
		
		
		// LOOKUP VIEW CLASS IN BACKEND
		
		// SWITCH CLASS NAME
		switch(arg_class_name)
		{	
			case 'Label':
			case 'DevaptLabel':
			{
				view_requires = [arg_backend_path + '/views/label'];
				break;
			}
			
			case 'Button':
			case 'DevaptButton':
			{
				view_requires = [arg_backend_path + '/views/button'];
				break;
			}
			
			case 'ButtonGroup':
			case 'DevaptButtonGroup':
			{
				view_requires = [arg_backend_path + '/views/button-group'];
				break;
			}
			
			case 'ButtonBar':
			case 'DevaptButtonBar':
			{
				view_requires = [arg_backend_path + '/views/button-bar'];
				break;
			}
			
			case 'Image':
			case 'DevaptImage':
			{
				view_requires = [arg_backend_path + '/views/image'];
				break;
			}
			
			case 'Breadcrumbs':
			case 'DevaptBreadcrumbs':
			{
				view_requires = [arg_backend_path + '/views/breadcrumbs'];
				break;
			}
			
			case 'Panel':
			case 'DevaptPanel':
			{
				view_requires = [arg_backend_path + '/views/panel'];
				break;
			}
			
			case 'menubar':
			case 'Menubar':
			case 'DevaptMenubar':
			{
				view_requires = [arg_backend_path + '/views/menubar'];
				break;
			}
			
			case 'Pagination':
			case 'DevaptPagination':
			{
				view_requires = [arg_backend_path + '/views/pagination'];
				break;
			}
			
			
			// BACKEND CONTAINER CLASSES
			
			case 'Row':
			case 'DevaptRow':
			{
				view_requires = [arg_backend_path + '/containers/row'];
				break;
			}
			
			case 'List':
			case 'DevaptList':
			{
				view_requires = [arg_backend_path + '/containers/list'];
				break;
			}
			
			case 'NavMenu':
			case 'DevaptNavMenu':
			{
				view_requires = [arg_backend_path + '/containers/navmenu'];
				break;
			}
			
			
			case 'Dropdown':
			case 'DevaptDropdown':
			{
				view_requires = [arg_backend_path + '/containers/dropdown'];
				break;
			}
			
			case 'Tabs':
			case 'DevaptTabs':
			{
				view_requires = [arg_backend_path + '/containers/tabs'];
				break;
			}
			
			case 'Accordion':
			case 'DevaptAccordion':
			{
				view_requires = [arg_backend_path + '/containers/accordion'];
				break;
			}
			
			case 'Table':
			case 'DevaptTable':
			{
				view_requires = [arg_backend_path + '/containers/table'];
				break;
			}
			
			case 'HBox':
			case 'DevaptHBox':
			{
				view_requires = [arg_backend_path + '/containers/hbox'];
				break;
			}
			
			case 'VBox':
			case 'DevaptVBox':
			{
				view_requires = [arg_backend_path + '/containers/vbox'];
				break;
			}
			
			case 'PGrid':
			case 'DevaptPGrid':
			{
				view_requires = [arg_backend_path + '/containers/pgrid'];
				break;
			}
			
			case 'RCGrid':
			case 'DevaptRCGrid':
			{
				view_requires = [arg_backend_path + '/containers/rcgrid'];
				break;
			}
			
			
			default:
			{
				DevaptTraces.trace_leave(context, 'resource type not found', DevaptFactory.factory_trace);
				return view_requires;
			}
		}
		
		
		DevaptTraces.trace_leave(context, 'resource class found', DevaptFactory.factory_trace);
		return view_requires;
	}
	
	
	return DevaptFactory;
} );
/**
 * @file     	Devapt.js
 * @desc     	Devapt static common features: Devapt static class, traces, errors, types, inheritance, modules, resources, utils
 * 				API
 * 					Devapt.trace:(boolean)
 * 					Devapt.jQuery:(object)
 * 					
 * 					AJAX
 * 						Devapt.url(url,token): (string)
 * 						Devapt.ajaxt(method,url,datas,options): (promise)
 * 						Devapt.ajax_get(url,datas,options): (promise)
 * 						Devapt.ajax_post(url,datas,options): (promise)
 * 						Devapt.ajax_put(url,datas,options): (promise)
 * 						Devapt.ajax_delete(url,datas,options): (promise)
 * 						
 * 					PLUGINS
 * 						Devapt.plugins_requires: (array)
 * 						Devapt.plugins_map: (object)
 * 						Devapt.get_plugins(): (object)
 * 						Devapt.set_plugins(plugins): (object)
 * 						Devapt.add_plugin(plugin): (nothing)
 * 						Devapt.get_plugin(name): (object)
 * 						
 * 					BACKEND
 * 						Devapt.current_backend: (object)
 * 						Devapt.get_current_backend(): (object)
 * 						Devapt.has_current_backend(): (boolean)
 * 						Devapt.set_current_backend(backend object): (boolean)
 * 						Devapt.is_valid_backend(backend object): (boolean)
 * 						
 * 					UTILS
 * 						Devapt.get_prototype_name()
 * 						Devapt.use_css(url)
 * 						Devapt.use_assets(urls)
 * 						
 * 					UID
 * 						Devapt.uid()
 * 						Devapt.get_unique_name(arg_prefix)
 * 						 
 * 					HASH
 * 						Devapt.hash(arg_method_name, arg_value)
 * 						
 * 					PROMISES
 * 						Devapt.is_defer(value): boolean
 * 						Devapt.is_promise(value): boolean
 * 						Devapt.defer(defer): deffered object
 * 						Devapt.promise(value): promise object
 * 						Devapt.promise_resolved(value): resolved promise object
 * 						Devapt.promise_rejected(value): rejected promise object
 * 						Devapt.promise_all(promises): promise object
 * 						
 * 					FACTORY
 * 						Devapt.require(urls_array): promise object
 * 						Devapt.get_requires(class_name): promise object of a depds urls array
 * 						Devapt.create(class_name, settings): promise object
 * 						
 * 					GARBAGE COLLECTOR
 * 						Devapt.gc_use(arg_using_object, arg_used_object)
 * 						
 * 						
 * @ingroup     DEVAPT_CORE
 * @date        2013-05-16
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */



define('Devapt',
	[
		'jquery',
		'core/init',
		'md5',
		'sha1',
		'Q',
		'factory'
	],
function($, DevaptInit, CryptoMD5, CryptoSHA1, Q, DevaptFactory)
{
	console.info('Loading Devapt bootstrap');
	
	
	/**
	 * @ingroup    			LIBAPT_MAIN_JS
	 * @public
	 * @static
	 * @class				Devapt
	 * @desc				Provide common features : types test, modules repository, classes inheritance
	 */
	var Devapt = function()
	{
	};
	
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @desc				Trace flag
	 */
	Devapt.trace = true;
	
	
	
	/**
	 * @memberof     		Devapt
	 * @public
	 * @static
	 * @method				Devapt
	 * @desc				Provide jQuery object
	 * @return {object}		jQuery object
	 */
	Devapt.jQuery = function()
	{
		return $;
	};
	
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @desc				Application static class
	 */
	Devapt.app = null;
	
	
	
	// -------------------------------------------------- MESSAGES ---------------------------------------------------------
	
	// STATIC RESULT MESSAGE
	Devapt.msg_default_empty_implementation = 'default empty implementation';
	
	Devapt.msg_success = 'success';
	Devapt.msg_failure = 'failure';
	
	Devapt.msg_found = 'found';
	Devapt.msg_not_found = 'not found';
	
	Devapt.msg_default_promise = 'default implementation: returns promise';
	Devapt.msg_success_promise = 'success: returns promise';
	Devapt.msg_failure_promise = 'failure: returns promise';
	
	Devapt.msg_success_require = 'success: a requirejs request is processing';
	Devapt.msg_failure_require = 'failure: a requirejs request is processing';
	
	// TASK STATES LABELS
	// CREATED -> STARTED -> RUNNING -> SUSPENDED -> RUNNING
	// CREATED -> STARTED -> RUNNING -> STOPPED -> DESTROYED
	// CREATED -> STARTED -> RUNNING -> STOPPED -> STARTED
	Devapt.STATE_CREATED = 'CREATED';
	Devapt.STATE_READY = 'READY';
	Devapt.STATE_STARTED = 'STARTED';
	Devapt.STATE_SUSPENDED = 'SUSPENDED';
	Devapt.STATE_RUNNING = 'RUNNING';
	Devapt.STATE_STOPPED = 'STOPPED';
	Devapt.STATE_DESTROYED = 'DESTROYED';
	
	// RENDERING PROCESS STATES LABELS
	Devapt.STATE_NOT_RENDERED = 'not_rendered';
	Devapt.STATE_BEFORE_RENDERING = 'before_rendering';
	Devapt.STATE_RENDERING = 'rendering';
	Devapt.STATE_AFTER_RENDERING = 'after_rendering';
	Devapt.STATE_RENDERED = 'rendered';
	
	
	
	// -------------------------------------------------- AJAX ---------------------------------------------------------
	
	/**
	 * @memberof  			Devapt
	 * @public
	 * @static
	 * @method				Devapt.url(url,token)
	 * @desc				Check and format URL
	 * @param {string}		arg_url			URL string
	 * @param {string}		arg_token		security token string
	 * @return {object}		A promise
	 */
	Devapt.url = function(arg_url, arg_token)
	{
		if (arg_url)
		{
			if ( ! arg_token)
			{
				return arg_url;
			}
			
			if ( arg_url.indexOf('?') > 0 )
			{
				return arg_url + '&security_token=' + arg_token;
			}
			
			return arg_url + '?security_token=' + arg_token;
		}
		
		return null;
	};
	
	/**
	 * @memberof  			Devapt
	 * @public
	 * @static
	 * @method				Devapt.ajax(method,url,datas,options)
	 * @desc				Send an ajax request
	 * @param {string}		arg_method		GET, PUT, POST, DELETE
	 * @param {string}		arg_url			URL string
	 * @param {object}		arg_datas		request datas
	 * @param {object}		arg_options		AJAX options
	 * @param {string}		arg_token		security token string
	 * @return {object}		A promise
	 */
	Devapt.ajax = function(arg_method, arg_url, arg_datas, arg_options, arg_token)
	{
		// CHECK AJAX METHOD
		if (arg_method !== 'GET' & arg_method !== 'PUT' && arg_method !== 'POST' && arg_method !== 'DELETE')
		{
			console.error(arg_method, 'Devapt.ajax failure: bad method');
			return Devapt.promise_rejected();
		}
		
		// APPEND SECURITY TOKEN
		if (arg_token)
		{
			arg_url = Devapt.url(arg_url, arg_token);
		}
		
		// DEFAULT AJAX OPTIONS
		var default_options = {
			async		: true,
			cache		: true,
			type		: arg_method,
			dataType	: 'json',
			// contentType	: 'json',
			url			: arg_url,
			timeout		: 5000,
			data		: arg_datas,
			
			success: function(datas, textStatus, jqXHR)
				{
					return datas;
				},
			
			error: function(jqXHR, textStatus, errorThrown)
				{
					console.log(arg_options, 'Devapt.ajax failure: arg_options');
					console.log(textStatus, 'Devapt.ajax failure: textStatus');
					console.log(jqXHR, 'Devapt.ajax failure: jqXHR');
					console.error(errorThrown, 'Devapt.ajax failure: errorThrown');
					return null;
				}
		};
		
		// MERGE AJAX OPTIONS
		var options = window.$.extend(default_options, arg_options);
		// console.log(options, 'Devapt.ajax: options');
		
		// SEND AJAX REQUEST
		var jq_promise = $.ajax(options);
		var ajax_promise = Devapt.promise(jq_promise);
		
		// PROCESS RESPONSE
		// var success_cb = undefined;
		var success_cb = function(arg)
		{
//			console.info(arg, 'Devapt.ajax: success');
		};
		var failure_cb = function(response)
		{
			console.error(response, 'Devapt.ajax: failure');
			if (response.status == '401')
			{
				if (! Devapt.current_backend)
				{
					console.error('no backend', 'Devapt.ajax: failure');
					return;
				}
				return Devapt.current_backend.render_login();
			}
		};
		ajax_promise.then(success_cb, failure_cb);
		
		return ajax_promise;
	};
	
	/**
	 * @memberof  			Devapt
	 * @public
	 * @static
	 * @method				Devapt.ajax_get(url,datas,options)
	 * @desc				Send a GET ajax request
	 * @param {string}		arg_url			URL string
	 * @param {object}		arg_datas		request datas
	 * @param {object}		arg_options		AJAX options
	 * @param {string}		arg_token		security token string
	 * @return {object}		A promise
	 */
	Devapt.ajax_get = function(arg_url, arg_datas, arg_options, arg_token)
	{
		return Devapt.ajax('GET', arg_url, arg_datas, arg_options, arg_token);
	};
	
	/**
	 * @memberof  			Devapt
	 * @public
	 * @static
	 * @method				Devapt.ajax_put(url,datas,options)
	 * @desc				Send a PUT ajax request
	 * @param {string}		arg_url			URL string
	 * @param {object}		arg_datas		request datas
	 * @param {object}		arg_options		AJAX options
	 * @param {string}		arg_token		security token string
	 * @return {object}		A promise
	 */
	Devapt.ajax_put = function(arg_url, arg_datas, arg_options, arg_token)
	{
		return Devapt.ajax('PUT', arg_url, arg_datas, arg_options, arg_token);
	};
	
	/**
	 * @memberof  			Devapt
	 * @public
	 * @static
	 * @method				Devapt.ajax_post(url,datas,options)
	 * @desc				Send a POST ajax request
	 * @param {string}		arg_url			URL string
	 * @param {object}		arg_datas		request datas
	 * @param {object}		arg_options		AJAX options
	 * @param {string}		arg_token		security token string
	 * @return {object}		A promise
	 */
	Devapt.ajax_post = function(arg_url, arg_datas, arg_options, arg_token)
	{
		return Devapt.ajax('POST', arg_url, arg_datas, arg_options, arg_token);
	};
	
	/**
	 * @memberof  			Devapt
	 * @public
	 * @static
	 * @method				Devapt.ajax_delete(url,datas,options)
	 * @desc				Send a DELETE ajax request
	 * @param {string}		arg_url			URL string
	 * @param {object}		arg_datas		request datas
	 * @param {object}		arg_options		AJAX options
	 * @return {object}		A promise
	 */
	Devapt.ajax_delete = function(arg_url, arg_datas, arg_options, arg_token)
	{
		return Devapt.ajax('DELETE', arg_url, arg_datas, arg_options, arg_token);
	};
	
	
	
	// -------------------------------------------------- PLUGINS ---------------------------------------------------------
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @desc				Application manager
	 */
	Devapt.plugin_manager = null;
	
	
	/**
	 * @memberof  			Devapt
	 * @public
	 * @static
	 * @method				Devapt.get_plugins()
	 * @desc				Get application plugins
	 * @return {object}		Plugins map
	 */
	Devapt.get_plugin_manager = function()
	{
		return Devapt.plugin_manager;
	};
	
	
	
	// -------------------------------------------------- BACKEND ---------------------------------------------------------
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @desc				current backend
	 */
	Devapt.current_backend = null;
	
	
	/**
	 * @memberof  			Devapt
	 * @public
	 * @static
	 * @method				Devapt.get_current_backend()
	 * @desc				Get the current backend
	 * @return {object}		A backend object
	 */
	Devapt.get_current_backend = function()
	{
		return Devapt.current_backend;
	};
	
	
	/**
	 * @memberof  			Devapt
	 * @public
	 * @static
	 * @method				Devapt.has_current_backend()
	 * @desc				Test if a current backend exists
	 * @return {boolean}	Has a backend ?
	 */
	Devapt.has_current_backend = function()
	{
		return Devapt.current_backend !== null;
	};
	
	
	/**
	 * @memberof  			Devapt
	 * @public
	 * @static
	 * @method				Devapt.set_current_backend(arg_current_backend)
	 * @desc				set the current backend
	 * @param {object}		arg_current_backend		backend object
	 * @return {boolean}	success or failure
	 */
	Devapt.set_current_backend = function(arg_current_backend)
	{
		if ( Devapt.is_valid_backend(arg_current_backend) )
		{
			Devapt.current_backend = arg_current_backend;
			return true;
		}
		
		console.error('Devapt.set_current_backend : bad backend object');
		return false;
	};
	
	
	/**
	 * @memberof  			Devapt
	 * @public
	 * @static
	 * @method				Devapt.is_valid_backend(arg_backend)
	 * @desc				Test if the given backend is valid
	 * @param {object}		arg_backend		backend object
	 * @return {boolean}	success or failure
	 */
	Devapt.is_valid_backend = function(arg_backend)
	{
		if ( ! arg_backend.get_infos )
		{
			console.log('Devapt.is_valid_backend: no "get_infos" function');
			return false;
		}
		
		// if ( ! arg_backend.build_from_declaration )
		// {
			// console.log('Devapt.is_valid_backend: no "build_from_declaration" function');
			// return false;
		// }
		
		if ( ! arg_backend.render_page )
		{
			console.log('Devapt.is_valid_backend: no "render_page" function');
			return false;
		}
		
		if ( ! arg_backend.render_view )
		{
			console.log('Devapt.is_valid_backend: no "render_view" function');
			return false;
		}
		
		if ( ! arg_backend.render_login )
		{
			console.log('Devapt.is_valid_backend: no "render_login" function');
			return false;
		}
		
		if ( ! arg_backend.render_logout )
		{
			console.log('Devapt.is_valid_backend: no "render_logout" function');
			return false;
		}
		
		if ( ! arg_backend.render_error )
		{
			console.log('Devapt.is_valid_backend: no "render_error" function');
			return false;
		}
		
		return true;
	};
	
	
	
	// -------------------------------------------------- UTILS ---------------------------------------------------------
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.register(arg_modules)
	 * @desc				Register a module definition
	 * @param {object}		arg_modules			module object to register
	 * @return {nothing}
	 */
	Devapt.get_prototype_name = function(arg_prototype)
	{
		if (arg_prototype.name === undefined)
		{
			var funcNameRegex = /function\s+(.{1,})\s*\(/;
			var results = funcNameRegex.exec(arg_prototype.toString());
			return (results && results.length > 1) ? results[1] : null;
		}
		
		return arg_prototype.name;
	};
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.use_css(arg_css_files)
	 * @desc				Register a list of css files
	 * @param {array}		arg_css_files	css files array
	 * @return {nothing}
	 */
	Devapt.use_css = function(arg_css_files)
	{
		console.info('Devapt.use_css [' + arg_css_files + ']');
		
		// LOAD MODULE CSS FILES
		if (arg_css_files)
		{
			// CHECK ARRAY
			var css_files = arg_css_files;
			var arg_is_string = (typeof arg_css_files) == 'string' || (typeof arg_css_files) == 'String';
			if (arg_is_string)
			{
				css_files = [ arg_css_files ];
			}
			
			// LOOP ON MODULE CSS FILES
			for(var css_file_index in css_files)
			{
				var url = css_files[css_file_index];
				
				$('head').append('<link>');
				var css = $('head').children(':last');
				css.attr(
					{
						rel:  "stylesheet",
						type: "text/css",
						href: url,
						media: 'all'
					}
				);
			}
		}
	};
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.use_assets(arg_assets_urls)
	 * @desc				Register a list of assets url
	 * @param {array}		arg_assets_urls		assets url array
	 * @return {nothing}
	 */
	Devapt.use_assets = function(arg_assets_urls)
	{
		console.info('Devapt.use_assets:', arg_assets_urls);
		
		// LOAD MODULE CSS FILES
		if (arg_assets_urls)
		{
			// CHECK ARRAY
			var is_string = (typeof arg_assets_urls) == 'string' || (typeof arg_assets_urls) == 'String';
			if (is_string)
			{
				arg_assets_urls = [ arg_assets_urls ];
			}
			
			// LOOP ON MODULE CSS FILES
			for(var asset_index in arg_assets_urls)
			{
				var url = arg_assets_urls[asset_index];
				
				var link_jqo = $('<link>');
				$('head').append(link_jqo);
				link_jqo.attr(
					{
						rel:  "import",
						type: "unknow",
						href: url,
						media: 'all'
					}
				);
			}
		}
	};
	
	
	// -------------------------------------------------- UID ---------------------------------------------------------
	var private_uid = 1000000;
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.uid()
	 * @desc				Get a unique id
	 * @return {integer}
	 */
	Devapt.uid = function()
	{
		private_uid++;
		return private_uid;
	};
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.get_unique_name()
	 * @desc				Get a unique name
	 * @param {string}		arg_prefix		name begin
	 * @return {integer}
	 */
	Devapt.get_unique_name = function(arg_prefix)
	{
		return arg_prefix + '_' + Devapt.uid();
	};
	
	
	
	// -------------------------------------------------- GARBAGE COLLECTOR ---------------------------------------------------------
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.gc_use(using,used)
	 * @desc				Register a used object by a using object
	 * @param {object}		arg_using_object		using object
	 * @param {object}		arg_used_object			used object
	 * @return {boolean}
	 */
	Devapt.gc_use = function(arg_using_object, arg_used_object)
	{
		if (! arg_using_object || ! arg_used_object || ! arg_using_object.gc_use || ! arg_used_object.gc_uses_counter)
		{
			return false;
		}
		
		arg_using_object.gc_use(arg_used_object);
		
		return null;
	};
	
	
	
	// -------------------------------------------------- HASH ---------------------------------------------------------
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.hash()
	 * @desc				Hash a value with a method
	 * @param {string}		arg_method_name		hash method name
	 * @param {string}		arg_value			value to hash
	 * @return {string}
	 */
	Devapt.hash = function(arg_method_name, arg_value)
	{
		if (! arg_method_name)
		{
			return null;
		}
		
		// console.log(CryptoJS, 'CryptoJS');
		switch(arg_method_name.toLocaleLowerCase())
		{
			case 'md5':		return window.CryptoJS.MD5(arg_value).toString();
			case 'sha1':	return window.CryptoJS.SHA1(arg_value).toString();
		}
		
		return null;
	};
	
	
	
	// -------------------------------------------------- PROMISE ---------------------------------------------------------
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.is_defer(value)
	 * @desc				Test if a value is a deferred object
	 * @param {object}		arg_value		value to test
	 * @return {boolean}
	 */
	Devapt.is_defer = function(arg_value)
	{
		return arg_value ? !!arg_value.resolve : false;
	};
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.is_promise(value)
	 * @desc				Test if a value is a promise object
	 * @param {object}		arg_value		value to test
	 * @return {boolean}
	 */
	Devapt.is_promise = function(arg_value)
	{
		return Q.isPromise(arg_value);
	};
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.defer(value)
	 * @desc				Create a deferred object
	 * @param {object}		arg_value		external deferred (optional)
	 * @return {object}
	 */
	Devapt.defer = function(arg_value)
	{
		if(arg_value)
		{
			return Q(arg_value);
		}
		return Q.defer();
	};
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.promise()
	 * @desc				Create a promise object
	 * @param {object}		arg_value		external deferred
	 * @return {object}
	 */
	Devapt.promise = function(arg_value)
	{
		if (arg_value.makeNodeResolver && arg_value.promise)
		{
			return arg_value.promise;
		}
		return Q(arg_value);
	};
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.promise_resolved(arg_resolved_value)
	 * @desc				Create a resolved promise object with a resolved value
	 * @param {anything}	arg_resolved_value		resolved value
	 * @return {promise}
	 */
	Devapt.promise_resolved = function(arg_resolved_value)
	{
		var defer = Q.defer();
		defer.resolve(arg_resolved_value);
		return defer.promise;
	};
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.promise_resolved(arg_resolved_value)
	 * @desc				Create a rejected promise object with a reason
	 * @param {anything}	arg_reject_reason		reject reason
	 * @return {promise}
	 */
	Devapt.promise_rejected = function(arg_reject_reason)
	{
		var defer = Q.defer();
		defer.reject(arg_reject_reason);
		return defer.promise;
	};
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.defer()
	 * @desc				Create a deferred object which is resolved when all given promises are resolved or rejected
	 * @param {array}		arg_promises		all promises
	 * @return {object}
	 */
	Devapt.promise_all = function(arg_promises)
	{
		return Q.all(arg_promises);
	};
	
	
	
	// -------------------------------------------------- FACTORY ---------------------------------------------------------
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.require(arg_required_urls)
	 * @desc				Load all required urls
	 * @param {array}		arg_required_urls		required urls
	 * @return {object}		A promise which is resolved when all dependancies are loaded
	 */
	Devapt.require = function(arg_required_urls)
	{
		// CHECK DEPENDANCIES
		if ( ! (arg_required_urls && arg_required_urls.length > 0) )
		{
			console.error(arg_required_urls, 'Devapt.require:failure: bad urls');
			return Devapt.promise_rejected('Devapt.require: bad given dependancies array');
		}
		
		// INIT PROMISE
		var defer = Devapt.defer();
		
		// LOAD REQUIRED URLS WITH COMMONJS
		if ( typeof require === 'function' && typeof define === 'function')
		{
			require(arg_required_urls,
				function() 
				{
					// console.log(arg_required_urls, 'Devapt.require:success:urls');
					// console.log(arguments, 'Devapt.require:success:arguments');
					defer.resolve(arguments);
				}
			);
		}
		else
		{
			console.error(arg_required_urls, 'Devapt.require:failure: bad AMD loader');
			defer.reject('Devapt.require: module loader not found');
		}
		
		return Devapt.promise(defer);
	};
	
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.get_requires(arg_class_name)
	 * @desc				Get class dependancies path names
	 * @param {string}		arg_class_name		class name to instanciate
	 * @return {object}		A promise of class urls dependancies array
	 */
	Devapt.get_requires = function(arg_class_name)
	{
		// var dependancies = [];
		
		
		// LOOKUP DEPENDANCIES
		var plugins_promise = Devapt.get_plugin_manager().get_class_requires(arg_class_name);
		var lookup_promise = plugins_promise.then(
			function(depds)
			{
				// console.info('Devapt.get_requires: plugins promise is resolved', depds);
				
				// LOOKUP CLASS DEPENDANCIES IN PLUGINS
				if ( depds && depds.length > 0 )
				{
					// console.info('Devapt.get_requires: dependancies found in plugins for ', arg_class_name);
					return depds;
				}

				// LOOKUP CLASS DEPENDANCIES IN DEFAULT FACTORY
				// console.info('Devapt.get_requires: lookup in default factory');
				var dependancies = DevaptFactory.get_class_require(arg_class_name, '');
				if ( dependancies && dependancies.length > 0 )
				{
					// console.info('Devapt.get_requires: dependancies found in default factory for ', arg_class_name);
					return dependancies;
				}
				
				// NOT FOUND
				// console.info('Devapt.get_requires: dependancies not found for ', arg_class_name);
				return [];
			},
			
			function()
			{
				console.error('Devapt.get_requires: dependancies not found for ', arg_class_name);
				return [];
			}
		);
		
		// console.info('Devapt.get_requires: lookup_promise');
		return lookup_promise;
	};
	
	
	/**
	 * @memberof			Devapt
	 * @public
	 * @static
	 * @method				Devapt.create(arg_class_name, arg_settings)
	 * @desc				Create an object from a class name and a settings map
	 * @param {string}		arg_class_name		class name to instanciate
	 * @param {object}		arg_settings		class instance settings
	 * @return {promise}
	 */
	Devapt.create = function(arg_class_name, arg_settings)
	{
		// console.log(arg_class_name, 'Devapt.create enter');
		
		// CHECK CLASS NAME
		if (! arg_class_name || arg_class_name.length === 0)
		{
			console.error(arg_class_name, 'Devapt.create: bad class name');
			return Devapt.promise_rejected('bad class name');
		}
		
		// CHECK CLASS SETTINGS
		if (! arg_settings || arg_settings.length === 0)
		{
			console.error(arg_settings, 'Devapt.create: bad class settings');
			return Devapt.promise_rejected('bad class settings');
		}
		
		
		// GET CLASS DEPENDANCIES
		// console.log('Devapt.create get class depds');
		var depds_promise = Devapt.get_requires(arg_class_name);
		
		var create_promise = depds_promise.then(
			function(dependancies)
			{
				// console.log('Devapt.create depds found', dependancies);
				
				// CREATE INSTANCE
				if (dependancies && dependancies.length > 0)
				{
					var require_promise = Devapt.require(dependancies);
					
					var create_promise = require_promise.then(
						function(args)
						{
							var ObjectClass = args[0];
							
							// CREATE MODEL
							var instance = ObjectClass.create(arg_settings);
							
							// RESOLVE DEFERRED
							if (instance)
							{
								// console.info(instance, 'instance creation success');
								return instance;
							}
							else
							{
								console.error(ObjectClass, 'instance creation failure');
								return null;
							}
						}
					);
					
					return create_promise;
				}
				
				return Devapt.promise_rejected('class dependancies failure');
			}
		);
		
		
		return create_promise;
	};
	
	
	return Devapt;
} );
/**
 * @file        core/inheritance.js
 * @desc        Devapt static inheritance features
 * @ingroup     DEVAPT_CORE
 * @date        2013-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('core/inheritance',['Devapt', 'core/traces', 'core/types', 'object/classes'],
function(Devapt, DevaptTraces, DevaptTypes, DevaptClasses)
{
	/**
	 * @memberof	DevaptInheritance
	 * @public
	 * @class
	 * @desc		Devapt inheritance features container
	 */
	var DevaptInheritance = function() {};
	
	
	/**
	 * @memberof	DevaptInheritance
	 * @public
	 * @static
	 * @desc		Trace flag
	 */
	DevaptInheritance.inheritance_trace = true;


	/**
	 * @memberof	DevaptInheritance
	 * @public
	 * @static
	 * @desc		Inheritance tree
	 */
	DevaptInheritance.inheritances = {};



	/**
	 * @memberof			DevaptInheritance
	 * @public
	 * @static
	 * @method				DevaptInheritance.get_inheritance(arg_class_proto, arg_class_proto_inherited)
	 * @desc				Get the inheritances array
	 * @return {array}		Array of object {current:class_proto, inherited: class_proto_inherited}
	 */
	DevaptInheritance.get_inheritances = function()
	{
		return DevaptInheritance.inheritances;
	};


	/**
	 * @memberof			DevaptInheritance
	 * @public
	 * @static
	 * @method				DevaptInheritance.get_inheritance(arg_class_proto, arg_class_proto_inherited)
	 * @desc				Get the classes names
	 * @return {array}		Array of string
	 */
	DevaptInheritance.get_classes = function()
	{
		return Object.keys( DevaptInheritance.inheritances );
	}



	/**
	 * @memberof			DevaptInheritance
	 * @public
	 * @static
	 * @method				DevaptInheritance.register_inheritance(arg_class_proto, arg_class_proto_inherited)
	 * @desc				Register an inheritance edge
	 * @param {object}		arg_class_proto				child class
	 * @param {object}		arg_class_proto_inherited	inherited class
	 * @return {nothing}
	 */
	DevaptInheritance.register_inheritance = function(arg_class_proto, arg_class_proto_inherited)
	{
		DevaptInheritance.inheritances[arg_class_proto.name] = {current:arg_class_proto, inherited: arg_class_proto_inherited};
	}


	/**
	 * @memberof			DevaptInheritance
	 * @public
	 * @static
	 * @method				DevaptInheritance.get_inherited_classes(arg_class_proto)
	 * @desc				Get all inherited classes
	 * @param {object}		arg_class_proto				class prototype
	 * @return {array}		inherited classes array
	 */
	DevaptInheritance.get_inherited_classes = function(arg_class_proto)
	{
		var context = 'DevaptInheritance.get_inherited_classes(class)';
		DevaptTraces.trace_enter(context, '', DevaptInheritance.inheritance_trace);
		
		
		var inherited_classes = [];
		var class_name = DevaptClasses.get_class_name(arg_class_proto);
		DevaptTraces.trace_var(context, 'class_name', class_name, DevaptInheritance.inheritance_trace);
		
		while( ! DevaptTypes.is_null( DevaptInheritance.inheritances[class_name] ) )
		{
			inherited_classes.push( DevaptInheritance.inheritances[class_name].inherited.name );
			class_name = DevaptInheritance.inheritances[class_name].inherited.name;
			DevaptTraces.trace_var(context, 'class_name', class_name, DevaptInheritance.inheritance_trace);
		}
		
		
		DevaptTraces.trace_leave(context, '', DevaptInheritance.inheritance_trace);
		return inherited_classes;
	}


	/**
	 * @memberof			DevaptInheritance
	 * @public
	 * @static
	 * @method				DevaptInheritance.test_inheritance(arg_class_proto, arg_class_proto_inherited)
	 * @desc				Test an inheritance
	 * @param {object}		arg_class_proto				class to test
	 * @param {object}		arg_class_proto_inherited	inherited class
	 * @return {boolean}
	 */
	DevaptInheritance.test_inheritance = function(arg_class_proto, arg_class_proto_inherited)
	{
		var context = 'DevaptInheritance.test_inheritance(proto,inherited proto)';
		DevaptTraces.trace_enter(context, '', DevaptInheritance.inheritance_trace);
		
		
		if ( DevaptTypes.is_null(arg_class_proto) || DevaptTypes.is_null(arg_class_proto_inherited) )
		{
			DevaptTraces.trace_leave(context, 'proto or inherited proto is null', DevaptInheritance.inheritance_trace);
			return false;
		}
		
		var class_name = null;
		if ( DevaptTypes.is_string(arg_class_proto) )
		{
			DevaptTraces.trace_step(context, 'proto is a string', DevaptInheritance.inheritance_trace);
			
			class_name = arg_class_proto;
			if (class_name == arg_class_proto_inherited.name)
			{
				DevaptTraces.trace_leave(context, 'inheritance is true', DevaptInheritance.inheritance_trace);
				return true;
			}
		}
		else
		{
			DevaptTraces.trace_step(context, 'proto is not a string', DevaptInheritance.inheritance_trace);
			
			if ( DevaptTypes.is_function(arg_class_proto) )
			{
				DevaptTraces.trace_step(context, 'proto is a function', DevaptInheritance.inheritance_trace);
				
				if (arg_class_proto == arg_class_proto_inherited)
				{
					DevaptTraces.trace_leave(context, 'inheritance is true', DevaptInheritance.inheritance_trace);
					return true;
				}
				
				class_name = arg_class_proto.name;
			}
			else
			{
				DevaptTraces.trace_step(context, 'proto is not a function', DevaptInheritance.inheritance_trace);
				
				if ( ! DevaptTypes.is_object(arg_class_proto) )
				{
					DevaptTraces.trace_step(context, 'proto is not an object', DevaptInheritance.inheritance_trace);
					
					DevaptTraces.trace_leave(context, 'inheritance is false', DevaptInheritance.inheritance_trace);
					return false
				}
				
				DevaptTraces.trace_step(context, 'proto is an object', DevaptInheritance.inheritance_trace);
				
				if (arg_class_proto.class_name == arg_class_proto_inherited.name || arg_class_proto instanceof arg_class_proto_inherited)
				{
					DevaptTraces.trace_leave(context, 'inheritance is true', DevaptInheritance.inheritance_trace);
					return true;
				}
				
				class_name = arg_class_proto.class_name;
			}
		}
		
		DevaptTraces.trace_step(context, 'get inheritance record', DevaptInheritance.inheritance_trace);
		var record = DevaptInheritance.inheritances[class_name];
		if ( DevaptTypes.is_null(record) )
		{
			DevaptTraces.trace_leave(context, 'inheritance is false', DevaptInheritance.inheritance_trace);
			return false;
		}
		
		if (record.inherited == arg_class_proto_inherited)
		{
			DevaptTraces.trace_leave(context, 'inheritance is true', DevaptInheritance.inheritance_trace);
			return true;
		}
		
		var result = DevaptInheritance.test_inheritance(record.inherited, arg_class_proto_inherited);
		
		
		DevaptTraces.trace_leave(context, 'inheritance is ' + (result ? 'true' : 'false'), DevaptInheritance.inheritance_trace);
		return result;
	}


	/**
	 * @memberof			DevaptInheritance
	 * @public
	 * @static
	 * @method				DevaptInheritance.is_a(arg_class_proto, arg_class_proto_inherited)
	 * @desc				Test an inheritance (alias of test_inheritance)
	 * @param {object}		arg_class_proto				class to test
	 * @param {object}		arg_class_proto_inherited	inherited class
	 * @return {boolean}
	 */
	DevaptInheritance.is_a = function(arg_class_proto, arg_class_proto_inherited)
	{
		return DevaptInheritance.test_inheritance(arg_class_proto, arg_class_proto_inherited);
	}
	
	
	return DevaptInheritance;
} );
/**
 * @file        object/mixin-assertion.js
 * @desc        Mixin of methods for assertion
 * @see			DevaptObject
 * @ingroup     DEVAPT_OBJECT
 * @date        2013-06-13
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define( 'object/mixin-assertion',['core/types', 'core/inheritance', 'object/class'],
function(DevaptTypes, DevaptInheritance, DevaptClass)
{
	var DevaptMixinAssertion =
	{
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @desc				Enable or disable the assertions trace
		 */
		trace_assert: false,
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert(arg_context, arg_name, arg_value, arg_label)
		 * @desc				Assert that value is true (assert failed if value is false)
		 * @param {string}		arg_context			assertion context
		 * @param {boolean}		arg_test			assertion test
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_label			assertion label : kind of check
		 * @param {string}		arg_value			assertion value
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert: function(arg_context, arg_name, arg_test, arg_label, arg_value)
		{
			if ( ! arg_test )
			{
				var msg = this.class_name + ':' + (arg_label ? arg_label : 'Assert True') + ' failed for name=[' + arg_name + '] value=[' + arg_value + ']';
				this.error(arg_context, msg, this.trace_assert);
				throw(arg_context + ':' + msg);
			}
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_true(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is true
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_true: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, DevaptTypes.is_boolean(arg_value) && arg_value, 'Assert True', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_false(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is false
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_false: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, DevaptTypes.is_boolean(arg_value) && (! arg_value), 'Assert False', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_null(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is null
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_null: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, DevaptTypes.is_null(arg_value), 'Assert Null', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_not_null(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is not null
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_not_null: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, ! DevaptTypes.is_null(arg_value), 'Assert NotNull', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_inherit(arg_context, arg_name, arg_value, arg_class_obj)
		 * @desc				Assert that value inherits of a given class
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_inherit: function(arg_context, arg_name, arg_value, arg_class_obj)
		{
			var bool_result = arg_value instanceof arg_class_obj || DevaptInheritance.test_inheritance(arg_value, arg_class_obj);
			this.assert(arg_context, arg_name, bool_result, 'Assert Inherit', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_typeof(arg_context, arg_name, arg_value, arg_type_name)
		 * @desc				Assert that value is of a given type
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @param {string}		arg_type_name		type name
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_typeof: function(arg_context, arg_name, arg_value, arg_type_name)
		{
			this.assert(arg_context, arg_name, typeof arg_value == arg_type_name, 'Assert Typeof', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_function(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is a function
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_function: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, DevaptTypes.is_function(arg_value), 'Assert Function', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_callback(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is a callback
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_callback: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, DevaptTypes.is_callback(arg_value), 'Assert Callback', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_object(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is an object
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_object: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, DevaptTypes.is_object(arg_value), 'Assert Object', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_object_size(arg_context, arg_name, arg_value, arg_size_min, arg_size_max)
		 * @desc				Assert that value is an object and the attributes count is greater or equal to the given min size and lesser or equal to the given max size
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @param {integer}		arg_size_min		assertion array minimal size
		 * @param {integer}		arg_size_max		assertion array maximal size
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_object_size: function(arg_context, arg_name, arg_value, arg_size_min, arg_size_max)
		{
			var keys_count = DevaptTypes.is_object(arg_value) ? Object.keys(arg_value).length : -1;
			var min_is_valid = keys_count >= arg_size_min;
			var max_is_valid = DevaptTypes.is_null(arg_size_max) ? true : (keys_count <= arg_size_max);
			this.assert(arg_context, arg_name, DevaptTypes.is_object(arg_value) && min_is_valid && max_is_valid, 'Assert assert_object_size', 'length:' + arg_value.length + ' min:' + min_is_valid + ' max:' + max_is_valid);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_array(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is an array
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_array: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, DevaptTypes.is_array(arg_value), 'Assert Array', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_array_size(arg_context, arg_name, arg_value, arg_size_min, arg_size_max)
		 * @desc				Assert that value is an array and the array size is greater or equal to the given min size and lesser or equal to the given max size
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @param {integer}		arg_size_min		assertion array minimal size
		 * @param {integer}		arg_size_max		assertion array maximal size
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_array_size: function(arg_context, arg_name, arg_value, arg_size_min, arg_size_max)
		{
			this.assert(arg_context, arg_name, DevaptTypes.is_array(arg_value) && arg_value.length >= arg_size_min && (DevaptTypes.is_null(arg_size_max) ? true : (arg_value.length <= arg_size_max) ), 'Assert assert_array_size', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_not_empty_array(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is an array ans it is not empty
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_not_empty_array: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, DevaptTypes.is_array(arg_value) && arg_value.length > 0, 'Assert NotEmptyArray', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_not_empty_object_or_array(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is an array or an object and the array or object is not empty
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_not_empty_object_or_array: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, (DevaptTypes.is_array(arg_value) && arg_value.length > 0) || DevaptTypes.is_object(arg_value), 'Assert NotEmptyArrayOrObject', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_not_empty_string(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is a string and the string is not empty
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_not_empty_string: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, DevaptTypes.is_not_empty_str(arg_value), 'Assert NotEmptyString', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_integer(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is an integer
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {integer}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_integer: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, DevaptTypes.is_integer(arg_value), 'Assert Integer', arg_value);
		},
		
		
		/**
		 * @memberof			DevaptMixinAssertion
		 * @public
		 * @method				assert_not_empty_value(arg_context, arg_name, arg_value)
		 * @desc				Assert that value is not null and the value is not an empty string
		 * @param {string}		arg_context			assertion context
		 * @param {string}		arg_name			assertion value name
		 * @param {string}		arg_value			assertion value to test
		 * @return {nothing}	(throw exception if assertion failed)
		 */
		assert_not_empty_value: function(arg_context, arg_name, arg_value)
		{
			this.assert(arg_context, arg_name, ! DevaptTypes.is_null(arg_value) && arg_value !== '' && arg_value !== {} && arg_value !== [], 'Assert NotEmptyValue', arg_value);
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-07-01',
			'updated':'2014-12-05',
			'description':'Mixin methods to assert values.'
		}
	};
	
	
	/**
	 * @mixin				DevaptMixinAssertionClass
	 * @public
	 * @desc				Mixin of methods for values assertion
	 */
	var DevaptMixinAssertionClass = new DevaptClass('DevaptMixinAssertion', null, class_settings);
	
	DevaptMixinAssertionClass.add_public_method('assert', {}, DevaptMixinAssertion.assert);
	
	DevaptMixinAssertionClass.add_public_method('assert_true', {}, DevaptMixinAssertion.assert_true);
	DevaptMixinAssertionClass.add_public_method('assert_false', {}, DevaptMixinAssertion.assert_false);
	
	DevaptMixinAssertionClass.add_public_method('assert_null', {}, DevaptMixinAssertion.assert_null);
	DevaptMixinAssertionClass.add_public_method('assert_not_null', {}, DevaptMixinAssertion.assert_not_null);
	
	DevaptMixinAssertionClass.add_public_method('assert_inherit', {}, DevaptMixinAssertion.assert_inherit);
	DevaptMixinAssertionClass.add_public_method('assert_inherits', {}, DevaptMixinAssertion.assert_inherit);
	
	DevaptMixinAssertionClass.add_public_method('assert_typeof', {}, DevaptMixinAssertion.assert_typeof);
	
	DevaptMixinAssertionClass.add_public_method('assert_function', {}, DevaptMixinAssertion.assert_function);
	
	DevaptMixinAssertionClass.add_public_method('assert_object', {}, DevaptMixinAssertion.assert_object);
	DevaptMixinAssertionClass.add_public_method('assert_object_size', {}, DevaptMixinAssertion.assert_object_size);
	
	DevaptMixinAssertionClass.add_public_method('assert_array', {}, DevaptMixinAssertion.assert_array);
	DevaptMixinAssertionClass.add_public_method('assert_array_size', {}, DevaptMixinAssertion.assert_array_size);
	DevaptMixinAssertionClass.add_public_method('assert_not_empty_array', {}, DevaptMixinAssertion.assert_not_empty_array);
	DevaptMixinAssertionClass.add_public_method('assert_not_empty_object_or_array', {}, DevaptMixinAssertion.assert_not_empty_object_or_array);
	
	DevaptMixinAssertionClass.add_public_method('assert_not_empty_str', {}, DevaptMixinAssertion.assert_not_empty_string);
	DevaptMixinAssertionClass.add_public_method('assert_not_empty_string', {}, DevaptMixinAssertion.assert_not_empty_string);
	DevaptMixinAssertionClass.add_public_method('assert_integer', {}, DevaptMixinAssertion.assert_integer);
	DevaptMixinAssertionClass.add_public_method('assert_not_empty_value', {}, DevaptMixinAssertion.assert_not_empty_value);
	
	
	DevaptMixinAssertionClass.build_class();
	
	return DevaptMixinAssertionClass;
} );
/**
 * @file        object/mixin-callback.js
 * @desc        Mixin of callback methods
 * @see			DevaptObject
 * @ingroup     DEVAPT_OBJECT
 * @date        2013-06-13
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'object/mixin-callback',['core/types', 'object/class'],
function(DevaptTypes, DevaptClass)
{
	/**
	 * @mixin				DevaptMixinCallback
	 * @public
	 * @desc				Mixin of callback methods
	 */
	var DevaptMixinCallback = 
	{
		/**
		 * @memberof			DevaptMixinCallback
		 * @public
		 * @desc				Enable/disable trace for callback operations
		 */
		mixin_callback_trace: true,
		
		
		
		/**
		 * @memberof			DevaptMixinCallback
		 * @public
		 * @method				do_callback(arg_callback, arg_operands_array)
		 * @desc				Run a callback function or method
		 * @param {array}		arg_callback			callback (function or method array)
		 * @param {array}		arg_operands_array		operands (array)
		 * @return {anything}	Callback result
		 */
		do_callback: function(arg_callback, arg_operands_array)
		{
			var self = this;
			self.push_trace(self.trace, self.mixin_callback_trace);
			var context = 'do_callback(callback,operands)';
			self.enter(context, '');
			// self.value(context, 'arg_callback', arg_callback);
			
			
			var cb_result = null;
			if ( DevaptTypes.is_null(arg_operands_array) )
			{
				arg_operands_array = [];
			}
			if (arg_callback && typeof(arg_callback) === 'function')
			{
				self.step(context, 'call function callback');
				// console.log(typeof arg_operands_array, 'operands type');
				// console.log(arg_operands_array.length, 'operands.length');
				cb_result = arg_callback.apply(null, arg_operands_array);
			}
			else if (arg_callback && typeof(arg_callback) === 'object' && arg_callback.length >= 2)
			{
				self.step(context, 'call array callback');
				var cb_object	= arg_callback[0];
				var cb_method	= arg_callback[1];
				var cb_operands	= [];
				// self.value(context, 'arg_callback[0]', arg_callback[0]);
				// self.value(context, 'arg_callback[1]', arg_callback[1]);
				
				// CHECK CALLBACK
				self.assert_not_null(context, 'cb_object', cb_object);
				self.assert_not_null(context, 'cb_method', cb_method);
				
				// GET OPERANDS
				if ( ! DevaptTypes.is_null(arg_operands_array) )
				{
					for(var opd_index = 0 ; opd_index < arg_operands_array.length ; opd_index++)
					{
						cb_operands.push(arg_operands_array[opd_index]);
					}
				}
				
				for(var opd_index = 2 ; opd_index < arg_callback.length ; opd_index++)
				{
					cb_operands.push(arg_callback[opd_index]);
				}
				
				cb_result = cb_method.call(cb_object, cb_operands);
			}
			else if (arg_callback && typeof(arg_callback) === 'string' && arg_callback.length >= 1)
			{
				self.step(context, 'call string callback [' + arg_callback + ']');
				
				// TODO SECURITY CONCERN !
				cb_result = eval(arg_callback);
			}
			else
			{
				self.leave(context, 'unknow callback type [' + typeof arg_callback + ']');
				self.pop_trace();
				return false;
			}
			
			self.leave(context, '');
			self.pop_trace();
			return cb_result;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// TRACE MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-07-01',
			'updated':'2014-12-05',
			'description':'Mixin methods to run callbacks.'
		}
	};
	
	
	/**
	 * @mixin				DevaptMixinCallbackClass
	 * @public
	 * @desc				Mixin of methods for values assertion
	 */
	var DevaptMixinCallbackClass = new DevaptClass('DevaptMixinCallback', null, class_settings);
	
	DevaptMixinCallbackClass.add_public_method('do_callback', {}, DevaptMixinCallback.do_callback);
	
	DevaptMixinCallbackClass.build_class();
	
	return DevaptMixinCallbackClass;
} );
/**
 * @file        object/mixin-trace.js
 * @desc        Mixin of traces methods
 * @see			DevaptObject
 * @ingroup     DEVAPT_OBJECT
 * @date        2013-06-13
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define( 'object/mixin-trace',['core/traces', 'core/types', 'object/class', 'object/classes'],
function(DevaptTraces, DevaptTypes, DevaptClass, DevaptClasses)
{
	/**
	 * @mixin			DevaptMixinTrace
	 * @public
	 * @desc			Base class for traces features
	 */
	var DevaptMixinTrace =
	{
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @desc				Level constant for all trace: DEBUG, INFO, WARN, ERROR
		 */
		LEVEL_ALL: 'ALL',
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @desc				Level constant for debugging trace: DEBUG, INFO, WARN, ERROR (same as ALL)
		 */
		LEVEL_DEBUG: 'DEBUG',
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @desc				Level constant for information trace: INFO, WARN, ERROR
		 */
		LEVEL_INFO: 'INFO',
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @desc				Level constant for warning trace: WARN, ERROR
		 */
		LEVEL_WARN: 'WARN',
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @desc				Level constant for error trace: ERROR only
		 */
		LEVEL_ERROR: 'ERROR',
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @desc				Level constant for debug trace: STEP ONLY
		 */
		LEVEL_DEBUG_STEP: 'STEP',
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @desc				Level constant for debug trace: ENTER and LEAVE ONLY
		 */
		LEVEL_DEBUG_ENTER_LEAVE: 'ENTER-LEAVE',
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @desc				Level constant for debug trace: VALUE ONLY
		 */
		LEVEL_DEBUG_VALUE: 'VALUE',
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @desc				Default trace level
		 */
		LEVEL_DEFAULT: 'ERROR',
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @desc				Trace levels list
		 */
		LEVELS: ['ALL', 'DEBUG', 'INFO', 'WARN', 'ERROR', 'STEP', 'ENTER-LEAVE', 'VALUE'],
		
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @desc				Trace stack
		 */
		trace_stack: null,
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				init_mixin_trace(self)
		 * @desc				Init mixin
		 * @param {object}		self		instance object
		 * @return {nothing}
		 */
		init_mixin_trace: function(self)
		{
			self.trace_stack = new Array();
			
			
			var instance = self;
			instance.trace = false;
			instance.trace_methods = {}; // { method_name_aa:level }
			
			
			// APPLY TRACE SETTINGS
			// console.log(DevaptClasses.traces_settings, self.name);
			if ( DevaptTypes.is_not_empty_array_or_object(DevaptClasses.traces_settings) )
			{
				// console.log(DevaptClasses.traces_settings, 'DevaptClasses.traces_settings)');
				for(var trace_key in DevaptClasses.traces_settings)
				{
					if (instance.trace)
					{
						continue;
					}
					
					// console.log(trace_key, 'trace_key');
					var trace_record = DevaptClasses.traces_settings[trace_key].split(':');
					// console.log(trace_record, 'trace_record');
					
					var class_name_pattern = trace_record.length > 0 ? trace_record[0] : null;
					var instance_name_pattern = trace_record.length > 1 ? trace_record[1] : null;
					var method_name_pattern = trace_record.length > 2 ? trace_record[2] : null;
					var level_name = trace_record.length > 3 ? trace_record[3].toLocaleUpperCase() : DevaptMixinTrace.LEVEL_DEFAULT;
					// console.log(class_name_pattern, 'class_name_pattern');
					// console.log(instance_name_pattern, 'instance_name_pattern');
					// console.log(method_name_pattern, 'method_name_pattern');
					// console.log(level_name, 'level_name');
					
					// ENABLE CLASS TRACE
					if ( DevaptTypes.is_not_empty_str(class_name_pattern) )
					{
						var regexp = new RegExp(class_name_pattern, 'i');
						var class_name_trace = regexp.test(instance.class_name);
						// console.log(class_name_trace, instance.class_name + ':class_name_trace');
						instance.trace = class_name_trace;
						// console.log(instance.trace, 'instance.trace for [' + instance.name + '] with pattern[' + class_name_pattern + ']');
						
						if (instance.trace)
						{
							continue;
						}
					}
					
					// ENABLE INSTANCE METHOD TRACE
					if ( DevaptTypes.is_not_empty_str(method_name_pattern) )
					{
						if ( DevaptTypes.is_not_empty_str(instance_name_pattern) )
						{
							var instance_regexp = new RegExp(instance_name_pattern, 'i');
							
							// console.log(instance.name + ':instance name and method pattern exist');
							
							if ( instance_regexp.test(instance.name) )
							{
								// console.log(self._class, instance.name + ':instance matches for method pattern');
								
								var method_regexp = new RegExp(method_name_pattern, 'i');
								var all_methods_map = self._class.methods.all_map;
								for(var method_name in all_methods_map)
								{
									var trace = method_regexp.test(method_name);
									if (trace)
									{
										// console.log(instance.name + ':method matches for instance');
										self.enable_method_trace(method_name, level_name);
										continue;
									}
								}
							}
						}
					}
					
					// ENABLE INSTANCE TRACE
					else
					{
						if ( DevaptTypes.is_not_empty_str(instance_name_pattern) )
						{
							var regexp = new RegExp(instance_name_pattern, 'i');
							var instance_name_trace = regexp.test(instance.name);
							// console.log(instance_name_trace, instance.name + ':instance_name_trace');
							instance.trace = instance_name_trace;
							// continue;
						}
					}
				}
			}
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				init_mixin_trace(self)
		 * @desc				Init mixin
		 * @param {string}		arg_method_name		instance method name to trace
		 * @param {string}		arg_level			trace level (ALL, DEBUG, INFO, WARN, ERROR)
		 * @return {nothing}
		 */
		enable_method_trace: function(arg_method_name, arg_level)
		{
			var self = this;
			var context = 'enable_method_trace';
			
			// NORMALIZE TRACE LEVEL
			arg_level = DevaptTypes.to_list_item(arg_level, DevaptMixinTrace.LEVELS, DevaptMixinTrace.DEFAULT_LEVEL);
			
			// CHECK METHOD
			if ( ! DevaptTypes.is_not_empty_str(arg_method_name) || ! DevaptTypes.is_function( self[arg_method_name] ) )
			{
				DevaptTraces.trace_error(self._class.name + '.' + context + '(' + self.name + ')', 'bad method name', true);
				return;
			}
			var saved_method_name = arg_method_name + '_orig_cb';
			
			// TEST IF ALREADY DECORATED
			if ( DevaptTypes.is_function( self[saved_method_name] ) )
			{
				self.step(context, 'method is already traced');
				return;
			}
			
			// SET METHOD TRACE LEVEL
			self.trace_methods[arg_method_name] = arg_level;
			
			// GET METHOD CALLBACK
			var all_methods_map = self._class.methods.all_map;
			var method_record = all_methods_map[arg_method_name];
			self.assert_not_null(context, 'method_record', method_record);
			var method_cb = method_record.callback;
			self.assert_function(context, 'method_cb', method_cb);
			
			// SET DECORATOR
			var decorator_cb = function()
			{
				var self = this;
				// console.log(self.name, 'decorator name');
				// console.log(self.trace_methods, self.name);
				
				// SAVE STATE AND ENABLE TRACE
				var saved_trace = self.trace;
				self.trace = true;
				self.trace_method = arg_method_name;
				// console.warn(self.trace_method, self.name);
				
				// DO CALLBACK
				// TODO PROCESS ASYNC
				var result = method_cb.apply(self, arguments);
				
				// RESTORE STATE
				self.trace = saved_trace;
				delete self.trace_method;
				
				return result;
			};
			
			// DECORATE INSTANCE
			self[arg_method_name] = decorator_cb;
			self[saved_method_name] = method_cb;					
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				push_trace(arg_saved_trace, arg_target_trace)
		 * @desc				Save and switch the trace flag
		 * @param {boolean}		arg_saved_trace			the current trace flag to save on the stack
		 * @param {boolean}		arg_target_trace		the new trace flag
		 * @return {nothing}
		 */
	/*	matches: function(arg_context, arg_class_name_pattern, arg_object_name_pattern, arg_method_name_pattern)
		{
			var self = this;
			
			arg_class_name_pattern = arg_class_name_pattern ? arg_class_name_pattern : '.*';
			arg_object_name_pattern = arg_object_name_pattern ? arg_object_name_pattern : '.*';
			arg_method_name_pattern = arg_method_name_pattern ? arg_method_name_pattern : '.*';
			
			var pattern = arg_class_name_pattern + ':' + arg_object_name_pattern + ':' + arg_method_name_pattern;
			var regexp = new RegExp(pattern, 'i');
			var str = self.class_name + ':' + self.name + ':' + arg_context;
			
			return regexp.test(str);
		},*/
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				push_trace(arg_saved_trace, arg_target_trace)
		 * @desc				Save and switch the trace flag
		 * @param {boolean}		arg_saved_trace			the current trace flag to save on the stack
		 * @param {boolean}		arg_target_trace		the new trace flag
		 * @return {nothing}
		 */
		push_trace: function(arg_saved_trace, arg_target_trace)
		{
			this.trace_stack.push(arg_saved_trace);
			this.trace = arg_target_trace;
		},
		
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				pop_trace()
		 * @desc				Restore and switch the trace flag
		 * @return {nothing}
		 */
		pop_trace: function()
		{
			this.trace = this.trace_stack.pop();
		},
		
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				should_trace(arg_context, arg_level)
		 * @desc				Shoud trace
		 * @param {string}		arg_context			method context
		 * @return {boolean}
		 */
		should_trace: function(arg_context, arg_level)
		{
			var method_name = this.trace_method ? this.trace_method : arg_context;
			
			if (this.trace_methods && this.trace_methods.hasOwnProperty(method_name) )
			{
				// console.warn(this.trace_methods[method_name], method_name);
				return this.trace_methods[method_name] === DevaptMixinTrace.LEVEL_ALL
					|| this.trace_methods[method_name] === DevaptMixinTrace.LEVEL_DEBUG
					|| (this.trace_methods[method_name] === DevaptMixinTrace.LEVEL_DEBUG_STEP && arg_level === DevaptMixinTrace.LEVEL_DEBUG_STEP)
					|| (this.trace_methods[method_name] === DevaptMixinTrace.LEVEL_DEBUG_ENTER_LEAVE && arg_level === DevaptMixinTrace.LEVEL_DEBUG_ENTER_LEAVE)
					|| (this.trace_methods[method_name] === DevaptMixinTrace.LEVEL_DEBUG_VALUE && arg_level === DevaptMixinTrace.LEVEL_DEBUG_VALUE)
					|| (this.trace_methods[method_name] === DevaptMixinTrace.LEVEL_INFO && arg_level in [DevaptMixinTrace.LEVEL_INFO, DevaptMixinTrace.LEVEL_WARN, DevaptMixinTrace.LEVEL_ERROR])
					|| (this.trace_methods[method_name] === DevaptMixinTrace.LEVEL_WARN && arg_level in [DevaptMixinTrace.LEVEL_WARN, DevaptMixinTrace.LEVEL_ERROR])
					|| (this.trace_methods[method_name] === DevaptMixinTrace.LEVEL_ERROR && arg_level === DevaptMixinTrace.LEVEL_ERROR)
					;
			}
			
			return this.trace;
		},
		
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				enter(arg_context, arg_msg)
		 * @desc				Trace the call stack : enter in method
		 * @param {string}		arg_context			method context
		 * @param {string}		arg_msg				information message
		 * @return {nothing}
		 */
		enter: function(arg_context, arg_msg)
		{
			if ( this.should_trace(arg_context, DevaptMixinTrace.LEVEL_DEBUG_ENTER_LEAVE) )
			{
				// VARIABLE MESSAGES COUNT
				if (arguments.length > 2)
				{
					arg_msg = '';
					for(var index = 1 ; index < arguments.length ; index++)
					{
						arg_msg += (arg_msg === '' ? '' : ',') + arguments[index];
					}
				}
				
				// TRACE DEBUG
				DevaptTraces.debug(
					{
						level:DevaptMixinTrace.LEVEL_DEBUG,
						step:'ENTER',
						class_name:this.class_name,
						object_name:this.name,
						method_name:arg_context,
						context:null,
						text:arg_msg
					}
				);
				DevaptTraces.log_indent();
			}
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				step(arg_context, arg_msg)
		 * @desc				Trace the call stack : step of a method
		 * @param {string}		arg_context			method context
		 * @param {string}		arg_msg				information message
		 * @return {nothing}
		 */
		step: function(arg_context, arg_msg)
		{
			if ( this.should_trace(arg_context, DevaptMixinTrace.LEVEL_DEBUG_STEP) )
			{
				DevaptTraces.debug(
					{
						level:DevaptMixinTrace.LEVEL_DEBUG,
						step:'STEP',
						class_name:this.class_name,
						object_name:this.name,
						method_name:arg_context,
						context:null,
						text:arg_msg
					}
				);
			}
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				warn(arg_context, arg_msg)
		 * @desc				Trace the call stack : warning message
		 * @param {string}		arg_context			method context
		 * @param {string}		arg_msg				information message
		 * @return {nothing}
		 */
		warn: function(arg_context, arg_msg, arg_force_trace)
		{
			if ( arg_force_trace || this.should_trace(arg_context, DevaptMixinTrace.LEVEL_WARN) )
			{
				DevaptTraces.warn(
					{
						level:DevaptMixinTrace.LEVEL_WARN,
						step:'',
						class_name:this.class_name,
						object_name:this.name,
						method_name:arg_context,
						context:null,
						text:arg_msg
					}
				);
			}
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				info(arg_context, arg_msg)
		 * @desc				Trace the call stack : information message
		 * @param {string}		arg_context			method context
		 * @param {string}		arg_msg				information message
		 * @return {nothing}
		 */
		info: function(arg_context, arg_msg, arg_force_trace)
		{
			if ( arg_force_trace || this.should_trace(arg_context, DevaptMixinTrace.LEVEL_INFO) )
			{
				DevaptTraces.info(
					{
						level:DevaptMixinTrace.LEVEL_INFO,
						step:'',
						class_name:this.class_name,
						object_name:this.name,
						method_name:arg_context,
						context:null,
						text:arg_msg
					}
				);
			}
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				leave(arg_context, arg_msg)
		 * @desc				Trace the call stack : leave the method
		 * @param {string}		arg_context			method context
		 * @param {string}		arg_msg				information message
		 * @return {nothing}
		 */
		leave: function(arg_context, arg_msg)
		{
			if ( this.should_trace(arg_context, DevaptMixinTrace.LEVEL_DEBUG_ENTER_LEAVE) )
			{
				DevaptTraces.log_unindent();
				DevaptTraces.debug(
					{
						level:DevaptMixinTrace.LEVEL_DEBUG,
						step:'LEAVE',
						class_name:this.class_name,
						object_name:this.name,
						method_name:arg_context,
						context:null,
						text:arg_msg
					}
				);
			}
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				leave_or_error(arg_context, arg_ok_msg, arg_ko_msg, arg_bool_result)
		 * @desc				Trace the call stack :  method output (success or error check)
		 * @param {string}		arg_context			method context
		 * @param {string}		arg_ok_msg			success information message
		 * @param {string}		arg_ko_msg			error information message
		 * @param {boolean}		arg_bool_result		value to test
		 * @return {nothing}
		 */
		leave_or_error: function(arg_context, arg_ok_msg, arg_ko_msg, arg_bool_result)
		{
			if (arg_bool_result)
			{
				if ( this.should_trace(arg_context, 'DEBUG') )
				{
					DevaptTraces.log_unindent();
					
					DevaptTraces.debug(
						{
							level:DevaptMixinTrace.LEVEL_DEBUG,
							step:'LEAVE',
							class_name:this.class_name,
							object_name:this.name,
							method_name:arg_context,
							context:null,
							text:arg_ok_msg
						}
					);
				}
			}
			else
			{
				DevaptTraces.log_unindent();
				DevaptTraces.error(
					{
						level:DevaptMixinTrace.LEVEL_DEBUG,
						step:'LEAVE',
						class_name:this.class_name,
						object_name:this.name,
						method_name:arg_context,
						context:null,
						text:arg_ko_msg
					}
				);
			}
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				error(arg_context, arg_msg)
		 * @desc				Trace the call stack : trace error
		 * @param {string}		arg_context			method context
		 * @param {string}		arg_msg				information message
		 * @return {nothing}
		 */
		error: function(arg_context, arg_msg)
		{
//			if ( this.should_trace(arg_context, DevaptMixinTrace.LEVEL_ERROR) )
//			{
				DevaptTraces.error(
					{
						level:DevaptMixinTrace.LEVEL_ERROR,
						step:'',
						class_name:this.class_name,
						object_name:this.name,
						method_name:arg_context,
						context:null,
						text:arg_msg
					}
				);
//			}
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				value(arg_context, arg_name, arg_value)
		 * @desc				Trace the call stack : trace value
		 * @param {string}		arg_context			method context
		 * @param {string}		arg_name			value name
		 * @param {string}		arg_value			value
		 * @return {nothing}
		 */
		value: function(arg_context, arg_name, arg_value)
		{
			if ( this.should_trace(arg_context, DevaptMixinTrace.LEVEL_DEBUG_VALUE) )
			{
				DevaptTraces.debug(
					{
						level:DevaptMixinTrace.LEVEL_DEBUG,
						step:'VALUE',
						class_name:this.class_name,
						object_name:this.name,
						method_name:arg_context,
						context:null,
						text:arg_name + '=' + DevaptTypes.get_value_str(arg_value)
					}
				);
			}
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				separator()
		 * @desc				Trace a line separator
		 * @return {nothing}
		 */
		separator: function()
		{
			if ( this.should_trace(arg_context, DevaptMixinTrace.LEVEL_ALL) )
			{
				DevaptTraces.log( { level:'****', step:'', context:'', text:'*****************************************************************' } );
			}
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				to_string_value(arg_name, arg_value_str)
		 * @desc				To string : Trace a value string
		 * @param {string}		arg_name			value name
		 * @param {string}		arg_value_str		value
		 * @return {nothing}
		 */
		to_string_value: function(arg_name, arg_value_str)
		{
			return arg_name + '=[' + arg_value_str + '],';
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				separator()
		 * @desc				Trace a line separator
		 * @return {nothing}
		 */
		to_string: function()
		{
			return this.class_name + '{'
				+ this.to_string_value('class', this.class_name)
				+ this.to_string_value('name',  this.name)
				+ this.to_string_value('trace', this.trace)
				+ this.to_string_value('trace_assert', this.trace_assert)
				+ this.to_string_self() + '}';
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				to_string_self()
		 * @desc				To string : Trace the child class specific content
		 * @return {nothing}
		 */
		to_string_self: function()
		{
		},
		
		
		/**
		 * @memberof			DevaptMixinTrace
		 * @public
		 * @method				toString()
		 * @desc				alias for to_string
		 * @return {nothing}
		 */
		toString: function()
		{
			return this.to_string();
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// TRACE MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-07-01',
			'updated':'2014-12-05',
			'description':'Mixin to log application activity (debug, info, warn, error).'
		}
	};
	var DevaptMixinTraceClass = new DevaptClass('DevaptMixinTraceClass', null, class_settings);
	
	
	// METHODS
	DevaptMixinTraceClass.infos.ctor = DevaptMixinTrace.init_mixin_trace;
	
	DevaptMixinTraceClass.add_public_method('enable_method_trace', {}, DevaptMixinTrace.enable_method_trace);
	
	DevaptMixinTraceClass.add_public_method('push_trace', {}, DevaptMixinTrace.push_trace);
	DevaptMixinTraceClass.add_public_method('pop_trace', {}, DevaptMixinTrace.pop_trace);
	
	DevaptMixinTraceClass.add_public_method('should_trace', {}, DevaptMixinTrace.should_trace);
	
	DevaptMixinTraceClass.add_public_method('get_trace_context', {}, DevaptMixinTrace.get_trace_context);
	DevaptMixinTraceClass.add_public_method('enter', {}, DevaptMixinTrace.enter);
	DevaptMixinTraceClass.add_public_method('matches', {}, DevaptMixinTrace.matches);
	DevaptMixinTraceClass.add_public_method('step', {}, DevaptMixinTrace.step);
	DevaptMixinTraceClass.add_public_method('warn', {}, DevaptMixinTrace.warn);
	DevaptMixinTraceClass.add_public_method('info', {}, DevaptMixinTrace.info);
	// DevaptMixinTraceClass.add_public_method('debug', {}, DevaptMixinTrace.debug);
	DevaptMixinTraceClass.add_public_method('leave', {}, DevaptMixinTrace.leave);
	DevaptMixinTraceClass.add_public_method('leave_or_error', {}, DevaptMixinTrace.leave_or_error);
	DevaptMixinTraceClass.add_public_method('error', {}, DevaptMixinTrace.error);
	DevaptMixinTraceClass.add_public_method('value', {}, DevaptMixinTrace.value);
	DevaptMixinTraceClass.add_public_method('separator', {}, DevaptMixinTrace.separator);
	
	
	
	// PROPERTIES
/*	DevaptMixinTraceClass.add_property_record(
		{
			name: 'trace_stack',
			description:'',
			aliases: [],
			
			visibility:'pulic',
			is_public:true,
			is_required: false,
			is_initializable:false,
			
			type: 'array',
			default_value: new Array(),
			array_separator: '',
			array_type: '',
			format: '',
			
			children: {}
		}
	);*/
	
	// BUILD
	DevaptMixinTraceClass.build_class();
	
	
	return DevaptMixinTraceClass;
} );
/**
 * @file        object/object-base.js
 * @desc        Object base class
 * @ingroup     DEVAPT_OBJECT
 * @date        2014-07-01
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('object/object-base',['Devapt', 'core/types', 'object/class', 'object/mixin-assertion', 'object/mixin-callback', 'object/mixin-trace'],
function(Devapt, DevaptTypes, DevaptClass, DevaptMixinAssertion, DevaptMixinCallback, DevaptMixinTrace)
{
	var jQuery = Devapt.jQuery();
	
	
	// var browser = window.navigator.userAgent;
	
	
	
	
	
	/* --------------------------------------------- CREATE OBJECT BASE CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2014-07-01',
			updated:'2014-12-05',
			description:'Base class for all Devapt objects.'
		},
		properties:{
			
		}
	};
	var parent_class = null;
	var DevaptObjectBase = new DevaptClass('DevaptObjectBase', parent_class, class_settings);
	
	
	
	/* --------------------------------------------- ADD METHODS ------------------------------------------------ */
	/**
	 * @memberof				DevaptObjectBase
	 * @public
	 * @method				is_a(arg_proto)
	 * @desc				Test class inheritance
	 * @param {object}		arg_proto	prototype
	 * @return {boolean}
	 */
	DevaptObjectBase.add_public_method('is_a',
		function(self, arg_proto)
		{
			return DevaptTypes.is_a(self, arg_proto);
		}
	);
	
	
	/**
	 * @public
	 * @method				merge_object(arg_options, arg_replace)
	 * @desc				Merge settings
	 * @param {object}		arg_options		settings
	 * @param {boolean}		arg_replace		should replace existing setting flag
	 * @return {boolean}
	 */
	DevaptObjectBase.add_public_method('merge_object',
		function(self, arg_options, arg_replace)
		{
			var context = 'merge_object(options,replace)';
			self.enter(context, '');
			
			if ( DevaptTypes.is_object(arg_options) )
			{
				self.step(context, 'options are a valid object');
				
				for(option_key in arg_options)
				{
					self.step(context, option_key);
					
					var option = arg_options[option_key];
					
					if ( ! DevaptTypes.is_null(self[option_key]) )
					{
						self.step(context, 'self has an existing option');
						if ( DevaptTypes.is_null(self[option_key]) )
						{
							self.step(context, 'update self null option with given option');
							self[option_key] = option;
						}
						else
						{
							self.step(context, 'skip given option because existing option is not null');
							if (arg_replace)
							{
								self[option_key] = option;
							}
						}
					}
					else
					{
						self.step(context, 'append the given option');
						self[option_key] = option;
					}
				}
			}
			else
			{
				self.step(context, 'options are not a valid object');
			}
			
			self.leave(context, 'success');
			return true;
		}
	);
	
	
	/**
	 * @public
	 * @method					destroy(...)
	 * @desc					Delete every given arguments
	 * @param {anything}		variable arguments of any type
	 * @return {null}
	 */
	DevaptObjectBase.add_public_method('destroy',
		function(/*... variable arguments*/)
		{
			var self = arguments[0];
			
			var context = 'destroy(...)';
			self.enter(context, '');
			
			
			var args_count = arguments.length;
			var current_arg = null;
			
			// LOOP ON ARGUMENTS
			for (var i = 1 ; i < args_count ; i++)
			{
				current_arg = arguments[i];
				if (current_arg)
				{
					// DELETE ARRAY ITEMS
					if ( DevaptTypes.is_array(current_arg) )
					{
						self.destroy.apply(self, current_arg);
					}
					
					// DELETE OBJECT WITH DESTRUCTOR
					else if ( DevaptTypes.is_function(current_arg.destroy_self) )
					{
						current_arg.destroy_self();
					}
					
					// DELETE OBJECT PROPERTIES
					else if ( DevaptTypes.is_object(current_arg) )
					{
						var properties_count = current_arg.length;
						var property_name = null;
						var property_ref = null;
						
						for (var property_index = 0 ; i < args_count ; i++)
						{
							property_name = current_arg[property_index];
							property_ref = current_arg[property_name];
							if (property_ref)
							{
								current_arg[property_name] = self.destroy(property_ref);
							}
						}
					}
				}
			}
			
			
			self.leave(context, 'success');
			return null;
		}
	);
	
	
	
	/* --------------------------------------------- ASPECT ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptObjectBase
	 * @public
	 * @method					register_aspect_before(arg_method_name, arg_callback)
	 * @desc					Register a method to be executed before the original method
	 * @param {string}			arg_method_name			Method name
	 * @param {function|array}	arg_callback			Before callback
	 * @param {boolean}			arg_give_arguments		Give original method arguments to the before callback (default:true)
	 * @param {boolean}			arg_execute_on_failed	Execute original callback if before callback failed (default:true)
	 * @return {boolean}		true:success,false:failure
	 */
	DevaptObjectBase.add_public_method('register_aspect_before',
		function(self, arg_method_name, arg_callback, arg_give_arguments, arg_execute_on_failed)
		{
			var context = 'register_aspect_before(method name,callback,give args,on failed)';
			self.enter(context, '');
			
			
			// CHECK ARGUMENTS
			self.assert_true(context, 'callback', DevaptTypes.is_string(arg_method_name) );
			self.assert_true(context, 'callback', DevaptTypes.is_callback(arg_callback) );
			arg_give_arguments		= DevaptTypes.is_boolean(arg_give_arguments) ? arg_give_arguments : true;
			arg_execute_on_failed	= DevaptTypes.is_boolean(arg_execute_on_failed) ? arg_execute_on_failed : true;
			
			// GET ORIGINAL METHOD CALLBACK
			var proxied = this[arg_method_name];
			self.assert_not_null(context, 'original callback', proxied);
			
			// SET NEW METHOD FUNCTION
			this[arg_method_name] = function()
				{
					self.enter('aspect before', arg_method_name);
					
					// EXECUTE BEFORE CALLBACK
					var result_before = false;
					if (arg_give_arguments)
					{
						result_before = arg_callback.apply(self, arguments);
					}
					else
					{
						result_before = arg_callback.apply(self, []);
					}
					
					// EXECUTE ORIGINAL CALLBACK
					var result_original = false;
					if (arg_execute_on_failed || result_before)
					{
						result_original = proxied.apply(self, arguments);
					}
					
					self.leave('aspect before', arg_method_name);
					return result_original;
				};
			this[arg_method_name].proxied = proxied;
			

			self.leave(context, 'success');
			return true;
		}
	);
	
	
	/**
	 * @memberof				DevaptObjectBase
	 * @public
	 * @method					register_aspect_after(arg_method_name, arg_callback)
	 * @desc					Register a method to be executed after the original method
	 * @param {string}			arg_method_name			Method name
	 * @param {function|array}	arg_callback			After callback
	 * @param {boolean}			arg_give_arguments		Give original method arguments to the after callback (default:true)
	 * @param {boolean}			arg_execute_on_failed	Execute original callback if after callback failed (default:true)
	 * @return {boolean}		true:success,false:failure
	 */
	DevaptObjectBase.add_public_method('register_aspect_after',
		function(self, arg_method_name, arg_callback, arg_give_arguments, arg_execute_on_failed)
		{
			var context = 'register_aspect_after(method name,callback,give args,on failed)';
			self.enter(context, '');
			
			
			// CHECK ARGUMENTS
			self.assert_true(context, 'callback', DevaptTypes.is_string(arg_method_name) );
			self.assert_true(context, 'callback', DevaptTypes.is_callback(arg_callback) );
			arg_give_arguments		= DevaptTypes.is_boolean(arg_give_arguments) ? arg_give_arguments : true;
			arg_execute_on_failed	= DevaptTypes.is_boolean(arg_execute_on_failed) ? arg_execute_on_failed : true;
			
			// GET ORIGINAL METHOD CALLBACK
			var proxied = this[arg_method_name];
			self.assert_not_null(context, 'original callback', proxied);
			
			// SET NEW METHOD FUNCTION
			this[arg_method_name] = function()
				{
					self.enter('aspect after', arg_method_name);
					
					// EXECUTE ORIGINAL CALLBACK
					var result_original = proxied.apply(self, arguments);
					
					// EXECUTE AFTER CALLBACK
					var result_after = false;
					if (arg_execute_on_failed || result_original)
					{
						if (arg_give_arguments)
						{
							arguments.push(result_original);
							result_after = arg_callback.apply(self, arguments);
						}
						else
						{
							result_after = arg_callback.apply(self, [result_original]);
						}
					}
					
					self.leave('aspect after', arg_method_name);
					return result_after;
				};
			this[arg_method_name].proxied = proxied;
			

			self.leave(context, 'success');
			return true;
		}
	);
	
	
	
	/* --------------------------------------------- MIXINS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptObjectBase
	 * @public
	 * @method					register_mixin(arg_mixin_proto, arg_mixin_attr_names)
	 * @desc					Enhance an existing object with attributes/methods of an other object (mixin)
	 * @param {object}			arg_mixin_proto				Mixin object
	 * @param {array}			arg_mixin_attr_names		Attributes names to mix
	 * @return {boolean}		true:success,false:failure
	 */
	DevaptObjectBase.add_public_method('register_mixin',
		function(self, arg_mixin_proto, arg_mixin_attr_names)
		{
			var context = 'register_mixin(proto,attributes names)';
			if (self.enter)
			{
				self.enter(context, '');
			}
			else if (self.trace)
			{
				DevaptTraces.debug( { level:'DEBUG', step:'ENTER', context:self.class_name + '.' + context + '[' + self.name + ']', text: DevaptTypes.to_string(arg_mixin_attr_names) } );
				DevaptTraces.log_indent();
			}
			
			if ( DevaptTypes.is_null(arg_mixin_attr_names) )
			{
				arg_mixin_attr_names = [];
				for(key in arg_mixin_proto)
				{
					arg_mixin_attr_names.push(key);
				}
			}
			
			if ( ! DevaptTypes.is_array(arg_mixin_attr_names) )
			{
				arg_mixin_attr_names = [arg_mixin_attr_names];
			}
			
			for(attr_name_key in arg_mixin_attr_names)
			{
				var attr_name	= arg_mixin_attr_names[attr_name_key];
				var attr_obj	= arg_mixin_proto[attr_name];
				if ( DevaptTypes.is_string(attr_name) && ! DevaptTypes.is_null(attr_obj) )
				{
					if ( DevaptTypes.is_function(attr_obj) )
					{
						self[attr_name] = attr_obj;
					}
					else
					{
						// console.log(self);
						// self[attr_name] = DevaptObjectBase.prototype.clone_object.call(self, attr_obj);
						self[attr_name] = DevaptObjectBase.clone_object(attr_obj);
						// console.log('clone of ' + self.name + ' : ' + attr_name);
						// console.log(self[attr_name]);
					}
				}
			}
			
			
			if (self.leave)
			{
				self.leave(context, 'success');
			}
			else if (self.trace)
			{
				DevaptTraces.log_unindent();
				DevaptTraces.debug( { level:'DEBUG', step:'LEAVE', context:self.class_name + '.' + context + '[' + self.name + ']', text: DevaptTypes.to_string(arg_mixin_attr_names) } );
			}
			return true;
		}
	);
	
	
	/**
	 * @memberof				DevaptObjectBase
	 * @public
	 * @method					register_mixin(arg_mixin_proto, arg_mixin_method_names)
	 * @desc					Enhance an existing object with methods of an other object (mixin)
	 * @param {object}			arg_mixin_proto				Mixin object
	 * @param {array}			arg_mixin_method_names		Attributes names to mix
	 * @return {boolean}		true:success,false:failure
	 */
	DevaptObjectBase.add_public_method('register_mixin_method',
		function(self, arg_mixin_proto, arg_mixin_method_names)
		{
			var self = this;
			var context = 'register_mixin_method(method name,proto,methods)';
			
			console.log(arg_mixin_proto, context + '.arg_mixin_proto');
			console.log(arguments, context + '.arguments');
			
			if (self.enter)
			{
				self.enter(context, '');
			}
			else if (self.trace)
			{
				DevaptTraces.debug( { level:'DEBUG', step:'ENTER', context:self.class_name + '.' + context + '[' + self.name + ']', text: DevaptTypes.to_string(arg_mixin_attr_names) } );
				DevaptTraces.log_indent();
			}
			
			if ( DevaptTypes.is_null(arg_mixin_method_names) )
			{
				arg_mixin_method_names = [];
				for(key in arg_mixin_proto)
				{
					arg_mixin_method_names.push(key);
				}
			}
			
			if ( ! DevaptTypes.is_array(arg_mixin_method_names) )
			{
				arg_mixin_method_names = [arg_mixin_method_names];
			}
			
			for(method_name_key in arg_mixin_method_names)
			{
				var method_name = arg_mixin_method_names[method_name_key];
				var method_func = arg_mixin_proto[method_name];
				if ( DevaptTypes.is_string(method_name) && DevaptTypes.is_function(method_func) )
				{
					self[method_name] = method_func;
				}
			}
			
			
			if (self.leave)
			{
				self.leave(context, 'success');
			}
			else if (self.trace)
			{
				DevaptTraces.log_unindent();
				DevaptTraces.debug( { level:'DEBUG', step:'LEAVE', context:self.class_name + '.' + context + '[' + self.name + ']', text: DevaptTypes.to_string(arg_mixin_attr_names) } );
			}
			return true;
		}
	);
	
	
	/**
	 * @memberof				DevaptObjectBase
	 * @public
	 * @method					register_mixin_proxy_method(arg_method_name)
	 * @desc					Unregister a proxy method
	 * @param {string}			arg_method_name			Method name
	 * @return {boolean}		true:success,false:failure
	 */
	DevaptObjectBase.add_public_method('unregister_mixin_proxy_method',
		function(self, arg_method_name)
		{
			var context = 'unregister_mixin_proxy_method(method name)';
			// self.enter(context, '');
			console.log(arguments, context + '.arguments');
			
			// GET ORIGINAL METHOD CALLBACK
			var proxied = self[arg_method_name];
			// self.assert_not_null(context, 'original callback', proxied);
			
			// REMOVE LAST PROXIED CALLBACK
			self[arg_method_name] = self[arg_method_name].proxied;
			
			
			// self.leave(context, 'success');
			return true;
		}
	);
	
	
	
	
	/**
	 * @public
	 * @class				DevaptObjectBase
	 * @desc				Devapt base class
	 * @param {string}		arg_name				name of the object
	 * @param {boolean}		arg_trace_constructor	enable the trace of the constructors chain
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// console.log(self, 'cb_constructor.self');
		// console.log(arg_name, 'cb_constructor.arg_name');
		
		// DEBUG
		// self.trace				= false;
		
	};
	
	
	

	// INTROSPETION : REGISTER OPTIONS
	// DevaptObjectBase.infos.ctor = cb_constructor;
	
	DevaptObjectBase.add_public_mixin(DevaptMixinTrace);
	DevaptObjectBase.add_public_mixin(DevaptMixinAssertion);
	DevaptObjectBase.add_public_mixin(DevaptMixinCallback);
	
	// BUILD CLASS
	// DevaptObjectBase.build_class();
	// console.log(DevaptObjectBase, 'DevaptObjectBase build');
	
	
	
	return DevaptObjectBase;
} );
/**
 * @file        object/events.js
 * @desc        Devapt static events features
 * @ingroup     DEVAPT_OBJECT
 * @date        2013-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'object/events',['Devapt', 'core/traces', 'core/types', 'object/event'],
function(Devapt, DevaptTraces, DevaptTypes, DevaptEvent)
{
	/**
	 * @memberof	DevaptEvents
	 * @public
	 * @class
	 * @desc		Devapt events features container
	 */
	var DevaptEvents = function() {};
	
	
	/**
	 * @memberof	DevaptEvents
	 * @public
	 * @static
	 * @desc		Trace flag
	 */
	DevaptEvents.events_trace = false;
	
	
	/**
	 * @memberof	DevaptEvents
	 * @public
	 * @static
	 * @desc		Events status (wait,run)
	 */
	DevaptEvents.events_status = 'wait';
	
	
	/**
	 * @memberof	DevaptEvents
	 * @public
	 * @static
	 * @desc		Events buffe for wait status
	 */
	DevaptEvents.events_buffer = [];
	
	
	/**
	 * @memberof	DevaptEvents
	 * @public
	 * @property	DevaptEvents.all_events
	 * @desc		Fired Events repository array (static method)
	 */
	DevaptEvents.all_events = [];


	/**
	 * @memberof	DevaptEvents
	 * @public
	 * @property	DevaptEvents.emitter_events
	 * @desc		Fired Events repository associative array by emitter name (static method)
	 */
	DevaptEvents.emitter_events = new Object();


	/**
	 * @memberof	DevaptEvents
	 * @public
	 * @property	DevaptEvents.kind_events
	 * @desc		Fired Events repository associative array by kind of event (static method)
	 */
	DevaptEvents.kind_events = new Object();


	/**
	 * @memberof	DevaptEvents
	 * @public
	 * @property	DevaptEvents.add_event_callbacks
	 * @desc		Callbacks to call on each new event into the repository
	 */
	DevaptEvents.add_event_callbacks = [];
	
	
	/**
	 * @memberof				DevaptEvents
	 * @public
	 * @method					DevaptEvents.get_events_array()
	 * @desc					Get events array
	 * @return {array}
	 */
	DevaptEvents.get_events_array = function()
	{
		return DevaptEvents.all_events;
	}
	
	
	/**
	 * @memberof				DevaptEvents
	 * @public
	 * @method					DevaptEvents.get_events_array_for_emitter()
	 * @desc					Get events array for a emitter name
	 * @param {string}			arg_emitter_name
	 * @return {array}
	 */
	DevaptEvents.get_events_array_for_emitter = function(arg_emitter_name)
	{
		var obj = DevaptEvents.emitter_events[arg_emitter_name];
		return obj ? obj : [];
	}
	
	
	/**
	 * @memberof				DevaptEvents
	 * @public
	 * @method					DevaptEvents.append_callback_on_add(arg_callback_function)
	 * @desc					Append a new callback to call on each new event
	 * @param {function}		arg_callback_function
	 * @return {nothing}
	 */
	DevaptEvents.append_callback_on_add = function(arg_callback_function)
	{
		if ( DevaptTypes.is_function(arg_callback_function) )
		{
			DevaptEvents.add_event_callbacks.push(arg_callback_function);
		}
	}


	/**
	 * @memberof				DevaptEvents
	 * @public
	 * @method					DevaptEvents.remove_callback_on_add(arg_callback_function)
	 * @desc					Remove an existing callback to call on each new event
	 * @param {function}		arg_callback_function
	 * @return {nothing}
	 */
	DevaptEvents.remove_callback_on_add = function(arg_callback_function)
	{
		if ( DevaptTypes.is_function(arg_callback_function) )
		{
			var tmp_callbacks = [];
			for(cb_index in DevaptEvents.add_event_callbacks)
			{
				var all_cb = DevaptEvents.add_event_callbacks[cb_index];
				if (all_cb != arg_callback_function)
				{
					tmp_callbacks.push(all_cb);
				}
			}
			DevaptEvents.add_event_callbacks = tmp_callbacks;
		}
	}


	/**
	 * @memberof			DevaptEvents
	 * @public
	 * @method				DevaptEvents.add(arg_event)
	 * @desc				Append a fired event to the events repository (static method)
	 * @param {object}		arg_event	event object
	 * @return {nothing}
	 */
	DevaptEvents.add = function(arg_event)
	{
		DevaptEvents.all_events.push(arg_event);
		DevaptEvents.emitter_events[ arg_event.get_emitter_name() ] = arg_event;
		DevaptEvents.kind_events[ arg_event.name ] = arg_event;
		
		// RUN CALLBACK ON EVENTS LISTENERS ADD
		if (DevaptEvents.add_event_callbacks.length > 0)
		{
			for(cb_index in DevaptEvents.add_event_callbacks)
			{
				var all_cb = DevaptEvents.add_event_callbacks[cb_index];
				all_cb.apply(null, [arg_event]);
			}
		}
	}


	/**
	 * @memberof			DevaptEvents
	 * @public
	 * @method				DevaptEvents.fire(arg_event, arg_emitter)
	 * @desc				Fire an event to the events repository (static method)
	 * @param {object}		arg_event	event object
	 * @return {nothing}
	 */
	DevaptEvents.fire = function(arg_event)
	{
		var context = 'DevaptEvents.fire(...)';
		DevaptTraces.trace_enter(context, '', DevaptEvents.events_trace);
		
		
		// GET EVENT
		var event = arg_event;
		if ( DevaptTypes.is_string(arg_event) )
		{
			DevaptTraces.trace_leave(context, 'bad event', DevaptEvents.events_trace);
			return;
		}
		
		
		// WAIT STATUS
		if ( DevaptEvents.events_status === 'wait')
		{
			DevaptEvents.events_buffer.push(event);
			DevaptTraces.trace_leave(context, 'event is buffered for wait status', DevaptEvents.events_trace);
			return;
		}
		
		// REGISTER EVENT
		// DevaptEvents.add(event);
		
		
		// GET CALLBACKS ARRAY
		var event_callbacks_records = event.emitter_object.events_callbacks[event.name];
		
		// FIRE EVENT
		if (event_callbacks_records)
		{
			event.fire(event_callbacks_records);
		}
		
		
		DevaptTraces.trace_leave(context, '', DevaptEvents.events_trace);
	}
	
	
	/**
	 * @memberof	DevaptEvents
	 * @public
	 * @method		DevaptEvents.disable()
	 * @desc		Set wait status (static method)
	 * @return		nothing
	 */
	DevaptEvents.disable = function()
	{
		// SET STATUS TO WAIT
		DevaptEvents.events_status = 'wait';
	}
	
	
	/**
	 * @memberof	DevaptEvents
	 * @public
	 * @method		DevaptEvents.enable()
	 * @desc		Set run status (static method)
	 * @return		nothing
	 */
	DevaptEvents.enable = function()
	{
		var context = 'DevaptEvents.enable()';
		DevaptTraces.trace_enter(context, '', DevaptEvents.events_trace);
		
		// SET STATUS TO RUN
		DevaptEvents.events_status = 'run';
		
		// PROCESS BUFFER OF WAITING EVENTS
		for(event_index in DevaptEvents.events_buffer)
		{
			var event = DevaptEvents.events_buffer[event_index];
			
			// REGISTER EVENT
			// DevaptEvents.add(event);
			
			
			// GET CALLBACKS ARRAY
			var event_callbacks = event.emitter_object.events_callbacks[event.name];
			
			// FIRE EVENT
			if (event_callbacks)
			{
				event.fire(event_callbacks);
			}
		}
		
		// EMPTY BUFFER
		DevaptEvents.events_buffer = [];
		
		DevaptTraces.trace_leave(context, '', DevaptEvents.events_trace);
	}
	
	
	/**
	 * @memberof	DevaptEvents
	 * @public
	 * @method		DevaptEvents.reset()
	 * @desc		Remove all fired events of the repository (static method)
	 * @return		nothing
	 */
	DevaptEvents.reset = function()
	{
		DevaptEvents.all_events = [];
		DevaptEvents.emitter_events = new Object();
		DevaptEvents.kind_events = new Object();
	}
	
	
	return DevaptEvents;
} );
/**
 * @file        object/event.js
 * @desc        Devapt event class
 * @see			object/events.js
 * @ingroup     DEVAPT_OBJECT
 * @date        2014-07-02
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'object/event',['Devapt', 'core/types', 'object/class', 'object/object-base', 'object/events'],
function(Devapt, DevaptTypes, DevaptClass, DevaptObjectBase, DevaptEvents)
{
	/**
	 * @class				DevaptEvent
	 * @desc				Event class constructor
	 */
	
	 
	/**
	 * @memberof			DevaptEvent
	 * @public
	 * @method				DevaptEvent.constructor
	 * @desc				Event class constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		var context = 'DevaptEvent(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// DEBUG
		// self.trace = true;
//		console.debug(self.name, context + ':name');
//		console.debug(self.emitter_object, context + ':emitter_object');
//		console.debug(self.operands_array, context + ':operands_array');
		
		// GET TIMESTAMP
		var now = new Date();
		
		// SET EVENT ATTRIBUTES
		self.fired_ts = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
		
		self.leave(context, 'success');
	}
	
	
	/**
	 * @memberof			DevaptEvent
	 * @public
	 * @method				DevaptEvent.get_emitter()
	 * @desc				Get event emitter object
	 * @return {object}
	 */
	var cb_get_emitter = function()
	{
		var self = this;
		var context = 'get_emitter()';
		self.enter(context, '');
		
		// console.log(self.emitter_object, context);
		
		self.leave(context, 'success');
		return self.emitter_object;
	}
	
	
	/**
	 * @memberof			DevaptEvent
	 * @public
	 * @method				DevaptEvent.get_emitter_name()
	 * @desc				Get event emitter object name
	 * @return {string}
	 */
	var cb_get_emitter_name = function()
	{
		var self = this;
		var context = 'get_emitter_name()';
		self.enter(context, '');
		
		// console.log(DevaptTypes.is_null(self.emitter_object) ? 'null emitter' : self.emitter_object.name, 'get_emitter_name()');
		
		self.leave(context, 'success');
		return DevaptTypes.is_null(self.emitter_object) ? 'null emitter' : self.emitter_object.name;
	}
	
	
	/**
	 * @memberof			DevaptEvent
	 * @public
	 * @method				DevaptEvent.fire(arg_callbacks_array)
	 * @desc				Fire event : call all callbacks
	 * @param {array}		arg_callbacks_records		callbacks records
	 * @return {boolean}	true:fired,false:skipped
	 */
	var cb_fire = function(arg_callbacks_records)
	{
		var self = this;
		var context = 'fire(callbacks)';
		self.enter(context, '');
		
		
		// REGISTER EVENT
		DevaptEvents.add(self);
		console.log(self.operands_array, self.to_string());
		// console.log(self.name, 'event');
		
		// TEST CALLBACKS ARRAY
		if ( ! DevaptTypes.is_array(arg_callbacks_records) )
		{
			self.leave(context, 'not a callbacks array');
			return true;
		}
		if ( arg_callbacks_records.length <= 0 )
		{
			self.leave(context, 'no callbacks to fire');
			return true;
		}
		
		// LOOP ON CALLBACKS
		for(var cb_index = 0 ; cb_index < arg_callbacks_records.length ; cb_index++)
		{
			self.value(context, 'fired callback index', cb_index);
			
			// GET CALLBACK RECORD
			var callback_record = arg_callbacks_records[cb_index];
			var callback = callback_record.event_cb;
			
			// TEST IF EMITTER MATCHES
			if ( ! self.matches(self.emitter_object, callback_record) )
			{
				self.error(context, 'skipped for emitter');
				self.leave(context, 'skipped for emitter');
				return false;
			}
			
			// GET CALLBACK OPERANDS
			var operands = new Array(self);
			operands.push(self.emitter_object);
			operands = operands.concat(self.operands_array);
			
			// RUN CALLBACK
			self.do_callback(callback, operands);
		}
		
		
		self.leave(context, 'success');
		return true;
	}
	
	
	/**
	 * @memberof			DevaptEvent
	 * @public
	 * @method				DevaptEvent.matches(emitter,records)
	 * @desc				Test if the event emitter matches listener callbacks records
	 * @param {array}		arg_emitter_object		event emitter object
	 * @param {array}		arg_callbacks_records	listener callbacks records
	 * @return {boolean}	true:emitter matches,false:emitter doesn't match
	*/
	var cb_matches = function(arg_emitter_object, arg_callbacks_records)
	{
		var self = this;
		var context = 'matches(emitter,records)';
		self.enter(context, '');
		
		
		// NOTHING TO TEST
		if ( ! DevaptTypes.is_not_empty_array(sources) && ! DevaptTypes.is_not_empty_array(not_sources) )
		{
			self.leave(context, 'matches without tests');
			return true;
		}
		
		// TEST ENABLED EMITTERS
		var sources = arg_callbacks_records.event_sources;
		if ( DevaptTypes.is_not_empty_array(sources) )
		{
			for(index in sources)
			{
				var item = sources[index];
				
				if ( DevaptTypes.is_not_empty_string(item) )
				{
					arg_callbacks_records.event_sources[index] = new RegExp(item, '');
					item = arg_callbacks_records.event_sources[index];
				}
				
				if ( DevaptTypes.type_of(item) === 'regexp' )
				{
					// TEST SOURCE REGEXP AGAIN THE EMITTER CLASS NAME
					if ( arg_emitter_object._class && item.test(arg_emitter_object._class.infos.class_name) )
					{
						self.leave(context, 'matches for class name');
						return true;
					}
					
					// TEST SOURCE REGEXP AGAIN THE EMITTER INSTANCE NAME
					if ( arg_emitter_object.name && item.test(arg_emitter_object.name) )
					{
						self.leave(context, 'matches for instance name');
						return true;
					}
				}
			}
		}
		
		// TEST DISABLED EMITTERS
		var not_sources = arg_callbacks_records.event_not_sources;
		if ( DevaptTypes.is_not_empty_array(not_sources) )
		{
			for(index in not_sources)
			{
				var item = not_sources[index];
				
				if ( DevaptTypes.is_not_empty_string(item) )
				{
					arg_callbacks_records.event_not_sources[index] = new RegExp(item, '');
					item = arg_callbacks_records.event_not_sources[index];
				}
				
				if ( DevaptTypes.type_of(item) === 'regexp' )
				{
					// TEST SOURCE REGEXP AGAIN THE EMITTER CLASS NAME
					if ( arg_emitter_object._class && item.test(arg_emitter_object._class.infos.class_name) )
					{
						self.leave(context, 'no match for class name');
						return false;
					}
					
					// TEST SOURCE REGEXP AGAIN THE EMITTER INSTANCE NAME
					if ( arg_emitter_object.name && item.test(arg_emitter_object.name) )
					{
						self.leave(context, 'no match for instance name');
						return false;
					}
				}
			}
			
			self.leave(context, 'matches with tests');
			return true;
		}
		
		
		self.leave(context, 'no match');
		return false;
	}
	
	
	/**
	 * @memberof			DevaptEvent
	 * @public
	 * @method				DevaptEvent.to_string_self()
	 * @desc				Child class specific to_string part
	 * @return {string}
	 */
	var cb_to_string_self = function()
	{
		var self = this;
		return 'event:' + self.name
			+ ' emitter:' + (DevaptTypes.is_null(self.emitter_object) ? 'null' : self.emitter_object.name)
			+ ' opds:' + self.operands_array.length
			+ ' ts:' + (DevaptTypes.is_null(self.fired_ts) ? 'no fired' : self.fired_ts)
			;
	}
	
	
	// INTROSPECTION : REGISTER OPTIONS
	DevaptEvents.enable();
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2014-07-02',
			updated:'2014-12-06',
			description:'Event class for all event objects.'
		},
		properties:{
		}
	};
	var parent_class = DevaptObjectBase;
	var DevaptEventClass = new DevaptClass('DevaptEvent', parent_class, class_settings);
	
	// METHODS
	DevaptEventClass.infos.ctor = cb_constructor;
	DevaptEventClass.add_public_method('get_emitter', {}, cb_get_emitter);
	DevaptEventClass.add_public_method('get_emitter_name', {}, cb_get_emitter_name);
	DevaptEventClass.add_public_method('fire', {}, cb_fire);
	DevaptEventClass.add_public_method('matches', {}, cb_matches);
	DevaptEventClass.add_public_method('to_string', {}, cb_to_string_self);
	DevaptEventClass.add_public_method('toString', {}, cb_to_string_self);
	
	// PROPERTIES
	DevaptEventClass.add_public_obj_property('emitter_object',		'event emitter object',		null, true, false, []);
	DevaptEventClass.add_public_int_property('fired_ts',			'event timestamp',			null, true, true, []);
	DevaptEventClass.add_public_array_property('operands_array',	'event operands',			[], false, true, [], 'object', '|');
	
//	DevaptEventClass.add_property_record(
//		{
//			name: 'operands_array',
//			description:'',
//			aliases: [],
//			
//			visibility:'public',
//			is_public:true,
//			is_required: false,
//			is_initializable: true,
//			
//			type: 'array',
//			default_value: [],
//			
//			array_separator: '',
//			array_type: '',
//			format: '',
//			
//			children: {}
//		}
//	);
	
	return DevaptEventClass;
} );

/**
 * @file        core/nav-history.js
 * @desc        Devapt static navigation history features
 * @ingroup     DEVAPT_CORE
 * @date        2014-06-16
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'core/nav-history',['Devapt', 'core/traces', 'core/types', 'object/classes', 'object/mixin-assertion', 'object/event', 'object/events'],
function(Devapt, DevaptTraces, DevaptTypes, DevaptClasses, DevaptMixinAssertion, DevaptEvent, DevaptEvents)
{
	/**
	 * @memberof	DevaptNavHistory
	 * @public
	 * @class
	 * @desc		Devapt navigation history features container
	 */
	var DevaptNavHistory = function() {};
	
	
	/**
	 * @memberof	DevaptNavHistory
	 * @public
	 * @static
	 * @desc		Trace flag
	 */
	DevaptNavHistory.history_trace = false;
	
	
	/**
	 * @memberof	DevaptNavHistory
	 * @public
	 * @static
	 * @property	DevaptNavHistory.current_hash
	 * @desc		... (static attribute)
	 */
	DevaptNavHistory.current_hash = null;
	
	
	/**
	 * @memberof	DevaptNavHistory
	 * @public
	 * @static
	 * @property	DevaptNavHistory.current_topbar_name
	 * @desc		... (static attribute)
	 */
	DevaptNavHistory.current_topbar_name = null;
	
	
	/**
	 * @memberof	DevaptNavHistory
	 * @public
	 * @static
	 * @property	DevaptNavHistory.current_topbar_object
	 * @desc		... (static attribute)
	 */
	DevaptNavHistory.current_topbar_object = null;
	
	
	/**
	 * @memberof	DevaptNavHistory
	 * @public
	 * @static
	 * @property	DevaptNavHistory.history_stack
	 * @desc		... (static attribute)
	 */
	DevaptNavHistory.history_stack = [];
	
	
	/**
	 * @memberof	DevaptNavHistory
	 * @public
	 * @static
	 * @property	DevaptNavHistory.history_map
	 * @desc		... (static attribute)
	 */
	DevaptNavHistory.history_map = {};
	
	
	/**
	 * @memberof	DevaptNavHistory
	 * @public
	 * @static
	 * @property	DevaptNavHistory.history_breadcrumbs_name
	 * @desc		... (static attribute)
	 */
	DevaptNavHistory.history_breadcrumbs_name = null;
	
	
	/**
	 * @memberof	DevaptNavHistory
	 * @public
	 * @static
	 * @property	DevaptNavHistory.history_breadcrumbs_object
	 * @desc		... (static attribute)
	 */
	DevaptNavHistory.history_breadcrumbs_object = null;
	
	
	/**
	 * @memberof				DevaptNavHistory
	 * @public
	 * @method					DevaptNavHistory.append_callback_on_add(arg_callback_function)
	 * @desc					Append a new callback to call on each new event
	 * @param {function}		arg_callback_function
	 * @return {nothing}
	 */
	DevaptNavHistory.init = function()
	{
		console.info('DevaptNavHistory.init');
		
		var $ = Devapt.jQuery();
		
		if (window.popstate)
		{
			$(window).bind('popstate',
				function(e)
				{
					return DevaptNavHistory.on_hash_change(e);
				}
			);
		}
		else if (window.hashchange)
		{
			$(window).bind('hashchange',
				function(e)
				{
					return DevaptNavHistory.on_hash_change(e);
				}
			);
		}
		else
		{
			// TODO start a timer (50ms) task
			/*...
				if (new_hash !== hash) {
                hash = new_hash;
                DevaptNavHistory.on_hash_change(hash);
            }*/
		}
		
		// REGISTER HOME PAGE
		var hash			= Devapt.app.get_home_view_hash();
		var hash_parts		= hash.split(':');
		var content_label	= hash_parts[3];
		var content_id		= Devapt.app.get_content_id();
		var content_url		= Devapt.app.get_home_view_url();
		var content_view	= hash_parts[1];
		var page_title		= hash_parts[2];
		var page_location	= Devapt.app.get_home_view_url();
		var menubar_name	= (hash_parts.length === 5) ? hash_parts[4] : DevaptNavHistory.current_topbar_name;
		
		DevaptNavHistory.push_url_content(content_label, content_id, content_url, page_title, page_location);
		
		DevaptNavHistory.current_hash = DevaptNavHistory.get_location_hash();
	}
	


	/**
	 * @memberof				DevaptNavHistory
	 * @public
	 * @method					DevaptNavHistory.get_location_hash()
	 * @desc					Get location hash (pathname part after the #) (null if no hash part)
	 * @return {string|null}
	 */
	DevaptNavHistory.get_location_hash = function()
	{
		var context = 'DevaptNavHistory.get_location_hash()';
		DevaptTraces.trace_step(context, '', DevaptNavHistory.history_trace);
		
		DevaptTraces.trace_var(context, 'hash', window.location.hash, DevaptNavHistory.history_trace);
		var href = window.location.hash.substr(1);
		
		return href;
	}
	


	/**
	 * @memberof				DevaptNavHistory
	 * @public
	 * @method					DevaptNavHistory.set_location_hash(hash)
	 * @desc					Set location hash (pathname part after the #)
	 * @param {string}			arg_hash		new location hash
	 * @return {nothing}
	 */
	DevaptNavHistory.set_location_hash = function(arg_hash)
	{
		var context = 'DevaptNavHistory.set_location_hash(hash)';
		DevaptTraces.trace_enter(context, '', DevaptNavHistory.history_trace);
		
		
		// DEBUG
		DevaptTraces.trace_var(context, 'current hash', window.location.hash, DevaptNavHistory.history_trace);
		DevaptTraces.trace_var(context, 'new hash', arg_hash, DevaptNavHistory.history_trace);
		
		
		// SET BROWSER HASH
		try {
			DevaptTraces.trace_step(context, 'SET BROWSER HASH', DevaptNavHistory.history_trace);
			window.location.hash = arg_hash;
			DevaptNavHistory.current_hash = arg_hash;
		}
		catch(exception)
		{
			console.info(exception, context + ':untrapped exception');
			DevaptTraces.trace_leave(context, Devapt.msg_success, DevaptNavHistory.history_trace);
			return;
		}
		
		
		// GET HASH STATE
		DevaptTraces.trace_step(context, 'GET HASH STATE', DevaptNavHistory.history_trace);
		var state = DevaptNavHistory.history_map[arg_hash];
		DevaptTraces.trace_var(context, 'state', state, DevaptNavHistory.history_trace);
		
		
		// NO EXISTING STATE
		if ( ! state && arg_hash && arg_hash.substr(0, 5) === 'view:' )
		{
			DevaptTraces.trace_step(context, 'NO EXISTING STATE', DevaptNavHistory.history_trace);
			
			var hash_parts = arg_hash.split(':');
			if (hash_parts.length === 4 || hash_parts.length === 5)
			{
				DevaptTraces.trace_step(context, 'process view hash parts', DevaptNavHistory.history_trace);
				
				state =
				{
					content_label:	hash_parts[3],
					content_id:		'page_content_id',
					content_url:	null,
					content_cb:		null,
					content_html:	null,
					content_view:	hash_parts[1],
					page_title:		hash_parts[2],
					page_location:	window.location.pathname + window.location.hash,
					menubar_name:	(hash_parts.length === 5) ? hash_parts[4] : DevaptNavHistory.current_topbar_name
				};
				DevaptTraces.trace_var(context, 'state', state, DevaptNavHistory.history_trace);
			}
		}
		
		
		// PROCESS HASH STATE
		if (state)
		{
			DevaptTraces.trace_step(context, 'PROCESS HASH STATE', DevaptNavHistory.history_trace);
			
			DevaptTraces.trace_var(context, 'hash for state', window.location.hash, DevaptNavHistory.history_trace);
			var result = DevaptNavHistory.set_content(state, true);
			if (! result)
			{
				DevaptTraces.trace_leave(context, Devapt.msg_failure, DevaptNavHistory.history_trace);
				return;
			}
		}
		
		
		DevaptTraces.trace_leave(context, Devapt.msg_success, DevaptNavHistory.history_trace);
	}
	
	
	
	/**
	 * @memberof				DevaptNavHistory
	 * @public
	 * @method					DevaptNavHistory.on_hash_change(event)
	 * @desc					Do actions on location hash (pathname part after the #) change
	 * @param {object}			arg_window_event
	 * @return {boolean}
	 */
	DevaptNavHistory.on_hash_change = function(arg_window_event)
	{
		var context = 'DevaptNavHistory.on_hash_change(event)';
		DevaptTraces.trace_enter(context, '', DevaptNavHistory.history_trace);
		
		
		// console.error(arg_window_event);
		var state_key = DevaptNavHistory.get_location_hash();
		DevaptTraces.trace_var(context, 'state_key', state_key, DevaptNavHistory.history_trace);
		DevaptTraces.trace_var(context, 'hash after state key', window.location.hash, DevaptNavHistory.history_trace);
		
		if ( state_key === DevaptNavHistory.current_hash )
		{
			DevaptTraces.trace_leave(context, Devapt.msg_success + ': nothing to do', DevaptNavHistory.history_trace);
			return true; // do not propagate event
		}
		
		DevaptNavHistory.set_location_hash(state_key);
		
		
		DevaptTraces.trace_leave(context, Devapt.msg_success, DevaptNavHistory.history_trace);
		return true; // do not propagate event
	}


	/**
	 * @memberof				DevaptNavHistory
	 * @public
	 * @method					DevaptNavHistory.push_html_content(arg_content_label, arg_content_id, arg_content_html, arg_page_title, arg_page_location)
	 * @desc					Push an html update on the navigation history stack
	 * @param {string}		arg_content_label
	 * @param {string}		arg_content_id
	 * @param {string}		arg_content_html
	 * @param {string}		arg_page_title
	 * @param {string}		arg_page_location
	 * @return {nothing}
	 */
	DevaptNavHistory.push_html_content = function(arg_content_label, arg_content_id, arg_content_html, arg_page_title, arg_page_location)
	{
		var context = 'DevaptNavHistory.push_html_content(...)';
		DevaptTraces.trace_step(context, '', DevaptNavHistory.history_trace);
		
		var state =
			{
				content_label:	arg_content_label,
				content_id:		arg_content_id,
				content_url:	null,
				content_cb:		null,
				content_html:	arg_content_html,
				content_view:	null,
				page_title:		arg_page_title ? arg_page_title : null,
				page_location:	arg_page_location ? arg_page_location : null,
				menubar_name:	DevaptNavHistory.current_topbar_name
			};
		var state_key = 'html:' + arg_page_title + ':' + arg_content_label + ':' + state.menubar_name;
		DevaptNavHistory.history_stack.push(state);
		DevaptNavHistory.history_map[state_key] = state;
		
		// UPDATE BREADCRUMBS
		DevaptNavHistory.update_breadcrumbs(state);
	}


	/**
	 * @memberof				DevaptNavHistory
	 * @public
	 * @method					DevaptNavHistory.push_cb_content(arg_content_label, arg_content_id, arg_content_html, arg_page_title, arg_page_location)
	 * @desc					Push a javascript callback on the navigation history stack
	 * @param {string}		arg_content_label
	 * @param {string}		arg_content_id
	 * @param {function}		arg_content_cb
	 * @param {string}		arg_page_title
	 * @param {string}		arg_page_location
	 * @return {nothing}
	 */
	DevaptNavHistory.push_cb_content = function(arg_content_label, arg_content_id, arg_content_cb, arg_page_title, arg_page_location)
	{
		var context = 'DevaptNavHistory.push_cb_content(...)';
		DevaptTraces.trace_step(context, '', DevaptNavHistory.history_trace);
		
		var state =
			{
				content_label:	arg_content_label,
				content_id:		arg_content_id,
				content_url:	null,
				content_cb:		arg_content_cb,
				content_html:	null,
				content_view:	null,
				page_title:		arg_page_title ? arg_page_title : null,
				page_location:	arg_page_location ? arg_page_location : null,
				menubar_name:	DevaptNavHistory.current_topbar_name
			};
		var state_key = 'cb:' + arg_page_title + ':' + arg_content_label + ':' + state.menubar_name;
		DevaptNavHistory.history_stack.push(state);
		DevaptNavHistory.history_map[state_key] = state;
		
		// UPDATE BREADCRUMBS
		DevaptNavHistory.update_breadcrumbs(state);
	}


	/**
	 * @memberof				DevaptNavHistory
	 * @public
	 * @method					DevaptNavHistory.push_url_content(arg_content_label, arg_content_id, arg_content_html, arg_page_title, arg_page_location)
	 * @desc					Push a javascript callback on the navigation history stack
	 * @param {string}		arg_content_label
	 * @param {string}		arg_content_id
	 * @param {function}		arg_content_url
	 * @param {string}		arg_page_title
	 * @param {string}		arg_page_location
	 * @return {nothing}
	 */
	DevaptNavHistory.push_url_content= function(arg_content_label, arg_content_id, arg_content_url, arg_page_title, arg_page_location)
	{
		var context = 'DevaptNavHistory.push_url_content(...)';
		DevaptTraces.trace_step(context, '', DevaptNavHistory.history_trace);
		
		var state =
			{
				content_label:	arg_content_label,
				content_id:		arg_content_id,
				content_url:	arg_content_url,
				content_cb:		null,
				content_html:	null,
				content_view:	null,
				page_title:		arg_page_title ? arg_page_title : null,
				page_location:	arg_page_location ? arg_page_location : null,
				menubar_name:	DevaptNavHistory.current_topbar_name
			};
		var state_key = 'url:' + arg_page_title + ':' + arg_content_label + ':' + state.menubar_name;
		DevaptNavHistory.history_stack.push(state);
		DevaptNavHistory.history_map[state_key] = state;
		
		// UPDATE BREADCRUMBS
		DevaptNavHistory.update_breadcrumbs(state);
	}


	/**
	 * @memberof			DevaptNavHistory
	 * @public
	 * @method				DevaptNavHistory.push_view_content(lable, id, html, title, location)
	 * @desc				Push a javascript callback on the navigation history stack
	 * @param {string}		arg_content_label
	 * @param {string}		arg_content_id
	 * @param {function}	arg_content_view_name
	 * @param {string}		arg_page_title
	 * @param {string}		arg_page_location
	 * @return {nothing}
	 */
	DevaptNavHistory.push_view_content= function(arg_content_label, arg_content_id, arg_content_view_name, arg_page_title, arg_page_location)
	{
		var context = 'DevaptNavHistory.push_view_content(...)';
		DevaptTraces.trace_step(context, '', DevaptNavHistory.history_trace);
		
		var security_token = Devapt.app.get_security_token();
		var page_url = arg_page_location ? Devapt.url(arg_page_location, security_token) : null;
		var state =
			{
				content_label:	arg_content_label,
				content_id:		arg_content_id,
				content_url:	null,
				content_cb:		null,
				content_html:	null,
				content_view:	arg_content_view_name,
				page_title:		arg_page_title ? arg_page_title : null,
				page_location:	page_url,
				menubar_name:	DevaptNavHistory.current_topbar_name
			};
		var state_key = 'view:' + arg_content_view_name + ':' + arg_page_title + ':' + arg_content_label + ':' + state.menubar_name;
		DevaptNavHistory.history_stack.push(state);
		DevaptNavHistory.history_map[state_key] = state;
		
		// UPDATE BREADCRUMBS
		DevaptNavHistory.update_breadcrumbs(state);
	}


	/**
	 * @memberof			DevaptNavHistory
	 * @public
	 * @method				DevaptNavHistory.update_breadcrumbs()
	 * @desc				Update application breadcrumbs (static method)
	 * @param {object}		arg_state			navigation history state object
	 * @return {nothing}
	 */
	DevaptNavHistory.update_breadcrumbs = function(arg_state)
	{
		var context = 'DevaptNavHistory.update_breadcrumbs(state)';
		DevaptTraces.trace_enter(context, '', DevaptNavHistory.history_trace);
		
		
		if ( DevaptTypes.is_object(DevaptNavHistory.history_breadcrumbs_object) && DevaptTypes.is_object(arg_state) )
		{
			DevaptTraces.trace_step(context, 'fire event', DevaptNavHistory.history_trace);
			var event_name = 'nav-history.add';
			var event = DevaptEvent.create(event_name, { emitter_object:DevaptNavHistory.history_breadcrumbs_object, operands_array:[arg_state] } );
			DevaptEvents.fire(event);
		}
		
		
		DevaptTraces.trace_leave(context, '', DevaptNavHistory.history_trace);
	}


	/**
	 * @memberof	DevaptNavHistory
	 * @public
	 * @method		DevaptNavHistory.reset()
	 * @desc		Remove all navigation history (static method)
	 * @return {nothing}
	 */
	DevaptNavHistory.reset = function()
	{
		var context = 'DevaptNavHistory.reset()';
		DevaptTraces.trace_step(context, '', DevaptNavHistory.history_trace);
		
		DevaptNavHistory.history_stack = [];
		DevaptNavHistory.history_map = {};
	}


	/**
	 * @memberof			DevaptNavHistory
	 * @public
	 * @method				DevaptNavHistory.go_back()
	 * @desc				Go back in navigation history (static method)
	 * @return {nothing}
	 */
/*	DevaptNavHistory.go_back = function()
	{
		var context = 'DevaptNavHistory.go_back()';
		DevaptTraces.trace_step(context, '', DevaptNavHistory.history_trace);
		
		if ( ! DevaptTypes.is_not_empty_array(DevaptNavHistory.history_stack) )
		{
			DevaptTraces.trace_step(context, 'stack is empty', DevaptNavHistory.history_trace);
			return;
		}
		
		// DevaptNavHistory.history_stack = [];
	}*/


	/**
	 * @memberof			DevaptNavHistory
	 * @public
	 * @method				DevaptNavHistory.go_forward()
	 * @desc				Go forward in navigation history (static method)
	 * @return {nothing}
	 */
/*	DevaptNavHistory.go_forward = function()
	{
		var context = 'DevaptNavHistory.go_forward()';
		DevaptTraces.trace_step(context, '', DevaptNavHistory.history_trace);
		
		if ( ! DevaptTypes.is_not_empty_array(DevaptNavHistory.history_stack) )
		{
			DevaptTraces.trace_step(context, 'stack is empty', DevaptNavHistory.history_trace);
			return;
		}
		
		// DevaptNavHistory.history_stack = [];
	}*/


	/**
	 * @memberof			DevaptNavHistory
	 * @public
	 * @method				DevaptNavHistory.hide_all_menubars()
	 * @desc				Hide all rendered menubars (static method)
	 * @return {nothing}
	 */
	DevaptNavHistory.hide_all_menubars = function(arg_state, arg_force_render)
	{
		var context = 'DevaptNavHistory.hide_all_menubars()';
		DevaptTraces.trace_enter(context, '', DevaptNavHistory.history_trace);
		
		
		// GET MENUBARS CONTAINER ID
		var container_id = Devapt.app.get_topbar_container_id();
		var container_jqo = null;
		if ( DevaptTypes.is_not_empty_str(container_id) )
		{
			DevaptTraces.trace_step(context, 'menubars container id is a valid string', DevaptNavHistory.history_trace);
			
			container_jqo = $('#' + container_id);
			if (container_jqo)
			{
				DevaptTraces.trace_step(context, 'menubars container jqo exists', DevaptNavHistory.history_trace);
				
				container_jqo.children('div').hide();
			}
		}
		
		
		DevaptTraces.trace_leave(context, Devapt.msg_success, DevaptNavHistory.history_trace);
	}


	/**
	 * @memberof			DevaptNavHistory
	 * @public
	 * @method				DevaptNavHistory.set_content(state)
	 * @desc				Set page content (static method)
	 * @param {object}		arg_state			navigation history state object
	 * @param {boolean}		arg_force_render
	 * @return {promise}
	 */
	DevaptNavHistory.show_menubar = function(arg_menubar_name)
	{
		var context = 'DevaptNavHistory.show_menubar(menubar)';
		DevaptTraces.trace_enter(context, '', DevaptNavHistory.history_trace);
		
		
		try
		{
			// CHECK MENUBAR NAME
			if ( ! DevaptTypes.is_not_empty_str(arg_menubar_name) )
			{
				DevaptTraces.trace_leave(context, Devapt.msg_failure + ':bad menubar name', DevaptNavHistory.history_trace);
				return false;
			}
			
			// GET MENUBARS CONTAINER ID
			var container_id = Devapt.app.get_topbar_container_id();
			if ( ! DevaptTypes.is_not_empty_str(container_id) )
			{
				DevaptTraces.trace_leave(context, Devapt.msg_failure + ':bad container id', DevaptNavHistory.history_trace);
				return false;
			}
			
			// GET MENUBARS CONTAINER JQUERY OBJECT
			var container_jqo = $('#' + container_id);
			if (! container_jqo)
			{
				DevaptTraces.trace_leave(context, Devapt.msg_failure + ':bad container jqo', DevaptNavHistory.history_trace);
				return false;
			}
			
			// GET APPLICATION CURRENT BACKEND
			var backend = Devapt.get_current_backend();
			if (! backend)
			{
				DevaptTraces.trace_leave(context, Devapt.msg_failure + ':bad backend object', DevaptNavHistory.history_trace);
				return false;
			}
			
			// RENDER MENUBAR
			var menubar_promise = backend.render_view(container_jqo, arg_menubar_name);
			
			// ON RENDER SUCCESS
			menubar_promise = menubar_promise.then(
				function(view)
				{
					DevaptTraces.trace_step(context, 'on menubar render success', DevaptNavHistory.app_trace);
					
					if ( ! DevaptTypes.is_object(view) || ! view.is_view )
					{
						DevaptTraces.trace_step(context, 'ERROR: resource view is not a valid object', DevaptNavHistory.app_trace);
						return null;
					}
					
					DevaptNavHistory.current_topbar_name = view.name;
					DevaptNavHistory.current_topbar_object = view;
					DevaptNavHistory.history_stack[0].menubar_name = view.name;
					
					return view;
				}
			);
			
			DevaptTraces.trace_leave(context, Devapt.msg_success_promise, DevaptNavHistory.history_trace);
			return menubar_promise;
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		DevaptTraces.trace_leave(context, Devapt.msg_failure_promise, DevaptNavHistory.history_trace);
		return Devapt.promise_rejected();
	}
	
	
	/**
	 * @memberof			DevaptNavHistory
	 * @public
	 * @method				DevaptNavHistory.set_content(state)
	 * @desc				Set page content (static method)
	 * @param {object}		arg_state			navigation history state object
	 * @param {boolean}		arg_force_render
	 * @return {boolean|promise}
	 */
	DevaptNavHistory.set_content = function(arg_state, arg_force_render)
	{
		var context = 'DevaptNavHistory.set_content(state)';
		DevaptTraces.trace_enter(context, '', DevaptNavHistory.history_trace);
		
		
		// CHECK STATE OBJECT
		if ( ! DevaptTypes.is_object(arg_state) )
		{
			DevaptTraces.trace_leave(context, 'state is not an object', DevaptNavHistory.history_trace);
			return false;
		}
		// console.log(arg_state, 'set_content.state');
		
		
		// GET STATE ATTRIBUTES
		var content_label	= arg_state.content_label;
		var content_id		= arg_state.content_id;
		var content_url		= arg_state.content_url;
		var content_cb		= arg_state.content_cb;
		var content_html	= arg_state.content_html;
		var content_view	= arg_state.content_view;
		var page_title		= arg_state.page_title;
		var page_location	= arg_state.page_location;
		var menubar_name	= arg_state.menubar_name;
		
		
		// CHECK STATE
		if ( ! DevaptTypes.is_not_empty_str(content_label) )
		{
			DevaptTraces.trace_leave(context, 'bad state content label', DevaptNavHistory.history_trace);
			return false;
		}
		if ( ! DevaptTypes.is_not_empty_str(page_title) )
		{
			DevaptTraces.trace_leave(context, 'bad state page title', DevaptNavHistory.history_trace);
			return false;
		}
		if ( ! DevaptTypes.is_not_empty_str(page_location) )
		{
			DevaptTraces.trace_leave(context, 'bad state page location', DevaptNavHistory.history_trace);
			return false;
		}
		
		
		// HIDE ALL EXISTING MENUBARS
		DevaptNavHistory.hide_all_menubars();
		
		
		// SHOW TARGET MENUBAR
		var topmenubar_promise = null;
		try
		{
			topmenubar_promise = DevaptNavHistory.show_menubar(menubar_name);
		}
		catch(e)
		{
			console.error(e, context + ':SHOW TARGET MENUBAR');
		}
		
		
		// HTML CONTENT
		if ( DevaptTypes.is_not_empty_str(content_id) && DevaptTypes.is_not_empty_str(content_html) )
		{
			try
			{
				// console.log('set_page_html_content', context);
				var result = DevaptNavHistory.set_page_html_content(content_label, content_id, content_html, page_title, page_location, arg_force_render);
				
				DevaptTraces.trace_leave(context, 'set html content', DevaptNavHistory.history_trace);
				return result;
			}
			catch(e)
			{
				console.error(e, context + ':HTML CONTENT');
				DevaptTraces.trace_leave(context, Devapt.msg_failure, DevaptNavHistory.history_trace);
				return false;
			}
		}
		
		// VIEW CONTENT
		if ( DevaptTypes.is_not_empty_str(content_id) && DevaptTypes.is_not_empty_str(content_view) )
		{
			try
			{
				// console.log('set_page_view_content', context);
				var result = DevaptNavHistory.set_page_view_content(content_label, content_id, content_view, page_title, page_location, arg_force_render, menubar_name);
				
				DevaptTraces.trace_leave(context, 'set view content', DevaptNavHistory.history_trace);
				return result;
			}
			catch(e)
			{
				console.error(e, context + ':VIEW CONTENT');
				DevaptTraces.trace_leave(context, Devapt.msg_failure, DevaptNavHistory.history_trace);
				return false;
			}
		}
		
		// URL CONTENT
		if ( DevaptTypes.is_not_empty_str(content_url) )
		{
			try
			{
				// console.log('content_url', context);
				window.title = page_title;
				window.location = Devapt.url(page_location, Devapt.app.get_security_token());
				
				// SAVE NAVIGATION
				if (arg_force_render)
				{
					DevaptNavHistory.push_html_content(content_label, content_id, content_html, page_title, page_location)
				}
				
				DevaptTraces.trace_leave(context, 'set view content', DevaptNavHistory.history_trace);
				return result;
			}
			catch(e)
			{
				console.error(e, context + ':URL CONTENT');
				DevaptTraces.trace_leave(context, Devapt.msg_failure, DevaptNavHistory.history_trace);
				return false;
			}
		}
		
		
		DevaptTraces.trace_leave(context, 'bad state content', DevaptNavHistory.history_trace);
		return false;
	}
	

	/**
	 * @memberof			DevaptNavHistory
	 * @public
	 * @method				DevaptNavHistory.set_page_html_content(label, id, html, title, location)
	 * @desc				Set HTML content (static method)
	 * @param {string}		arg_content_label
	 * @param {string}		arg_content_id
	 * @param {string}		arg_content_html
	 * @param {string}		arg_page_title
	 * @param {string}		arg_page_location
	 * @param {boolean}		arg_force_render
	 * @return {boolean}
	 */
	DevaptNavHistory.set_page_html_content = function(arg_content_label, arg_content_id, arg_content_html, arg_page_title, arg_page_location, arg_force_render)
	{
		var context = 'DevaptNavHistory.set_page_html_content(...)';
		DevaptTraces.trace_enter(context, '', DevaptNavHistory.history_trace);
		
		
		// GET CONTENT JQO
		var page_container_jqo = $('#' + arg_content_id);
		if ( ! page_container_jqo)
		{
			return DevaptTraces.trace_leaveko(context, 'bad content id [' + arg_content_id + ']', false, DevaptNavHistory.history_trace);
		}
		
		// SAVE NAVIGATION
		if (arg_force_render)
		{
			DevaptNavHistory.push_html_content(arg_content_label, arg_content_id, arg_content_html, arg_page_title, arg_page_location)
		}
		
		// UPDATE PAGE CONTENT
		var div_jqo = $('<div>').html(arg_content_html);
		page_container_jqo.append(div_jqo);
		
		window.title = arg_page_title;
		window.location = Devapt.url(arg_page_location, Devapt.app.get_security_token());
		
		
		DevaptTraces.trace_leave(context, '', DevaptNavHistory.history_trace);
		return true;
	}


	/**
	 * @memberof	DevaptNavHistory
	 * @public
	 * @method		DevaptNavHistory.set_view_content(label, id, view, title, location...)
	 * @desc		Set the view content (static method)
	 * @param {string}		arg_content_label
	 * @param {string}		arg_content_id
	 * @param {string}		arg_content_view_name
	 * @param {string}		arg_page_title
	 * @param {string}		arg_page_location
	 * @param {boolean}		arg_force_render
	 * @param {string}		arg_menubar_name
	 * @return {object}		render promise object
	 */
	DevaptNavHistory.set_view_content = function(arg_content_label, arg_content_id, arg_content_view_name, arg_page_title, arg_page_location, arg_force_render, arg_menubar_name)
	{
		var context = 'DevaptNavHistory.set_view_content(...)';
		DevaptTraces.trace_enter(context, '', DevaptNavHistory.history_trace);
		
		
		// GET STATE ATTRIBUTES
		var state =
			{
				content_label:	arg_content_label,
				content_id:		arg_content_id,
				content_url:	null,
				content_cb:		null,
				content_html:	null,
				content_view:	arg_content_view_name,
				page_title:		arg_page_title ? arg_page_title : null,
				page_location:	arg_page_location ? arg_page_location : null,
				menubar_name:	arg_menubar_name
			};
		
		var result = DevaptNavHistory.set_content(state, arg_force_render);
		DevaptNavHistory.push_view_content(arg_content_label, arg_content_id, arg_content_view_name, arg_page_title, arg_page_location);
		
		
		DevaptTraces.trace_leave(context, '', DevaptNavHistory.history_trace);
		return result;
	}
	

	/**
	 * @memberof	DevaptNavHistory
	 * @public
	 * @method		DevaptNavHistory.set_page_view_content(label, id, view, title, location...)
	 * @desc		Set the page view (static method)
	 * @param {string}		arg_content_label
	 * @param {string}		arg_content_id
	 * @param {string}		arg_content_view_name
	 * @param {string}		arg_page_title
	 * @param {string}		arg_page_location
	 * @param {boolean}		arg_force_render
	 * @param {string}		arg_menubar_name
	 * @return {object}		render promise object
	 */
	DevaptNavHistory.set_page_view_content = function(arg_content_label, arg_content_id, arg_content_view_name, arg_page_title, arg_page_location, arg_force_render, arg_menubar_name)
	{
		var context = 'DevaptNavHistory.set_page_view_content(...)';
		DevaptTraces.trace_enter(context, '', DevaptNavHistory.history_trace);
		
		
		DevaptTraces.trace_var(context, 'arg_content_view_name', arg_content_view_name, DevaptNavHistory.history_trace);
		
		// UPDATE TITLE AND LOCATION
		DevaptTraces.trace_step(context, 'UPDATE TITLE AND LOCATION', DevaptNavHistory.history_trace);
		window.title = arg_page_title;
		var new_hash = 'view:' + arg_content_view_name + ':' + arg_page_title + ':' + arg_content_label;
		if ( DevaptTypes.is_not_empty_str(arg_menubar_name) )
		{
			new_hash += ':' + arg_menubar_name;
		}
		if ( DevaptNavHistory.get_location_hash() !== new_hash )
		{
			DevaptTraces.trace_step(context, 'update location hash', DevaptNavHistory.history_trace);
			DevaptTraces.trace_var(context, 'current hash', DevaptNavHistory.get_location_hash(), DevaptNavHistory.history_trace);
			DevaptTraces.trace_var(context, 'target hash', new_hash, DevaptNavHistory.history_trace);
			window.location.hash = new_hash;
		}
		
		// SAVE NAVIGATION
		if (arg_force_render)
		{
			DevaptTraces.trace_step(context, 'FORCE RENDER VIEW', DevaptNavHistory.history_trace);
			DevaptNavHistory.push_view_content(arg_content_label, arg_content_id, arg_content_view_name, arg_page_title, arg_page_location);
			DevaptTraces.trace_var(context, 'hash after push_view_content', window.location.hash, DevaptNavHistory.history_trace);
		}
		
		
		// GET CONTENT JQO
		DevaptTraces.trace_step(context, 'GET CONTENT JQO', DevaptNavHistory.history_trace);
		var page_container_jqo = $('#' + arg_content_id);
		if ( ! page_container_jqo)
		{
			var reject_promise = Devapt.promise_rejected('bad content id [' + arg_content_id + ']');
			return DevaptTraces.trace_leaveko(context, 'bad content id [' + arg_content_id + ']', reject_promise, DevaptNavHistory.history_trace);
		}
		page_container_jqo.children().hide();
		DevaptTraces.trace_var(context, 'hash after container hide', window.location.hash, DevaptNavHistory.history_trace);
		
		
		// SHOW AN EXISTING VIEW
		DevaptTraces.trace_step(context, 'GET THE VIEW OBJECT', DevaptNavHistory.history_trace);
		var view_object = DevaptClasses.get_instance(arg_content_view_name);
		// console.log(view_object, context + ':view_object for [' + arg_content_view_name + ']');
		if (view_object)
		{
			DevaptTraces.trace_step(context, 'SHOW AN EXISTING VIEW', DevaptNavHistory.history_trace);
			
			view_object.content_jqo.show();
			DevaptTraces.trace_var(context, 'hash after content show', window.location.hash, DevaptNavHistory.history_trace);
			
			DevaptTraces.trace_leave(context, 'show existing view', DevaptNavHistory.history_trace);
			return Devapt.promise_resolved();
		}
		
		
		// GET CURRENT BACKEND
		DevaptTraces.trace_step(context, 'GET CURRENT BACKEND', DevaptNavHistory.history_trace);
		var backend = Devapt.get_current_backend();
		DevaptMixinAssertion.infos.proto.assert_not_null(context, 'backend', backend);
		
		
		// RENDER VIEW
		DevaptTraces.trace_step(context, 'RENDER VIEW', DevaptNavHistory.history_trace);
		var promise = Devapt.require(['Devapt', 'core/resources']).then(
			function(Devapt, DevaptResources)
			{
				DevaptTraces.trace_step(context, 'RENDER VIEW on Resources loaded', DevaptNavHistory.history_trace);
				
				try
				{
					var render_promise = backend.render_view(page_container_jqo, arg_content_view_name);
					DevaptTraces.trace_var(context, 'hash after render view', window.location.hash, DevaptNavHistory.history_trace);
					
					return render_promise;
				}
				catch(e)
				{
					console.error(e, context + ':RENDER VIEW on Resources loaded');
				}
				return Devapt.promise_rejected();
			}
		);
		
		
		DevaptTraces.trace_leave(context, 'async renderer', DevaptNavHistory.history_trace);
		return promise;
	}

	
	return DevaptNavHistory;
} );
/**
 * @file        object/mixin-event-listener.js
 * @desc        Mixin of methods for event listening
 * 		API
 * 			ATTRIBUTES
 * 				self.events_callbacks:map by event name of arrays of event callback records
 * 					example:
 * 						self.events_callbacks['updated'] = [event_cb_record_1,event_cb_record_2,...]
 * 
 * 			PRIVATE METHODS
 * 
 * 			PUBLIC METHODS
 * 				init_mixin_event_listener(self): mixin constructor (nothing)
 * 				
 * 				has_event_callback(arg_event_name,arg_event_cb): test if the object has a listener for the event (boolean)
 * 				
 * 				add_event_callback(arg_event_name,arg_event_cb,arg_unique,arg_sources,arg_not_sources): add an event listener (boolean)
 * 				remove_event_callback(arg_event_name,arg_event_cb): remove an event listener (boolean)
 * 				
 * 				on_event(arg_event_name,arg_event_cb, arg_unique, arg_sources, arg_not_sources): shorthand for add_event_callback (boolean)
 * 				rm_event(arg_event_name,arg_event_cb): shorthand for remove_event_callback (boolean)
 * 				
 * 				relay_event(arg_source_event_name,arg_relayed_event_name,arg_sources): emit a new event with an alternate name on source event (boolean)
 * 				proxy_event(arg_event_name,arg_target_objects,arg_sources): emit a received event from the source to the targets (boolean)
 * 				proxy_event_to_parents(arg_event_name,arg_sources): emit a received event from the source to the parents hierarchy (boolean)
 * 				proxy_event_to_children(arg_event_name,arg_sources): emit a received event from the source to the children hierarchy (boolean)
 * 				
 * 				get_proxy_event_parents(): get an array of parents objects to transfer the event (array)
 * 				get_proxy_event_children(): get an array of children objects to transfer the event (array)
 * 				
 * 				suspend_event(arg_event_name): suspend event listening (nothing)
 * 				resume_event(arg_event_name): resume event listening (nothing)
 * 				
 * 				add_buffer_listener(arg_event_name,arg_delay,arg_event_cb,arg_unique,arg_sources,arg_not_sources)
 * 
 * 			EVENT CALLBACK RECORD
 * 				{
 * 					event_name:string,
 * 					event_cb:function|array[object,function],
 * 					event_sources:array of (string|regexp),
 * 					event_not_sources:array of (string|regexp),
 * 					event_buffer_delay:integer
 * 				}
 * 					
 * @see			DevaptObject
 * @ingroup     DEVAPT_OBJECT
 * @date        2013-06-13
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'object/mixin-event-listener',['core/types', 'object/class'],
function(DevaptTypes, DevaptClass)
{
	/**
	 * @mixin				DevaptMixinEventListener
	 * @public
	 * @desc				Mixin of methods for event listening
	 */
	var DevaptMixinEventListener = 
	{
		/**
		 * @memberof			DevaptMixinEventListener
		 * @public
		 * @desc				Enable/disable trace for event listening operations
		 */
		mixin_event_listener_trace: false,
		
		
		/**
		 * @memberof			DevaptMixinEventListener
		 * @public
		 * @desc				List of events callbacks
		 */
		events_callbacks: null,
		
		
		/**
		 * @memberof			DevaptMixinEventListener
		 * @public
		 * @method				init_mixin_event_listener(self)
		 * @desc				Init mixin
		 * @param {object}		self		instance object
		 * @return {nothing}
		 */
		init_mixin_event_listener: function(self)
		{
			self.events_callbacks = new Object();
		},
		
		
		/**
		 * @memberof			DevaptMixinEventListener
		 * @public
		 * @method				has_event_callback(arg_event_name, arg_event_cb)
		 * @desc				Test if an event callback is registered
		 * @param {string}		arg_event_name		event name
		 * @param {function}	arg_event_cb		event callback
		 * @return {boolean}	true:success,false:failure
		 */
		has_event_callback: function(arg_event_name, arg_event_cb)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinEventListener.mixin_event_listener_trace);
			var context = 'has_event_callback(' + arg_event_name + ',callback)';
			self.enter(context, '');
			
			
			var event_callbacks = self.events_callbacks[arg_event_name];
			if ( DevaptTypes.is_array(event_callbacks) )
			{
				self.step(context, 'object event has registered callbacks');
				for(var record_index in event_callbacks)
				{
					self.step(context, 'loop on event callback record at [' + record_index + ']');
					
					var event_cb_record = event_callbacks[record_index];
					var event_cb = event_cb_record.event_cb;
					
					if ( DevaptTypes.is_function(event_cb) )
					{
						self.step(context, 'object event is a function');
						if (event_cb === arg_event_cb)
						{
							self.leave(context, 'callback function found');
							self.pop_trace();
							return true;
						}
					}
					
					if ( DevaptTypes.is_array(event_cb) )
					{
						self.step(context, 'object event is an array');
						if ( DevaptTypes.is_array(arg_event_cb) )
						{
							self.step(context, 'arg event is an array');
							if (event_cb.length === arg_event_cb.length)
							{
								self.step(context, 'object events array have the same size');
								var found = true;
								var size = event_cb.length;
								for(var index = 0 ; index < size ; index++)
								{
									if (event_cb[index] !== arg_event_cb[index])
									{
										self.step(context, 'object event item is not equals at index[' + index + ']');
										found = false;
										break;
									}
								}
								if (found)
								{
									self.leave(context, 'callback array found');
									self.pop_trace();
									return true;
								}
							}
						}
					}
				}
			}
			
			
			self.leave(context, 'not found');
			self.pop_trace();
			return false;
		},
		
		
		
		/**
		 * @memberof			DevaptMixinEventListener
		 * @public
		 * @method				add_event_callback(arg_event_name,arg_event_cb,arg_unique,arg_sources,arg_not_sources,arg_worker)
		 * @desc				Register an event callback
		 * @param {string}		arg_event_name		event name
		 * @param {function}	arg_event_cb		event callback
		 * @param {boolean}		arg_unique			has unique callback for event
		 * @param {array}		arg_sources			list of processed event sources (emitters)
		 * @param {array}		arg_not_sources		list of ignored event sources (emitters)
		 * @param {object}		arg_worker			tasks worker
		 * @return {boolean}	true:success,false:failure
		 */
		add_event_callback: function(arg_event_name, arg_event_cb, arg_unique, arg_sources, arg_not_sources, arg_worker)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinEventListener.mixin_event_listener_trace);
			var context = 'add_event_callback(' + arg_event_name + ',callback...)';
			self.enter(context, '');
			
			
			// CHECK EVENT NAME ARGUMENT
			self.assert_not_empty_string(context, 'event name', arg_event_name);
			
			// CHECK EVENT CALLBACK ARGUMENT
			self.assert_not_null(context, 'event cb', arg_event_cb);
			
			// CHECK UNIQUE ARGUMENT
			if ( DevaptTypes.is_null(arg_unique) )
			{
				arg_unique = true;
			}
			if (arg_unique && self.has_event_callback(arg_event_name, arg_event_cb) )
			{
				self.leave(context, 'unique event is already registered');
				self.pop_trace();
				return true;
			}
			
			// GET CALLBACKS ARRAY
			var event_callbacks = self.events_callbacks[arg_event_name];
			if ( DevaptTypes.is_null(event_callbacks) )
			{
				event_callbacks = new Array();
				self.events_callbacks[arg_event_name] = event_callbacks;
			}
			
			// APPEND CALLBACK
			var event_cb_record = {
				event_name:arg_event_name,
				event_cb:arg_event_cb,
				event_sources:arg_sources,
				event_not_sources:arg_not_sources
			};
			event_callbacks.push(event_cb_record);
			// console.log(event_cb_record, 'event_cb_record for event [' + arg_event_name + '] of [' + self.name + ']');
			
			
			self.leave(context, 'success');
			self.pop_trace();
			return true;
		},
		
		
		
		/**
		 * @memberof			DevaptMixinEventListener
		 * @public
		 * @method				add_event_once_callback(arg_event_name,arg_event_cb,arg_sources,arg_not_sources,arg_worker)
		 * @desc				Register an event callback
		 * @param {string}		arg_event_name		event name
		 * @param {function}	arg_event_cb		event callback
		 * @param {array}		arg_sources			list of processed event sources (emitters)
		 * @param {array}		arg_not_sources		list of ignored event sources (emitters)
		 * @param {object}		arg_worker			tasks worker
		 * @return {boolean}	true:success,false:failure
		 */
		add_event_once_callback: function(arg_event_name, arg_event_cb, arg_sources, arg_not_sources, arg_worker)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinEventListener.mixin_event_listener_trace);
			var context = 'add_event_once_callback(' + arg_event_name + ',callback...)';
			self.enter(context, '');
			
			
			var once_cb = function()
			{
				self.remove_event_callback(arg_event_name, once_cb);
				self.do_callback(once_cb, arguments);
			};
			self.add_event_callback(arg_event_name, once_cb, false, arg_sources, arg_not_sources, arg_worker);
			
			
			self.leave(context, 'success');
			self.pop_trace();
			return true;
		},
		
		
		
		/**
		 * @memberof			DevaptMixinEventListener
		 * @public
		 * @method				remove_event_callback(arg_event_name, arg_event_cb)
		 * @desc				Unregister an event callback
		 * @param {string}		arg_event_name		event name
		 * @param {function}	arg_event_cb		event callback
		 * @return {boolean}	true:success,false:failure
		 */
		remove_event_callback : function(arg_event_name, arg_event_cb)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinEventListener.mixin_event_listener_trace);
			var context = 'remove_event_callback(' + arg_event_name + ',callback)';
			self.enter(context, '');
			
			
			// GET CALLBACKS ARRAY
			var event_callbacks = self.events_callbacks[arg_event_name];
			if ( DevaptTypes.is_null(event_callbacks) )
			{
				self.leave(context, 'not found');
				self.pop_trace();
				return false;
			}
			
			// REMOVE GIVEN CALLBACK
			for(var record_index in event_callbacks)
			{
				self.step(context, 'loop on event callback record at [' + record_index + ']');
				
				var event_cb_record = event_callbacks[record_index];
				var event_cb = event_cb_record.event_cb;
				
				// CALLBACK IS A FUNCTION
				if ( DevaptTypes.is_function(event_cb) )
				{
					self.step(context, 'object event is a function');
					if (event_cb === arg_event_cb)
					{
						event_callbacks.splice(record_index, 1);
						self.leave(context, 'callback function found');
						self.pop_trace();
						return true;
					}
				}
				
				// CALLBACK IS A METHOD
				if ( DevaptTypes.is_array(event_cb) )
				{
					self.step(context, 'object event is an array');
					if ( DevaptTypes.is_array(arg_event_cb) && arg_event_cb.length === 2 && event_cb.length === 2 )
					{
						if (arg_event_cb[0] === event_cb[0] && arg_event_cb[1] === event_cb[1])
						{
							event_callbacks.splice(record_index, 1);
							self.leave(context, 'callback function found');
							self.pop_trace();
							return true;
						}
					}
				}
			}
			
			
			self.leave(context, 'not found');
			self.pop_trace();
			return false;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2013-06-13',
			'updated':'2014-12-05',
			'description':'Mixin methods for event listening.'
		}
	};
	var DevaptMixinEventListenerClass = new DevaptClass('DevaptMixinEventListener', null, class_settings);
	
	// METHODS
	DevaptMixinEventListenerClass.infos.ctor = DevaptMixinEventListener.init_mixin_event_listener;
	DevaptMixinEventListenerClass.add_public_method('has_event_callback', {}, DevaptMixinEventListener.has_event_callback);
	DevaptMixinEventListenerClass.add_public_method('add_event_callback', {}, DevaptMixinEventListener.add_event_callback);
	DevaptMixinEventListenerClass.add_public_method('add_event_once_callback', {}, DevaptMixinEventListener.add_event_once_callback);
	DevaptMixinEventListenerClass.add_public_method('remove_event_callback', {}, DevaptMixinEventListener.remove_event_callback);
	
	// PROPERTIES
	
	// BUILD CLASS
	DevaptMixinEventListenerClass.build_class();
	
	
	return DevaptMixinEventListenerClass;
} );
/**
 * @file        object/mixin-event-sender.js
 * @desc        Mixin of methods for event sending
 * @see			DevaptObject
 * @ingroup     DEVAPT_OBJECT
 * @date        2013-06-13
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('object/mixin-event-sender',['core/types', 'object/class', 'object/event', 'object/events'],
function(DevaptTypes, DevaptClass, DevaptEvent, DevaptEvents)
{
	/**
	 * @mixin				DevaptMixinEventSender
	 * @public
	 * @desc				Mixin of methods for event sender
	 */
	var DevaptMixinEventSender = 
	{
		/**
		 * @memberof			DevaptMixinEventSender
		 * @public
		 * @desc				Enable/disable trace for event sending operations
		 */
		mixin_event_sender_trace: false,
		
		
		
		/**
		 * @memberof				DevaptMixinEventSender
		 * @public
		 * @method					fire_event(arg_event_name_or_obj, arg_operands_or_nothing)
		 * @desc					Fire an event callbacks
		 * @param {DevaptEvent}		arg_event_name_or_obj	event name (string) or event object
		 * @param {array|null}		arg_operands_or_nothing	event operands to give to the callback
		 * @return {boolean}		true:success,false:failure
		 */
		fire_event : function(arg_event_name_or_obj, arg_operands_or_nothing)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinEventSender.mixin_event_sender_trace);
			var context = 'fire_event(' + (DevaptTypes.is_string(arg_event_name_or_obj) ? arg_event_name_or_obj : arg_event_name_or_obj.name) + ',callback)';
			self.enter(context, '');
//			self.value(context, 'opds', arg_operands_or_nothing);
			
			
			// GET EVENT NAME
			var event = null;
			var event_name = null;
			if ( DevaptTypes.is_string(arg_event_name_or_obj) )
			{
				event_name = arg_event_name_or_obj;
			}
			else if ( event instanceof DevaptEvent )
			{
				event = arg_event_name_or_obj;
				event_name = event.name;
			}
			else
			{
				self.leave(context, 'bad event name or object of type [' + typeof arg_event_name_or_obj + ']');
				self.pop_trace();
				return false;
			}
			
			// GET CALLBACKS ARRAY
			if (! self.events_callbacks)
			{
				self.events_callbacks = new Object();
			}
			var event_callbacks_records = self.events_callbacks[event_name];
			
			// GET ALL EVENTS CALLBACK
			var all_events_callbacks = self.events_callbacks['*'];
			if ( DevaptTypes.is_array(all_events_callbacks) )
			{
				self.step(context, 'event has callbacks');
				event_callbacks_records = all_events_callbacks.concat(event_callbacks_records);
			}
			
			// TEST IF CALLBACKS EXISTS
			if ( ! DevaptTypes.is_array(event_callbacks_records) || event_callbacks_records.length === 0 )
			{
				self.leave(context, 'success: no listeners->not fired');
				self.pop_trace();
				return true;
			}
			
			// BUILD EVENT IF NEEDED
			if ( event === null )
			{
				self.step(context, 'create event');
				event = DevaptEvent.create(event_name, { emitter_object:self, operands_array:arg_operands_or_nothing} );
			}
			
			
			// FIRE EVENT
			if (event_callbacks_records)
			{
				self.step(context, 'fire event on callbacks');
				event.fire(event_callbacks_records);
			}
			
			
			self.leave(context, 'success');
			self.pop_trace();
			return true;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2013-06-13',
			'updated':'2014-12-05',
			'description':'Mixin methods for event sending.'
		}
	};
	var DevaptMixinEventSenderClass = new DevaptClass('DevaptMixinEventSender', null, class_settings);
	
	// METHODS
	DevaptMixinEventSenderClass.add_public_method('fire_event', {}, DevaptMixinEventSender.fire_event);
	
	// PROPERTIES
	
	// BUILD MIXIN CLASS
	DevaptMixinEventSenderClass.build_class();
	
	
	return DevaptMixinEventSenderClass;
} );
/**
 * @file        object/object.js
 * @desc        Object class
 * 					Inherits from ObjectBase
 * 					Append options (ie registered settings) and events (send and listen) features
 * 				API
 * 					cb_set_property
 * 					cb_get_option_from_plain_object_string
 * 					cb_to_string
 * 					
 * @see			object/object-base.js
 * @ingroup     DEVAPT_CORE
 * @date        2014-05-10
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('object/object',[
	'Devapt', 'core/types', 'core/traces',
	'object/class', 'object/object-base', 'object/mixin-event-listener', 'object/mixin-event-sender'
],
function(
	Devapt, DevaptTypes, DevaptTraces,
	DevaptClass, DevaptObjectBase, DevaptMixinEventListener, DevaptMixinEventSender)
{
	var jQuery = Devapt.jQuery();
	
	
	/**
	 * @memberof			DevaptObject
	 * @public
	 * @method				get_property(arg_property_name)
	 * @desc				Get a property value
	 * @param {string}		arg_property_name		property name
	 * @return {anything}
	 */
	var cb_get_property = function(arg_property_name)
	{
		var self = this;
		var context = 'get_property(property)';
		self.enter(context, '');
		
		// TODO
		var value = self[arg_property_name];
		
		self.leave(context, '');
		return value;
	}
	
	
	/**
	 * @memberof			DevaptObject
	 * @public
	 * @method				set_property(arg_property_name)
	 * @desc				Set a property value
	 * @param {string}		arg_property_name		property name
	 * @param {string}		arg_property_value		property value
	 * @return {boolean}
	 */
	var cb_set_property = function(arg_property_name, arg_property_value)
	{
		var self = this;
		var context = 'set_property(property)';
		self.enter(context, '');
		
		// TODO
		self[arg_property_name] = arg_property_value;
		var result = true;
		
		self.leave(context, result ? 'success' : 'failure');
		return result;
	}
	
	
	/**
	 * @memberof			DevaptObject
	 * @public
	 * @method				get_worker(arg_worker_name)
	 * @desc				Get the named worker
	 * @param {string}		arg_worker_name		worker name (optional)
	 * @return {object}		worker creation promise
	 */
	var cb_get_worker = function(arg_worker_name)
	{
		var self = this;
		var context = 'get_worker(name)';
		self.enter(context, '');
		
		
		// INIT WORKERS
		if ( ! DevaptTypes.is_object(self.workers_promises) )
		{
			self.workers_promises = {};
		}
		
		// CREATE TASKS WORKER
		var worker_name = arg_worker_name && arg_worker_name.length > 0 ? arg_worker_name : self.name + '_worker';
		var worker_delay = self.worker_default_delay ? self.worker_default_delay : 200;
		
		
		// GET OR CREATE WORKER
		var worker_promise = null;
		if (arg_worker_name in self.workers_promises)
		{
			worker_promise = self.workers_promises[worker_name];
		}
		else
		{
			worker_promise = Devapt.create('DevaptTimer', { name:worker_name, timer_delay:worker_delay });
			self.workers_promises[worker_name] = worker_promise;
			
			worker_promise = worker_promise.then(
				function(worker)
				{
					// console.log(worker, 'start worker');
					worker.start();
					// console.log(worker, 'started worker');
					return worker;
				}
			);
		}
		
		
		self.leave(context, Devapt.msg_success_promise);
		return worker_promise;
	}
	
	
	/**
	 * @memberof			DevaptObject
	 * @public
	 * @method				get_option_from_plain_object_string(arg_option_str, arg_option_attributes)
	 * @desc				Get an plain object from a string with attributes names check
	 * @param {string}		arg_option_str			Option string
	 * @param {array}		arg_option_attributes	Option attributes array
	 * @return {object|null}
	 */
/*	var cb_get_option_from_plain_object_string = function(arg_option_str, arg_option_attributes)
	{
		var self = this;
		var context = 'get_option_from_plain_object_string(option_str,option_attr)';
		self.enter(context, '');
		
		
		// CHECK ARGS
		self.assert_not_empty_string(context, 'option_str', arg_option_str);
		self.assert_array(context, 'option_attributes', arg_option_attributes);
		
		// CHECK STRING FORMAT
		var pattern = '[ \t]*\\{([\\w]+[:][\"]?[\\w]+[\"]?[,]?)+\\}[ \t]*';
		var regexp = new RegExp(pattern, '');
		var is_object_str = regexp.test(arg_option_str);
		if (!is_object_str)
		{
			self.leave(context, 'bad option string format');
			return null;
		}
		
		// CREATE PLAIN OBJECT FROM STRING
		var option_obj = eval('(' + arg_option_str + ')');
		// TODO secure string to object conversion
		// var option_obj = $.parseJSON(self.model_load_strategy);
		for(option_key in option_obj)
		{
			if (arg_option_attributes.indexOf(option_key) < 0)
			{
				self.leave(context, 'bad option attribute for [' + option_key + ']');
				return null;
			}
		}
		
		
		self.leave(context, 'success');
		return option_obj;
	}*/
	
	
	/**
	 * @memberof			DevaptObject
	 * @public
	 * @method				self.to_string()
	 * @desc				Get a string output of the object
	 * @return {string}		String output
	 */
	var cb_to_string = function()
	{
		var self = this;
		
		var str = '';
		var members = self._class.properties.all_map;
		for(var key in members)
		{
			var property = members[key];
			var member = self[property.name];
			
			if (member === self)
			{
				continue;
			}
			
			if ( ! DevaptTypes.is_function(member) )
			{
				str += '\n  ' + property.name + '=' + DevaptTypes.get_value_str(member, 0);
			}
		}
		return str;
	}
	
	
	/**
	 * @memberof			DevaptObject
	 * @public
	 * @method				DevaptStorage.gc_use(arg_used_object)
	 * @desc				Define an object usage : a.gc_use(b) => a use b
	 * @param {object}		arg_used_object		used object
	 * @return {nothing}
	 */
	var cb_gc_use = function(arg_used_object)
	{
		var self = this;
		
		if (! arg_used_object)
		{
			return;
		}
		
		if (! self.gc_using_objects)
		{
			self.gc_using_objects = [];
		}
		
		self.gc_using_objects.push(arg_used_object);
		
		++self.gc_uses_counter;
	}
	
	
	/**
	 * @memberof			DevaptObject
	 * @public
	 * @method				DevaptStorage.gc_free(arg_used_object)
	 * @desc				Remove an object usage : a.gc_free(b) => a does'nt use b
	 * @param {object}		arg_used_object		used object
	 * @return {nothing}
	 */
	var cb_gc_free = function(arg_used_object)
	{
		var self = this;
		
		if (! arg_used_object)
		{
			return;
		}
		
		if (! self.gc_using_objects)
		{
			return;
		}
		
		var index = self.gc_using_objects.length;
		while(index >= 0)
		{
			if (self.gc_using_objects[index] === arg_used_object)
			{
				self.gc_using_objects.splice(index, 1);
				index = -1;
			}
		}
		
		--self.gc_uses_counter;
	}
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2014-05-10',
			updated:'2015-02-01',
			description:'Object class for all Devapt objects.'
		},
		properties:{
			
		}
	};
	var parent_class = DevaptObjectBase;
	var DevaptObjectClass = new DevaptClass('DevaptObject', parent_class, class_settings);
	
	// METHODS
	DevaptObjectClass.add_public_method('get_worker', {}, cb_get_worker);
	DevaptObjectClass.add_public_method('get_property', {}, cb_get_property);
	DevaptObjectClass.add_public_method('set_property', {}, cb_set_property);
	// DevaptObjectClass.add_public_method('get_option_from_plain_object_string', {}, cb_get_option_from_plain_object_string);
	DevaptObjectClass.add_public_method('to_string', {}, cb_to_string);
	DevaptObjectClass.add_public_method('toString', {}, cb_to_string);
	
	DevaptObjectClass.add_public_method('gc_use', {}, cb_gc_use);
	DevaptObjectClass.add_public_method('gc_free', {}, cb_gc_free);
	
	// MIXINS
	DevaptObjectClass.add_public_mixin(DevaptMixinEventSender);
	DevaptObjectClass.add_public_mixin(DevaptMixinEventListener);
	
	// PROPERTIES
	DevaptObjectClass.add_public_str_property('class_type', 'class type:view or model or ...', null, false, true);
	DevaptObjectClass.add_public_int_property('gc_uses_counter', 'garbage collector uses counter', 0, false, true);
	
	
	
	return DevaptObjectClass;
} );
/**
 * @file        object/plugin-manager.js
 * @desc        Plugin manager class
 * @ingroup     DEVAPT_CORE
 * @date        2015-02-28
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'object/plugin-manager',['Devapt', 'core/types', 'object/class', 'object/object'],
function(Devapt, DevaptTypes, DevaptClass, DevaptObject)
{
	/**
	 * @public
	 * @class				DevaptPluginManager
	 * @desc				Plugin manager class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptPluginManager
	 * @desc				Get plugin classes factory
	 * @param(string)		arg_name		plugin name
	 * @param(string)		arg_url			plugin url
	 * @return {object}		A factory object
	 */
	var cb_declare_plugin_url = function(arg_name, arg_url)
	{
		var self = this;
		var context = 'declare_plugin_url(name,url)';
		self.assert_not_empty_string(context, 'plugin name', arg_name);
		self.assert_not_empty_string(context, 'plugin url', arg_url);
		self.enter(context, arg_name, arg_url);
		
		
		self.plugins_urls_map[arg_name] = arg_url;
		
		
		self.leave(context, Devapt.msg_succcess);
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptPluginManager
	 * @desc				Load a plugin or return an already loaded plugin
	 * @param(string)		arg_name		plugin name
	 * @return {object}		A promise of a Plugin instance
	 */
	var cb_load_plugin = function(arg_name)
	{
		var self = this;
		var context = 'load_plugin(name)';
		self.assert_not_empty_string(context, 'plugin name', arg_name);
		self.enter(context, arg_name);
		
		
		// PLUGIN IS ALREADY LOADED
		if (self.plugins_map[arg_name])
		{
			self.leave(context, Devapt.msg_success_promise);
			return Devapt.promise_resolved( self.plugins_map[arg_name] );
		}
		
		// PLUGIN URL IS NOT DECLARED
		if (! arg_name in self.plugins_urls_map)
		{
			self.leave(context, Devapt.msg_failure_promise);
			return Devapt.promise_rejected();
		}
		
		// CHECK PLUGIN NAME
		var plugin_url = self.plugins_urls_map[arg_name];
		if ( ! plugin_url )
		{
			self.leave(context, Devapt.msg_failure_promise);
			return Devapt.promise_rejected();
		}
		
		// LOAD A PLUGIN URL
		var defer = Devapt.defer();
		// console.log(arg_name, 'arg_name');
		// console.log(self.plugins_urls_map, 'self.plugins_urls_map');
		
		require([plugin_url],
			function(plugin_class)
			{
				self.step(context, 'plugin is loaded');
				
				var plugin = plugin_class.create(arg_name);
				self.step(context, 'plugin object is created');
				
				self.set_plugin(plugin);
				self.step(context, 'plugin object is registered');
				
				defer.resolve(plugin);
			}
		);
		
		
		self.leave(context, Devapt.msg_default_implementation);
		return Devapt.promise(defer);
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptPluginManager
	 * @desc				Get an already loaded plugin
	 * @param(string)		arg_name		plugin name
	 * @return {object}		A promise of a Plugin instance
	 */
	var cb_get_plugin = function(arg_name)
	{
		var self = this;
		var context = 'get_plugin(name)';
		self.assert_not_empty_string(context, 'plugin name', arg_name);
		self.enter(context, arg_name);
		
		
		// PLUGIN IS NOT ALREADY LOADED
		if (! self.plugins_map[arg_name])
		{
			self.leave(context, Devapt.msg_failure_promise);
			return Devapt.promise_rejected();
		}
		
		
		self.leave(context, Devapt.msg_success_promise);
		return Devapt.promise_resolved( self.plugins_map[arg_name] );
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptPluginManager
	 * @desc				Register a plugin object
	 * @param(object)		arg_plugin		plugin instance
	 * @return {nothing}
	 */
	var cb_set_plugin = function(arg_plugin)
	{
		var self = this;
		var context = 'set_plugin(plugin)';
		self.assert_object(context, 'plugin', arg_plugin);
		self.enter(context, arg_plugin.name);
		
		
		self.plugins_map[arg_plugin.name] = arg_plugin;
		self.plugins_array.push(arg_plugin);
		
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptPluginManager
	 * @desc				Get a class required url
	 * @param(string)		arg_class_name		class name
	 * @return {object}		A promise of a class required urls
	 */
	var cb_get_class_requires = function(arg_class_name)
	{
		var self = this;
		var context = 'get_class_requires(class name)';
		self.assert_not_empty_string(context, 'class name', arg_class_name);
		self.enter(context, arg_class_name);
		
		
		// LOOP ON LOADED PLUGINS
		for(var plugin_index in self.plugins_array)
		{
			self.value(context, 'plugin index', plugin_index);
			
			var plugin = self.plugins_array[plugin_index];
			self.value(context, 'plugin name', plugin.name);
			
			if ( plugin.has_class_depds(arg_class_name) )
			{
				var dependancies = plugin.get_class_depds(arg_class_name);
				
				self.leave(context, Devapt.msg_success_promise);
				return Devapt.promise_resolved(dependancies);
			}
		}
		
		
		self.leave(context, Devapt.msg_failure_promise);
		return Devapt.promise_resolved([]);
	};
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-02-28',
			'updated':'2015-02-28',
			'description':'Plugins manager for Devapt applications.',
			'is_abstract':false,
			'is_singleton':true
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptObject;
	var DevaptPluginManagerClass = new DevaptClass('DevaptPluginManager', parent_class, class_settings);
	
	// METHODS
	DevaptPluginManagerClass.add_public_method('declare_plugin_url', {}, cb_declare_plugin_url);
	DevaptPluginManagerClass.add_public_method('load_plugin', {}, cb_load_plugin);
	DevaptPluginManagerClass.add_public_method('get_plugin', {}, cb_get_plugin);
	DevaptPluginManagerClass.add_public_method('set_plugin', {}, cb_set_plugin);
	DevaptPluginManagerClass.add_public_method('get_class_requires', {}, cb_get_class_requires);
	
	// PROPERTIES
	DevaptPluginManagerClass.add_public_array_property('plugins_array',	'Ordered list of loaded plugins',	[], false, false, []);
	DevaptPluginManagerClass.add_public_obj_property('plugins_map',		'Map of loaded plugins',			{}, false, false, []);
	DevaptPluginManagerClass.add_public_obj_property('plugins_urls_map',	'Map of not loaded plugins urls',	{}, false, false, []);
	
	
	return DevaptPluginManagerClass;
} );
/* jshint browser: true */
/* global define: false */

// AMD shim
(function(root, factory) {

    'use strict';

    if (typeof define === 'function' && define.amd) {
        define('jStorage',factory);
    } else {
        root.simpleStorage = factory();
    }

}(this, function() {

    'use strict';

    var
        VERSION = '0.1.3',

        /* This is the object, that holds the cached values */
        _storage = false,

        /* How much space does the storage take */
        _storage_size = 0,

        _storage_available = false,

        _ttl_timeout = null;

    // This method might throw as it touches localStorage and doing so
    // can be prohibited in some environments
    function _init() {

        // If localStorage does not exist, the following throws
        // This is intentional
        window.localStorage.setItem('__simpleStorageInitTest', 'tmpval');
        window.localStorage.removeItem('__simpleStorageInitTest');

        // Load data from storage
        _load_storage();

        // remove dead keys
        _handleTTL();

        // start listening for changes
        _setupUpdateObserver();

        // handle cached navigation
        if ('addEventListener' in window) {
            window.addEventListener('pageshow', function(event) {
                if (event.persisted) {
                    _reloadData();
                }
            }, false);
        }

        _storage_available = true;
    }

    /**
     * Sets up a storage change observer
     */
    function _setupUpdateObserver() {
        if ('addEventListener' in window) {
            window.addEventListener('storage', _reloadData, false);
        } else {
            document.attachEvent('onstorage', _reloadData);
        }
    }

    /**
     * Reload data from storage when needed
     */
    function _reloadData() {
        try {
            _load_storage();
        } catch (E) {
            _storage_available = false;
            return;
        }
        _handleTTL();
    }

    function _load_storage() {
        var source = localStorage.getItem('simpleStorage');

        try {
            _storage = JSON.parse(source) || {};
        } catch (E) {
            _storage = {};
        }

        _storage_size = _get_storage_size();
    }

    function _save() {
        try {
            localStorage.setItem('simpleStorage', JSON.stringify(_storage));
            _storage_size = _get_storage_size();
        } catch (E) {
            return E;
        }
        return true;
    }

    function _get_storage_size() {
        var source = localStorage.getItem('simpleStorage');
        return source ? String(source).length : 0;
    }

    function _handleTTL() {
        var curtime, i, len, expire, keys, nextExpire = Infinity,
            expiredKeysCount = 0;

        clearTimeout(_ttl_timeout);

        if (!_storage || !_storage.__simpleStorage_meta || !_storage.__simpleStorage_meta.TTL) {
            return;
        }

        curtime = +new Date();
        keys = _storage.__simpleStorage_meta.TTL.keys || [];
        expire = _storage.__simpleStorage_meta.TTL.expire || {};

        for (i = 0, len = keys.length; i < len; i++) {
            if (expire[keys[i]] <= curtime) {
                expiredKeysCount++;
                delete _storage[keys[i]];
                delete expire[keys[i]];
            } else {
                if (expire[keys[i]] < nextExpire) {
                    nextExpire = expire[keys[i]];
                }
                break;
            }
        }

        // set next check
        if (nextExpire != Infinity) {
            _ttl_timeout = setTimeout(_handleTTL, Math.min(nextExpire - curtime, 0x7FFFFFFF));
        }

        // remove expired from TTL list and save changes
        if (expiredKeysCount) {
            keys.splice(0, expiredKeysCount);

            _cleanMetaObject();
            _save();
        }
    }

    function _setTTL(key, ttl) {
        var curtime = +new Date(),
            i, len, added = false;

        ttl = Number(ttl) || 0;

        // Set TTL value for the key
        if (ttl !== 0) {
            // If key exists, set TTL
            if (_storage.hasOwnProperty(key)) {

                if (!_storage.__simpleStorage_meta) {
                    _storage.__simpleStorage_meta = {};
                }

                if (!_storage.__simpleStorage_meta.TTL) {
                    _storage.__simpleStorage_meta.TTL = {
                        expire: {},
                        keys: []
                    };
                }

                _storage.__simpleStorage_meta.TTL.expire[key] = curtime + ttl;

                // find the expiring key in the array and remove it and all before it (because of sort)
                if (_storage.__simpleStorage_meta.TTL.expire.hasOwnProperty(key)) {
                    for (i = 0, len = _storage.__simpleStorage_meta.TTL.keys.length; i < len; i++) {
                        if (_storage.__simpleStorage_meta.TTL.keys[i] == key) {
                            _storage.__simpleStorage_meta.TTL.keys.splice(i);
                        }
                    }
                }

                // add key to keys array preserving sort (soonest first)
                for (i = 0, len = _storage.__simpleStorage_meta.TTL.keys.length; i < len; i++) {
                    if (_storage.__simpleStorage_meta.TTL.expire[_storage.__simpleStorage_meta.TTL.keys[i]] > (curtime + ttl)) {
                        _storage.__simpleStorage_meta.TTL.keys.splice(i, 0, key);
                        added = true;
                        break;
                    }
                }

                // if not added in previous loop, add here
                if (!added) {
                    _storage.__simpleStorage_meta.TTL.keys.push(key);
                }
            } else {
                return false;
            }
        } else {
            // Remove TTL if set
            if (_storage && _storage.__simpleStorage_meta && _storage.__simpleStorage_meta.TTL) {

                if (_storage.__simpleStorage_meta.TTL.expire.hasOwnProperty(key)) {
                    delete _storage.__simpleStorage_meta.TTL.expire[key];
                    for (i = 0, len = _storage.__simpleStorage_meta.TTL.keys.length; i < len; i++) {
                        if (_storage.__simpleStorage_meta.TTL.keys[i] == key) {
                            _storage.__simpleStorage_meta.TTL.keys.splice(i, 1);
                            break;
                        }
                    }
                }

                _cleanMetaObject();
            }
        }

        // schedule next TTL check
        clearTimeout(_ttl_timeout);
        if (_storage && _storage.__simpleStorage_meta && _storage.__simpleStorage_meta.TTL && _storage.__simpleStorage_meta.TTL.keys.length) {
            _ttl_timeout = setTimeout(_handleTTL, Math.min(Math.max(_storage.__simpleStorage_meta.TTL.expire[_storage.__simpleStorage_meta.TTL.keys[0]] - curtime, 0), 0x7FFFFFFF));
        }

        return true;
    }

    function _cleanMetaObject() {
        var updated = false,
            hasProperties = false,
            i;

        if (!_storage || !_storage.__simpleStorage_meta) {
            return updated;
        }

        // If nothing to TTL, remove the object
        if (_storage.__simpleStorage_meta.TTL && !_storage.__simpleStorage_meta.TTL.keys.length) {
            delete _storage.__simpleStorage_meta.TTL;
            updated = true;
        }

        // If meta object is empty, remove it
        for (i in _storage.__simpleStorage_meta) {
            if (_storage.__simpleStorage_meta.hasOwnProperty(i)) {
                hasProperties = true;
                break;
            }
        }

        if (!hasProperties) {
            delete _storage.__simpleStorage_meta;
            updated = true;
        }

        return updated;
    }

    ////////////////////////// PUBLIC INTERFACE /////////////////////////

    try {
        _init();
    } catch (E) {}

    return {

        version: VERSION,

        canUse: function() {
            return !!_storage_available;
        },

        set: function(key, value, options) {
            if (key == '__simpleStorage_meta') {
                return false;
            }

            if (!_storage) {
                return false;
            }

            // undefined values are deleted automatically
            if (typeof value == 'undefined') {
                return this.deleteKey(key);
            }

            options = options || {};

            // Check if the value is JSON compatible (and remove reference to existing objects/arrays)
            try {
                value = JSON.parse(JSON.stringify(value));
            } catch (E) {
                return E;
            }

            _storage[key] = value;

            _setTTL(key, options.TTL || 0);

            return _save();
        },

        get: function(key) {
            if (!_storage) {
                return false;
            }

            if (_storage.hasOwnProperty(key) && key != '__simpleStorage_meta') {
                // TTL value for an existing key is either a positive number or an Infinity
                if (this.getTTL(key)) {
                    return _storage[key];
                }
            }
        },

        deleteKey: function(key) {

            if (!_storage) {
                return false;
            }

            if (key in _storage) {
                delete _storage[key];

                _setTTL(key, 0);

                return _save();
            }

            return false;
        },

        setTTL: function(key, ttl) {
            if (!_storage) {
                return false;
            }

            _setTTL(key, ttl);

            return _save();
        },

        getTTL: function(key) {
            var ttl;

            if (!_storage) {
                return false;
            }

            if (_storage.hasOwnProperty(key)) {
                if (_storage.__simpleStorage_meta &&
                    _storage.__simpleStorage_meta.TTL &&
                    _storage.__simpleStorage_meta.TTL.expire &&
                    _storage.__simpleStorage_meta.TTL.expire.hasOwnProperty(key)) {

                    ttl = Math.max(_storage.__simpleStorage_meta.TTL.expire[key] - (+new Date()) || 0, 0);

                    return ttl || false;
                } else {
                    return Infinity;
                }
            }

            return false;
        },

        flush: function() {
            if (!_storage) {
                return false;
            }

            _storage = {};
            try {
                localStorage.removeItem('simpleStorage');
                return true;
            } catch (E) {
                return E;
            }
        },

        index: function() {
            if (!_storage) {
                return false;
            }

            var index = [],
                i;
            for (i in _storage) {
                if (_storage.hasOwnProperty(i) && i != '__simpleStorage_meta') {
                    index.push(i);
                }
            }
            return index;
        },

        storageSize: function() {
            return _storage_size;
        }
    };

}));
/**
 * @file        core/security.js
 * @desc        Devapt static security features
 * @ingroup     DEVAPT_CORE
 * @date        2015-03-14
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */

define(
'core/security',['Devapt', 'core/traces', 'core/types', 'core/nav-history', 'jStorage'],
function(Devapt, DevaptTrace, DevaptTypes, DevaptNavHistory, DevaptCache)
{
	console.info(DevaptCache, 'DevaptCache');
	
	
	/**
	 * @memberof	DevaptSecurity
	 * @public
	 * @class
	 * @desc		Devapt cache features container
	 */
	var DevaptSecurity = function() {};
	
	
	/**
	 * @memberof	DevaptSecurity
	 * @public
	 * @static
	 * @desc		Trace flag
	 */
	DevaptSecurity.security_trace = false;
	
	
	/**
	 * @memberof	DevaptSecurity
	 * @public
	 * @static
	 * @desc		default logged user informations
	 */
	DevaptSecurity.default_logged_user =
	{
		status:null,
		login:null,
		password:null,
		expire:null,
		token:null
	};
	
	
	/**
	 * @memberof	DevaptSecurity
	 * @public
	 * @static
	 * @desc		Logged user record key
	 */
	DevaptSecurity.logged_user_key = 'Devapt.security.user';
	
	
	
	/**
	 * @memberof				DevaptSecurity
	 * @public
	 * @method					DevaptSecurity.login(arg_login, arg_password)
	 * @desc					Login a user
	 * @param {string}			arg_login		user login
	 * @param {string}			arg_password	user password
	 * @return {object}			Promise of boolean result : Connection accepted or refused
	 */
	DevaptSecurity.login = function(arg_login, arg_password)
	{
		var context = 'DevaptSecurity.login(login,pwd)';
		DevaptTrace.trace_enter(context, arg_login, DevaptSecurity.security_trace);
		
		
	    var hashed_password = Devapt.hash('MD5', arg_password);
		DevaptTrace.trace_value(context, 'hashed_password', hashed_password, DevaptSecurity.security_trace);
		
		var url_base = Devapt.app.get_url_base(); 
		var url = url_base + 'security/authentication/login';
		
		var datas = {
			login:arg_login,
			password:hashed_password
		};
		var json_datas = JSON.stringify(datas);
		
		var ajax_settings = {
			contentType	: 'application/x-www-form-urlencoded; charset=utf-8',
			dataType	: 'json',
			async		: true,
			cache		: false,
			timeout		: 3000
		};
		
		DevaptSecurity.delete_logged_user();
		
		var ajax_promise = Devapt.ajax_post(url, json_datas, ajax_settings, null);
		
		// ON SUCCESS
		ajax_promise.then(
			function(result)
			{
				console.info(arg_login, 'login success');
				console.log(result, 'login result');
				
				var record =
				{
					status: result.status,
					login: result.login,
					password: hashed_password,
					expire: result.expire,
					token: result.token
				};
				DevaptSecurity.set_logged_user(record);
				
				Devapt.get_current_backend().notify_info('login success for [' + arg_login + ']');
				
				try
				{
					Devapt.app.render();
				}
				catch(e)
				{
					console.error(e, context);
				}
			},
			function(request)
			{
				console.error(arg_login, 'login failure');
				console.log(request, 'request');
				
				Devapt.get_current_backend().notify_error('login failure for [' + arg_login + ']');
			}
		);
		
		
		DevaptTrace.trace_leave(context, Devapt.msg_success_promise, DevaptSecurity.security_trace);
		return ajax_promise;
	}
	
	
	/**
	 * @memberof				DevaptSecurity
	 * @public
	 * @method					DevaptSecurity.logout()
	 * @desc					Logout a connected user
	 * @return {nothing}
	 */
	DevaptSecurity.logout = function()
	{
		var context = 'DevaptSecurity.logout()';
		DevaptTrace.trace_enter(context, '', DevaptSecurity.security_trace);
		
		try
		{
			// REMOVE CURRENT LOGGED USER RECORD
			DevaptSecurity.delete_logged_user();
			
			// GET CURRENT BACKEND
			var backend = Devapt.get_current_backend();
			
			// CHECK AUTHENTICATION
			logout_promise = backend.render_logout();
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		DevaptTrace.trace_leave(context, Devapt.msg_success, DevaptSecurity.security_trace);
	}
	
	
	/**
	 * @memberof				DevaptSecurity
	 * @public
	 * @method					DevaptSecurity.login(arg_login, arg_password)
	 * @desc					Login a user
	 * @param {string}			arg_login		user login
	 * @param {string}			arg_password	user password
	 * @return {object}			Promise of boolean result : Connection accepted or refused
	 */
	DevaptSecurity.set_logged_user = function(arg_user_record)
	{
		var context = 'DevaptSecurity.set_logged_user(record)';
		DevaptTrace.trace_enter(context, '', DevaptSecurity.security_trace);
		
		try
		{
			var record = jQuery.extend(DevaptSecurity.default_logged_user, arg_user_record);
			// console.log(record, 'DevaptSecurity.set_logged_user: record');
			
			DevaptCache.set(DevaptSecurity.logged_user_key, record);
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		DevaptTrace.trace_leave(context, Devapt.msg_success, DevaptSecurity.security_trace);
	}
	
	
	/**
	 * @memberof				DevaptSecurity
	 * @public
	 * @method					DevaptSecurity.get_logged_user()
	 * @desc					Get a logged user record
	 * @return {object}			{ status:..., login:..., password:..., expire:..., token:... }
	 */
	DevaptSecurity.get_logged_user = function()
	{
		var context = 'DevaptSecurity.get_logged_user()';
		DevaptTrace.trace_enter(context, '', DevaptSecurity.security_trace);
		
		try
		{
			var record = DevaptCache.get(DevaptSecurity.logged_user_key, DevaptSecurity.default_logged_user);
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		DevaptTrace.trace_leave(context, Devapt.msg_success, DevaptSecurity.security_trace);
		return record;
	}
	
	
	/**
	 * @memberof				DevaptSecurity
	 * @public
	 * @method					DevaptSecurity.delete_logged_user()
	 * @desc					Get a logged user record
	 * @return {nothing}
	 */
	DevaptSecurity.delete_logged_user = function()
	{
		var context = 'DevaptSecurity.delete_logged_user()';
		DevaptTrace.trace_enter(context, '', DevaptSecurity.security_trace);
		
		
		try
		{
			// var DevaptCache = window.$.jStorage;
			DevaptCache.deleteKey(DevaptSecurity.logged_user_key);
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		DevaptTrace.trace_leave(context, Devapt.msg_success, DevaptSecurity.security_trace);
	}
	
	
	/**
	 * @memberof				DevaptSecurity
	 * @public
	 * @method					DevaptSecurity.get_token()
	 * @desc					Get security token
	 * @return {string}	
	 */
	DevaptSecurity.get_token = function()
	{
		var context = 'DevaptSecurity.get_token()';
		DevaptTrace.trace_enter(context, '', DevaptSecurity.security_trace);
		
		try
		{
			var record = DevaptCache.get(DevaptSecurity.logged_user_key, DevaptSecurity.default_logged_user);
			
			DevaptTrace.trace_leave(context, Devapt.msg_success, DevaptSecurity.security_trace);
			return record.token;
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		DevaptTrace.trace_leave(context, Devapt.msg_failure, DevaptSecurity.security_trace);
		return null;
	}
	
	
	/**
	 * @memberof				DevaptSecurity
	 * @public
	 * @method					DevaptSecurity.check_expiration()
	 * @desc					Check security token expiration
	 * @return {boolean}	
	 */
	DevaptSecurity.check_expiration = function()
	{
		var context = 'DevaptSecurity.check_expiration()';
		DevaptTrace.trace_enter(context, '', DevaptSecurity.security_trace);
		
		try
		{
			var record = DevaptCache.get(DevaptSecurity.logged_user_key, DevaptSecurity.default_logged_user);
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		DevaptTrace.trace_leave(context, Devapt.msg_success, DevaptSecurity.security_trace);
		return record.expire*1000 > Date.now();
	}
	
	
	// SET GLOBAL
	Devapt.security = DevaptSecurity;
	
	
	return DevaptSecurity;
} );
/**
 * @file        core/application.js
 * @desc        Devapt static application features
 * @ingroup     DEVAPT_CORE
 * @date        2013-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'core/application',['Devapt',
	'core/traces', 'core/types', 'core/init', 'core/nav-history',
	'object/classes', 'object/plugin-manager', 'core/security'
],
function(Devapt,
	DevaptTrace, DevaptTypes, DevaptInit, DevaptNavHistory,
	DevaptClasses, DevaptPluginManager, DevaptSecurity
)
{
	/**
	 * @memberof	DevaptApplication
	 * @public
	 * @class
	 * @desc		Devapt application features container
	 */
	var DevaptApplication = function() {};
	
	
	/**
	 * @memberof	DevaptApplication
	 * @public
	 * @static
	 * @desc		Trace flag
	 */
	DevaptApplication.app_trace = false;
	
	
	/**
	 * @memberof	DevaptApplication
	 * @public
	 * @static
	 * @desc		Application configuration
	 */
	DevaptApplication.app_config = null;
	
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_config()
	 * @desc				Get application configuration associative array
	 * @return {object}		Application configuration
	 */
	DevaptApplication.get_config = function()
	{
		var context = 'DevaptApplication.get_config()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		
		if ( ! DevaptTypes.is_object(DevaptApplication.app_config) )
		{
			DevaptTrace.trace_leave(context, 'failure', DevaptApplication.app_trace);
			return null;
		}
		
		
		DevaptTrace.trace_leave(context, 'found', DevaptApplication.app_trace);
		return DevaptApplication.app_config;
	}
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.gset_config(arg_config)
	 * @desc				Get application configuration associative array
	 * @param {object}		Application configuration
	 * @return {boolean}	failure or success
	 */
	DevaptApplication.set_config = function(arg_config)
	{
		var context = 'DevaptApplication.set_config(arg_config)';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		
		// CHECK CONFIGURATION
		if ( ! DevaptTypes.is_object(arg_config) )
		{
			DevaptTrace.trace_leave(context, 'failure', DevaptApplication.app_trace);
			return false;
		}
		
		// SET CONFIGURATION
		DevaptApplication.app_config = arg_config;
		
		
		DevaptTrace.trace_leave(context, 'success', DevaptApplication.app_trace);
		return true;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.run()
	 * @desc				Init application and render views
	 * @return {object}		A promise
	 */
	DevaptApplication.run = function()
	{
		var context = 'DevaptApplication.run()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		
		var init_plugins_promise = null;
		
		try
		{
			// INIT NAVIGATION HISTORY
			DevaptNavHistory.init();
			
			// INIT TRACES
			DevaptClasses.traces_settings = DevaptApplication.get_value('application.traces.items', []);
			
			// LOAD ALL FILES ?
			var load_all = DevaptApplication.get_value('application.status.load_all_classes', false);
			if (load_all)
			{
				var requires_promise = Devapt.require(['core/all', 'datas/all', 'views/all'])
				init_plugins_promise = requires_promise.then(
					function()
					{
						return DevaptApplication.init_plugins();
					}
				);
			}
			else
			{
				init_plugins_promise = DevaptApplication.init_plugins();
			}
		}
		catch(e)
		{
			console.error(context, e);
		}
		
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return init_plugins_promise;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.init_plugins()
	 * @desc				Load application plugins
	 * @return {object}		A promise
	 */
	DevaptApplication.init_plugins = function()
	{
		var context = 'DevaptApplication.init_plugins()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		
		var promises_array = [];
		Devapt.plugin_manager = DevaptPluginManager.create('plugin_manager');
		
		try
		{
			// INIT PLUGINS DECLARATION
			DevaptTrace.trace_step(context, 'INIT PLUGINS DECLARATION', DevaptApplication.app_trace);
			var plugins_declarations = DevaptApplication.get_value('application.client.plugins', []);
			for(var plugin_declaration_key in plugins_declarations)
			{
				DevaptTrace.trace_step(context, 'loop on [' + plugin_declaration_key + ']', DevaptApplication.app_trace);
				
				var defer = Devapt.defer();
				promises_array.push( Devapt.promise(defer) );
				
				var plugin_declaration = plugins_declarations[plugin_declaration_key];
				var plugin_declaration_name = ('name' in plugin_declaration) ? plugin_declaration['name'] : null;
				var plugin_declaration_url = ('url' in plugin_declaration) ? plugin_declaration['url'] : null;
				var plugin_declaration_autoload = ('autoload' in plugin_declaration) ? plugin_declaration['autoload'] : false;
				
				if (plugin_declaration_url)
				{
					DevaptTrace.trace_step(context, 'PLUGIN DECLARATION WITH URL', DevaptApplication.app_trace);
					
					var load_url_promise = require([plugin_declaration_url],
						function(plugins_names)
						{
							DevaptTrace.trace_step(context, 'PLUGIN DECLARATION URL IS LOADING', DevaptApplication.app_trace);
							
							var plugins_promises_array = [];
							
							if (plugin_declaration_autoload)
							{
								DevaptTrace.trace_step(context, 'PLUGIN DECLARATION WITH AUTOLOAD', DevaptApplication.app_trace);
								
								for(var key in plugins_names)
								{
									var plugin_name = plugins_names[key];
									DevaptTrace.trace_step(context, 'loop on plugin name [' + plugin_name + ']', DevaptApplication.app_trace);
									
									var load_plugin_promise = Devapt.plugin_manager.load_plugin(plugin_name);
									// console.log(load_plugin_promise, 'load_plugin_promise');
									plugins_promises_array.push(load_plugin_promise);
								}
							}
							
							// console.log(plugins_promises_array, 'plugins_promises_array');
							var promise_all_plugins = Devapt.promise_all(plugins_promises_array);
							promise_all_plugins.then(
								function()
								{
									defer.resolve();
								}
							);
							// return promise_all_plugins;
						}
					);
					
					DevaptTrace.trace_step(context, 'PLUGIN DECLARATION WITH URL: push promises', DevaptApplication.app_trace);
					// promises_array.push(load_url_promise);
				}
				else
				{
					defer.resolve();
				}
				
				
				if (plugin_declaration_name && plugin_declaration_autoload)
				{
					DevaptTrace.trace_step(context, 'PLUGIN DECLARATION WITH NAME AND AUTOLOAD', DevaptApplication.app_trace);
					
					var load_plugin_promise = Devapt.plugin_manager.load_plugin(plugin_declaration_name);
					promises_array.push(load_plugin_promise);
				}
			}
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		// LAUNCH INIT BACKEND
		var promise_all = Devapt.promise_all(promises_array);
		try
		{
			promise_all.then(
				function()
				{
					DevaptTrace.trace_step(context, 'ALL PROMISES ARE RESOLVED', DevaptApplication.app_trace);
					DevaptApplication.init_backend();
				}
			);
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		DevaptTrace.trace_leave(context, Devapt.msg_success_promise, DevaptApplication.app_trace);
		return promise_all;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.init_backend()
	 * @desc				Init application and render views
	 * @return {object}		A promise
	 */
	DevaptApplication.init_backend = function()
	{
		var context = 'DevaptApplication.init_backend()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		
		// INIT BACKEND
		if ( ! Devapt.has_current_backend() )
		{
			DevaptTrace.trace_step(context, 'no current backend', DevaptApplication.app_trace);
			
			// GET BACKEND NAME
			var backend_name = DevaptApplication.get_value('application.layouts.default.backend.name');
			if ( ! DevaptTypes.is_not_empty_str(backend_name) )
			{
				DevaptTrace.trace_error(context, 'bad default backend name for configuration value [application.layouts.default.backend.name]', true);
				return Deavapt.promise_rejected('bad default backend name');
			}
			
			// LOAD PLUGIN
			var backend_plugin_promise = Devapt.get_plugin_manager().load_plugin(backend_name);
			
			// SET CURRENT BACKEND
			var set_backend_promise = backend_plugin_promise.then(
				function(default_backend_plugin)
				{
					DevaptTrace.trace_step(context, 'set current backend', DevaptApplication.app_trace);
					
					// GET DEFAULT BACKEND
					var default_backend = default_backend_plugin.get_backend();
					if ( ! default_backend || ! default_backend.render_view)
					{
						DevaptTrace.trace_error(context, 'backend plugin has no valid backend', true);
						return Devapt.promise_rejected('backend plugin has no valid backend');
					}
					
					// SET CURRENT BACKEND
					var result = Devapt.set_current_backend(default_backend);
					if ( ! result)
					{
						DevaptTrace.trace_error(context, 'init backend failed', true);
						return Devapt.promise_rejected('init backend failed');
					}
					
					// RENDER VIEW
					return DevaptApplication.render();
				}
			);
			
			DevaptTrace.trace_leave(context, Devapt.msg_success_promise, DevaptApplication.app_trace);
			return set_backend_promise;
		}
		
		
		// RENDER VIEW WITH AN EXISTING CURRENT BACKEND
		DevaptTrace.trace_leave(context, Devapt.msg_success_promise, DevaptApplication.app_trace);
		return DevaptApplication.render();
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.render()
	 * @desc				Render views
	 * @return {object}		A promise
	 */
	DevaptApplication.render = function()
	{
		var context = 'DevaptApplication.render()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		
		try
		{
			// GET CURRENT BACKEND
			DevaptTrace.trace_step(context, 'GET CURRENT BACKEND', DevaptApplication.app_trace);
			var backend = Devapt.get_current_backend();
			
			
			// CHECK AUTHENTICATION
			DevaptTrace.trace_step(context, 'CHECK AUTHENTICATION', DevaptApplication.app_trace);
			if ( ! DevaptApplication.check_authentication() )
			{
				DevaptTrace.trace_step(context, 'RENDER LOGIN', DevaptApplication.app_trace);
				
				var login_promise = backend.render_login();
				DevaptTrace.trace_leave(context, Devapt.msg_success_promise, DevaptApplication.app_trace);
				return login_promise;
			}
			
			
			// INIT DEAULT TOP MENUBAR
			DevaptTrace.trace_step(context, 'INIT TOP MENUBAR', DevaptApplication.app_trace);
			var topmenubar_promise = null;
			
			var default_topbar_name = DevaptApplication.get_topbar_name();
			if ( ! DevaptTypes.is_not_empty_str(DevaptNavHistory.current_topbar_name))
			{
				DevaptTrace.trace_step(context, 'SET DEFAULT TOP MENUBAR', DevaptApplication.app_trace);
				DevaptNavHistory.current_topbar_name = default_topbar_name;
			}
			
			
			// INIT DEFAULT VIEW
			DevaptTrace.trace_step(context, 'OTHERS INIT', DevaptApplication.app_trace);
			DevaptInit.init();
			
			
			// GET PAGE HASH
			DevaptTrace.trace_step(context, 'GET PAGE HASH', DevaptApplication.app_trace);
			var hash = DevaptNavHistory.get_location_hash();
			if ( ! DevaptTypes.is_not_empty_str(hash) )
			{
				DevaptTrace.trace_step(context, 'SET DEFAULT HOME HASH', DevaptApplication.app_trace);
				
				var hash = DevaptApplication.get_home_view_hash();
			}
			DevaptTrace.trace_value(context, 'hash', hash, DevaptApplication.app_trace);
			
			// RENDER PAGE
			DevaptTrace.trace_step(context, 'RENDER PAGE', DevaptApplication.app_trace);
			var cb_async_render = function()
			{
				DevaptTrace.trace_step(context, 'RENDER PAGE callback', DevaptApplication.app_trace);
				DevaptNavHistory.set_location_hash(hash);
			};
			setTimeout(cb_async_render, 10);
			
			
			// INIT BREADCRUMBS
			DevaptTrace.trace_step(context, 'INIT BREADCRUMBS', DevaptApplication.app_trace);
			var breadcrumbs_promise = null;
			
			var breadcrumbs = DevaptApplication.get_breadcrumbs_name();
			if ( DevaptTypes.is_not_empty_str(breadcrumbs) )
			{
				var container_id = DevaptApplication.get_breadcrumbs_container_id();
				if ( DevaptTypes.is_not_empty_str(container_id) )
				{
					var container_jqo = $('#' + container_id);
					if (container_jqo)
					{
						DevaptNavHistory.history_breadcrumbs_name = breadcrumbs;
						
						// console.log(container_jqo, 'breadcrumbs container_jqo');
						
						var render_promise = backend.render_view(container_jqo, breadcrumbs);
						
						breadcrumbs_promise = render_promise.then(
							function(view)
							{
								if ( ! DevaptTypes.is_object(view) || ! view.is_view )
								{
									DevaptTrace.trace_step(context, 'ERROR: resource view is not a valid object', DevaptApplication.app_trace);
									return;
								}
								
								DevaptNavHistory.history_breadcrumbs_object = view;
								view.add_event_callback('nav-history.add',
									[view, view.on_nav_history_add],
									false
								);
							}
						);
					}
				}
			}
			
			
			var all_promise = [];
			if (topmenubar_promise)
			{
				all_promise.push(topmenubar_promise);
			}
			if (breadcrumbs_promise)
			{
				all_promise.push(breadcrumbs_promise);
			}
			
			DevaptTrace.trace_leave(context, Devapt.msg_success_promise, DevaptApplication.app_trace);
			return Devapt.promise_all(all_promise);
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		DevaptTrace.trace_leave(context, Devapt.msg_failure_promise, DevaptApplication.app_trace);
		return Devapt.promise_rejected();
	}
	
	
	/**
	 * @memberof				DevaptApplication
	 * @public
	 * @static
	 * @method					DevaptApplication.get_value(arg_path)
	 * @desc					Get application configuration value
	 * @param {string}			arg_value_path	Value path (aaa.bb.ccc.dd)
	 * @param {anything}		arg_default_value	Default value
	 * @return {anything}		Configuration value or null if not found
	 */
	DevaptApplication.get_value = function(arg_value_path, arg_default_value)
	{
		var context = 'DevaptApplication.get_value(value path, default value)';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		
		var path_array = arg_value_path.split('.');
		var path_node = DevaptApplication.app_config;
		for(var path_node_index in path_array)
		{
			var path_node_value = path_array[path_node_index];
			if ( path_node_index == 0 && path_node_value === 'application' )
			{
				continue;
			}
			
			if ( path_node[path_node_value] )
			{
				path_node = path_node[path_node_value];
				continue;
			}
			
			DevaptTrace.trace_leave(context, 'not found, returns default value', DevaptApplication.app_trace);
			return arg_default_value;
		}
		
		if ( path_node === DevaptApplication.app_config )
		{
			DevaptTrace.trace_leave(context, 'not found, returns default value', DevaptApplication.app_trace);
			return arg_default_value;
		}
		
		
		DevaptTrace.trace_leave(context, 'found', DevaptApplication.app_trace);
		return path_node;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_url_base()
	 * @desc				Get application configuration base url "application.url.base"
	 * @return {string}		Application base url
	 */
	DevaptApplication.get_url_base = function()
	{
		var context = 'DevaptApplication.get_url_base()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('url.base', null);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_title()
	 * @desc				Get application configuration "application.title"
	 * @return {string}		Application topbar name
	 */
	DevaptApplication.get_title = function()
	{
		var context = 'DevaptApplication.get_title()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('title', null);
		DevaptTrace.trace_var(context, 'title', value, DevaptApplication.app_trace);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_name()
	 * @desc				Get application configuration "application.name"
	 * @return {string}		Application topbar name
	 */
	DevaptApplication.get_name = function()
	{
		var context = 'DevaptApplication.get_name()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('name', null);
		DevaptTrace.trace_var(context, 'name', value, DevaptApplication.app_trace);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_short_label()
	 * @desc				Get application configuration "application.short_label"
	 * @return {string}		Application topbar name
	 */
	DevaptApplication.get_short_label = function()
	{
		var context = 'DevaptApplication.get_short_label()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('short_label', null);
		DevaptTrace.trace_var(context, 'short_label', value, DevaptApplication.app_trace);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_long_label()
	 * @desc				Get application configuration "application.long_label"
	 * @return {string}		Application topbar name
	 */
	DevaptApplication.get_long_label = function()
	{
		var context = 'DevaptApplication.get_long_label()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('long_label', null);
		DevaptTrace.trace_var(context, 'long_label', value, DevaptApplication.app_trace);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_version()
	 * @desc				Get application configuration "application.version"
	 * @return {string}		Application topbar name
	 */
	DevaptApplication.get_version = function()
	{
		var context = 'DevaptApplication.get_version()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('version', null);
		DevaptTrace.trace_var(context, 'version', value, DevaptApplication.app_trace);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_home_view_hash()
	 * @desc				Get application home locatio  hash
	 * @return {string}		Application location hash
	 */
	DevaptApplication.get_home_view_hash = function()
	{
		var context = 'DevaptApplication.get_home_view_hash()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var home_view = DevaptApplication.get_value('layouts.default.content.name', null);
		var menubar_view = DevaptApplication.get_value('layouts.default.topbar.name', null);
		var page_title = 'HOME';
		var content_label = 'HOME';
		var hash = 'view:' + home_view + ':' + page_title + ':' + content_label + ':' + menubar_view;
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return hash;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_home_view_url()
	 * @desc				Get application configuration home url "application.url.home"
	 * @return {string}		Application base url
	 */
	DevaptApplication.get_home_view_url = function()
	{
		var context = 'DevaptApplication.get_home_view_url()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var url_base = DevaptApplication.get_value('url.base', null);
		var value = url_base + DevaptApplication.get_value('url.home', null);
		value = value.replace('//', '/');
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_login_view_url()
	 * @desc				Get application configuration login url "application.url.login"
	 * @return {string}		Application base url
	 */
	DevaptApplication.get_login_view_url = function()
	{
		var context = 'DevaptApplication.get_login_view_url()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('url.login', null);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_home_view_url()
	 * @desc				Get application configuration home url "application.url.home"
	 * @return {string}		Application base url
	 */
	DevaptApplication.get_content_id = function()
	{
		var context = 'DevaptApplication.get_content_id()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('layouts.default.content.id', null);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_topbar_name()
	 * @desc				Get application configuration "application.layouts.default.topbar.name"
	 * @return {string}		Application topbar name
	 */
	DevaptApplication.get_topbar_name = function()
	{
		var context = 'DevaptApplication.get_topbar_name()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('layouts.default.topbar.name', null);
		DevaptTrace.trace_var(context, 'topbar.name', value, DevaptApplication.app_trace);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_topbar_container_id()
	 * @desc				Get application configuration "application.layouts.default.topbar.container_id"
	 * @return {string}		Application topbar name
	 */
	DevaptApplication.get_topbar_container_id = function()
	{
		var context = 'DevaptApplication.get_topbar_container_id()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('layouts.default.topbar.container_id', null);
		DevaptTrace.trace_var(context, 'topbar.container_id', value, DevaptApplication.app_trace);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_breadcrumbs_name()
	 * @desc				Get application configuration "application.layouts.default.breadcrumbs.name"
	 * @return {string}		Application breadcrumbs name
	 */
	DevaptApplication.get_breadcrumbs_name = function()
	{
		var context = 'DevaptApplication.get_breadcrumbs_name()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('layouts.default.breadcrumbs.name', null);
		DevaptTrace.trace_var(context, 'breadcrumbs.container_id', value, DevaptApplication.app_trace);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_breadcrumbs_container_id()
	 * @desc				Get application configuration "application.layouts.default.breadcrumbs.container_id"
	 * @return {string}		Application breadcrumbs container html id
	 */
	DevaptApplication.get_breadcrumbs_container_id = function()
	{
		var context = 'DevaptApplication.get_breadcrumbs_container_id()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('layouts.default.breadcrumbs.container_id', null);
		DevaptTrace.trace_var(context, 'breadcrumbs.container_id', value, DevaptApplication.app_trace);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_client_plugins()
	 * @desc				Get application configuration "application.plugins.client"
	 * @return {array}		Application client plugins
	 */
	DevaptApplication.get_client_plugins = function()
	{
		var context = 'DevaptApplication.get_client_plugins()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		var value = DevaptApplication.get_value('plugins.client', {});
		DevaptTrace.trace_var(context, 'client plugins', value, DevaptApplication.app_trace);
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_logged_user()
	 * @desc				Get logged user record
	 * @return {object}
	 */
	DevaptApplication.get_logged_user = function()
	{
		var context = 'DevaptApplication.get_logged_user()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		
		var record = DevaptSecurity.get_logged_user();
		DevaptTrace.trace_var(context, 'logged_user', record, DevaptApplication.app_trace);
		
		
		DevaptTrace.trace_leave(context, Devapt.msg_success, DevaptApplication.app_trace);
		return record;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.get_security_token()
	 * @desc				Get security user
	 * @return {string}
	 */
	DevaptApplication.get_security_token = function()
	{
		var context = 'DevaptApplication.get_security_token()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		
		var record = DevaptApplication.get_logged_user();
		if ( ! record || ! record.token )
		{
			DevaptTrace.trace_leave(context, Devapt.msg_failure, DevaptApplication.app_trace);
			return null;
		}
		DevaptTrace.trace_var(context, 'security token', record.token, DevaptApplication.app_trace);
		
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return record.token;
	}
	
	
	/**
	 * @memberof			DevaptApplication
	 * @public
	 * @static
	 * @method				DevaptApplication.check_authentication()
	 * @desc				Test if a user is logged
	 * @return {boolean}
	 */
	DevaptApplication.check_authentication = function()
	{
		var context = 'DevaptApplication.check_authentication()';
		DevaptTrace.trace_enter(context, '', DevaptApplication.app_trace);
		
		
		// TEST IF AUTHENTICATION IS ENABLED 
		var value = DevaptApplication.get_value('security.authentication.enabled', true);
		if (value)
		{
			// GET LOGGED USER RECORD
			var record = DevaptApplication.get_logged_user();
			if ( ! record || ! record.token )
			{
				DevaptTrace.trace_leave(context, Devapt.msg_failure, DevaptApplication.app_trace);
				return false;
			}
			
			// CHECK RECORD IS OK AND HAS TOKEN
			value = record.status === 'ok' && DevaptTypes.is_not_empty_str(record.token);
			DevaptTrace.trace_var(context, 'check authentication status and token', value, DevaptApplication.app_trace);
			
			// CHECK EXPIRATION
			var ts = Date.now();
			value = value && record.expire*1000 > ts;
			DevaptTrace.trace_var(context, 'check authentication expiration', record.expire < ts, DevaptApplication.app_trace);
		}
		DevaptTrace.trace_var(context, 'check expire', !!value, DevaptApplication.app_trace);
		
		
		DevaptTrace.trace_leave(context, '', DevaptApplication.app_trace);
		return !!value;
	}
	
	
	Devapt.app = DevaptApplication;
	
	
	return DevaptApplication;
} );
/**
 * @file        core/cache.js
 * @desc        Devapt static cache features
 * @ingroup     DEVAPT_CORE
 * @date        2013-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */

define('core/cache',['Devapt', 'core/traces', 'core/types', 'jStorage'],
function(Devapt, DevaptTrace, DevaptTypes, JStorage)
{
	/**
	 * @memberof	DevaptCache
	 * @public
	 * @class
	 * @desc		Devapt cache features container
	 */
	var DevaptCache = function() {};
	
	
	/**
	 * @memberof	DevaptCache
	 * @public
	 * @static
	 * @desc		Trace flag
	 */
	DevaptCache.cache_trace = false;
	
	
	/**
	 * @memberof	DevaptCache
	 * @public
	 * @static
	 * @desc		Default TTL value
	 */
	DevaptCache.cache_default_ttl = 0; // 0 for Production, 5000 for DEV
	
	
	/**
	 * @memberof			DevaptCache
	 * @public
	 * @static
	 * @method				DevaptCache.get_from_cache(arg_key, arg_default)
	 * @desc				Get a value from cache
	 * @param {string}		arg_key			name of the value
	 * @param {mixed}		arg_default		default value
	 * @return {mixed}		Found value or default value
	 */
	DevaptCache.get_from_cache = function(arg_key, arg_default)
	{
		var context = 'DevaptCache.get(key,default)';
		DevaptTrace.trace_enter(context, '', DevaptCache.cache_trace);
		
		
		// var value = Devapt.jQuery().jStorage.get(arg_key, arg_default);
		var value = JStorage.get(arg_key, arg_default);
		if (!value)
		{
			DevaptTrace.trace_leave(context, 'not found', DevaptCache.cache_trace);
			return false;
		}
		
		
		DevaptTrace.trace_leave(context, 'found', DevaptCache.cache_trace);
		return value;
	}
	
	
	/**
	 * @memberof			DevaptCache
	 * @public
	 * @static
	 * @method				DevaptCache.has_into_cache(arg_key)
	 * @desc				Test if a value is registered for a key into cache
	 * @param {string}		arg_key			name of the value
	 * @return {boolean}
	 */
	DevaptCache.has_into_cache = function(arg_key)
	{
		var context = 'DevaptCache.has_into_cache(key)';
		DevaptTrace.trace_enter(context, '', DevaptCache.cache_trace);
		
		// var value = $.jStorage.get(arg_key, null);
		var value = JStorage.get(arg_key, null);
		
		DevaptTrace.trace_leave(context, '', DevaptCache.cache_trace);
		return ! DevaptTypes.is_null(value);
	}
	
	
	/**
	 * @memberof			Libapt
	 * @public
	 * @static
	 * @method				DevaptCache.set_into_cache(arg_key, arg_value, arg_ttl)
	 * @desc				Register a value into cache
	 * @param {string}		arg_key			name of the value
	 * @param {mixed}		arg_value		value
	 * @param {integer}		arg_ttl			remaining TTL (in milliseconds) or 0 for no TTL
	 * @return {boolean}
	 */
	DevaptCache.set_into_cache = function(arg_key, arg_value, arg_ttl)
	{
		var context = 'DevaptCache.set_into_cache(key,value,ttl)';
		DevaptTrace.trace_enter(context, '', DevaptCache.cache_trace);
		
		
		var options = DevaptTypes.is_number(arg_ttl) ? { 'TTL': arg_ttl } : { 'TTL': DevaptCache.cache_default_ttl };
		// var result = $.jStorage.set(arg_key, arg_value, options);
		var result = JStorage.set(arg_key, arg_value, options);
		if (!result)
		{
			DevaptTrace.trace_leave(context, 'failure', LibaptCache.cache_trace);
			return false;
		}
		
		
		DevaptTrace.trace_leave(context, '', DevaptCache.cache_trace);
		return true;
	}


	/**
	 * @memberof			DevaptCache
	 * @public
	 * @static
	 * @method				DevaptCache.set_ttl_into_cache(arg_key, arg_ttl)
	 * @desc				Set TTL of a cache record for a key
	 * @param {string}		arg_key			name of the value
	 * @param {integer}		arg_ttl			remaining TTL (in milliseconds) or 0 for no TTL
	 * @return {boolean}
	 */
	DevaptCache.set_ttl_into_cache = function(arg_key, arg_ttl)
	{
		var context = 'DevaptCache.set_ttl_into_cache(key,value,ttl)';
		DevaptTrace.trace_enter(context, '', DevaptCache.cache_trace);
		
		// var result = $.jStorage.setTTL(arg_key, arg_ttl);
		var result = JStorage.setTTL(arg_key, arg_ttl);
		
		DevaptTrace.trace_leave(context, '', DevaptCache.cache_trace);
		return result;
	}


	/**
	 * @memberof			DevaptCache
	 * @public
	 * @static
	 * @method				DevaptCache.delete_from_cache(arg_key)
	 * @desc				Delete a value from cache
	 * @param {string}		arg_key			name of the value
	 * @return {boolean}
	 */
	DevaptCache.delete_from_cache = function(arg_key)
	{
		var context = 'DevaptCache.delete_from_cache(key)';
		DevaptTrace.trace_enter(context, '', DevaptCache.cache_trace);
		
		// var result = $.jStorage.deleteKey(arg_key);
		var result = JStorage.deleteKey(arg_key);
		
		DevaptTrace.trace_leave(context, '', DevaptCache.cache_trace);
		return result;
	}
	
	return DevaptCache;
} );
/**
 * @file        core/compatibility.js
 * @desc        Devapt static compatibility features
 * @ingroup     DEVAPT_CORE
 * @date        2013-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */

define('core/compatibility',['Devapt'], function(Devapt)
{

	/**
	 * @public
	 * @method				Function.prototype.name
	 * @desc				Get the prototype/class name for IE 9
	 * @return {string}
	 */
	if (Function.prototype.name === undefined)
	{
		if (Object.defineProperty !== undefined)
		{
			// IE8 : Object.defineProperty exists but only accept DOM object
			try
			{
				Object.defineProperty(Function.prototype, 'name',
					{
						get: function()
							{
								var funcNameRegex = /function\s+(.{1,})\s*\(/;
								var results = funcNameRegex.exec(this.toString());
								return (results && results.length > 1) ? results[1] : "";
							},
						set: function(value) {}
					}
				);
			}
			catch(e)
			{
				if (typeof console === "undefined" || typeof console.log === "undefined")
				{
					alert('ERROR Function.prototype.name is not defined !!!');
				}
				else
				{
					console.log('ERROR Function.prototype.name is not defined !!!');
				}
				// throw 'ERROR Function.prototype.name is not defined !!!';
			}
		}
	}


	/**
	 * @public
	 * @method				Array.forEach(fn, scope)
	 * @desc				Register the forEach method if needed
	 * @param {function}	fn
	 * @param {object}		scope
	 * @return {nothing}
	 */
	if (Array.prototype.forEach === undefined)
	{
		Array.prototype.forEach = function(fun) // function(fun, scope)
			{
				var len = this.length;
				if (typeof fun != "function")
				{
					console.log(fun);
					throw new TypeError();
				}
				
				var scope = arguments[1];
				for (var i = 0; i < len; i++)
				{
					if (i in this)
					{
						fun.call(scope, this[i], i, this);
					}
				}
			};
	/*	Array.prototype.forEach =
			function (fn, scope)
			{
				'use strict';
				var i, len;
				for (i = 0, len = this.length; i < len; ++i)
				{
					if (i in this)
					{
						fn.call(scope, this[i], i, this);
					}
				}
			};*/
	}



	/**
	 * @public
	 * @method				Object.keys(obj)
	 * @desc				Register the keys method if needed
	 * @param {object}		obj		Object value
	 * @return {array}		Array of object attributes names
	 */
	if (typeof Object.keys == "undefined")
	{
		Object.keys =
			function(obj)
			{
				var props=[];
				for(var p in obj)
				{
					if (obj.propertyIsEnumerable(p))
					{
						props.push(p);
					}
				}
				return props;
			};
	}



	/**
	 * @public
	 * @method				Object.values(obj)
	 * @desc				Register the values method if needed
	 * @param {object}		obj		Object value
	 * @return {array}		Array of object attributes values
	 */
	if (typeof Object.values == "undefined")
	{
		Object.values =
			function(obj)
			{
				var props=[];
				for(var p in obj)
				{
					if (obj.propertyIsEnumerable(p))
					{
						props.push(obj[p]);
					}
				}
				return props;
			};
	}



	/**
	 * @public
	 * @method				Array.every(arg_test_callback)
	 * @desc				Test if all items of the array pass the given test
	 * @param {object}		arg_test_callback		Test function
	 * @return {boolean}	Test result
	 */
	if ( ! Array.prototype.every )
	{
		Array.prototype.every = function(arg_test_callback /*, thisp */)
		{
			'use strict';
			var t, len, i, thisp;

			if (this == null)
			{
				throw new TypeError();
			}
			
			t = Object(this);
			len = t.length >>> 0;
			if (typeof fun !== 'function')
			{
				throw new TypeError();
			}
			
			thisp = arguments[1];
			for (i = 0; i < len; i++)
			{
				if (i in t && ! fun.call(thisp, t[i], i, t) )
				{
					return false;
				}
			}
			
			return true;
		};
	}

	return Devapt;
} );
/**
 * @file        core/resources.js
 * @desc        Devapt resources loading features
 * 		API
 * 			STATIC PUBLIC ATTRIBUTES
 * 				DevaptResources.resources_trace = false
 * 				DevaptResources.resources_ajax_timeout = 5000
 * 				DevaptResources.resources_promises_by_name = {}
 * 				DevaptResources.resources_providers = []
 * 				
 * 			STATIC PUBLIC METHODS
 * 				DevaptResources.add_cached_declaration(arg_resource_json):boolean
 * 				DevaptResources.get_cached_declaration(arg_resource_name):object|null
 * 				DevaptResources.get_resource_declaration(arg_resource_name):promise
 * 				DevaptResources.get_resource_instance(arg_resource_name):promise
 * 				DevaptResources.build_from_declaration(arg_resource_json):promise
 * 				DevaptResources.init_default_providers():nothing
 * 				
 * @ingroup     DEVAPT_CORE
 * @date        2014-04-21
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'core/resources',['Devapt', 'core/traces', 'core/types', 'object/classes', 'core/cache'],
function(Devapt, DevaptTraces, DevaptTypes, DevaptClasses, DevaptCache)
{
	/**
	 * @memberof	DevaptResources
	 * @public
	 * @class
	 * @desc		Devapt resources loading features container
	 */
	var DevaptResources = function() {};
	
	/**
	 * @memberof	DevaptResources
	 * @public
	 * @static
	 * @desc		Trace flag
	 */
	DevaptResources.resources_trace = false;
	
	/**
	 * @memberof	DevaptResources
	 * @public
	 * @static
	 * @desc		Ajax timeout
	 */
	DevaptResources.resources_ajax_timeout = 5000;
	
	/**
	 * @memberof	DevaptResources
	 * @public
	 * @static
	 * @desc		Resources promises repository (access by name)
	 */
	DevaptResources.resources_promises_by_name = {};
	
	/**
	 * @memberof	DevaptResources
	 * @public
	 * @static
	 * @desc		Storage engines for resources providers: callbacks as "call(resource name, ok_cb, ko_cb) -> boolean"
	 */
	DevaptResources.resources_providers = [];
	
	
	
	/**
	 * @memberof					DevaptResources
	 * @public
	 * @static
	 * @method						DevaptResources.add_cached_declaration(arg_resource_json)
	 * @desc						Add a resource declaration to the resources cache
	 * @param {object}				arg_resource_json	The resource declaration (json object)
	 * @return {boolean}			success of failure
	 */
	DevaptResources.add_cached_declaration = function (arg_resource_json)
	{
		var context = 'DevaptResources.add_cached_declaration(arg_resource_json)';
		DevaptTraces.trace_enter(context, '', DevaptResources.resources_trace);
		
		
		// CHECK ARGS
		if ( ! DevaptTypes.is_object(arg_resource_json) )
		{
			DevaptTraces.trace_error(context, 'bad args', DevaptResources.resources_trace);
			return false;
		}
		
		// GET RESOURCE NAME
		var resource_name = 'devapt.resources.' + arg_resource_json['name'];
		if ( ! DevaptTypes.is_string(resource_name) || resource_name === '' )
		{
			DevaptTraces.trace_error(context, 'bad resource name', DevaptResources.resources_trace);
			return false;
		}
		
		// REGISTER RESOURCE
		DevaptCache.set_into_cache(resource_name, arg_resource_json);
		
		
		DevaptTraces.trace_leave(context, 'success', DevaptResources.resources_trace);
		return true;
	}
	
	
	
	/**
	 * @memberof					DevaptResources
	 * @public
	 * @static
	 * @method						DevaptResources.get_cached_declaration(arg_resource_name)
	 * @desc						Get a resource declaration from the resources cache
	 * @param {string}				arg_resource_name	The resource name
	 * @return {object|null}		A json object
	 */
	DevaptResources.get_cached_declaration = function (arg_resource_name)
	{
		var context = 'DevaptResources.get_cached_declaration(resoure name)';
		DevaptTraces.trace_enter(context, '', DevaptResources.resources_trace);
		
		
		// CHECK RESOURCE NAME
		if ( ! DevaptTypes.is_string(arg_resource_name) || arg_resource_name === '' )
		{
			DevaptTraces.trace_error(context, 'bad resource name', DevaptResources.resources_trace);
			return null;
		}
		
		// REGISTER RESOURCE
		var resource_name = 'devapt.resources.' + arg_resource_name;
		var resource_declaration = DevaptCache.get_from_cache(resource_name, null);
		
		
		DevaptTraces.trace_leave(context, (DevaptTypes.is_null(resource_declaration) ? 'not found' : 'success'), DevaptResources.resources_trace);
		return resource_declaration;
	}
	
	
	
	/**
	 * @memberof					DevaptResources
	 * @public
	 * @static
	 * @method						DevaptResources.get_resource_declaration(arg_resource_name)
	 * @desc						Get a resource declaration
	 * @param {string}				arg_resource_name	The resource name
	 * @param {object}				arg_deferred		An optional deferred object
	 * @return {object}				A promise of a json object
	 */
	DevaptResources.get_resource_declaration = function (arg_resource_name, arg_deferred)
	{
		var context = 'DevaptResources.get_resource_declaration(' + arg_resource_name + ')';
		DevaptTraces.trace_enter(context, '', DevaptResources.resources_trace);
		
		
		// CHECK RESOURCE NAME
		if ( ! DevaptTypes.is_string(arg_resource_name) || arg_resource_name === '' )
		{
			DevaptTraces.trace_error(context, 'bad resource name', DevaptResources.resources_trace);
			return Devapt.promise_rejected('bad resource name');
		}
		
		
		// CHECK PROVIDERS
		if ( ! DevaptTypes.is_not_empty_array(DevaptResources.resources_providers) )
		{
			DevaptTraces.trace_leave(context, 'no resources provider', DevaptResources.resources_trace);
			return Devapt.promise_rejected('no resources provider');
		}
		
		
		// CLONE THE ARRAY
		var providers = DevaptResources.resources_providers.slice();
		
		
		// LOOK UP CALLBACK
		var invoke_cb =
			function(arg_deferred, arg_resource_name, arg_providers)
			{
				var cb_context = context + '.invoke provider cb';
				DevaptTraces.trace_enter(cb_context, '', DevaptResources.resources_trace);
				
				// FOUND CALLBACK: RESOLVE GIVEN DEFERRED
				var promise_success_cb =
					function(arg_promise_result)
					{
						DevaptTraces.trace_leave(cb_context, 'promise success', DevaptResources.resources_trace);
						
						DevaptTraces.trace_info(cb_context, 'resource found for [' + arg_resource_name + ']', true);
						arg_deferred.resolve(arg_promise_result);
						
						DevaptTraces.trace_var(cb_context, 'promise success: arg_promise_result', arg_promise_result, DevaptResources.resources_trace);
					};
				
				// NOT FOUND CALLBACK: CALL NEXT SEARCH CALLBACK
				var promise_failure_cb =
					function(arg_promise_result)
					{
						DevaptTraces.trace_step(cb_context, 'promise failure: call next provider', DevaptResources.resources_trace);
						
						invoke_cb(arg_deferred, arg_resource_name, arg_providers);
						
						DevaptTraces.trace_leave(cb_context, 'promise failure: no more provider', DevaptResources.resources_trace);
					};
				
				// PROGRESS CALLBACK; UNUSED
				var promise_progress_cb = null;
				
				// GET NEXT SEARCH CALLBACK
				var next_provider_cb = arg_providers.shift();
				if (next_provider_cb)
				{
					// CALL NEXT SEARCH CALLBACK
					var promise = next_provider_cb(arg_resource_name, arg_deferred);
					promise.then(promise_success_cb, promise_failure_cb, promise_progress_cb);
					
					DevaptTraces.trace_leave(cb_context, 'call next provider: async request', DevaptResources.resources_trace);
					return;
				}
				
				// NOT FOUND AND NO MORE CALLBACK
				DevaptTraces.trace_warn(cb_context, 'resource not found for [' + arg_resource_name + ']', true);
				DevaptTraces.trace_leave(cb_context, 'not found: no more provider', DevaptResources.resources_trace);
			};
		
		
		// FIRST SEARCH CALL
		var master_deferred = Devapt.is_defer(arg_deferred) ? arg_deferred : Devapt.defer();
		invoke_cb(master_deferred, arg_resource_name, providers);
		
		
		DevaptTraces.trace_leave(context, 'resource promise', DevaptResources.resources_trace);
		return Devapt.promise(master_deferred);
	}
	
	
	
	/**
	 * @memberof					DevaptResources
	 * @public
	 * @static
	 * @method						DevaptResources.get_resource_instance(arg_resource_name)
	 * @desc						Get a resource instance from the resources repositories
	 * @param {string}				arg_resource_name	The resource name
	 * @return {object}				A promise of a resource object
	 */
	DevaptResources.get_resource_instance = function (arg_resource_name)
	{
		var context = 'DevaptResources.get_resource_instance(' + arg_resource_name + ')';
		DevaptTraces.trace_enter(context, '[' + arg_resource_name + ']', DevaptResources.resources_trace);
		
		
		// CHECK RESOURCE NAME
		if ( ! DevaptTypes.is_not_empty_str(arg_resource_name) )
		{
			DevaptTraces.trace_leave(context, 'failure: promise is rejected: arg is not a string', DevaptResources.resources_trace);
			return Devapt.promise_rejected('resource name is not a valid string');
		}
		
		
		// GET RESOURCE FROM REPOSITORY
		// var resource_instance = DevaptResources.resources_instances_by_name[arg_resource_name];
		DevaptTraces.trace_step(context, 'get resource from repository', DevaptResources.resources_trace);
		var resource_instance = DevaptClasses.get_instance(arg_resource_name);
		if ( DevaptTypes.is_object(resource_instance) )
		{
			DevaptTraces.trace_leave(context, 'promise is resolved: resource found', DevaptResources.resources_trace);
			return Devapt.promise_resolved(resource_instance);
		}
		
		
		// A PROMISE ALREADY EXISTS
		DevaptTraces.trace_step(context, 'test if a promise already exists for the resource', DevaptResources.resources_trace);
		var existing_promise = DevaptResources.resources_promises_by_name[arg_resource_name];
		if ( DevaptTypes.is_object(existing_promise) )
		{
			DevaptTraces.trace_leave(context, 'a promise already exists', DevaptResources.resources_trace);
			return existing_promise;
		}
		if ( ! DevaptTypes.is_null(existing_promise) )
		{
			console.log(existing_promise, 'existing_promise');
		}
		
		
		// CREATE INSTANCE PROMISE
		DevaptTraces.trace_step(context, 'create and register an instance promise', DevaptResources.resources_trace);
		var repo_instance_deferred = Devapt.defer();
		var repo_instance_promise = Devapt.promise(repo_instance_deferred);
		DevaptResources.resources_promises_by_name[arg_resource_name] = repo_instance_promise;
		
		
		// GET RESOURCE DECLARATION AND BUILD RESOURCE
		DevaptTraces.trace_step(context, 'get resource declaration promise', DevaptResources.resources_trace);
		var declaration_promise = DevaptResources.get_resource_declaration(arg_resource_name);
		
		var build_instance_promise = declaration_promise.then(
			function(arg_declaration)
			{
				// BUILD RESOURCE INSTANCE FROM RESOURCE DECLARATION
				DevaptTraces.trace_step(context, 'promise is resolved: resource declaration is found', DevaptResources.resources_trace);
				// console.log(arg_declaration, 'resource declaration');
				var class_id = arg_declaration.class_name ? arg_declaration.class_name : arg_declaration.class_type;
				
				return Devapt.create(class_id, arg_declaration);
			}
		);
		
		build_instance_promise.then(
			function(arg_instance)
			{
				// REMOVE WAITING PROMISE
				DevaptResources.resources_promises_by_name[arg_resource_name] = null;
				delete DevaptResources.resources_promises_by_name[arg_resource_name];
				
				DevaptTraces.trace_step(context, 'remove promise from resource promises repository', DevaptResources.resources_trace);
				
				repo_instance_deferred.resolve(arg_instance);
			}
		);
		
		
		DevaptTraces.trace_leave(context, 'resource build is async', DevaptResources.resources_trace);
		return repo_instance_promise;
	}
	
	
	
	/**
	 * @memberof				DevaptResources
	 * @public
	 * @static
	 * @method					DevaptResources.init_default_providers()
	 * @desc					Get a resource from the resources repositories
	 * @param {string}			arg_resource_name	The resource name
	 * @return {nothing}
	 */
	DevaptResources.init_default_providers = function ()
	{
		var context = 'DevaptResources.init_default_providers()';
		DevaptTraces.trace_enter(context, '', DevaptResources.resources_trace);
		
		
		require(['core/application'], function(DevaptApplication)
			{
				// GET APP BASE URL
				var url_base = Devapt.app.get_url_base();
				
				// SET CACHE PROVIDER
				var cache_provider = function(arg_resource_name)
					{
						var context = 'DevaptResources.cache_provider(' + arg_resource_name + ')';
						DevaptTraces.trace_enter(context + '.cache provider', '', DevaptResources.resources_trace);
						
						
						// GET RESOURCE DECLARATION FROM CACHE
						var resource_declaration = DevaptResources.get_cached_declaration(arg_resource_name);
						if (resource_declaration)
						{
							DevaptTraces.trace_leave(context + '.cache provider', 'resource declaration found from cache', DevaptResources.resources_trace);
							return Devapt.promise_resolved(resource_declaration);
						}
						
						DevaptTraces.trace_leave(context + '.cache provider', 'resource declaration not found from cache', DevaptResources.resources_trace);
						return Devapt.promise_rejected();
					};
				
				// SET JSON PROVIDERS
				var json_provider = function(arg_resource_name)
					{
						var context = 'DevaptResources.json_provider(' + arg_resource_name + ')';
						DevaptTraces.trace_enter(context + '.json provider', '', DevaptResources.resources_trace);
						
						
						// INIT REQUEST ARGS
						var url = url_base + 'resources/' + arg_resource_name + '/get_resource';
						var options =
						{
							dataType	: 'json',
							timeout		: DevaptResources.resources_ajax_timeout
						};
						
						// SEND REQUEST
						var ajax_promise = Devapt.ajax_get(url, null, options, Devapt.app.get_security_token());
						
						
						DevaptTraces.trace_leave(context + '.json provider', 'async request', DevaptResources.resources_trace);
						return ajax_promise;
					};
				
				
				// REGISTER JSON PROVIDERS
				DevaptResources.resources_providers.push(cache_provider);
				DevaptResources.resources_providers.push(json_provider);
			}
		);
		
		
		DevaptTraces.trace_leave(context, '', DevaptResources.resources_trace);
	}
	
	
	DevaptResources.init_default_providers();
	
	
	return DevaptResources;
});
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

/*global define: false*/

(function (global, factory) {
  if (typeof exports === "object" && exports) {
    factory(exports); // CommonJS
  } else if (typeof define === "function" && define.amd) {
    define('mustache', [], factory({})); // AMD
  } else {
    global.Mustache = factory({}); // <script>
  }
}(this, function (mustache) {

  var Object_toString = Object.prototype.toString;
  var isArray = Array.isArray || function (object) {
    return Object_toString.call(object) === '[object Array]';
  };

  function isFunction(object) {
    return typeof object === 'function';
  }

  function escapeRegExp(string) {
    return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&");
  }

  // Workaround for https://issues.apache.org/jira/browse/COUCHDB-577
  // See https://github.com/janl/mustache.js/issues/189
  var RegExp_test = RegExp.prototype.test;
  function testRegExp(re, string) {
    return RegExp_test.call(re, string);
  }

  var nonSpaceRe = /\S/;
  function isWhitespace(string) {
    return !testRegExp(nonSpaceRe, string);
  }
  
  var entityMap = {
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': '&quot;',
    "'": '&#39;',
    "/": '&#x2F;'
  };

  function escapeHtml(string) {
    return String(string).replace(/[&<>"'\/]/g, function (s) {
      return entityMap[s];
    });
  }

  var whiteRe = /\s*/;
  var spaceRe = /\s+/;
  var equalsRe = /\s*=/;
  var curlyRe = /\s*\}/;
  var tagRe = /#|\^|\/|>|\{|&|=|!/;

  /**
   * Breaks up the given `template` string into a tree of tokens. If the `tags`
   * argument is given here it must be an array with two string values: the
   * opening and closing tags used in the template (e.g. [ "<%", "%>" ]). Of
   * course, the default is to use mustaches (i.e. mustache.tags).
   *
   * A token is an array with at least 4 elements. The first element is the
   * mustache symbol that was used inside the tag, e.g. "#" or "&". If the tag
   * did not contain a symbol (i.e. {{myValue}}) this element is "name". For
   * all text that appears outside a symbol this element is "text".
   *
   * The second element of a token is its "value". For mustache tags this is
   * whatever else was inside the tag besides the opening symbol. For text tokens
   * this is the text itself.
   *
   * The third and fourth elements of the token are the start and end indices,
   * respectively, of the token in the original template.
   *
   * Tokens that are the root node of a subtree contain two more elements: 1) an
   * array of tokens in the subtree and 2) the index in the original template at
   * which the closing tag for that section begins.
   */
  function parseTemplate(template, tags) {
    if (!template)
      return [];

    var sections = [];     // Stack to hold section tokens
    var tokens = [];       // Buffer to hold the tokens
    var spaces = [];       // Indices of whitespace tokens on the current line
    var hasTag = false;    // Is there a {{tag}} on the current line?
    var nonSpace = false;  // Is there a non-space char on the current line?

    // Strips all whitespace tokens array for the current line
    // if there was a {{#tag}} on it and otherwise only space.
    function stripSpace() {
      if (hasTag && !nonSpace) {
        while (spaces.length)
          delete tokens[spaces.pop()];
      } else {
        spaces = [];
      }

      hasTag = false;
      nonSpace = false;
    }

    var openingTagRe, closingTagRe, closingCurlyRe;
    function compileTags(tags) {
      if (typeof tags === 'string')
        tags = tags.split(spaceRe, 2);

      if (!isArray(tags) || tags.length !== 2)
        throw new Error('Invalid tags: ' + tags);

      openingTagRe = new RegExp(escapeRegExp(tags[0]) + '\\s*');
      closingTagRe = new RegExp('\\s*' + escapeRegExp(tags[1]));
      closingCurlyRe = new RegExp('\\s*' + escapeRegExp('}' + tags[1]));
    }

    compileTags(tags || mustache.tags);

    var scanner = new Scanner(template);

    var start, type, value, chr, token, openSection;
    while (!scanner.eos()) {
      start = scanner.pos;

      // Match any text between tags.
      value = scanner.scanUntil(openingTagRe);

      if (value) {
        for (var i = 0, valueLength = value.length; i < valueLength; ++i) {
          chr = value.charAt(i);

          if (isWhitespace(chr)) {
            spaces.push(tokens.length);
          } else {
            nonSpace = true;
          }

          tokens.push([ 'text', chr, start, start + 1 ]);
          start += 1;

          // Check for whitespace on the current line.
          if (chr === '\n')
            stripSpace();
        }
      }

      // Match the opening tag.
      if (!scanner.scan(openingTagRe))
        break;

      hasTag = true;

      // Get the tag type.
      type = scanner.scan(tagRe) || 'name';
      scanner.scan(whiteRe);

      // Get the tag value.
      if (type === '=') {
        value = scanner.scanUntil(equalsRe);
        scanner.scan(equalsRe);
        scanner.scanUntil(closingTagRe);
      } else if (type === '{') {
        value = scanner.scanUntil(closingCurlyRe);
        scanner.scan(curlyRe);
        scanner.scanUntil(closingTagRe);
        type = '&';
      } else {
        value = scanner.scanUntil(closingTagRe);
      }

      // Match the closing tag.
      if (!scanner.scan(closingTagRe))
        throw new Error('Unclosed tag at ' + scanner.pos);

      token = [ type, value, start, scanner.pos ];
      tokens.push(token);

      if (type === '#' || type === '^') {
        sections.push(token);
      } else if (type === '/') {
        // Check section nesting.
        openSection = sections.pop();

        if (!openSection)
          throw new Error('Unopened section "' + value + '" at ' + start);

        if (openSection[1] !== value)
          throw new Error('Unclosed section "' + openSection[1] + '" at ' + start);
      } else if (type === 'name' || type === '{' || type === '&') {
        nonSpace = true;
      } else if (type === '=') {
        // Set the tags for the next time around.
        compileTags(value);
      }
    }

    // Make sure there are no open sections when we're done.
    openSection = sections.pop();

    if (openSection)
      throw new Error('Unclosed section "' + openSection[1] + '" at ' + scanner.pos);

    return nestTokens(squashTokens(tokens));
  }

  /**
   * Combines the values of consecutive text tokens in the given `tokens` array
   * to a single token.
   */
  function squashTokens(tokens) {
    var squashedTokens = [];

    var token, lastToken;
    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {
      token = tokens[i];

      if (token) {
        if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {
          lastToken[1] += token[1];
          lastToken[3] = token[3];
        } else {
          squashedTokens.push(token);
          lastToken = token;
        }
      }
    }

    return squashedTokens;
  }

  /**
   * Forms the given array of `tokens` into a nested tree structure where
   * tokens that represent a section have two additional items: 1) an array of
   * all tokens that appear in that section and 2) the index in the original
   * template that represents the end of that section.
   */
  function nestTokens(tokens) {
    var nestedTokens = [];
    var collector = nestedTokens;
    var sections = [];

    var token, section;
    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {
      token = tokens[i];

      switch (token[0]) {
      case '#':
      case '^':
        collector.push(token);
        sections.push(token);
        collector = token[4] = [];
        break;
      case '/':
        section = sections.pop();
        section[5] = token[2];
        collector = sections.length > 0 ? sections[sections.length - 1][4] : nestedTokens;
        break;
      default:
        collector.push(token);
      }
    }

    return nestedTokens;
  }

  /**
   * A simple string scanner that is used by the template parser to find
   * tokens in template strings.
   */
  function Scanner(string) {
    this.string = string;
    this.tail = string;
    this.pos = 0;
  }

  /**
   * Returns `true` if the tail is empty (end of string).
   */
  Scanner.prototype.eos = function () {
    return this.tail === "";
  };

  /**
   * Tries to match the given regular expression at the current position.
   * Returns the matched text if it can match, the empty string otherwise.
   */
  Scanner.prototype.scan = function (re) {
    var match = this.tail.match(re);

    if (!match || match.index !== 0)
      return '';

    var string = match[0];

    this.tail = this.tail.substring(string.length);
    this.pos += string.length;

    return string;
  };

  /**
   * Skips all text until the given regular expression can be matched. Returns
   * the skipped string, which is the entire tail if no match can be made.
   */
  Scanner.prototype.scanUntil = function (re) {
    var index = this.tail.search(re), match;

    switch (index) {
    case -1:
      match = this.tail;
      this.tail = "";
      break;
    case 0:
      match = "";
      break;
    default:
      match = this.tail.substring(0, index);
      this.tail = this.tail.substring(index);
    }

    this.pos += match.length;

    return match;
  };

  /**
   * Represents a rendering context by wrapping a view object and
   * maintaining a reference to the parent context.
   */
  function Context(view, parentContext) {
    this.view = view == null ? {} : view;
    this.cache = { '.': this.view };
    this.parent = parentContext;
  }

  /**
   * Creates a new context using the given view with this context
   * as the parent.
   */
  Context.prototype.push = function (view) {
    return new Context(view, this);
  };

  /**
   * Returns the value of the given name in this context, traversing
   * up the context hierarchy if the value is absent in this context's view.
   */
  Context.prototype.lookup = function (name) {
    var cache = this.cache;

    var value;
    if (name in cache) {
      value = cache[name];
    } else {
      var context = this, names, index;

      while (context) {
        if (name.indexOf('.') > 0) {
          value = context.view;
          names = name.split('.');
          index = 0;

          while (value != null && index < names.length)
            value = value[names[index++]];
        } else {
          value = context.view[name];
        }

        if (value != null)
          break;

        context = context.parent;
      }

      cache[name] = value;
    }

    if (isFunction(value))
      value = value.call(this.view);

    return value;
  };

  /**
   * A Writer knows how to take a stream of tokens and render them to a
   * string, given a context. It also maintains a cache of templates to
   * avoid the need to parse the same template twice.
   */
  function Writer() {
    this.cache = {};
  }

  /**
   * Clears all cached templates in this writer.
   */
  Writer.prototype.clearCache = function () {
    this.cache = {};
  };

  /**
   * Parses and caches the given `template` and returns the array of tokens
   * that is generated from the parse.
   */
  Writer.prototype.parse = function (template, tags) {
    var cache = this.cache;
    var tokens = cache[template];

    if (tokens == null)
      tokens = cache[template] = parseTemplate(template, tags);

    return tokens;
  };

  /**
   * High-level method that is used to render the given `template` with
   * the given `view`.
   *
   * The optional `partials` argument may be an object that contains the
   * names and templates of partials that are used in the template. It may
   * also be a function that is used to load partial templates on the fly
   * that takes a single argument: the name of the partial.
   */
  Writer.prototype.render = function (template, view, partials) {
    var tokens = this.parse(template);
    var context = (view instanceof Context) ? view : new Context(view);
    return this.renderTokens(tokens, context, partials, template);
  };

  /**
   * Low-level method that renders the given array of `tokens` using
   * the given `context` and `partials`.
   *
   * Note: The `originalTemplate` is only ever used to extract the portion
   * of the original template that was contained in a higher-order section.
   * If the template doesn't use higher-order sections, this argument may
   * be omitted.
   */
  Writer.prototype.renderTokens = function (tokens, context, partials, originalTemplate) {
    var buffer = '';

    // This function is used to render an arbitrary template
    // in the current context by higher-order sections.
    var self = this;
    function subRender(template) {
      return self.render(template, context, partials);
    }

    var token, value;
    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {
      token = tokens[i];

      switch (token[0]) {
      case '#':
        value = context.lookup(token[1]);

        if (!value)
          continue;

        if (isArray(value)) {
          for (var j = 0, valueLength = value.length; j < valueLength; ++j) {
            buffer += this.renderTokens(token[4], context.push(value[j]), partials, originalTemplate);
          }
        } else if (typeof value === 'object' || typeof value === 'string') {
          buffer += this.renderTokens(token[4], context.push(value), partials, originalTemplate);
        } else if (isFunction(value)) {
          if (typeof originalTemplate !== 'string')
            throw new Error('Cannot use higher-order sections without the original template');

          // Extract the portion of the original template that the section contains.
          value = value.call(context.view, originalTemplate.slice(token[3], token[5]), subRender);

          if (value != null)
            buffer += value;
        } else {
          buffer += this.renderTokens(token[4], context, partials, originalTemplate);
        }

        break;
      case '^':
        value = context.lookup(token[1]);

        // Use JavaScript's definition of falsy. Include empty arrays.
        // See https://github.com/janl/mustache.js/issues/186
        if (!value || (isArray(value) && value.length === 0))
          buffer += this.renderTokens(token[4], context, partials, originalTemplate);

        break;
      case '>':
        if (!partials)
          continue;

        value = isFunction(partials) ? partials(token[1]) : partials[token[1]];

        if (value != null)
          buffer += this.renderTokens(this.parse(value), context, partials, value);

        break;
      case '&':
        value = context.lookup(token[1]);

        if (value != null)
          buffer += value;

        break;
      case 'name':
        value = context.lookup(token[1]);

        if (value != null)
          buffer += mustache.escape(value);

        break;
      case 'text':
        buffer += token[1];
        break;
      }
    }

    return buffer;
  };

  mustache.name = "mustache.js";
  mustache.version = "0.8.1";
  mustache.tags = [ "{{", "}}" ];

  // All high-level mustache.* functions use this writer.
  var defaultWriter = new Writer();

  /**
   * Clears all cached templates in the default writer.
   */
  mustache.clearCache = function () {
    return defaultWriter.clearCache();
  };

  /**
   * Parses and caches the given template in the default writer and returns the
   * array of tokens it contains. Doing this ahead of time avoids the need to
   * parse templates on the fly as they are rendered.
   */
  mustache.parse = function (template, tags) {
    return defaultWriter.parse(template, tags);
  };

  /**
   * Renders the `template` with the given `view` and `partials` using the
   * default writer.
   */
  mustache.render = function (template, view, partials) {
    return defaultWriter.render(template, view, partials);
  };

  // This is here for backwards compatibility with 0.4.x.
  mustache.to_html = function (template, view, partials, send) {
    var result = mustache.render(template, view, partials);

    if (isFunction(send)) {
      send(result);
    } else {
      return result;
    }
  };

  // Export the escaping function so that the user may override it.
  // See https://github.com/janl/mustache.js/issues/244
  mustache.escape = escapeHtml;

  // Export these mainly for testing, but also for advanced usage.
  mustache.Scanner = Scanner;
  mustache.Context = Context;
  mustache.Writer = Writer;

  return mustache;

}));
define("../../lib/mustache/mustache.js", function(){});

define('mustache',['../../lib/mustache/mustache.js'], function(Mustache){
    // Tell Require.js that this module returns a reference to Mustache
    return Mustache;
 });
/**
 * @file        core/template.js
 * @desc        Devapt static template features
 * @ingroup     DEVAPT_CORE
 * @date        2014-05-10
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */

define(
'core/template',['Devapt', 'core/traces', 'core/types', 'mustache'],
function(Devapt, DevaptTrace, DevaptTypes, Mustache)
{
	/**
	 * @memberof	DevaptTemplate
	 * @public
	 * @class
	 * @desc		Devapt cache features container
	 */
	var DevaptTemplate = function() {};
	
	
	/**
	 * @memberof	DevaptTemplate
	 * @public
	 * @static
	 * @desc		Trace flag
	 */
	DevaptTemplate.template_trace = false;
	
	
	/**
	 * @memberof	DevaptTemplate
	 * @public
	 * @static
	 * @desc		default template tags
	 */
	DevaptTemplate.template_tags =
		{
			'br':'<div>',
			'begin_row':'<div>',
			
			'er':'</div>',
			'end_row':'</div>'
		};
	
	/**
	 * @memberof				DevaptTemplate
	 * @public
	 * @method					DevaptTemplate.render(arg_template_str, arg_template_tags)
	 * @desc					Render template string
	 * @param {string}			arg_template_str		text to render
	 * @param {object}			arg_template_tags		tags for substitution (optional)
	 * @return {string}			Rendered string
	 */
	DevaptTemplate.render = function(arg_template_str, arg_template_tags)
	{
		var context = 'DevaptTemplate.render(str,tags)';
		DevaptTrace.trace_enter(context, '', DevaptTemplate.template_trace);
		
		
		// SWITCH TAGS IF NEEDED
		var tags = DevaptTemplate.template_tags;
		if ( DevaptTypes.is_object(arg_template_tags) )
		{
			tags = arg_template_tags;
		}
		
		// RENDER TEMPLATE
		arg_template_str = arg_template_str.replace(/{#([a-zA-Z0-9_]+)}/gm, '@@@#$1@@@');
		arg_template_str = arg_template_str.replace(/{\/([a-zA-Z0-9_]+)}/gm, '@@@/$1@@@');
		arg_template_str = arg_template_str.replace(/{/gm, '{{{');
		arg_template_str = arg_template_str.replace(/}/gm, '}}}');
		arg_template_str = arg_template_str.replace(/@@@#([a-zA-Z0-9_]+)@@@/gm, '{{#$1}}');
		arg_template_str = arg_template_str.replace(/@@@\/([a-zA-Z0-9_]+)@@@/gm, '{{/$1}}');
		
		var str = Mustache.render(arg_template_str, tags);
		
		
		DevaptTrace.trace_leave(context, 'success', DevaptTemplate.template_trace);
		return str;
	}
	
	
	return DevaptTemplate;
} );
/**
 * @file       core/ utils.js
 * @desc        Devapt static utils features
 * @ingroup     DEVAPT_CORE
 * @date        2013-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */

define('core/utils',['Devapt'], function(Devapt)
{
	/**
	 * @memberof	DevaptUtils
	 * @public
	 * @class
	 * @desc		Devapt utils features container
	 */
	var DevaptUtils = function() {};

	/**
	 * @memberof			DevaptUtils
	 * @public
	 * @static
	 * @method				DevaptUtils.get_main_icon_url(arg_icon_relative_path_name)
	 * @desc				Get the standard icon url
	 * @param {string}		arg_icon_relative_path_name		relative path name of the icon
	 * @return {string}		icon url
	 */
	DevaptUtils.get_main_icon_url = function(arg_icon_relative_path_name)
	{
		return APT_IMAGES_URL + arg_icon_relative_path_name;
	}


	/**
	 * @memberof			DevaptUtils
	 * @public
	 * @static
	 * @method				DevaptUtils.go_to_view(arg_view, arg_options)
	 * @desc				Go to the given view page
	 * @param {string}		arg_view			view name
	 * @param {object}		arg_options			view options
	 * @return {nothing}
	 */
	DevaptUtils.go_to_view = function(arg_view, arg_options)
	{
		// GET VIEW OBJECT
		var view_obj = arg_view;
		if ( LibaptTypes.is_string(arg_view) )
		{
			view_obj = LibaptViews.get(arg_view);
		}
		
		// CHECK VIEW OBJECT
		if (! view_obj.is_view)
		{
			LibaptTraces.error( {context:'DevaptUtils.go_to_view', step:'check view', text:'View object is not a LibaptView subclass'} );
			return;
		}
		
		// GET URL BASE
		var url = 'index.php?viewAction=displayHtmlPage' + view_obj.name;
		
		// GET URL QUERY OPTIONS
		if (arg_options instanceof LibaptQuery)
		{
			url += '&' + arg_options.get_url_string();
		}
		else
		// GET URL STRING OPTIONS
		if ( LibaptTypes.is_string(arg_options) )
		{
			url += '&' + arg_options;
		}
		
		// GOTO URL
		window.location.assign(url);
	}


	/**
	 * @public
	 * @static
	 * @method				jQuery.serializeJSON()
	 * @desc				Register the json serialization of jQuery if needed
	 * @return {string}		a json string
	 */
	if (typeof $.fn.serializeJSON == 'undefined')
	{
		$.fn.serializeJSON=function()
		{
			var json = {};
			jQuery.map(
				$(this).serializeArray(),
				function(n, i)
				{
					json[n['name']] = n['value'];
				}
			);
			return json;
		};
	}
	
	return DevaptUtils;
} );
/**
 * @file        core/all.js
 * @desc        Load all Devapt core classes
 * @ingroup     DEVAPT_CORE
 * @date        2014-12-26
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */

define(
	'core/all',[
		'Devapt',
		'core/application',
		'core/cache',
		'core/compatibility',
		'core/inheritance',
		'core/init',
		'core/nav-history',
		'core/resources',
		'core/template',
		'core/traces',
		'core/traces-console',
		'core/traces-memory',
		'core/types',
		'core/types-is',
		'core/types-to',
		'core/utils'
	],
	function()
	{
	}
);
/**
 * @file        datas/datasource/provider.js
 * @desc        Base class for all datas providers
 *              API:
 *                  ->constructor(object)     : nothing
 *  				
 *                  ->is_valid()     	      : boolean
 *                  ->get_records()     	  : array
 *                  ->set_records(array)      : boolean
 *                  ->get_count()             : integer
 *                  ->has(key)                : boolean
 *                  ->get(key,default)        : anything
 *                  ->set(key,value)          : boolean
 *                  ->get_storage_settings()  : object
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2015-04-17
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/datasource/provider',['Devapt', 'core/types', 'object/class', 'object/object'],
function(Devapt, DevaptTypes, DevaptClass, DevaptObject)
{
	/**
	 * @public
	 * @class				DevaptProvider
	 * @desc				Datas records provider storage engines
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptProvider
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// self.trace=true;
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					DevaptProvider.is_valid()
	 * @desc					Test if the datas provider is valid
	 * @return {boolean}		Is valid ?
	 */
	var cb_is_valid = function()
	{
		var self = this;
		return DevaptTypes.is_array(self.records);
		// return true;
	};
	
	
	
	/* --------------------------------------------- COLLECTION OPERATIONS ------------------------------------------------ */
	
	/**
	 * @public
	 * @static
	 * @memberof			DevaptProvider
	 * @desc				Get all records array
	 * @return {array}
	 */
	var cb_get_self_records = function()
	{
		return self.records;
	};
	
	
	
	/**
	 * @public
	 * @static
	 * @memberof			DevaptProvider
	 * @desc				Get all records array
	 * @param {integer}		arg_offset	first index of returned records (optional, default 0)
	 * @param {integer}		arg_length	number of returned records starting from offset (optional, default all records)
	 * @return {array}
	 */
	var cb_get_records = function(arg_offset, arg_length)
	{
		var self = this;
//			 console.log(datas, 'datas');
		
		// CHECK IF PROVIDER IS VALID
		if ( ! self.is_valid() )
		{
			return [];
		}
		
		var datas = self.get_self_records();
		
		var full_index = 0;
		var full_count = datas.length;
//			console.log(full_count, 'datasources.get_records.full_count');
		
		arg_offset = (arg_offset === undefined) ? 0 : (arg_offset < full_count ? arg_offset : full_count - 1);
		arg_length = (arg_length === undefined) ? (datas.length - arg_offset) : arg_length;
//			console.log(arg_offset, 'datasources.get_records.arg_offset');
//			console.log(arg_length, 'datasources.get_records.arg_length');
		
		var filtered_index = 0;
		var filtered_offset= (arg_offset > 0 && arg_offset < full_count) ? arg_offset : 0;
		var filtered_count = (arg_length > 0 && (filtered_offset + arg_length) < full_count) ? arg_length : ( (full_count - 1) - filtered_offset);
//			console.log(filtered_offset, 'datasources.get_records.filtered_offset');
//			console.log(filtered_count, 'datasources.get_records.filtered_count');
		
		// SKIP 'OFFSET' FILTERED ITEMS
		while( full_index < full_count && filtered_index < (filtered_offset + 1) )
		{
			var item = datas[full_index];
			var record = self.decode(item);
//				console.log(record, 'datasources.get_records.record');
			
			if ( item && self.filter_record(record) )
			{
//					console.log(record, 'datasources.get_records.record is filtered');
				++filtered_index;
			}
			++full_index;
		}
//			console.log(filtered_index, 'datasources.get_records.filtered_index');
//			console.log(full_index, 'datasources.get_records.full_index');
		
		// GET 'LENGTH' ITEMS FROM 'OFFSET'
		var records = [];
		while(full_index < full_count && records.length < filtered_count)
		{
			var item = datas[full_index];
			var record = self.decode(item);
//				console.log(record, 'datasources.get_records.new record');
			
			if ( item && self.filter_record(record) )
			{
//					console.log(record, 'datasources.get_records.new record is filtered');
				records.push(record);
				++filtered_index;
			}
			++full_index;
		}
//			console.log(filtered_index, 'datasources.get_records.filtered_index');
//			console.log(full_index, 'datasources.get_records.full_index');
		
		return records;
	};
	
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.get_count()
	 * @desc					Get all records count
	 * @return {array}
	 */
	var cb_get_count = function ()
	{
		var self = this;
		return self.get_records().length;
	};
	
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.set_records()
	 * @desc					Set records
	 * @param {array}			arg_records		datas records
	 * @return {boolean}
	 */
	var cb_set_records = function (arg_records)
	{
		var self = this;
		
		if (self.is_readonly)
		{
			return false;
		}
		
		delete self.records;
		self.records = arg_records;
		return true;
	};
	
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.remove_records()
	 * @desc					Remove all records
	 * @return {boolean}
	 */
	var cb_remove_records = function ()
	{
		var self = this;
		
		if (self.is_readonly)
		{
			return false;
		}
		
		delete self.records;
		self.records = [];
		return true;
	};
	
	
	
	/* --------------------------------------------- ENCODE/DECODE/FILTER OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.encode(record)
	 * @desc					Encode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_encode = function (arg_record)
	{
		var self = this;
		
		return arg_record;
	};
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.decode(record)
	 * @desc					Decode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_decode = function (arg_record)
	{
		var self = this;
		
		return arg_record;
	};
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.filter(record)
	 * @desc					Test if a data record should be returned by this provider
	 * @param {string|integer}	arg_record		data record
	 * @return {boolean}
	 */
	var cb_filter = function (arg_record)
	{
		var self = this;
		
		return true;
	};
	
	
	
	/* --------------------------------------------- COLLECTION OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.has(key)
	 * @desc					Test if a data record exists at key
	 * @param {string|integer}	arg_key			data key
	 * @return {boolean}
	 */
	var cb_has = function (arg_key)
	{
		var self = this;
		return self.is_valid() ? arg_key in self.records : false;
	};
	
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.get(key,default)
	 * @desc					Get a data record for the given key
	 * @param {string|integer}	arg_key			data key
	 * @param {anything}		arg_default		default value
	 * @return {anything}
	 */
	var cb_get = function (arg_key, arg_default)
	{
		var self = this;
		
		if (! arg_key || ! self.is_valid())
		{
			return arg_default;
		}
		
		var records = self.get_self_records();
		if (arg_key in records)
		{
			var item = records[arg_key];
			return self.decode(item);
		}
		
		return arg_default;
	};
	
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.set(key,value)
	 * @desc					Set a data record for the given key
	 * @param {string|integer}	arg_key			data key
	 * @param {anything}		arg_record		datas value
	 * @return {boolean}
	 */
	var cb_set = function (arg_key, arg_record)
	{
		var self = this;
		
		if (self.is_readonly)
		{
			return false;
		}
		
		if ( self.is_valid() )
		{
			if (arg_key in self.records)
			{
				self.records[arg_key] = self.encode(arg_record);
				return true;
			}
			
			self.records.push( self.encode(arg_record) );
			return true;
		}
		
		return false;
	};
	
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.remove(key)
	 * @desc					Remove a data record at the given key
	 * @param {string|integer}	arg_key			data key
	 * @return {boolean}
	 */
	var cb_remove = function (arg_key)
	{
		var self = this;
		
		if (self.is_readonly)
		{
			return false;
		}
		
		if ( self.is_valid() )
		{
			if (arg_key in self.records)
			{
				self.records[arg_key] = null;
				delete self.records[arg_key];
				
				return true;
			}
			
			return false;
		}
		
		return false;
	};
	
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.add(record)
	 * @desc					Add a data record
	 * @param {object}			arg_record		data record
	 * @return {boolean}
	 */
	var cb_add = function (arg_record)
	{
		var self = this;
		
		if (self.is_readonly)
		{
			return false;
		}
		
		if ( self.is_valid() )
		{
			self.records.push( self.encode(arg_record) );
			
			return true;
		}
		
		return false;
	};
	
	
	
	/* --------------------------------------------- RESOURCES SETTINGS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.get_storage_settings()
	 * @desc					Get a settings object for storage engine creation
	 * @return {object}
	 */
	var cb_get_storage_settings = function ()
	{
		var self = this;
		
		if ( ! self.is_valid() )
		{
			return null;
		}
		
		var settings = {
			'name': self.name + '_engine',
			'source': 'array',
			'provider': self
		};
		
		// self.error('DevaptProvider.get_storage_settings()', 'default empty implementation');
		
		return settings;
	};
	
	
	
	/**
	 * @memberof				DevaptProvider
	 * @public
	 * @method					self.get_model_settings()
	 * @desc					Get a settings object for model creation
	 * @return {object}
	 */
	var cb_get_model_settings = function ()
	{
		var self = this;
		
		if ( ! self.is_valid() )
		{
			return null;
		}
		
		self.error('DevaptProvider.get_storage_settings()', 'default empty implementation');
		
		return null;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-04-17',
			updated:'2015-04-17',
			description:'Datas provider for storage engines'
		},
		mixins:[]
	};
	var parent_class = DevaptObject;
	var DevaptProviderClass = new DevaptClass('DevaptProvider', parent_class, class_settings);
	
	// METHODS
	DevaptProviderClass.infos.ctor = cb_constructor;
	DevaptProviderClass.add_public_method('is_valid', {}, cb_is_valid);
	DevaptProviderClass.add_public_method('get_self_records', {}, cb_get_self_records);
	
	DevaptProviderClass.add_public_method('get_records', {}, cb_get_records);
	DevaptProviderClass.add_public_method('set_records', {}, cb_set_records);
	DevaptProviderClass.add_public_method('remove_records', {}, cb_remove_records);
	
	DevaptProviderClass.add_public_method('encode', {}, cb_encode);
	DevaptProviderClass.add_public_method('decode', {}, cb_decode);
	DevaptProviderClass.add_public_method('filter', {}, cb_filter);
	
	DevaptProviderClass.add_public_method('encode_record', {}, cb_encode);
	DevaptProviderClass.add_public_method('decode_record', {}, cb_decode);
	DevaptProviderClass.add_public_method('filter_record', {}, cb_filter);
	
	DevaptProviderClass.add_public_method('has', {}, cb_has);
	DevaptProviderClass.add_public_method('get', {}, cb_get);
	DevaptProviderClass.add_public_method('set', {}, cb_set);
	DevaptProviderClass.add_public_method('remove', {}, cb_remove);
	DevaptProviderClass.add_public_method('add', {}, cb_add);
	
	DevaptProviderClass.add_public_method('has_record', {}, cb_has);
	DevaptProviderClass.add_public_method('get_record', {}, cb_get);
	DevaptProviderClass.add_public_method('set_record', {}, cb_set);
	DevaptProviderClass.add_public_method('remove_record', {}, cb_remove);
	DevaptProviderClass.add_public_method('add_record', {}, cb_add);
	
	DevaptProviderClass.add_public_method('get_storage_settings', {}, cb_get_storage_settings);
	DevaptProviderClass.add_public_method('get_model_settings', {}, cb_get_model_settings);
	
	// MIXINS
	
	// PROPERTIES
	DevaptProviderClass.add_public_bool_property('is_provider', 'object is a datas provider', true, false, true, []);
	DevaptProviderClass.add_public_bool_property('is_readonly', 'datas provider is readonly', true, false, true, []);
	DevaptProviderClass.add_public_array_property('records', 'records array', [], false, false, [], 'object', '|');
	
	
	return DevaptProviderClass;
} );
/**
 * @file        datas/datasource/classes_provider.js
 * @desc        Classes datas providers
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2015-06-10
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/datasource/classes_provider',['Devapt', 'core/types',
	'object/classes', 'object/class', 'datas/datasource/provider'],
function(Devapt, DevaptTypes,
	DevaptClasses, DevaptClass, DevaptProvider)
{
	/**
	 * @public
	 * @class				DevaptClassesProvider
	 * @desc				Datas records provider storage engines
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptClassesProvider
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// self.trace=true;
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	
	/* --------------------------------------------- COLLECTION OPERATIONS ------------------------------------------------ */
	
	/**
	 * @public
	 * @static
	 * @memberof			DevaptClassesProvider
	 * @desc				Get all records array
	 * @return {array}
	 */
	var get_self_records_cb = function(self)
	{
		return DevaptClasses.get_classes_array();
	}
	
	
	
	/* --------------------------------------------- ENCODE/DECODE/FILTER OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptClassesProvider
	 * @public
	 * @method					self.encode(record)
	 * @desc					Encode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_encode = function (arg_record)
	{
		// var self = this;
		
		return null;
	};
	
	/**
	 * @memberof				DevaptClassesProvider
	 * @public
	 * @method					self.decode(record)
	 * @desc					Decode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_decode = function (arg_record)
	{
		// var self = this;
		
		return (!arg_record) ? {} : {
			id:arg_record.id ? arg_record.id : Devapt.uid(),
			name:arg_record.infos.class_name,
			author:arg_record.infos.author,
			updated:arg_record.infos.updated,
			description:arg_record.infos.description
		};
	};
	
	/**
	 * @memberof				DevaptClassesProvider
	 * @public
	 * @method					self.filter(record)
	 * @desc					Test if a data record should be returned by this provider
	 * @param {string|integer}	arg_record		data record
	 * @return {boolean}
	 */
	var cb_filter = function (arg_record)
	{
		return true;
	};
	
	
	
	/* --------------------------------------------- RESOURCES SETTINGS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptClassesProvider
	 * @public
	 * @method					self.get_model_settings()
	 * @desc					Get a settings object for model creation
	 * @return {object}
	 */
	var cb_get_model_settings = function ()
	{
		var self = this;
		if ( ! self.is_valid() )
		{
			return null;
		}
		
		var settings = {
			'name': self.name + '_model',
			
			'class_type': 'model',
			
			'access':{"create":false,"read":true,"update":false,"delete":false},
			
			"role_read":"ROLE_BROWSER_CLASSES_READ",
			"role_create":"ROLE_BROWSER_CLASSES_CREATE",
			"role_update":"ROLE_BROWSER_CLASSES_UPDATE",
			"role_delete":"ROLE_BROWSER_CLASSES_DELETE",
			
			'engine': self.get_storage_settings(),
			
			"fields":{
					"id":{
						"type":"String",
						"label":"Id",
						"is_pk":true
					},
					"name":{
						"type":"String",
						"label":"Name"
					},
					"author":{
						"type":"String",
						"label":"Author"
					},
					"updated":{
						"type":"Date",
						"label":"Last update date"
					},
					"description":{
						"type":"String",
						"label":"Class description"
					}
				}
		};
		
		return settings;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-06-10',
			updated:'2015-06-10',
			description:'Datas classes provider for storage engines'
		},
		mixins:[]
	};
	var parent_class = DevaptProvider;
	var DevaptClassesProviderClass = new DevaptClass('DevaptClassesProvider', parent_class, class_settings);
	
	
	// METHODS
	DevaptClassesProviderClass.infos.ctor = cb_constructor;
	
	DevaptClassesProviderClass.add_public_method('get_self_records', {}, get_self_records_cb);
	
	DevaptClassesProviderClass.add_public_method('encode', {}, cb_encode);
	DevaptClassesProviderClass.add_public_method('decode', {}, cb_decode);
	DevaptClassesProviderClass.add_public_method('filter', {}, cb_filter);
	
	DevaptClassesProviderClass.add_public_method('encode_record', {}, cb_encode);
	DevaptClassesProviderClass.add_public_method('decode_record', {}, cb_decode);
	DevaptClassesProviderClass.add_public_method('filter_record', {}, cb_filter);
	
	DevaptClassesProviderClass.add_public_method('get_model_settings', {}, cb_get_model_settings);
	
	
	// PROPERTIES
	
	
	return DevaptClassesProviderClass;
} );
/**
 * @file        datas/datasource/crud_api_provider.js
 * @desc        CRUD API datas providers
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2015-06-10
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/datasource/crud_api_provider',['Devapt', 'core/types',
	'object/classes', 'object/class', 'datas/datasource/provider'],
function(Devapt, DevaptTypes,
	DevaptClasses, DevaptClass, DevaptProvider)
{
	/**
	 * @public
	 * @class				DevaptCrudApiProvider
	 * @desc				Datas records provider storage engines
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptCrudApiProvider
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// self.trace=true;
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	
	/* --------------------------------------------- COLLECTION OPERATIONS ------------------------------------------------ */
	
	/**
	 * @public
	 * @static
	 * @memberof			DevaptCrudApiProvider
	 * @desc				Get all records array
	 * @return {array}
	 */
	var get_self_records_cb = function(self)
	{
		var datas = [];
		
		var model_instances = DevaptClasses.get_model_instances();
		console.log(model_instances, 'model_instances');
		
		var model_index = 0;
		for( ; model_index < model_instances.length ; model_index++)
		{
			var model = model_instances[model_index];
				
			var server_api = model.get_server_api();
			// console.log(server_api);
			if (server_api.is_local)
			{
				continue;
			}
			
			var record_create = {
				id:Devapt.uid(),
				resource_name:server_api.model_name,
				controller:'rest',
				action:'create',
				method:server_api.action_create.method,
				format:server_api.action_create.format,
				url:server_api.action_create.url
			};
			var record_read = {
				id:Devapt.uid(),
				resource_name:server_api.model_name,
				controller:'rest',
				action:'read',
				method:server_api.action_read.method,
				format:server_api.action_read.format,
				url:server_api.action_read.url
			};
			var record_update = {
				id:Devapt.uid(),
				resource_name:server_api.model_name,
				controller:'rest',
				action:'update',
				method:server_api.action_update.method,
				format:server_api.action_update.format,
				url:server_api.action_update.url
			};
			var record_delete = {
				id:Devapt.uid(),
				resource_name:server_api.model_name,
				controller:'rest',
				action:'delete',
				method:server_api.action_delete.method,
				format:server_api.action_delete.format,
				url:server_api.action_delete.url
			};
			
			datas.push(record_create);
			datas.push(record_read);
			datas.push(record_update);
			datas.push(record_delete);
		}
		
		return datas;
	}
	
	
	
	/* --------------------------------------------- ENCODE/DECODE/FILTER OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptCrudApiProvider
	 * @public
	 * @method					self.encode(record)
	 * @desc					Encode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_encode = function (arg_record)
	{
		// var self = this;
		
		return null;
	};
	
	/**
	 * @memberof				DevaptCrudApiProvider
	 * @public
	 * @method					self.decode(record)
	 * @desc					Decode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_decode = function (arg_record)
	{
		// var self = this;
		
		return arg_record;
	};
	
	/**
	 * @memberof				DevaptCrudApiProvider
	 * @public
	 * @method					self.filter(record)
	 * @desc					Test if a data record should be returned by this provider
	 * @param {string|integer}	arg_record		data record
	 * @return {boolean}
	 */
	var cb_filter = function (arg_record)
	{
		return true;
	};
	
	
	
	/* --------------------------------------------- RESOURCES SETTINGS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptCrudApiProvider
	 * @public
	 * @method					self.get_model_settings()
	 * @desc					Get a settings object for model creation
	 * @return {object}
	 */
	var cb_get_model_settings = function ()
	{
		var self = this;
		if ( ! self.is_valid() )
		{
			return null;
		}
		
		var settings = {
			'name': self.name + '_model',
			
			'class_type': 'model',
			
			'access':{"create":false,"read":true,"update":false,"delete":false},
			
			"role_read":"ROLE_BROWSER_CRUD_API_READ",
			"role_create":"ROLE_BROWSER_CRUD_API_CREATE",
			"role_update":"ROLE_BROWSER_CRUD_API_UPDATE",
			"role_delete":"ROLE_BROWSER_CRUD_API_DELETE",
			
			'engine': self.get_storage_settings(),
			
			"fields":{
					"id":{
						"type":"Integer",
						"label":"Id",
						"is_pk":true
					},
					"resource_name":{
						"type":"String",
						"label":"Resource name"
					},
					"controller":{
						"type":"String",
						"label":"Controller name"
					},
					"action":{
						"type":"String",
						"label":"Action"
					},
					"method":{
						"type":"String",
						"label":"Method"
					},
					"format":{
						"type":"String",
						"label":"Format"
					},
					"url":{
						"type":"String",
						"label":"URL"
					}
				}
		};
		
		return settings;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-06-10',
			updated:'2015-06-10',
			description:'Datas CRUD API provider for storage engines'
		},
		mixins:[]
	};
	var parent_class = DevaptProvider;
	var DevaptCrudApiProviderClass = new DevaptClass('DevaptCrudApiProvider', parent_class, class_settings);
	
	
	// METHODS
	DevaptCrudApiProviderClass.infos.ctor = cb_constructor;
	
	DevaptCrudApiProviderClass.add_public_method('get_self_records', {}, get_self_records_cb);
	
	DevaptCrudApiProviderClass.add_public_method('encode', {}, cb_encode);
	DevaptCrudApiProviderClass.add_public_method('decode', {}, cb_decode);
	DevaptCrudApiProviderClass.add_public_method('filter', {}, cb_filter);
	
	DevaptCrudApiProviderClass.add_public_method('encode_record', {}, cb_encode);
	DevaptCrudApiProviderClass.add_public_method('decode_record', {}, cb_decode);
	DevaptCrudApiProviderClass.add_public_method('filter_record', {}, cb_filter);
	
	DevaptCrudApiProviderClass.add_public_method('get_model_settings', {}, cb_get_model_settings);
	
	
	// PROPERTIES
	
	
	return DevaptCrudApiProviderClass;
} );
/**
 * @file        datas/datasource/datasources.js
 * @desc        Datasource model provider
 * @see			DevaptModel, DevaptStorage
 * @ingroup     DEVAPT_DATAS
 * @date        2015-04-19
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'datas/datasource/datasources',['Devapt',
	'core/traces', 'core/types', 'core/traces-memory', 'core/resources',
	'object/class', 'object/classes', 'object/events'//,
	// 'datas/datasource/logs_provider'
],
function(Devapt,
	DevaptTraces, DevaptTypes, DevaptTracesMemory, DevaptResources,
	DevaptClass, DevaptClasses, DevaptEvents//,
	// DevaptLogsProvider
)
{
	/**
	 * @mixin				DevaptDatasources
	 * @public
	 * @desc				Datas sources provider
	 */
	var DevaptDatasources = 
	{
		/**
		 * @memberof			DevaptDatasources
		 * @static
		 * @public
		 * @desc				Enable/disable trace for static class operations
		 */
		trace_datasources: true,
		
		/**
		 * @memberof			DevaptDatasources
		 * @static
		 * @public
		 * @desc				Datasource providers
		 */
		datasources_providers: {},
		
		
		/**
		 * @public
		 * @static
		 * @memberof			DevaptDatasources
		 * @desc				Get datasource provider
		 * @param {string}		arg_datasource_name		the name of the requested datasource
		 * @return {promise}	or null if not found
		 */
		get_datasource_provider: function(arg_datasource_name)
		{
			var context = 'get_datasource_provider(name)';
			
			// CACHED PROVIDER
			if (arg_datasource_name in DevaptDatasources.datasources_providers)
			{
				DevaptTraces.trace_step(context, 'provider is logs from cache', DevaptDatasources.trace_datasources);
				
				var provider = DevaptDatasources.datasources_providers[arg_datasource_name];
				return Devapt.promise_resolved(provider);
			}
			
			// SERACH PROVIDER
			switch(arg_datasource_name)
			{
				case 'logs':
				{
					DevaptTraces.trace_step(context, 'provider is logs from promise', DevaptDatasources.trace_datasources);
					
					return Devapt.create('DevaptLogsProvider', 'LogsProvider', {});
				}
					
				case 'resources':
				{
					DevaptTraces.trace_step(context, 'provider is resources from promise', DevaptDatasources.trace_datasources);
					
					return Devapt.create('DevaptResourcesProvider', 'ResourcesProvider', {});
				}
				
				case 'events':
				{
					DevaptTraces.trace_step(context, 'provider is events from promise', DevaptDatasources.trace_datasources);
					
					return Devapt.create('DevaptEventsProvider', 'EventsProvider', {});
				}
				
				case 'classes':
				{
					DevaptTraces.trace_step(context, 'provider is classes from promise', DevaptDatasources.trace_datasources);
					
					return Devapt.create('DevaptClassesProvider', 'ClassesProvider', {});
				}
				
				case 'crud-api':
				{
					DevaptTraces.trace_step(context, 'provider is crud-api from promise', DevaptDatasources.trace_datasources);
					
					return Devapt.create('DevaptCrudApiProvider', 'CrudApiProvider', {});
				}
				
				case 'view-api':
				{
					DevaptTraces.trace_step(context, 'provider is view-api from promise', DevaptDatasources.trace_datasources);
					
					return Devapt.create('DevaptViewApiProvider', 'ViewApiProvider', {});
				}
				
				case 'resource-api':
				{
					DevaptTraces.trace_step(context, 'provider is resource-api from promise', DevaptDatasources.trace_datasources);
					
					return Devapt.create('DevaptResourceApiProvider', 'ResourceApiProvider', {});
				}
			}
			
			// return Devapt.promise_rejected();
			return null;
		},
		
		
		/**
		 * @public
		 * @static
		 * @memberof			DevaptDatasources
		 * @desc				Get datasource model
		 * @param {string}		arg_datasource_name		the name of the requested datasource
		 * @return {promise}
		 */
		get_datasource_model: function(arg_datasource_name)
		{
			var context = 'get_datasource_model(name)';
			DevaptTraces.trace_enter(context, DevaptTypes.to_string(arg_datasource_name, 'bad name'), DevaptDatasources.trace_datasources);
			
			
			// CHECK NAME
			if ( ! DevaptTypes.is_not_empty_str(arg_datasource_name) )
			{
				DevaptTraces.trace_leave(context, Devapt.msg_failure_promise, DevaptDatasources.trace_datasources);
				return Devapt.promise_rejected();
			}
			
			
			// GET MODEL
			var model_promise = null;
			try
			{
				var provider_promise = DevaptDatasources.get_datasource_provider(arg_datasource_name);
				
				if (provider_promise)
				{
					DevaptTraces.trace_leave(context, Devapt.msg_sucess_promise, DevaptDatasources.trace_datasources);
					return provider_promise.then(
						function(arg_provider)
						{
							var settings = arg_provider.get_model_settings();
							return Devapt.create('DevaptModel', settings);
						}
					);
				}
			}
			catch(e)
			{
				console.error(e, context);
			}
			
			
			DevaptTraces.trace_leave(context, Devapt.msg_failure_promise, DevaptDatasources.trace_datasources);
			return Devapt.promise_rejected();
		}
	};
	
	
	return DevaptDatasources;
}
);
/**
 * @file        datas/datasource/events_provider.js
 * @desc        Events datas providers
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2015-06-10
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/datasource/events_provider',['Devapt', 'core/types',
	'object/events', 'object/class', 'datas/datasource/provider'],
function(Devapt, DevaptTypes,
	DevaptEvents, DevaptClass, DevaptProvider)
{
	/**
	 * @public
	 * @class				DevaptEventsProvider
	 * @desc				Datas records provider storage engines
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptEventsProvider
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// self.trace=true;
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	
	/* --------------------------------------------- COLLECTION OPERATIONS ------------------------------------------------ */
	
	/**
	 * @public
	 * @static
	 * @memberof			DevaptEventsProvider
	 * @desc				Get all records array
	 * @return {array}
	 */
	var get_self_records_cb = function(self)
	{
		return DevaptEvents.get_events_array();
	}
	
	
	
	/* --------------------------------------------- ENCODE/DECODE/FILTER OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptEventsProvider
	 * @public
	 * @method					self.encode(record)
	 * @desc					Encode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_encode = function (arg_record)
	{
		// var self = this;
		
		return null;
	};
	
	/**
	 * @memberof				DevaptEventsProvider
	 * @public
	 * @method					self.decode(record)
	 * @desc					Decode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_decode = function (arg_record)
	{
		// var self = this;
		
		return (!arg_record) ? {} : {
			id:arg_record.id ? arg_record.id : Devapt.uid(),
			name:arg_record.name,
			ts:arg_record.fired_ts,
			emitter:arg_record.emitter_object.name,
			operands:arg_record.operands_array.length
		};
	};
	
	/**
	 * @memberof				DevaptEventsProvider
	 * @public
	 * @method					self.filter(record)
	 * @desc					Test if a data record should be returned by this provider
	 * @param {string|integer}	arg_record		data record
	 * @return {boolean}
	 */
	var cb_filter = function (arg_record)
	{
		var regexp1 = /^.*_events.*$/i;
		var regexp2 = /^.*_logs.*$/i;
		if ( regexp1.test(arg_record.emitter) || regexp2.test(arg_record.emitter) )
		{
			return false;
		}
		return true;
	};
	
	
	
	/* --------------------------------------------- RESOURCES SETTINGS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptEventsProvider
	 * @public
	 * @method					self.get_model_settings()
	 * @desc					Get a settings object for model creation
	 * @return {object}
	 */
	var cb_get_model_settings = function ()
	{
		var self = this;
		if ( ! self.is_valid() )
		{
			return null;
		}
		
		var settings = {
			'name': self.name + '_model',
			
			'class_type': 'model',
			
			'access':{"create":false,"read":true,"update":false,"delete":false},
			
			"role_read":"ROLE_BROWSER_EVENTS_READ",
			"role_create":"ROLE_BROWSER_EVENTS_CREATE",
			"role_update":"ROLE_BROWSER_EVENTS_UPDATE",
			"role_delete":"ROLE_BROWSER_EVENTS_DELETE",
			
			'engine': self.get_storage_settings(),
			
			"fields":{
					"id":{
						"type":"String",
						"label":"Id",
						"is_pk":true
					},
					"name":{
						"type":"String",
						"label":"Name"
					},
					"ts":{
						"type":"String",
						"label":"TS"
					},
					"emitter":{
						"type":"String",
						"label":"Emitter"
					},
					"operands":{
						"type":"Integer",
						"label":"Operands count"
					}
				}
		};
		
		return settings;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-06-10',
			updated:'2015-06-10',
			description:'Datas classes provider for storage engines'
		},
		mixins:[]
	};
	var parent_class = DevaptProvider;
	var DevaptEventsProviderClass = new DevaptClass('DevaptEventsProvider', parent_class, class_settings);
	
	
	// METHODS
	DevaptEventsProviderClass.infos.ctor = cb_constructor;
	
	DevaptEventsProviderClass.add_public_method('get_self_records', {}, get_self_records_cb);
	
	DevaptEventsProviderClass.add_public_method('encode', {}, cb_encode);
	DevaptEventsProviderClass.add_public_method('decode', {}, cb_decode);
	DevaptEventsProviderClass.add_public_method('filter', {}, cb_filter);
	
	DevaptEventsProviderClass.add_public_method('encode_record', {}, cb_encode);
	DevaptEventsProviderClass.add_public_method('decode_record', {}, cb_decode);
	DevaptEventsProviderClass.add_public_method('filter_record', {}, cb_filter);
	
	DevaptEventsProviderClass.add_public_method('get_model_settings', {}, cb_get_model_settings);
	
	
	// PROPERTIES
	
	
	return DevaptEventsProviderClass;
} );
/**
 * @file        datas/datasource/logs_provider.js
 * @desc        Logs datas providers
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2015-06-10
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/datasource/logs_provider',['Devapt', 'core/types', 'core/traces-memory',
	'object/class', 'datas/datasource/provider'],
function(Devapt, DevaptTypes, DevaptTracesMemory,
	DevaptClass, DevaptProvider)
{
	/**
	 * @public
	 * @class				DevaptLogsProvider
	 * @desc				Datas records provider storage engines
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptLogsProvider
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// self.trace=true;
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	
	/* --------------------------------------------- COLLECTION OPERATIONS ------------------------------------------------ */
	
	/**
	 * @public
	 * @static
	 * @memberof			DevaptLogsProvider
	 * @desc				Get all records array
	 * @return {array}
	 */
	var get_self_records_cb = function(self)
	{
		return DevaptTracesMemory.get_logs();
	}
	
	
	
	/* --------------------------------------------- ENCODE/DECODE/FILTER OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptLogsProvider
	 * @public
	 * @method					self.encode(record)
	 * @desc					Encode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_encode = function (arg_record)
	{
		// var self = this;
		
		return {
			id:arg_record.id ? arg_record.id : Devapt.uid(),
			level:arg_record.level,
			class_name:arg_record.class_name,
			object_name:arg_record.instance,
			method_name:arg_record.method,
			context:arg_record.context,
			step:arg_record.step,
			text:arg_record.text
		};
	};
	
	/**
	 * @memberof				DevaptLogsProvider
	 * @public
	 * @method					self.decode(record)
	 * @desc					Decode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_decode = function (arg_record)
	{
		// var self = this;
		
		return (!arg_record) ? {} : {
			id:arg_record.id ? arg_record.id : Devapt.uid(),
			level:arg_record.level,
			class_name:arg_record.class_name,
			instance:arg_record.object_name,
			method:arg_record.method_name,
			context:arg_record.context,
			step:arg_record.step,
			text:arg_record.text
		};
	};
	
	/**
	 * @memberof				DevaptLogsProvider
	 * @public
	 * @method					self.filter(record)
	 * @desc					Test if a data record should be returned by this provider
	 * @param {string|integer}	arg_record		data record
	 * @return {boolean}
	 */
	var cb_filter = function (arg_record)
	{
		var self = this;
		
		var regexp1 = /^.*_events.*$/i;
		var regexp2 = /^.*_logs.*$/i;
		if ( regexp1.test(arg_record.context) || regexp2.test(arg_record.context) || regexp2.test(arg_record.instance) )
		{
			return false;
		}
		
		return true;
	};
	
	
	
	/* --------------------------------------------- RESOURCES SETTINGS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptLogsProvider
	 * @public
	 * @method					self.get_storage_settings()
	 * @desc					Get a settings object for storage engine creation
	 * @return {object}
	 */
/*	var cb_get_storage_settings = function ()
	{
		var self = this;
		if ( ! self.is_valid() )
		{
			return null;
		}
		
		var settings = {
			'name': self.name + '_engine',
			'source': 'array',
			'provider': self
		};
		
		return settings;
	};*/
	
	
	
	/**
	 * @memberof				DevaptLogsProvider
	 * @public
	 * @method					self.get_model_settings()
	 * @desc					Get a settings object for model creation
	 * @return {object}
	 */
	var cb_get_model_settings = function ()
	{
		var self = this;
		if ( ! self.is_valid() )
		{
			return null;
		}
		
		var settings = {
			'name': self.name + '_model',
			
			'class_type': 'model',
			
			'access':{"create":false,"read":true,"update":false,"delete":false},
			
			"role_read":"ROLE_BROWSER_LOGS_READ",
			"role_create":"ROLE_BROWSER_LOGS_CREATE",
			"role_update":"ROLE_BROWSER_LOGS_UPDATE",
			"role_delete":"ROLE_BROWSER_LOGS_DELETE",
			
			'engine': self.get_storage_settings(),
			
			"fields":{
					"id":{
						"type":"String",
						"label":"Id",
						"is_pk":true
					},
					"level":{
						"type":"String",
						"label":"Level"
					},
					"class_name":{
						"type":"String",
						"label":"Class"
					},
					"instance":{
						"type":"String",
						"label":"Object"
					},
					"method":{
						"type":"String",
						"label":"Method"
					},
					"context":{
						"type":"String",
						"label":"Context"
					},
					"step":{
						"type":"String",
						"label":"Step"
					},
					"text":{
						"type":"String",
						"label":"Text"
					}
				}
		};
		
		return settings;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-06-10',
			updated:'2015-06-10',
			description:'Datas logs provider for storage engines'
		},
		mixins:[]
	};
	var parent_class = DevaptProvider;
	var DevaptLogsProviderClass = new DevaptClass('DevaptLogsProvider', parent_class, class_settings);
	
	
	// METHODS
	DevaptLogsProviderClass.infos.ctor = cb_constructor;
	
	DevaptLogsProviderClass.add_public_method('get_self_records', {}, get_self_records_cb);
	
	DevaptLogsProviderClass.add_public_method('encode', {}, cb_encode);
	DevaptLogsProviderClass.add_public_method('decode', {}, cb_decode);
	DevaptLogsProviderClass.add_public_method('filter', {}, cb_filter);
	
	DevaptLogsProviderClass.add_public_method('encode_record', {}, cb_encode);
	DevaptLogsProviderClass.add_public_method('decode_record', {}, cb_decode);
	DevaptLogsProviderClass.add_public_method('filter_record', {}, cb_filter);
	
	// DevaptLogsProviderClass.add_public_method('get_storage_settings', {}, cb_get_storage_settings);
	DevaptLogsProviderClass.add_public_method('get_model_settings', {}, cb_get_model_settings);
	
	
	// PROPERTIES
	
	
	return DevaptLogsProviderClass;
} );
/**
 * @file        datas/datasource/resource_api_provider.js
 * @desc        RESOURCE API datas providers
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2015-06-10
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/datasource/resource_api_provider',['Devapt', 'core/types',
	/*'object/classes',*/ 'object/class', 'datas/datasource/provider'],
function(Devapt, DevaptTypes,
	/*DevaptClasses,*/ DevaptClass, DevaptProvider)
{
	/**
	 * @public
	 * @class				DevaptResourceApiProvider
	 * @desc				Datas records provider storage engines
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptResourceApiProvider
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// self.trace=true;
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	
	/* --------------------------------------------- COLLECTION OPERATIONS ------------------------------------------------ */
	
	/**
	 * @public
	 * @static
	 * @memberof			DevaptResourceApiProvider
	 * @desc				Get all records array
	 * @return {array}
	 */
	var get_self_records_cb = function(self)
	{
		var datas = [];
		
		var url_base = Devapt.app.get_url_base();
		
		var record_get_resource = {
			controller:'resources',
			resource_name:'myresource',
			action:'get_resource',
			method:'GET',
			format:'devapt_resource_api_2',
			 url:url_base + 'resources/' + 'myresource' + '/get_resource'
		};
		
		var record_list_all = {
			controller:'resources',
			resource_name:'all',
			action:'list',
			method:'GET',
			format:'devapt_resource_api_2',
			url:url_base + 'resources/' + 'all' + '/list'
		};
		
		var record_list_views = {
			controller:'resources',
			resource_name:'views',
			action:'list',
			method:'GET',
			format:'devapt_resource_api_2',
			url:url_base + 'resources/' + 'views' + '/list'
		};
		
		var record_list_models = {
			controller:'resources',
			resource_name:'models',
			action:'list',
			method:'GET',
			format:'devapt_resource_api_2',
			url:url_base + 'resources/' + 'models' + '/list'
		};
		
		var record_list_menus = {
			controller:'resources',
			resource_name:'menus',
			action:'list',
			method:'GET',
			format:'devapt_resource_api_2',
			url:url_base + 'resources/' + 'menus' + '/list'
		};
		
		var record_list_menubars = {
			controller:'resources',
			resource_name:'menubars',
			action:'list',
			method:'GET',
			format:'devapt_resource_api_2',
			url:url_base + 'resources/' + 'menubars' + '/list'
		};
		
		var record_list_loggers = {
			controller:'resources',
			resource_name:'loggers',
			action:'list',
			method:'GET',
			format:'devapt_resource_api_2',
			url:url_base + 'resources/' + 'loggers' + '/list'
		};
		
		datas.push(record_get_resource);
		datas.push(record_list_all);
		datas.push(record_list_views);
		datas.push(record_list_models);
		datas.push(record_list_menus);
		datas.push(record_list_menubars);
		datas.push(record_list_loggers);
		
		return datas;
	}
	
	
	
	/* --------------------------------------------- ENCODE/DECODE/FILTER OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptResourceApiProvider
	 * @public
	 * @method					self.encode(record)
	 * @desc					Encode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_encode = function (arg_record)
	{
		// var self = this;
		
		return null;
	};
	
	/**
	 * @memberof				DevaptResourceApiProvider
	 * @public
	 * @method					self.decode(record)
	 * @desc					Decode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_decode = function (arg_record)
	{
		// var self = this;
		
		return arg_record;
	};
	
	/**
	 * @memberof				DevaptResourceApiProvider
	 * @public
	 * @method					self.filter(record)
	 * @desc					Test if a data record should be returned by this provider
	 * @param {string|integer}	arg_record		data record
	 * @return {boolean}
	 */
	var cb_filter = function (arg_record)
	{
		return true;
	};
	
	
	
	/* --------------------------------------------- RESOURCES SETTINGS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptResourceApiProvider
	 * @public
	 * @method					self.get_model_settings()
	 * @desc					Get a settings object for model creation
	 * @return {object}
	 */
	var cb_get_model_settings = function ()
	{
		var self = this;
		if ( ! self.is_valid() )
		{
			return null;
		}
		
		var settings = {
			'name': self.name + '_model',
			
			'class_type': 'model',
			
			'access':{"create":false,"read":true,"update":false,"delete":false},
			
			"role_read":"ROLE_BROWSER_RESOURCE_API_READ",
			"role_create":"ROLE_BROWSER_RESOURCE_API_CREATE",
			"role_update":"ROLE_BROWSER_RESOURCE_API_UPDATE",
			"role_delete":"ROLE_BROWSER_RESOURCE_API_DELETE",
			
			'engine': self.get_storage_settings(),
			
			"fields":{
					"id":{
						"type":"Integer",
						"label":"Id",
						"is_pk":true
					},
					"controller":{
						"type":"String",
						"label":"Controller name"
					},
					"resource_name":{
						"type":"String",
						"label":"Resource name"
					},
					"action":{
						"type":"String",
						"label":"Action"
					},
					"method":{
						"type":"String",
						"label":"Method"
					},
					"format":{
						"type":"String",
						"label":"Format"
					},
					"url":{
						"type":"String",
						"label":"URL"
					}
				}
		};
		
		return settings;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-06-10',
			updated:'2015-06-10',
			description:'Datas RESOURCE API provider for storage engines'
		},
		mixins:[]
	};
	var parent_class = DevaptProvider;
	var DevaptResourceApiProviderClass = new DevaptClass('DevaptResourceApiProvider', parent_class, class_settings);
	
	
	// METHODS
	DevaptResourceApiProviderClass.infos.ctor = cb_constructor;
	
	DevaptResourceApiProviderClass.add_public_method('get_self_records', {}, get_self_records_cb);
	
	DevaptResourceApiProviderClass.add_public_method('encode', {}, cb_encode);
	DevaptResourceApiProviderClass.add_public_method('decode', {}, cb_decode);
	DevaptResourceApiProviderClass.add_public_method('filter', {}, cb_filter);
	
	DevaptResourceApiProviderClass.add_public_method('encode_record', {}, cb_encode);
	DevaptResourceApiProviderClass.add_public_method('decode_record', {}, cb_decode);
	DevaptResourceApiProviderClass.add_public_method('filter_record', {}, cb_filter);
	
	DevaptResourceApiProviderClass.add_public_method('get_model_settings', {}, cb_get_model_settings);
	
	
	// PROPERTIES
	
	
	return DevaptResourceApiProviderClass;
} );
/**
 * @file        datas/datasource/resources_provider.js
 * @desc        Resources datas providers
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2015-06-10
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/datasource/resources_provider',['Devapt', 'core/types', 'core/resources',
	'object/classes', 'object/class', 'datas/datasource/provider'],
function(Devapt, DevaptTypes, DevaptResources,
	DevaptClasses, DevaptClass, DevaptProvider)
{
	/**
	 * @public
	 * @class				DevaptResourcesProvider
	 * @desc				Datas records provider storage engines
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptResourcesProvider
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// self.trace=true;
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	
	/* --------------------------------------------- COLLECTION OPERATIONS ------------------------------------------------ */
	
	/**
	 * @public
	 * @static
	 * @memberof			DevaptResourcesProvider
	 * @desc				Get all records array
	 * @return {array}
	 */
	var get_self_records_cb = function(self)
	{
		return DevaptClasses.get_instances_array();
	}
	
	
	
	/* --------------------------------------------- ENCODE/DECODE/FILTER OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptResourcesProvider
	 * @public
	 * @method					self.encode(record)
	 * @desc					Encode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_encode = function (arg_record)
	{
		// var self = this;
		
		return null;
	};
	
	/**
	 * @memberof				DevaptResourcesProvider
	 * @public
	 * @method					self.decode(record)
	 * @desc					Decode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_decode = function (arg_record)
	{
		// var self = this;
		var context = 'DevaptResourcesProvider.decode(record)';
		return (!arg_record) ? {} : {
			id:arg_record.id ? arg_record.id : Devapt.uid(),
			name:arg_record.name,
			class_name:arg_record.class_name,
			trace:arg_record.trace ? true : false,
			get_instance: function() {
				var promise = DevaptResources.get_resource_instance(arg_record.name);
				return promise.then(
					function(arg_instance)
					{
						console.log(arg_instance, context + ':instance is found');
						return arg_instance;
					},
					function()
					{
						console.error(arguments, context + ':failure callback');
					}
				);
			}
		};
	};
	
	/**
	 * @memberof				DevaptResourcesProvider
	 * @public
	 * @method					self.filter(record)
	 * @desc					Test if a data record should be returned by this provider
	 * @param {string|integer}	arg_record		data record
	 * @return {boolean}
	 */
	var cb_filter = function (arg_record)
	{
		return true;
	};
	
	
	
	/* --------------------------------------------- RESOURCES SETTINGS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptResourcesProvider
	 * @public
	 * @method					self.get_model_settings()
	 * @desc					Get a settings object for model creation
	 * @return {object}
	 */
	var cb_get_model_settings = function ()
	{
		var self = this;
		if ( ! self.is_valid() )
		{
			return null;
		}
		
		var settings = {
			'name': self.name + '_model',
			
			'class_type': 'model',
			
			'access':{"create":false,"read":true,"update":false,"delete":false},
			
			"role_read":"ROLE_BROWSER_RESOURCES_READ",
			"role_create":"ROLE_BROWSER_RESOURCES_CREATE",
			"role_update":"ROLE_BROWSER_RESOURCES_UPDATE",
			"role_delete":"ROLE_BROWSER_RESOURCES_DELETE",
			
			'engine': self.get_storage_settings(),
			
			"fields":{
					"id":{
						"type":"String",
						"label":"Id",
						"is_pk":true
					},
					"name":{
						"type":"String",
						"label":"Name"
					},
					"class_name":{
						"type":"String",
						"label":"Class"
					},
					"trace":{
						"type":"Boolean",
						"label":"Trace enabled"
					},
					"get_instance":{
						"type":"Function",
						"label":"get resource instance"
					}
				}
		};
		
		return settings;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-06-10',
			updated:'2015-06-10',
			description:'Datas resources provider for storage engines'
		},
		mixins:[]
	};
	var parent_class = DevaptProvider;
	var DevaptResourcesProviderClass = new DevaptClass('DevaptResourcesProvider', parent_class, class_settings);
	
	
	// METHODS
	DevaptResourcesProviderClass.infos.ctor = cb_constructor;
	
	DevaptResourcesProviderClass.add_public_method('get_self_records', {}, get_self_records_cb);
	
	DevaptResourcesProviderClass.add_public_method('encode', {}, cb_encode);
	DevaptResourcesProviderClass.add_public_method('decode', {}, cb_decode);
	DevaptResourcesProviderClass.add_public_method('filter', {}, cb_filter);
	
	DevaptResourcesProviderClass.add_public_method('encode_record', {}, cb_encode);
	DevaptResourcesProviderClass.add_public_method('decode_record', {}, cb_decode);
	DevaptResourcesProviderClass.add_public_method('filter_record', {}, cb_filter);
	
	DevaptResourcesProviderClass.add_public_method('get_model_settings', {}, cb_get_model_settings);
	
	
	// PROPERTIES
	
	
	return DevaptResourcesProviderClass;
} );
/**
 * @file        datas/datasource/view_api_provider.js
 * @desc        VIEW API datas providers
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2015-06-10
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/datasource/view_api_provider',['Devapt', 'core/types',
	'object/classes', 'object/class', 'datas/datasource/provider'],
function(Devapt, DevaptTypes,
	DevaptClasses, DevaptClass, DevaptProvider)
{
	/**
	 * @public
	 * @class				DevaptViewApiProvider
	 * @desc				Datas records provider storage engines
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptViewApiProvider
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// self.trace=true;
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	
	/* --------------------------------------------- COLLECTION OPERATIONS ------------------------------------------------ */
	
	/**
	 * @public
	 * @static
	 * @memberof			DevaptViewApiProvider
	 * @desc				Get all records array
	 * @return {array}
	 */
	var get_self_records_cb = function(self)
	{
		var datas = [];
							
		var view_instances = DevaptClasses.get_view_instances();
		// console.log(view_instances, 'view_instances');
		
		var view_index = 0;
		for( ; view_index < view_instances.length ; view_index++)
		{
			var view = view_instances[view_index];
			
			var server_api = view.get_server_api();
			// console.log(server_api);
			
			var record_view = {
				resource_name:server_api.view_name,
				controller:'views',
				action:'display_view',
				method:server_api.action_view.method,
				format:server_api.action_view.format,
				url:server_api.action_view.url
			};
			var record_page = {
				resource_name:server_api.view_name,
				controller:'views',
				action:'display_page',
				method:server_api.action_page.method,
				format:server_api.action_page.format,
				url:server_api.action_page.url
			};
			
			datas.push(record_view);
			datas.push(record_page);
		}
		
		return datas;
	}
	
	
	
	/* --------------------------------------------- ENCODE/DECODE/FILTER OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptViewApiProvider
	 * @public
	 * @method					self.encode(record)
	 * @desc					Encode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_encode = function (arg_record)
	{
		// var self = this;
		
		return null;
	};
	
	/**
	 * @memberof				DevaptViewApiProvider
	 * @public
	 * @method					self.decode(record)
	 * @desc					Decode a data record
	 * @param {object}			arg_record		data record
	 * @return {object}
	 */
	var cb_decode = function (arg_record)
	{
		// var self = this;
		
		return arg_record;
	};
	
	/**
	 * @memberof				DevaptViewApiProvider
	 * @public
	 * @method					self.filter(record)
	 * @desc					Test if a data record should be returned by this provider
	 * @param {string|integer}	arg_record		data record
	 * @return {boolean}
	 */
	var cb_filter = function (arg_record)
	{
		return true;
	};
	
	
	
	/* --------------------------------------------- RESOURCES SETTINGS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptViewApiProvider
	 * @public
	 * @method					self.get_model_settings()
	 * @desc					Get a settings object for model creation
	 * @return {object}
	 */
	var cb_get_model_settings = function ()
	{
		var self = this;
		if ( ! self.is_valid() )
		{
			return null;
		}
		
		var settings = {
			'name': self.name + '_model',
			
			'class_type': 'model',
			
			'access':{"create":false,"read":true,"update":false,"delete":false},
			
			"role_read":"ROLE_BROWSER_VIEW_API_READ",
			"role_create":"ROLE_BROWSER_VIEW_API_CREATE",
			"role_update":"ROLE_BROWSER_VIEW_API_UPDATE",
			"role_delete":"ROLE_BROWSER_VIEW_API_DELETE",
			
			'engine': self.get_storage_settings(),
			
			"fields":{
					"id":{
						"type":"Integer",
						"label":"Id",
						"is_pk":true
					},
					"resource_name":{
						"type":"String",
						"label":"Resource name"
					},
					"controller":{
						"type":"String",
						"label":"Controller name"
					},
					"action":{
						"type":"String",
						"label":"Action"
					},
					"method":{
						"type":"String",
						"label":"Method"
					},
					"format":{
						"type":"String",
						"label":"Format"
					},
					"url":{
						"type":"String",
						"label":"URL"
					}
				}
		};
		
		return settings;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-06-10',
			updated:'2015-06-10',
			description:'Datas VIEW API provider for storage engines'
		},
		mixins:[]
	};
	var parent_class = DevaptProvider;
	var DevaptViewApiProviderClass = new DevaptClass('DevaptViewApiProvider', parent_class, class_settings);
	
	
	// METHODS
	DevaptViewApiProviderClass.infos.ctor = cb_constructor;
	
	DevaptViewApiProviderClass.add_public_method('get_self_records', {}, get_self_records_cb);
	
	DevaptViewApiProviderClass.add_public_method('encode', {}, cb_encode);
	DevaptViewApiProviderClass.add_public_method('decode', {}, cb_decode);
	DevaptViewApiProviderClass.add_public_method('filter', {}, cb_filter);
	
	DevaptViewApiProviderClass.add_public_method('encode_record', {}, cb_encode);
	DevaptViewApiProviderClass.add_public_method('decode_record', {}, cb_decode);
	DevaptViewApiProviderClass.add_public_method('filter_record', {}, cb_filter);
	
	DevaptViewApiProviderClass.add_public_method('get_model_settings', {}, cb_get_model_settings);
	
	
	// PROPERTIES
	
	
	return DevaptViewApiProviderClass;
} );
/**
 * @file        datas/datasource/all.js
 * @desc        Load all Devapt datas classes
 * @ingroup     DEVAPT_DATAS
 * @date        2015-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
	'datas/datasource/all',[
		'datas/datasource/classes_provider',
		'datas/datasource/crud_api_provider',
		'datas/datasource/datasources',
		'datas/datasource/events_provider',
		'datas/datasource/logs_provider',
		'datas/datasource/provider',
		'datas/datasource/resource_api_provider',
		'datas/datasource/resources_provider',
		'datas/datasource/view_api_provider'
	],
	function()
	{
	}
);
/**
 * @file        datas/query.js
 * @desc        Devapt datas query class
 * 					QUERY version 2 FORMAT
 * 					{
 * 						action: '...',
 * 						crud_db: '...',
 * 						crud_table: '...',
 * 						fields: [],
 * 						one_field: '...',
 * 						values: {},
 * 						values_count: ...,
 * 						filters: [],
 * 						orders: [],
 * 						groups: [],
 * 						slice: { offset:'...', length:'...' },
 * 						joins: [],
 * 					}
 * 
 * @see			object/object.js
 * @ingroup     DEVAPT_DATAS
 * @date        2014-08-12
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'datas/query',['Devapt', 'core/types', 'object/class', 'object/events', 'object/object'],
function(Devapt, DevaptTypes, DevaptClass, DevaptEvents, DevaptObject)
{
	/**
	 * @class				DevaptQuery
	 * @desc				Query class constructor
	 * @method				DevaptQuery.constructor
	 * @param {string}		arg_name				object name
	 * @param {object|null}	arg_options				associative array of name/value options
	 * @return {nothing}
	 */
	
	
	/**
	 * @memberof			DevaptQuery
	 * @public
	 * @method				DevaptQuery.constructor
	 * @desc				Query class constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		var context = self.class_name + '.constructor[' + self.name + ']';
		self.enter(context, 'constructor');
		
		
		// INIT ATTRIBUTES
		// self.trace =  true;
		self.filters_array = new Array();
		self.filters_array_by_field = new Object();
		if (self.filters && self.filters.length > 0)
		{
			self.filters_array = self.filters;
		}
		
		
		self.leave(context, 'success');
	}
	
	
	
	/**
	 * @memberof			DevaptQuery
	 * @public
	 * @method				DevaptQuery.reset()
	 * @desc				Remove all configured attributes and set a basic read all query (preserve fields, crud_db and crud_table)
	 * @return {nothing}
	 */
	var cb_reset = function()
	{
		this.action = 'read';
		this.query_type = 'select';
		
		this.one_field = null;
		
		this.values = [];
		this.values_count = 0;
		
		this.filters_array = [];
		this.orders = [];
		this.groups = [];
		this.joins = [];
		
		this.slice = null;
	}
	
	
	
	/**
	 * @memberof			DevaptQuery
	 * @public
	 * @method				DevaptQuery.reset()
	 * @desc				Remove all configured attributes and set a basic read all query (reset one_field, values, filters, slice)
	 * @return {nothing}
	 */
	var cb_select_all = function()
	{
		this.action = 'read';
		this.query_type = 'select';
		
		this.one_field = null;
		
		this.values = [];
		this.values_count = 0;
		
		this.filters_array = [];
		this.slice = null;
	}
	
	
	
	/**
	 * @memberof			DevaptQuery
	 * @public
	 * @method				DevaptQuery.is_empty()
	 * @desc				Is empty
	 * @return {boolean}
	 */
	var cb_is_empty = function()
	{
		var self = this;
		var context = 'is_empty()';
		self.enter(context, '');
		
		var is_empty_action = (self.action === null && self.query_type === null) || (self.action === 'read' && self.query_type === 'select');
		var is_empty = is_empty_action && self.values.length && self.slice.length && self.filters_array.length;
		
		self.leave(context, 'success');
		return is_empty;
	}
	
	
	/**
	 * @memberof			DevaptQuery
	 * @public
	 * @method				DevaptQuery.get_json()
	 * @desc				Get query version 2 JSON object
	 * @return {object}
	 */
	var cb_get_json = function()
	{
		var self = this;
		var context = 'get_json()';
		self.enter(context, '');
		
		self.value(context, 'self.filters_array', self.filters_array);
		
		var json_obj = {
			query_json: {
				action: self.action,
				query_type: self.query_type,
				crud_db: self.crud_db,
				crud_table: self.crud_table,
				fields: self.fields,
				one_field: self.one_field,
				values: self.values,
				values_count: self.values_count,
				filters: self.filters_array,
				orders: self.orders,
				groups: self.groups,
				slice: self.slice,
				joins: self.joins
			}
		};
		// console.log(self.filters_array, self.name + '.' + context);
		// console.log(json_obj, context + '.json_obj');
		
		
		self.leave(context, 'success');
		return json_obj;
	}
	
	
	/**
	 * @memberof			DevaptQuery
	 * @public
	 * @method				DevaptQuery.get_key()
	 * @desc				Get query version 2 key string
	 * @return {string}
	 */
	var cb_get_key = function()
	{
		var self = this;
		var context = 'get_key()';
		self.enter(context, '');
		
		
		var json = self.get_json();
		var json_str = JSON.stringify(json);
		if ( ! DevaptTypes.is_not_empty_str(json_str) )
		{
			self.leave(context, Devapt.msg_failure);
			return null;
		}
		
		
		self.leave(context, Devapt.msg_success);
		return Devapt.hash('md5', json_str);
	}
	
	
	/**
	 * @memberof			DevaptQuery
	 * @public
	 * @method				DevaptQuery.remove_filters_for_field(field name)
	 * @desc				Remove all filters for the given field from the query
	 * @param {string}		arg_field_name
	 * @return {nothing}
	 */
	var cb_remove_filters_for_field = function(arg_field_name)
	{
		var self = this;
		var context = 'remove_filters_for_field(' + arg_field_name + ')';
		self.enter(context, '');
		
		
		self.value(context, 'self.filters_array', self.filters_array);
		// console.log(self, context + '.self');
		
		// GET FILTERS FOR FIELD
		var field_filters = self.filters_array_by_field[arg_field_name];
		if ( ! DevaptTypes.is_array(field_filters) )
		{
			self.leave(context, 'nothing to remove');
			return;
		}
		
		// TEST : REMOVE ALL
		if (field_filters.length === self.filters_array.length)
		{
			self.filters_array_by_field[arg_field_name] = [];
			self.filters_array = new Array();
			self.leave(context, 'remove all filters');
			return;
		}
		
		// LOOP ON FILTERS FOR FIELD
		var filter_key = null;
		for(filter_key in field_filters)
		{
			self.value(context, 'loop on filter key', filter_key);
			
			// GET FILTER
			var filter_ref = field_filters[filter_key];
			var filter_index = filter_ref.index;
			self.value(context, 'loop filter index', filter_index);
			// console.log('loop removed filter at ' + filter_index);
			
			// REMOVE FILTER
			self.filters_array.splice(filter_index, 1);
		}
		
		delete self.filters_array_by_field[arg_field_name];
//		self.filters_array_by_field[arg_field_name] = new Array();
//		
//		self.filters_array.forEach(
//			function(index, item, array)
//			{
//				if (item === null)
//				{
//					delete array[index];
//				}
//			}
//		);
		
		
		self.leave(context, 'success');
	}
	
	
	/**
	 * @memberof			DevaptQuery
	 * @public
	 * @method				DevaptQuery.add_filter(filter)
	 * @desc				Add a filter to the query
	 * @param {string}		arg_field_name
	 * @param {object}		arg_filter
	 * @param {boolean}		filter should be unique on this field
	 * @return {nothing}
	 */
	var cb_add_filter = function(arg_field_name, arg_filter, arg_is_unique)
	{
		var self = this;
		var context = 'add_filter(field name,filter,unique)';
		self.enter(context, '');
		
		
		// DEBUG
		// self.trace =  true;
		self.value(context, 'self.filters_array', self.filters_array);
		self.value(context, 'arg_filter', arg_filter);
		// console.log(self, context + ':query');
		
		// INIT FILTERS
		if ( ! DevaptTypes.is_array(self.filters_array) )
		{
			self.step(context, 'init Query filters');
			self.filters_array = new Array();
		}
		
		// REMOVE EXISTING FILED FILTERS
		if (arg_is_unique)
		{
			self.step(context, 'filter is unique');
			self.remove_filters_for_field(arg_field_name);
		}
		// self.value(context, 'filters', self.filters_array);
		// console.log(self.filters_array, context + '[' + self.name + '] filters before');
		self.value(context, 'filters before', self.filters_array);
		
		// ADD FILTER FOR FIELD
		var field_filters = self.filters_array_by_field[arg_field_name];
		if ( ! DevaptTypes.is_array(field_filters) )
		{
			self.step(context, 'init Query filters for field [' + arg_field_name + ']');
			self.filters_array_by_field[arg_field_name] = [];
			field_filters = self.filters_array_by_field[arg_field_name];
		}
		field_filters.push( { index:self.filters_array.length, field_name:arg_field_name } );
		// self.value(context, 'field_filters', field_filters);
		// console.log(field_filters, context + '[' + self.name + '].field_filters for [' + arg_field_name + ']');
		
		// ADD FILTER FOR QUERY
		self.filters_array.push(arg_filter);
		// self.value(context, 'filters', self.filters_array);
		// console.log(self.filters_array, context + '[' + self.name + '] filters after');
		
		// DEBUG
		// self.trace = false;
		
		
		self.leave(context, 'success');
	}
	
	
	
	// ONE FIELD
	var cb_set_one_field = function(arg_one_field)
	{
		// this.assert(arg_one_field instanceof LibaptField);
		this.one_field = arg_one_field;
		return true;
	}
	
	// ACTION METHOD - SET
	var cb_set_action = function(arg_action)
	{
		this.action = arg_action;
	}
	
	var cb_set_select = function()
	{
		this.action = 'read';
		this.query_type = 'select';
	}
	
	var cb_set_select_distinct = function()
	{
		this.action = 'read';
		this.query_type = 'select_distinct';
	}
	
	var cb_set_select_distinct_one = function()
	{
		this.action = 'read';
		this.query_type = 'select_distinct_one';
	}
	
	var cb_set_select_count = function()
	{
		this.action = 'read';
		this.query_type = 'select_count';
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-12',
			'updated':'2014-12-13',
			'description':'Datas query class.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptObject;
	var DevaptQueryClass = new DevaptClass('DevaptQuery', parent_class, class_settings);
	
	// METHODS
	DevaptQueryClass.infos.ctor = cb_constructor;
	
	DevaptQueryClass.add_public_method('reset', {}, cb_reset);
	DevaptQueryClass.add_public_method('select_all', {}, cb_select_all);
	DevaptQueryClass.add_public_method('is_empty', {}, cb_is_empty);
	
	DevaptQueryClass.add_public_method('get_json', {}, cb_get_json);
	DevaptQueryClass.add_public_method('get_key', {}, cb_get_key);
	
	DevaptQueryClass.add_public_method('add_filter', {}, cb_add_filter);
	DevaptQueryClass.add_public_method('remove_filters_for_field', {}, cb_remove_filters_for_field);
	
	DevaptQueryClass.add_public_method('set_one_field', {}, cb_set_one_field);
	DevaptQueryClass.add_public_method('set_action', {}, cb_set_action);
	DevaptQueryClass.add_public_method('set_select', {}, cb_set_select);
	DevaptQueryClass.add_public_method('set_select_distinct', {}, cb_set_select_distinct);
	DevaptQueryClass.add_public_method('set_select_distinct_one', {}, cb_set_select_distinct_one);
	DevaptQueryClass.add_public_method('set_select_count', {}, cb_set_select_count);
	
	// PROPERTIES
	DevaptQueryClass.add_public_str_property('is_query',		'object is a query', true, false, true, []);
	
	DevaptQueryClass.add_public_str_property('action',			'', null, true, false, []);
	DevaptQueryClass.add_public_str_property('query_type',		'', null, true, false, []);
	DevaptQueryClass.add_public_str_property('crud_db',			'', null, false, false, []);
	DevaptQueryClass.add_public_str_property('crud_table',		'', null, false, false, []);
	DevaptQueryClass.add_public_str_property('one_field',		'', null, true, false, []);
	DevaptQueryClass.add_public_str_property('values_count',	'', null, true, false, []);
	
	DevaptQueryClass.add_public_array_property('fields',		'', [], false, false, [], 'string', ',');
	DevaptQueryClass.add_public_array_property('values',		'', [], false, false, [], 'string', ',');
	DevaptQueryClass.add_public_array_property('filters',		'', [], false, false, [], 'object', '|');
	DevaptQueryClass.add_public_array_property('orders',		'', [], false, false, [], 'object', ',');
	DevaptQueryClass.add_public_array_property('groups',		'', [], false, false, [], 'string', ',');
	DevaptQueryClass.add_public_array_property('joins',			'', [], false, false, [], 'object', ',');
	
	DevaptQueryClass.add_public_object_property('slice',		'', null, false, false, []);
	
	
	return DevaptQueryClass;
} );

/**
 * @file        datas/mixin-status.js
 * @desc        Mixin for resources data source
 *              API:
 *                  ->constructor()         : nothing
 *  
 *                  ->get_status()            : string
 *                  ->set_status(status)      : nothing
 *  				
 *                  ->get_error()             : string
 *                  ->set_error(error)        : nothing
 *  				
 *                  ->set_ok()                : nothing
 *  				
 *                  ->is_valid()              : boolean (query, model, view, records are valid object and status is 'ok')
 *                  ->is_ok()                 : boolean (status is 'ok')
 *                  ->is_error()              : boolean (status is 'error')
 *  			
 * @see			...
 * @ingroup     DEVAPT_CORE
 * @date        2015-02-05
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'object/mixin-status',['Devapt', 'core/types', 'object/class'],
function(Devapt, DevaptTypes, DevaptClass)
{
	/**
	 * @mixin				DevaptMixinStatus
	 * @public
	 * @desc				Mixin for status and error
	 */
	var DevaptMixinStatus = 
	{
		/**
		 * @public
		 * @memberof			DevaptMixinStatus
		 * @desc				Init mixin
		 * @return {nothing}
		 */
		init_mixin_status: function(self)
		{
			// var self = this;
			var context = 'init_mixin_status()';
			self.enter(context, '');
			
			
			
			self.leave(context, Devapt.msg_success);
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinStatus
		 * @desc				Get status
		 * @return {nothing}
		 */
		get_status: function()
		{
			var self = this;
			var context = 'get_status()';
			self.enter(context, '');
			
			
			self.leave(context, Devapt.msg_success);
			return self.status;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinStatus
		 * @desc				Set status
		 * @param{string}		arg_status		new status
		 * @return {nothing}
		 */
		set_status: function(arg_status)
		{
			var self = this;
			var context = 'set_status(status)';
			self.enter(context, '');
			
			self.status = arg_status;
			
			self.leave(context, Devapt.msg_success);
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinStatus
		 * @desc				Get error
		 * @return {nothing}
		 */
		get_error: function()
		{
			var self = this;
			var context = 'get_error()';
			self.enter(context, '');
			
			
			self.leave(context, Devapt.msg_success);
			return self.error_msg;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinStatus
		 * @desc				Set error status
		 * @param{string}		arg_error		new error
		 * @return {nothing}
		 */
		set_error: function(arg_error)
		{
			var self = this;
			var context = 'set_error(error)';
			self.enter(context, '');
			
			self.status = 'error';
			self.error_msg = arg_error;
			
			self.leave(context, Devapt.msg_success);
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinStatus
		 * @desc				Set ok status
		 * @return {nothing}
		 */
		set_ok: function()
		{
			var self = this;
			var context = 'set_ok()';
			self.enter(context, '');
			
			self.status = 'ok';
			self.error_msg = null;
			
			self.leave(context, Devapt.msg_success);
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinStatus
		 * @desc				Is valid
		 * @return {boolean}
		 */
		is_valid: function()
		{
			var self = this;
			var context = 'is_valid()';
			self.enter(context, '');
			
			switch(self.status)
			{
				case 'ok':
					self.leave(context, Devapt.msg_success);
					return self.error_msg === null;
				
				case 'error':
					self.leave(context, Devapt.msg_success);
					return self.error_msg !== null;
			}
			
			self.leave(context, Devapt.msg_success);
			return false;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinStatus
		 * @desc				Is ok
		 * @return {boolean}
		 */
		is_ok: function()
		{
			var self = this;
			var context = 'is_ok()';
			self.enter(context, '');
			
			self.leave(context, Devapt.msg_success);
			return self.status === 'ok';
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinStatus
		 * @desc				Is error
		 * @return {boolean}
		 */
		is_error: function()
		{
			var self = this;
			var context = 'is_error()';
			self.enter(context, '');
			
			self.leave(context, Devapt.msg_success);
			return self.status === 'error';
		}
	};
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-02-05',
			'updated':'2015-02-05',
			'description':'Mixin methods for status of object.'
		}
	};
	
	// CREATE CLASS
	var DevaptMixinStatusClass = new DevaptClass('DevaptMixinStatus', null, class_settings);
	
	// METHODS
	DevaptMixinStatusClass.infos.ctor = DevaptMixinStatus.init_mixin_status;
	
	DevaptMixinStatusClass.add_public_method('get_status', {}, DevaptMixinStatus.get_status);
	DevaptMixinStatusClass.add_public_method('set_status', {}, DevaptMixinStatus.set_status);
	
	DevaptMixinStatusClass.add_public_method('get_error', {}, DevaptMixinStatus.get_error);
	DevaptMixinStatusClass.add_public_method('set_error', {}, DevaptMixinStatus.set_error);
	
	DevaptMixinStatusClass.add_public_method('set_ok', {}, DevaptMixinStatus.set_ok);
	
	DevaptMixinStatusClass.add_public_method('is_valid', {}, DevaptMixinStatus.is_valid);
	DevaptMixinStatusClass.add_public_method('is_ok', {}, DevaptMixinStatus.is_ok);
	DevaptMixinStatusClass.add_public_method('is_error', {}, DevaptMixinStatus.is_error);
	
	// PROPERTIES
	DevaptMixinStatusClass.add_public_str_property('status', 'object status', null, false, true, []);
	DevaptMixinStatusClass.add_public_str_property('error_msg', 'object error message', null, false, true, []);
	
	// BUILD CLASS
	DevaptMixinStatusClass.build_class();
	
	
	return DevaptMixinStatusClass;
}
);
/**
 * @file        datas/model/record.js
 * @desc        A record of fields values from a RecordSet
 *              API:
 *                  ->constructor(object) : nothing
 *  
 *                  ->update_status()     : Update status with the datas check
 *                  ->free()              : Reset Record
 *                  
 *                  ->load_from_id(id)    : Load all record fields values from the model for the given id
 *                  ->load(datas)         : Load all record fields values from the given datas
 *                  ->save()              : Save all record fields values to the model
 *                  ->erase()             : Delete this record into the model
 *  
 *                  ->get_id()            : Get Record id value 
 *                  ->get_datas()         : Get Record values object
 *                  ->get_fields_values() : Get Record field_name/field_value pairs array
 *                  ->get(name)           : Get the field value with the given name for this record get_fields_values
 *                  ->set(name,value)     : Set the field value with the given name for this record
 *  				
 *  				->select()            : Record enters in select mode
 *  				->unselect()          : Record leaves in select mode
 *  				
 *  				- model : the model which stores the datas
 *  				- datas : current record values
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2015-04-24
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/model/record',['Devapt',
	'core/types',
	'object/class', 'object/object', 'object/mixin-status',
	'datas/query'],
function(Devapt,
	DevaptTypes, DevaptClass,
	DevaptObject, DevaptMixinStatus,
	DevaptQuery)
{
	/**
	 * @public
	 * @class				DevaptRecord
	 * @desc				A set of fields values
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptRecord
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// self.trace=true;
		
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// INIT STATUS
		self.status = 'empty';
		self.error_msg = null;
		
		
		// INIT DATAS
		if (self.datas)
		{
			self.step(context, 'INIT DATAS');
			var is_loaded = self.load(self.datas);
			self.assert_true(context, 'is_loaded', is_loaded);
//			self.is_dirty = ! is_loaded;
		}
		
		// INIT ATTACHED VIEWS MAP
		self.attached_views_map = {};
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	
	/* --------------------------------------------- STATUS OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.update_status()
	 * @desc					Update the Record status with the datas
	 * @return {nothing}
	 */
	var cb_update_status = function()
	{
		var self = this;
		
		
		// SET VALID STATUS
		if ( DevaptTypes.is_object(self.datas) && Object.keys(self.datas).length === self.recordset.model.fields.length )
		{
			self.status = 'ok';
			self.error_msg = null;
			return;
		}
		
		// SET ERROR STATUS
		self.status = 'error';
		self.error_msg = self.error_msg ? self.error_msg : 'bad datas';
	};
	
	
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.free()
	 * @desc					Unuse the Record, reset attributes
	 * @return {nothing}
	 */
	var cb_free = function ()
	{
		var self = this;
		var context = 'free()';
		self.enter(context, '');
		
		
		self.is_dirty = false;
		
		// LOOP ON FIELDS
		var fields = self.recordset.model.fields_map;
		for(var field_name in self.datas)
		{
			var field = fields[field_name];
			self.datas[field_name] = field.field_value.default;
		}
		
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	
	/* --------------------------------------------- LOAD / SAVE / ERASE OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.load_from_id(arg_id)
	 * @desc					Load the record from an id value
	 * @param {string|integer}	arg_id		id field values
	 * @return {promise}
	 */
	var cb_load_from_id = function (arg_id)
	{
		var self = this;
		var context = 'load_from_id(id)';
		self.enter(context, DevaptTypes.to_string(arg_id, 'bad id') );
		
		
		// CHECK MODEL
		self.assert_object(context, 'model', self.recordset.model);
		
		// CHECK ID
		self.assert_not_empty_str(context, 'id', arg_id);
		
		// CREATE QUERY
		var pk_field_name = self.recordset.model.get_pk_field().name;
		var query_name = Devapt.get_unique_name(self.recordset.model.name + '_query');
		var query = DevaptQuery.create(query_name, {});
		query.set_select();
		query.add_filter(pk_field_name, arg_id, true);
		
		var read_promise = self.recordset.model.read(query);
		
		self.status = 'loading';
		self.error_msg = null;
		self.is_dirty = true;
		
		read_promise.then(
			function(recordset)
			{
				var items = recordset.get_records();
				if ( DevaptTypes.is_not_empty_array(items) )
				{
					self.datas = items[0];
					self.status = 'ok';
					self.error_msg = null;
					return;
				}
				
				// ERROR
				self.datas = null;
				self.status = 'error';
				self.error_msg = 'model.read recordset failure';
				
				// FREE QUERY
				query.destroy();
				// delete query; // TODO DELETE
			},
			
			function()
			{
				self.datas = null;
				self.status = 'error';
				self.error_msg = 'model.read failure';
				
				// FREE QUERY
				query.destroy();
				// delete query; // TODO DELETE
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return read_promise;
	};
	
	
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.load(arg_datas)
	 * @desc					Update the record with given fields values
	 * @param {object|array}	arg_datas	fields values
	 * @return {promise}
	 */
	var cb_load = function (arg_datas)
	{
		var self = this;
		var context = 'load(datas)';
		self.enter(context, arg_datas && DevaptTypes.to_integer(arg_datas.length, -1) );
		
		
		// CHECK MODEL
		self.assert_object(context, 'recordset', self.recordset);
		self.assert_object(context, 'model', self.recordset.model);
		
		
		// INIT DATAS
		self.datas = null;
		self.is_dirty = true;
		
		
		// TEST GIVEN DATAS
		if (DevaptTypes.is_object(arg_datas) && arg_datas.is_record)
		{
			self.step(context, 'INIT DATAS WITH A RECORD');
			
			self.datas = arg_datas.datas;
		}
		
		else if ( DevaptTypes.is_string(arg_datas) || DevaptTypes.is_integer(arg_datas) )
		{
			self.step(context, 'INIT DATAS WITH AN ID');
			
			var promise = self.load_from_id();
			
			self.leave(context, Devapt.msg_success_promise);
			return promise;
		}
		
		else if ( DevaptTypes.is_object(arg_datas) )
		{
			self.step(context, 'INIT DATAS WITH AN OBJECT');
			
			self.datas = {};
			
			// LOOP ON FIELDS
			var fields = self.recordset.model.fields_map;
			for(var field_name in fields)
			{
				var field = fields[field_name];
				var field_value = field_name in arg_datas ? arg_datas[field_name] : field.field_value.default;
				self.datas[field_name] = field_value;
			}
		}
		
		else if ( DevaptTypes.is_array(arg_datas) && arg_datas.length === self.recordset.model.fields.lenth )
		{
			self.datas = {};
			
			// LOOP ON FIELDS
			var all_fields = self.recordset.model.fields;
			for(var field_index in all_fields)
			{
				var loop_field = all_fields[field_index];
				if ( DevaptTypes.is_integer(loop_field.index) && loop_field.index >=0 )
				{
					field_index = loop_field.index;
				}
				var value = field_index in arg_datas ? arg_datas[field_index] : loop_field.field_value.default;
				self.datas[loop_field.name] = value;
			}
		}
		
		// UPDATE RECORD STATUS
		self.update_status();
		
		// RECORD EXISTS IN STORAGE ENGINE (DB)
		if ( self.get_id() )
		{
			self.is_created = true;
		}
		
		// CHECK RECORD DATAS
		if ( self.is_ok() )
		{
			self.leave(context, Devapt.msg_success_promise);
			return Devapt.promise_resolved();
		}
		
		
		self.leave(context, Devapt.msg_failure_promise);
		return Devapt.promise_rejected();
	};
	
	
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.save()
	 * @desc					Save record datas to the model
	 * @return {promise}
	 */
	var cb_save = function ()
	{
		var self = this;
		var context = 'save()';
		self.enter(context, '');
		
		
		// CHECK MODEL
		self.assert_object(context, 'recordset', self.recordset);
		self.assert_object(context, 'model', self.recordset.model);
		self.assert_object(context, 'datas', self.datas);
		self.assert_true(context, 'is_ok', self.is_ok());
		
		if (! self.is_dirty)
		{
			self.step(context, 'record is not dirty: nothing to do');
			
			self.leave(context, Devapt.msg_success_promise);
			return Devapt.promise_resolved();
		}
		
		// MODEL OPERATION
		var promise = null;
		if (self.is_created)
		{
			promise = self.recordset.model.update( [self] );
		}
		else
		{
			promise = self.recordset.model.create( [self] );
		}
		promise.then(
			function()
			{
				self.is_dirty = false;
				self.is_created = true;
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.erase()
	 * @desc					Delete record data from the model
	 * @return {promise}
	 */
	var cb_erase = function ()
	{
		var self = this;
		var context = 'erase()';
		self.enter(context, '');
		
		
		// CHECK MODEL
		self.assert_object(context, 'recordset', self.recordset);
		self.assert_object(context, 'model', self.recordset.model);
		self.assert_object(context, 'datas', self.datas);
		self.assert_not_empty_string(context, 'id_field_name', self.recordset.id_field_name);
		self.assert_true(context, 'is_ok', self.is_ok());
		
		// MODEL OPERATION
//		var record_id = {};
//		record_id[self.recordset.id_field_name] = self.get_id();
		
		var promise = self.recordset.model.delete([self]);
		promise.then(
			function()
			{
				self.free();
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	
	/* --------------------------------------------- FIELDS VALUES OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.get_id()
	 * @desc					Get record id value
	 * @return {string}
	 */
	var cb_get_id = function ()
	{
		var self = this;
		var context = 'get_id()';
		self.enter(context, '');
		
		self.assert_object(context, 'recordset', self.recordset);
		self.assert_object(context, 'datas', self.datas);
		var id = (self.recordset.id_field_name in self.datas) ? self.datas[self.recordset.id_field_name] : null;
		
		self.leave(context, Devapt.msg_success);
		return id;
	};
	
	
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.get_datas()
	 * @desc					Get record plain object datas
	 * @return {object}
	 */
	var cb_get_datas = function ()
	{
		var self = this;
		var context = 'get_datas()';
		self.enter(context, '');
		
		
		self.leave(context, Devapt.msg_success);
		return self.datas;
	};
	
	
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.has_field(field name)
	 * @desc					Test if Record has the given field name
	 * @param {string}			arg_field_name	field name
	 * @return {boolean}
	 */
	var cb_has_field = function (arg_field_name)
	{
		var self = this;
		var context = 'has_field()';
		self.enter(context, '');
		
		var found = arg_field_name in self.datas;
		
		self.leave(context, found ? Devapt.msg_found : Devapt.msg_not_found);
		return found;
	};
	
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.has_field_value(field name, field value)
	 * @desc					Test if Record has the given field name and field value
	 * @param {string}			arg_field_name	field name
	 * @param {anything}		arg_field_value	field value
	 * @return {boolean}
	 */
	var cb_has_field_value = function (arg_field_name, arg_field_value)
	{
		var self = this;
		var context = 'has_field()';
		self.enter(context, '');
		
		var found = arg_field_name in self.datas;
		var field_value = found ? self.datas[arg_field_name] : null;
		found = found && (field_value == arg_field_value);
		
		self.leave(context, found ? Devapt.msg_found : Devapt.msg_not_found);
		return found;
	};
	
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.get_fields_values()
	 * @desc					Get datas fields/values array
	 * @param {array}			arg_fields_names	Fields names list (Optional)
	 * @return {array}
	 */
	var cb_get_fields_values = function (arg_fields_names)
	{
		var self = this;
		var context = 'get_fields_values()';
		self.enter(context, '');
		
		// SET FIELDS NAMES
		var fields_names = DevaptTypes.is_not_empty_array(arg_fields_names) ? arg_fields_names : Object.keys(self.datas);
		var items = [];
		
		// LOOP ON FIELDS
		for(var field_name_index in fields_names)
		{
			var field_name = fields_names[field_name_index];
			self.value(context, 'loop on field at', field_name);
			
			var field_value = (field_name in self.datas) ? self.datas[field_name] : null;
			var field_record = { 'field_name': field_name, 'field_value': field_value };
			
			items.push(field_record);
		}
		
		self.leave(context, Devapt.msg_success);
		return items;
	};
	
	
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.get(field)
	 * @desc					Get record value for the given field
	 * @param {string|object}	arg_field		field name or field object
	 * @return {anything}
	 */
	var cb_get = function (arg_field)
	{
		var self = this;
		var context = 'get(field)';
		self.enter(context, '');
		
		
		// CHECK MODEL
		self.assert_object(context, 'recordset', self.recordset);
		self.assert_object(context, 'model', self.recordset.model);
		self.assert_object(context, 'datas', self.datas);
		self.assert_true(context, 'is_ok', self.is_ok());
		
		// CHECK FIELD
		var field_name = null;
		if ( DevaptTypes.is_not_empty_str(arg_field) )
		{
			if (arg_field in self.recordset.model.fields_map)
			{
				field_name = arg_field;
			}
		}
		else if ( DevaptTypes.is_object(arg_field) && arg_field.is_field )
		{
			field_name = arg_field.name;
		}
		
		// DATAS OPERATION
		self.assert_not_empty_string(context, 'field', field_name);
		var value = self.datas[field_name];
		
		
		self.leave(context, Devapt.msg_success);
		return value;
	};
	
	
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.get(field,value)
	 * @desc					Get record value for the given field
	 * @param {string|object}	arg_field		field name or field object
	 * @param {anything}		arg_value		field value
	 * @return {boolean}
	 */
	var cb_set = function (arg_field, arg_value)
	{
		var self = this;
		var context = 'set(field,value)';
		self.enter(context, '');
		
		
		// CHECK MODEL
		self.assert_object(context, 'recordset', self.recordset);
		self.assert_object(context, 'model', self.recordset.model);
		self.assert_object(context, 'datas', self.datas);
		self.assert_true(context, 'is_ok', self.is_ok());
		
		// CHECK FIELD
		var field_name = null;
		if ( DevaptTypes.is_not_empty_str(arg_field) )
		{
			if (arg_field in self.recordset.model.fields_map)
			{
				field_name = arg_field;
			}
		}
		else if ( DevaptTypes.is_object(arg_field) && arg_field.is_field )
		{
			field_name = arg_field.name;
		}
		
		// DATAS OPERATION
		self.assert_not_empty_string(context, 'field', field_name);
		self.datas[field_name] = arg_value;
		self.is_dirty = true;
		
		
		self.leave(context, Devapt.msg_success);
		return true;
	};
	
	
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.fill_with_defaults()
	 * @desc					Fill record with fields default values
	 * @return {boolean}
	 */
	var cb_fill_with_defaults = function ()
	{
		var self = this;
		var context = 'fill_with_defaults()';
		self.enter(context, '');
		
		
		// CHECK MODEL
		self.assert_object(context, 'recordset', self.recordset);
		self.assert_object(context, 'model', self.recordset.model);
		
		// TARGET DATAS
		var datas = {};
		
		// LOOP ON MODEL FIELDS
		var fields = self.recordset.model.fields;
		for(var field_index in fields)
		{
			var field = fields[field_index];
			
			if ( field.is_pk )
			{
				continue;
			}
			
			var default_value = field.field_value.default;
			self.value(context, 'field_name', field.name);
			self.value(context, 'default_value', default_value);
			
			datas[field.name] = default_value;
		}
		
		self.load(datas);
		
		
		self.leave(context, Devapt.msg_success);
		return true;
	};
	
	
	
	/* --------------------------------------------- SELECT OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.select()
	 * @desc					This record enters in select mode
	 * @return {nothing}
	 */
	var cb_select = function ()
	{
		var self = this;
		var context = 'select()';
		self.enter(context, '');
		
		// NOTHING TO DO
		
		self.leave(context, Devapt.msg_success);
	};
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					DevaptRecord.unselect()
	 * @desc					This record leaves select mode
	 * @return {nothing}
	 */
	var cb_unselect = function ()
	{
		var self = this;
		var context = 'unselect()';
		self.enter(context, '');
		
		
		if (self.is_dirty || ! self.is_created)
		{
			self.save();
		}
		
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	
	/* --------------------------------------------- ATTACHED VIEWS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					self.attach_view(arg_view, arg_options)
	 * @desc					Register a view which use this record and set some view relative attributes
	 * @param {object}			arg_view		A View object
	 * @param {object}			arg_options		Plain object attribtues (optional)
	 * @return {nothing}
	 */
	var cb_attach_view = function (arg_view, arg_options)
	{
		var self = this;
		var context = 'attach_view(view,options)';
		self.enter(context, '');
		
		
		// CHECK ARGS
		self.assert_object(context, 'view', arg_view);
		if (arg_view.name in self.attached_views_map)
		{
			self.leave(context, 'Already attached');
			return true;
		}
		
		// ATTACH
		var options = DevaptTypes.is_object(arg_options) ? arg_options : {};
		options.view = arg_view;
		self.attached_views_map[arg_view.name] = options;
		
		
		self.leave(context, Devapt.msg_success);
		return true;
	};
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					self.detach_view(arg_view)
	 * @desc					Unegister a view which use this record
	 * @param {object}			arg_view		A View object
	 * @return {boolean}
	 */
	var cb_detach_view = function (arg_view)
	{
		var self = this;
		var context = 'detach_view(view)';
		self.enter(context, '');
		
		
		// CHECK ARGS
		self.assert_object(context, 'view', arg_view);
		
		// TEST AND PROCESS
		if (arg_view.name in self.attached_views_map)
		{
			// DETACH VIEW
			var options = self.attached_views_map[arg_view.name];
			options.view = null;
			delete self.attached_views_map[arg_view.name];
			
			self.leave(context, Devapt.msg_success);
			return true;
		}
		
		
		self.leave(context, Devapt.msg_not_found);
		return false;
	};
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					self.get_view_attributes()
	 * @desc					Get attached view record attributes
	 * @param {object}			arg_view		A View object
	 * @return {object}			
	 */
	var cb_get_view_attributes = function (arg_view)
	{
		var self = this;
		var context = 'get_view_attributes(view)';
		self.enter(context, '');
		
		
		// CHECK ARGS
		self.assert_object(context, 'view', arg_view);
		
		// TEST AND PROCESS
		if (arg_view.name in self.attached_views_map)
		{
			self.leave(context, Devapt.msg_found);
			return self.attached_views_map[arg_view.name];
		}
		
		
		self.leave(context, Devapt.msg_not_found);
		return null;
	};
	
	/**
	 * @memberof				DevaptRecord
	 * @public
	 * @method					self.set_view_attributes()
	 * @desc					Set/Replace attached view record attributes
	 * @param {object}			arg_view		A View object
	 * @param {object}			arg_options		Plain object attribtues (optional)
	 * @return {nothing}
	 */
	var cb_set_view_attributes = function (arg_view, arg_options)
	{
		var self = this;
		var context = 'set_view_attributes(view,options)';
		self.enter(context, '');
		
		
		// CHECK ARGS
		self.assert_object(context, 'view', arg_view);
		
		// TEST AND PROCESS
		if (arg_view.name in self.attached_views_map)
		{
			var options = DevaptTypes.is_object(arg_options) ? arg_options : {};
			options.view = arg_view;
			self.attached_views_map[arg_view.name] = options;
			
			self.leave(context, 'Already attached');
			return true;
		}
		
		
		self.leave(context, Devapt.msg_not_found);
		return false;
	};
	
	
	
	/* --------------------------------------------- DUMP ------------------------------------------------ */
	
	/**
	 * @memberof			DevaptRecord
	 * @public
	 * @method				self.to_string()
	 * @desc				Get a string output of the object
	 * @return {string}		String output
	 */
	var cb_to_string = function()
	{
		var self = this;
		
		var str = '';
		var members = self._class.properties.all_map;
		for(var key in members)
		{
			var property = members[key];
			var member = self[property.name];
			
			if (member === self || property.name === 'recordset')
			{
				continue;
			}
			
			if ( ! DevaptTypes.is_function(member) )
			{
				str += '\n  ' + property.name + '=' + DevaptTypes.get_value_str(member, 0);
			}
		}
		return str;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-04-24',
			updated:'2015-04-24',
			description:'A record of fields values'
		},
		mixins:[DevaptMixinStatus]
	};
	var parent_class = DevaptObject;
	var DevaptRecordClass = new DevaptClass('DevaptRecord', parent_class, class_settings);
	
	// METHODS
	DevaptRecordClass.infos.ctor = cb_constructor;
	
	DevaptRecordClass.add_public_method('update_status', {}, cb_update_status);
	DevaptRecordClass.add_public_method('free', {}, cb_free);
	
	DevaptRecordClass.add_public_method('load_from_id', {}, cb_load_from_id);
	DevaptRecordClass.add_public_method('load', {}, cb_load);
	
	DevaptRecordClass.add_public_method('save', {}, cb_save);
	DevaptRecordClass.add_public_method('erase', {}, cb_erase);
	
	DevaptRecordClass.add_public_method('get_id', {}, cb_get_id);
	DevaptRecordClass.add_public_method('get_datas', {}, cb_get_datas);
	DevaptRecordClass.add_public_method('has_field', {}, cb_has_field);
	DevaptRecordClass.add_public_method('has_field_value', {}, cb_has_field_value);
	DevaptRecordClass.add_public_method('get_fields_values', {}, cb_get_fields_values);
	DevaptRecordClass.add_public_method('get', {}, cb_get);
	DevaptRecordClass.add_public_method('set', {}, cb_set);
	DevaptRecordClass.add_public_method('fill_with_defaults', {}, cb_fill_with_defaults);
	
	DevaptRecordClass.add_public_method('select', {}, cb_select);
	DevaptRecordClass.add_public_method('unselect', {}, cb_unselect);
	
	DevaptRecordClass.add_public_method('attach_view', {}, cb_attach_view);
	DevaptRecordClass.add_public_method('detach_view', {}, cb_detach_view);
	DevaptRecordClass.add_public_method('get_view_attributes', {}, cb_get_view_attributes);
	DevaptRecordClass.add_public_method('set_view_attributes', {}, cb_set_view_attributes);
	
	DevaptRecordClass.add_public_method('to_string', {}, cb_to_string);
	
	// PROPERTIES
	DevaptRecordClass.add_public_bool_property('is_record', 'object is a Record object', true, false, true, []);
	DevaptRecordClass.add_public_bool_property('is_dirty', 'object Record should be saved', true, false, true, []);
	DevaptRecordClass.add_public_bool_property('is_created', 'object Record exists in storage engine (db)', false, false, true, []);
	DevaptRecordClass.add_public_object_property('recordset', 'Recordset of the record', null, false, false, [], 'object', '|');
	DevaptRecordClass.add_public_object_property('datas', 'source datas', null, false, false, [], 'object', '|');
	
	
	return DevaptRecordClass;
} );
/**
 * @file        datas/model/recordset.js
 * @desc        Array of records on a model with a filtering query
 *              API:
 *                  ->constructor(object)     : nothing
 *  
 *                  ->get_records()   		  : array of Records objects
 *                  ->get_count()             : integer (records count)
 *  
 *                  ->new_record()            : 
 *                  ->free_record()           : 
 *                  
 *                  ->update_records_map()    : Reload all query model records
 *                  ->get_record_by_id(id)    : Lookup a record with its id
 *                  ->get_first_record_by_field(n,v): Lookup a record with a field name and a field value
 *                  ->get_first_record_by_object(o) : Lookup a record with its values
 *                  
 *                  ->load(datas)             : Fill the Recordset with given datas records
 *                  ->read()                  : Read records from the model with the owned query
 *                  ->read_all()              : Read all available records from the model
 *  
 *                  ->save()                  : Save all dirty records into the model
 *                  ->erase()                 : Remove all records and update the model
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2015-02-02
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/model/recordset',[
	'Devapt', 'core/types',
	'object/class', 'object/object', 'object/mixin-status',
	'datas/model/record', 'datas/query'],
function(Devapt, DevaptTypes,
	DevaptClass, DevaptObject, DevaptMixinStatus,
	DevaptRecord, DevaptQuery)
{
	/**
	 * @public
	 * @class				DevaptRecordSet
	 * @desc				Read only result set fot storage engines
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptRecordSet
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// DEBUG
//		self.trace=true;
		
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// INIT EMPTY RECORDS
		self.empty_records = [];
		
		// LOAD A RECORDSET
		if (self.recordset && self.resultset.is_recordset)
		{
			self.model = self.recordset.model;
			self.records = self.recordset.records;
			self.records_map = self.recordset.records_map;
			self.query = self.recordset.query.clone();
			self.id_field_name = self.recordset.id_field_name;
		}
		
		// LOAD A RESULTSET
		else if (self.resultset && self.resultset.is_resultset)
		{
			self.load(self.resultset);
		}
		
		// NOTHING TO LOAD
		else
		{
			self.status = 'empty';
			self.error_msg = null;
		}
		
		// CHECK MODEL
		self.assert_object(context, 'model', self.model);
		
		// INIT QUERY
		if ( ! DevaptTypes.is_object(self.query) )
		{
			self.query = DevaptQuery.create(self.name + '_query', {});
			self.query.select_all();
		}
		
		// INIT STATUS
		if ( DevaptTypes.is_array(self.records) )
		{
			self.status = 'ok';
			self.error_msg = null;
		}
		
		
		// CONSTRUCTOR END
		self.leave(context, Devapt.msg_success);
	};
	
	
	
	/* --------------------------------------------- RECORD OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.get_records()
	 * @desc					Get all result records
	 * @return {array}
	 */
	var cb_get_records = function ()
	{
		var self = this;
		return self.records;
	};
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.get_count()
	 * @desc					Get result records count
	 * @return {string}
	 */
	var cb_get_count = function ()
	{
		var self = this;
		return self.records.length;
	};
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.new_record()
	 * @desc					Get an empty Record object (create it or reuse it)
	 * @return {object}
	 */
	var cb_new_record = function ()
	{
		var self = this;
		
		if( self.empty_records.length > 0 )
		{
			return self.empty_records.pop();
		}
		
		return DevaptRecord.create(self.name + '_record_' + Devapt.uid(), { recordset:self });
	};
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.free_record(record)
	 * @desc					Unuse a Record
	 * @param {object}			arg_record		uused Record object
	 * @return {nothing}
	 */
	var cb_free_record = function (arg_record)
	{
		var self = this;
		var context = 'free_record(record)';
		self.enter(context, '');
		self.assert_object(context, 'record', arg_record);
		
		arg_record.free();
		self.empty_records.push(arg_record);
		
		self.leave(context, '');
	};
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.init_record()
	 * @desc					Fill an Record object with fields default value
	 * @param {object}			arg_record		A Record object
	 * @return {object}
	 */
	var cb_init_record = function (arg_record)
	{
		var self = this;
		var context = 'init_record(record)';
		self.enter(context, '');
		
		
		// CHECK RECORD
		self.assert_object(context, 'arg_record', arg_record);
		self.assert_true(context, 'arg_record.is_record', arg_record.is_record);
		
		/*var datas = {};
		
		// LOOP ON MODEL FIELDS
		var fields = self.model.fields;
		for(var field_name in fields)
		{
			var field = fields[field_name];
			
			if ( field.is_pk )
			{
				continue;
			}
			
			var default_value = field.field_value.default;
			self.value(context, 'field_name', field_name);
			self.value(context, 'default_value', default_value);
			
			datas[field_name] = default_value;
		}
		
		arg_record.load(datas);*/
		
		arg_record.fill_with_defaults();
		
		
		self.leave(context, Devapt.msg_success);
		return arg_record;
	};
	
				
	
	/* --------------------------------------------- LOOKUP OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					self.update_records_map()
	 * @desc					Fill the records map
	 * @return {nothing}	
	 */
	var cb_update_records_map = function ()
	{
		var self = this;
		var context = 'update_records_map()';
		self.enter(context, '');
		self.assert_object(context, 'model', self.model);
		self.assert_array(context, 'records', self.records);
		
		try
		{
			var pk_field = self.model.get_pk_field();
			self.assert_object(context, 'pk_field', pk_field);
			
			self.id_field_name = pk_field.name;
			self.records_map = {};
			
//			console.debug(self.records, 'self.records');
			for(var record_index in self.records)
			{
				var record = self.records[record_index];
				var record_id = record.get(self.id_field_name);
				
//				console.debug(record, 'record');
//				console.debug(self.id_field_name, 'self.id_field_name');
//				console.debug(record_id, 'record_id');
				
				if (record_id && record)
				{
					self.records_map[record_id] = record;
				}
			}
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		self.leave(context, '');
	};
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					self.has_record()
	 * @desc					Test if a Record is part of this Recordset
	 * @param {object}			arg_record		a Record object
	 * @return {boolean}	
	 */
	var cb_has_record = function(arg_record)
	{
		var self = this;
		var context = 'has_record(record)';
		self.enter(context, '');
		self.assert_object(context, 'record is object', arg_record);
		self.assert_true(context, 'record.is_record', arg_record.is_record);
		self.assert_array(context, 'records', self.records);
		
		
		var found = false;
		try
		{
			if ( ! DevaptTypes.is_not_empty_object(self.records_map) )
			{
				self.update_records_map();
			}
			
			// GET RECORD ID
			var id = self.id_field_name in arg_record ? arg_record[self.id_field_name] : null;
			self.value(context, 'id_field_name', self.id_field_name);
			self.value(context, 'given record id', id);
			
			found = id && (id in arg_record) && (id in self.records_map);
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		
		self.leave(context, found ? Devapt.msg_found : Devapt.msg_not_found);
		return found;
	};
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					self.get_record_by_id()
	 * @desc					Get a Record with its id
	 * @param {anything}		arg_field_value		lookup field value
	 * @return {object}			Found Record object or null if not found
	 */
	var cb_get_record_by_id = function(arg_field_value)
	{
		var self = this;
		var context = 'get_record_by_id(value)';
		self.enter(context, '');
		self.assert_not_empty_string(context, 'arg_field_value', arg_field_value);
		self.assert_object(context, 'model', self.model);
		self.assert_object(context, 'records_map', self.records_map);
		
		
		try
		{
			if ( ! DevaptTypes.is_not_empty_object(self.records_map) )
			{
				self.update_records_map();
			}
			
			if (arg_field_value in self.records_map)
			{
				self.leave(context, Devapt.msg_found);
				return self.records_map[arg_field_value];
			}
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		
		self.leave(context, Devapt.msg_not_found);
		return null;
	};
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					self.get_first_record_by_field(field name, field value)
	 * @desc					Lookup the first Record corresponding to the field/value filter
	 * @param {string}			arg_field_name		lookup field name
	 * @param {anything}		arg_field_value		lookup field value
	 * @return {object}			Found Record object or null if not found
	 */
	var cb_get_first_record_by_field = function(arg_field_name, arg_field_value)
	{
		var self = this;
		var context = 'get_first_record_by_field(name,value)';
		self.enter(context, '');
		self.assert_not_empty_string(context, 'arg_field_name', arg_field_name);
		self.assert_object(context, 'model', self.model);
		self.assert_array(context, 'records', self.records);
		self.value(context, 'arg_field_name', arg_field_name);
		self.value(context, 'arg_field_value', arg_field_value);
		
		
		try
		{
			// FIELD NAME IS ID FIELD NAME
			if (arg_field_name === self.id_field_name)
			{
				var record = self.get_record_by_id(arg_field_value);
				
				self.leave(context, record ? Devapt.msg_found : Devapt.msg_not_found);
				return record;
			}
			
			// BAD FIELD NAME
			if (! self.model.get_field(arg_field_name) )
			{
				self.leave(context, Devapt.msg_not_found);
				return null;
			}
			
			// LOOP ON RECORDS
			for(var record_index in self.records)
			{
				var record = self.records[record_index];
				var record_value = record.get(arg_field_name);
				self.value(context, 'record', record);
				self.value(context, 'record_value', record_value);
				
				if (arg_field_value == record_value)
				{
					self.leave(context, Devapt.msg_found);
					return record;
				}
			}
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		
		self.leave(context, Devapt.msg_not_found);
		return null;
	};
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					self.get_all_records_by_field(field name, field value, records)
	 * @desc					Lookup all Record corresponding to the field/value filter
	 * @param {string}			arg_field_name		lookup field name
	 * @param {anything}		arg_field_value		lookup field value
	 * @param {anything}		arg_records			lookup records list (optional, default: all recordset records)
	 * @return {array}			Array of all found Record object
	 */
	var cb_get_all_records_by_field = function(arg_field_name, arg_field_value, arg_records)
	{
		var self = this;
		var context = 'get_all_records_by_field(name,value,records)';
		self.enter(context, '');
		
		// CHECK ARGS
		self.assert_not_empty_string(context, 'arg_field_name', arg_field_name);
		self.assert_object(context, 'model', self.model);
		self.assert_array(context, 'records', self.records);
		self.value(context, 'arg_field_name', arg_field_name);
		self.value(context, 'arg_field_value', arg_field_value);
		arg_records = DevaptTypes.is_array(arg_records) ? arg_records : self.records;
		
		
		try
		{
			var record = null;
			
			// FIELD NAME IS ID FIELD NAME
			if (arg_field_name === self.id_field_name)
			{
				self.step(context, 'FIELD NAME IS ID FIELD NAME');
				
				record = self.get_record_by_id(arg_field_value);
				
				self.leave(context, record ? Devapt.msg_found : Devapt.msg_not_found);
				return [record];
			}
			
			// BAD FIELD NAME
			if (! self.model.get_field(arg_field_name) )
			{
				self.step(context, 'FIELD NAME IS NOT FOUND IN MODEL FIELDS');
				
				self.leave(context, Devapt.msg_not_found);
				return [];
			}
			
			// LOOP ON RECORDS
			self.step(context, 'LOOP ON RECORDS');
			var found_records = [];
			for(var record_index in arg_records)
			{
				// GET AND CHECK CURRENT RECORD
				record = arg_records[record_index];
				if (! DevaptTypes.is_object(record) || ! record.is_record)
				{
					continue;
				}
				
				// GET RECORD FIELD VALUE
				var record_value = record.get(arg_field_name);
				self.value(context, 'record.name', record.name);
				self.value(context, 'record.datas', record.datas);
				self.value(context, 'record[' + arg_field_name + '] value', record_value);
				
				if (arg_field_value == record_value)
				{
					self.value(context, 'found record', record);
					found_records.push(record);
				}
			}
			
			self.leave(context, found_records.length > 0 ? Devapt.msg_found :  Devapt.msg_not_found);
			return found_records;
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		
		self.leave(context, Devapt.msg_not_found);
		return [];
	};
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					self.get_first_record_by_object(arg_object)
	 * @desc					Get a Record with its values
	 * @param {anything}		arg_object		plain object
	 * @return {object}			Found Record object or null if not found
	 */
	var cb_get_first_record_by_object = function(arg_object)
	{
		var self = this;
		var context = 'get_first_record_by_object(object)';
		self.enter(context, '');
		self.assert_object(context, 'arg_object', arg_object);
		self.assert_not_empty_string(context, 'id_field_name', self.id_field_name);
		self.assert_object(context, 'model', self.model);
		self.assert_array(context, 'records', self.records);
		
		
		// DEBUG
//		console.log(arg_object, context + ':arg_object');
		
		try
		{
			if (arg_object.is_record)
			{
				self.step(context, 'given object is a record');
				
				if ( self.has_record(arg_object) )
				{
					self.step(context, 'given object is found in recordset');
					
					self.leave(context, Devapt.msg_found);
					return arg_object;
				}
				
				self.step(context, 'given object is not found in recordset');
				arg_object = arg_object.datas;
			}
			
			if ( ! DevaptTypes.is_not_empty_object(self.records_map) )
			{
				self.update_records_map();
			}
			
			// GET RECORD ID
			var id = self.id_field_name in arg_object ? arg_object[self.id_field_name] : null;
			self.value(context, 'id_field_name', self.id_field_name);
			self.value(context, 'given record id', id);
			
			// LOOKUP ID IN RECORDS MAP
			if (id && id in self.records_map)
			{
				self.step(context, 'given object id is found in records map');
				
				self.leave(context, Devapt.msg_found);
				return self.records_map[id];
			}
			
			// LOOP ON OTHER FIELDS
			// var fields = self.model.fields;
			// var filters_count = Object.keys(arg_object).length;
			var found_records = self.records;
			for(var field_name in arg_object)
			{
				var value = arg_object[field_name];
				self.value(context, 'field_name', field_name);
				self.value(context, 'value', value);
				
				// SKIP CONTAINER INDEX INTERNAL ADDON
				if (field_name === 'container_item_index')
				{
					self.step(context, 'skip "container_item_index"');
					continue;
				}
				
				// VIEW ITERATOR IS 'FIELDS'
				if (field_name === 'field_name')
				{
					self.step(context, 'object is a field_name/field_value pair');
					
					field_name = arg_object.field_name;
					value = arg_object.field_value;
					
					self.value(context, 'field_name', field_name);
					self.value(context, 'value', value);
				}
				
//				console.debug({'field':field_name,'value':value}, context + ':field name/value');
				if ( self.model.has_field(field_name) )
				{
					self.step(context, 'model has field');
					
					found_records = self.get_all_records_by_field(field_name, value, found_records);
					if (found_records && found_records.length < 1)
					{
						self.step(context, 'model has field but no record found');
						
						self.leave(context, Devapt.msg_not_found);
						return null;
					}
				}
			}
			
			var found_record = found_records.length >= 1 ? found_records[0] : null;
			
			self.leave(context, found_record ? Devapt.msg_found : Devapt.msg_not_found);
			return found_record;
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		
		self.leave(context, Devapt.msg_not_found);
		return null;
	};
	
	
	
	/* --------------------------------------------- LOAD OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.load(datas)
	 * @desc					Fill the recordset with given datas
	 * @param {array|object}	arg_datas		datas to fill recordset (a ResultSet, an array of Records, an array of Plain objects)
	 * @return {object}			Promise of the operation
	 */
	var cb_load = function (arg_datas)
	{
		var self = this;
		var context = 'load()';
		self.enter(context, '');
		self.assert_not_null(context, 'datas', arg_datas);
		
		
		try
		{
			// INIT LOADING
			self.set_status('loading');
			self.records = [];
			self.records_map = {};
			
			// RESULTSET
			if ( DevaptTypes.is_object(arg_datas) && arg_datas.is_resultset )
			{
				self.step(context, 'set a Resultset');
				arg_datas = arg_datas.get_records();
			}
			
			// ARRAY OF ITEMS
			if ( DevaptTypes.is_array(arg_datas) )
			{
				self.step(context, 'process an array of datas');
				self.value(context, 'arg_datas', arg_datas);
				
				var items_promises = [];
				for(var item_key in arg_datas)
				{
					var item = arg_datas[item_key];
					var record = self.new_record();
					var promise = record.load(item);
					self.value(context, 'item for key[' + item_key + ']', item);
					
					self.records.push(record);
					items_promises.push(promise);
				}
				
				// FINISH LOADING
				var all_promise = Devapt.promise_all(items_promises);
				var promise = all_promise.then(
					function()
					{
						self.step(context, 'update records map');
						self.update_records_map();
						self.set_ok();
					}
				);
				
				promise = promise.then(
					function() { return self; }
				);
				
				self.leave(context, Devapt.msg_success_promise);
				return promise;
			}
			
			// FINISH LOADING
			self.set_error('bad datas');
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		
		self.leave(context, Devapt.msg_failure_promise);
		return Devapt.promise_rejected();
	};
	
	
	
	/* --------------------------------------------- READ OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.read()
	 * @desc					Read records from the model with the owned query
	 * @return {object}			Promise of the operation
	 */
	var cb_read = function ()
	{
		var self = this;
		var context = 'read()';
		self.assert_object(context, 'model', self.model);
		self.assert_object(context, 'query', self.query);
		
		try
		{
			self.set_status('reading');
			self.records = [];
			var promise = self.model.read(self.query, self);
			promise = promise.then(
				function()
				{
					return self;
				}
			);
			
			return promise;
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		return Devapt.promise_rejected();
	};
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.read_all()
	 * @desc					Read all records from the model
	 * @return {object}			Promise of the operation
	 */
	var cb_read_all = function ()
	{
		var self = this;
		var context = 'read_all()';
		self.assert_object(context, 'model', self.model);
		self.assert_object(context, 'query', self.query);
		
		try
		{
			self.query.select_all();
			var promise = self.read();
			
			return promise;
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		return Devapt.promise_rejected();
	};
	
	
	
	/* --------------------------------------------- SAVE / ERASE OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.save()
	 * @desc					Save all dirty records into the model
	 * @return {object}			Promise of the operation
	 */
	var cb_save = function ()
	{
		var self = this;
		var context = 'save()';
		self.assert_object(context, 'model', self.model);
		self.assert_array(context, 'records', self.records);
		
		
		try
		{
			// LOOP ON RECORDS
			var dirty_records = [];
			var dirty_records_datas = [];
			for(var record_index in self.records)
			{
				var record = self.records[record_index];
				if (record.is_dirty)
				{
					dirty_records.push(record);
					dirty_records_datas.push(record.datas);
				}
			}
			
			
			// NO DIRTY RECORD TO SAVE
			if (dirty_records_datas.length === 0)
			{
				return Devapt.promise_resolved();
			}
			
			
			// SAVE DIRTY RECORDS
			// TODO LOCK UPDATE OF RECORDS DURING SAVING
			var promise = self.model.update(dirty_records_datas);
			promise = promise.then(
				function()
				{
					for(var record_index in dirty_records)
					{
						dirty_records[record_index].is_dirty = false;
					}
					
					return self;
				}
			);
			
			return promise;
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		
		return Devapt.promise_rejected();
	};
	
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.erase()
	 * @desc					Remove all records and update the model
	 * @return {object}			Promise of the operation
	 */
	var cb_erase = function ()
	{
		var self = this;
		var context = 'erase()';
		self.assert_object(context, 'model', self.model);
		self.assert_array(context, 'records', self.records);
		
		
		try
		{
			// LOOP ON RECORDS
			// TODO LOCK CHANGE ON RECORDSET
			var all_promises = [];
			for(var record_index in self.records)
			{
				var record = self.records[record_index];
				
				var erase_promise = record.erase();
				erase_promise.then(
					function()
					{
						self.free_record(record);
					}
				);
				
				all_promises.push(erase_promise);
			}
			
			
			return Devapt.promise_all(all_promises).then( function() { return self; } );
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		
		return Devapt.promise_rejected();
	};
	
	
	
	/* --------------------------------------------- APPEND / INSERT / REMOVE OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.append(datas)
	 * @desc					Create records into the model and append them to the recordset
	 * @param {object|array}	arg_datas		one plain object or an array of plain objects
	 * @return {object}			Promise of the operation
	 */
	var cb_append = function (arg_datas)
	{
		var self = this;
		var context = 'append(datas)';
		self.assert_object(context, 'model', self.model);
		self.assert_not_empty_object_or_array(context, 'datas', arg_datas);
		
		
		try
		{
			// ONE RECORD
			if ( ! DevaptTypes.is_array(arg_datas) )
			{
				arg_datas = [ arg_datas ];
			}
			
			
			// CREATE NORMALIZED RECORDS
			var records = [];
			var records_datas = [];
			var items_promises = [];
			for(var item_key in arg_datas)
			{
				self.value(context, 'key', item_key);
				
				var item = arg_datas[item_key];
				var record = self.new_record();
				var promise = record.load(item);
				
				records.push(record);
				promise.then(
					function()
					{
						records_datas.push(record.datas);
					}
				);
				items_promises.push(promise);
			}
			var all_promise = Devapt.promise_all(items_promises);
			
			
			// MODEL AND RECORDSET OPERATIONS
			all_promise = all_promise.then(
				function()
				{
//					console.log(records_datas, context + ':records_datas');
					
					// CREATE IN MODEL
					var create_promise = self.model.create(records_datas);
					
					// APPEND INTO THE RECORDSET
					return create_promise.then(
						function(records)
						{
							// APPEND AN ARRAY OF RECORDS
							for(var record_index in records)
							{
								var record = records[record_index];
								self.records.push(record);
								
								var record_id = record[self.id_field_name];
								self.records_map[record_id] = record;
							}
							
							self.set_ok();
							
							return records;
						}
					);
				}
			);
			
			return all_promise;
//			return all_promise.then( function() { return self; } );
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		
		return Devapt.promise_rejected();
	};
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.insert(index, datas)
	 * @desc					Create records into the model and insert them to the recordset at the given index
	 * @param {integer}			arg_index			index to insert datas
	 * @param {object|array}	arg_datas			one record object or an array of objects
	 * @return {object}			Promise of the operation
	 */
/*	var cb_insert = function (arg_index, arg_datas)
	{
		var self = this;
		var context = 'insert()';
		self.assert_object(context, 'model', self.model);
		self.assert_integer(context, 'index', arg_index);
		self.assert_not_empty_object_or_array(context, 'datas', arg_datas);
		
		
		try
		{
			// ONE RECORD
			if ( DevaptTypes.is_object(arg_datas) )
			{
				arg_records = [ arg_records ];
			}
			
			
			// CREATE NORMALIZED RECORDS
			var records = [];
			var records_datas = [];
			var items_promises = [];
			for(var item_key in arg_datas)
			{
				var item = arg_datas[item_key];
				var record = self.new_record();
				var promise = record.load(item);
				records.push(record);
				promise.then(
					function()
					{
						records_datas.push(record.datas);
					}
				);
				items_promises.push(promise);
			}
			var all_promise = Devapt.promise_all(items_promises);
			
			
			// MODEL AND RECORDSET OPERATIONS
			all_promise = all_promise.then(
				function()
				{
					// CREATE IN MODEL
					var create_promise = self.model.create(records_datas);
					
					// APPEND INTO THE RECORDSET
					return create_promise.then(
						function()
						{
							// APPEND AN ARRAY OF RECORDS
							for(var record_index in records)
							{
								var record = records[record_index];
								self.records.push(record);
								
								var record_id = record[self.id_field_name];
								self.records_map[record_id] = record;
							}
							
							self.set_ok();
						}
					);
				}
			);
			
			
			return all_promise.then( function() { return self; } );
		}
		catch(e)
		{
			self.error_msg(context, e);
		}
		
		
		return Devapt.promise_rejected();
	};*/
	
	
	
	
	/**
	 * @memberof				DevaptRecordSet
	 * @public
	 * @method					DevaptRecordSet.remove(datas)
	 * @desc					Delete records into the model for the given datas (ids)
	 * @param {object|array}	arg_datas			one record object or an array of objects or an array of primary keys
	 * @return {object}			Promise of the operation
	 */
	// var cb_remove = function (arg_datas)
	// {
		// var self = this;
		// self.assert_object(context, 'model', self.model);
		// self.assert_not_empty_object_or_array(context, 'records', arg_records);
		
		// var promise = self.model.delete(arg_records);
		// promise.then(
			// function()
			// {
			// }
		// );
		
		// return promise;
	// };
	
	
	
	/* --------------------------------------------- QUERY OPERATIONS ------------------------------------------------ */
	
	/**
	 * @public
	 * @memberof				DevaptRecordSet
	 * @desc					Add a filter on a query with a field name/value pair.
	 * @param {string|object}	arg_field_name		field name or field object
	 * @param {string|number}	arg_field_value		field value
	 * @param {boolean}			arg_is_unique		filter should be unique on this field
	 * @return {nothing}
	 */
	var cb_add_field_value_filter = function(arg_field_name, arg_field_value, arg_is_unique)
	{
		var self = this;
		var context = 'add_field_value_filter(field,value,unique)';
		self.enter(context, arg_field_name);
		self.assert_not_empty_string(context, 'arg_field_name', arg_field_name);
		
		
		// CHECK ARGS
		var field_name = DevaptTypes.is_string(arg_field_name) ? arg_field_name : (DevaptTypes.is_object(arg_field_name) ? arg_field_name.name : null);
		self.assert_not_empty_string(context, 'field_name', field_name);
		var id = self.query.name + '.' + field_name + '.' + DevaptTypes.to_string(arg_field_value, 'nothing');
		var field_filter = { id: id, combination:'and', expression: {operator: 'equals', operands: [{ value:field_name, type:'string'}, { value:arg_field_value, type:'string'}]} };
		
		// DEBUG
		self.value(context, 'field_name', field_name);
		self.value(context, 'arg_field_value', arg_field_value);
		self.value(context, 'arg_is_unique', arg_is_unique);
		
		// ADD FILTER
		self.query.add_filter(field_name, field_filter, arg_is_unique);
		
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-02-02',
			updated:'2015-02-02',
			description:'Read only result set fot storage engines'
		},
		mixins:[DevaptMixinStatus]
	};
	var parent_class = DevaptObject;
	var DevaptRecordSetClass = new DevaptClass('DevaptRecordSet', parent_class, class_settings);
	
	
	// METHODS
	DevaptRecordSetClass.infos.ctor = cb_constructor;
	
	DevaptRecordSetClass.add_public_method('get_records', {}, cb_get_records);
	DevaptRecordSetClass.add_public_method('get_count', {}, cb_get_count);
	
	DevaptRecordSetClass.add_public_method('new_record', {}, cb_new_record);
	DevaptRecordSetClass.add_public_method('free_record', {}, cb_free_record);
	DevaptRecordSetClass.add_public_method('init_record', {}, cb_init_record);
	
	DevaptRecordSetClass.add_public_method('update_records_map', {}, cb_update_records_map);
	DevaptRecordSetClass.add_public_method('has_record', {}, cb_has_record);
	
	DevaptRecordSetClass.add_public_method('get_record_by_id', {}, cb_get_record_by_id);
	DevaptRecordSetClass.add_public_method('get_first_record_by_field', {}, cb_get_first_record_by_field);
	DevaptRecordSetClass.add_public_method('get_all_records_by_field', {}, cb_get_all_records_by_field);
	DevaptRecordSetClass.add_public_method('get_first_record_by_object', {}, cb_get_first_record_by_object);
	
	DevaptRecordSetClass.add_public_method('load', {}, cb_load);
	DevaptRecordSetClass.add_public_method('read', {}, cb_read);
	DevaptRecordSetClass.add_public_method('read_all', {}, cb_read_all);
	
	DevaptRecordSetClass.add_public_method('save', {}, cb_save);
	DevaptRecordSetClass.add_public_method('erase', {}, cb_erase);
	
	DevaptRecordSetClass.add_public_method('append', {}, cb_append);
	// DevaptRecordSetClass.add_public_method('insert', {}, cb_insert);
	// DevaptRecordSetClass.add_public_method('remove', {}, cb_remove);
	
	DevaptRecordSetClass.add_public_method('add_field_value_filter', {}, cb_add_field_value_filter);
	
	
	// PROPERTIES
	DevaptRecordSetClass.add_public_bool_property('is_recordset', 'object is a Records object', true, false, true, []);
	
	DevaptRecordSetClass.add_public_str_property('id_field_name', 'records id field name', null, false, true, []);
	DevaptRecordSetClass.add_public_array_property('records', 'records array', [], false, false, [], 'object', '|');
	DevaptRecordSetClass.add_public_array_property('records_map', 'records map with record id as key', {}, false, false, [], 'object', '|');
	
	DevaptRecordSetClass.add_public_object_property('model', 'recordset model', null, false, false, []);
	DevaptRecordSetClass.add_public_object_property('resultset', 'resultset source', null, false, false, [], 'object', '|');
	
	
	return DevaptRecordSetClass;
} );
/**
 * @file        datas/field.js
 * @desc        Devapt datas field class
 * 				API:
 * 					- fields
 * 					->is_value_valid(value)
 * 					//->get_stored_value(value)
 * 					//->get_displayed_value(value)
 * 					->
 * @see			datas/model/model.js
 * @ingroup     DEVAPT_DATAS
 * @date        2014-08-12
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'datas/field',['Devapt', 'core/types', 'core/resources',
	'object/class', 'object/object',
	'datas/query', 'datas/model/recordset'],
function(Devapt, DevaptTypes, DevaptResources,
	DevaptClass, DevaptObject,
	DevaptQuery, DevaptRecordSet)
{
	/**
	 * @class				DevaptField
	 * @desc				Field class constructor
	 * @method				DevaptField.constructor
	 */
	
	
	/**
	 * @memberof			DevaptField
	 * @public
	 * @method				DevaptField.constructor
	 * @desc				Field constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		self.association = null;
		self.has_association_link = null;
		self.has_foreign_link = null;
		self.has_join_link = null;
		
		
		self.leave(context, 'success');
	}
	
	
	/**
	 * @memberof			DevaptField
	 * @public
	 * @method				DevaptField.is_value_valid(value)
	 * @desc				Test if the given value is valid
	 * @param {string}		arg_value			value to test for field
	 * @return {boolean}
	 */
	var cb_is_value_valid = function(arg_value)
	{
		var self = this;
		var context = 'is_value_valid(value)';
		self.enter(context, '');
		
		
		var is_valid = DevaptTypes.is_not_empty_str(self.name);
		is_valid = is_valid && DevaptTypes.is_not_empty_str(self.label);
		is_valid = is_valid && DevaptTypes.is_not_empty_str(self.source);
		is_valid = is_valid && DevaptTypes.is_not_empty_str(self.type);
		
		
		self.leave(context, Devapt.msg_success);
		return is_valid;
	}
	
	
	/**
	 * @memberof			DevaptField
	 * @public
	 * @method				DevaptField.has_association()
	 * @desc				Test if the given value has an association link
	 * @return {boolean}
	 */
	var cb_has_association = function()
	{
		var self = this;
		var context = 'has_association()';
		self.enter(context, '');
		
		
		if ( ! DevaptTypes.is_boolean(self.has_association_link) )
		{
			self.has_association_link = self.has_foreign() || self.has_join() || self.has_one_to_one();
		}
		self.value(context, 'self.has_association_link', self.has_association_link);
		
		self.leave(context, Devapt.msg_success);
		return self.has_association_link;
	}
	
	
	/**
	 * @memberof			DevaptField
	 * @public
	 * @method				DevaptField.get_association()
	 * @desc				Test if the given value has a foreign link
	 * @return {object}
	 */
	var cb_get_association = function()
	{
		var self = this;
		var context = 'get_association()';
		self.enter(context, '');
		
		
		if ( self.has_association() && ! DevaptTypes.is_object(self.association) )
		{
			self.step(context, 'SHOULD CREATE ASSOCIATION');
			self.association = {min:null, max:null, model_name:null, model:null, query:null};
			
			if (self.has_join() && self.join)
			{
				self.step(context, 'HAS HOIN');
				/*
					[FIELD DEFINITION]
					type=String
					label=User login
					is_editable=1
					is_visible=1
					sql_is_primary_key=0
					sql_is_expression=0
					sql_column=login
					sql_table=join_users
					
					[MODEL DEFINITION]
					crud_table=groups_users
					joins.users.mode=inner
					joins.users.model=MODEL_AUTH_USERS
					joins.users.source.column=id_user
					joins.users.target.table=users
					joins.users.target.table_alias=join_users
				*/
				self.association.min = 1;
				self.association.max = null;
				self.association.model = self.join.model_object;
				self.association.model_name = self.join.model;
				self.association.target_field_name = self.name;
				self.association.target_field_key = self.join.target.column;
			}
			
			else if ( self.has_foreign() )
			{
				self.step(context, 'HAS FOREIGN');
				/*
					[FIELD DEFINITION]
					type=String
					label=Role label
					is_editable=1
					is_visible=1
					sql_is_primary_key=0
					sql_is_expression=0
					sql_column=id_role
					sql_foreign_table=roles
					sql_foreign_key=id_role
					sql_foreign_column=label
					
					[MODEL DEFINITION]
					crud_table=users_roles
				*/
				self.association.min = 1;
				self.association.max = null;
				if (self.foreign_model && self.sql_foreign_column && self.sql_foreign_key)
				{
					self.step(context, 'HAS FOREIGN MODEL AND KEY');
					self.association.model = self.foreign_model;
					self.association.model_name = self.association.model.name;
					self.association.target_field_name = self.foreign_model.get_field_for_column(self.sql_foreign_column);
					// self.association.target_field_key = self.foreign_model.get_field_for_column(self.sql_foreign_key);
				}
				else
				{
					self.step(context, 'HAS NOT FOREIGN MODEL NOR KEY');
					self.association.model = self.model;
					self.association.model_name = self.association.model.name;
					self.association.target_field_name = self.name;
					// self.association.target_field_key = self.sql_foreign_key;
				}
			}
			// else if ( self.has_one_to_one() )
			// {
				/*
					[FIELD DEFINITION]
					type=String
					label=Role label
					is_editable=1
					is_visible=1
					sql_is_primary_key=0
					sql_is_expression=0
					sql_table=country
					sql_column=country_label
					sql_key=id_country
					
					[MODEL DEFINITION]
					crud_table=users
				*/
				/*self.association.min = 1;
				self.association.max = 1;
				self.association.model = self.join.model_object;
				self.association.model_name = self.join.model;
				self.association.model_name = self.join.model;
				self.association.target_field_name = self.name;*/
			// }
			else
			{
				self.error(context, 'bad association');
			}
			
			// CREATE QUERY
			if (self.association.target_field_name && self.association.target_field_key)
			{
				self.step(context, 'HAS TARGET FIELD');
				
				var order = self.association.target_field_name + '=ASC';
				var query_settings = {
					// fields: [self.association.target_field_key, self.association.target_field_name],
					one_field: self.association.target_field_name,
					orders: [order]
				};
				
				self.association.query = DevaptQuery.create(self.name + '_get_values', query_settings);
				self.association.query.set_select_distinct_one();
			}
		}
		
		
		self.leave(context, self.association ? Devapt.msg_success : Devapt.msg_failure);
		return self.association;
	}
	
	
	/**
	 * @memberof			DevaptField
	 * @public
	 * @method				DevaptField.has_foreign()
	 * @desc				Test if the given value has a foreign link
	 * @return {boolean}
	 */
	var cb_has_foreign = function()
	{
		var self = this;
		var context = 'has_foreign()';
		self.enter(context, '');
		
		
		if ( ! DevaptTypes.is_boolean(self.has_foreign_link) )
		{
			self.has_foreign_link = DevaptTypes.is_not_empty_str(self.sql_foreign_key);
			self.has_foreign_link = self.has_foreign_link && DevaptTypes.is_not_empty_str(self.sql_foreign_column);
		}
		self.value(context, 'self.has_foreign_link', self.has_foreign_link);
		
		
		self.leave(context, Devapt.msg_success);
		return self.has_foreign_link;
	}
	
	
	/**
	 * @memberof			DevaptField
	 * @public
	 * @method				DevaptField.has_join()
	 * @desc				Test if the given value is part of a join link
	 * @return {boolean}
	 */
	var cb_has_join = function()
	{
		var self = this;
		var context = 'has_join()';
		self.enter(context, '');
		
		
		if ( ! DevaptTypes.is_boolean(self.has_join_link) )
		{
			self.has_join_link = false;
			var model_has_join = DevaptTypes.is_object(self.model) && DevaptTypes.is_not_empty_object(self.model.joins);
			if (model_has_join && DevaptTypes.is_not_empty_str(self.sql_table))
			{
				for(var join_table in self.model.joins)
				{
					var join_record = self.model.joins[join_table];
					var target_table = join_record.target.table_alias;
					// console.log(join_record, 'join_record')
					if (target_table === self.sql_table)
					{
						self.has_join_link = true;
						self.join = join_record;
						self.value(context, 'self.has_join_link', self.has_join_link);
						self.leave(context, Devapt.msg_success);
						return true;
					}
				}
			}
		}
		self.value(context, 'self.has_join_link', self.has_join_link);
		
		
		self.leave(context, Devapt.msg_success);
		// self.trace=false;
		return self.has_join_link;
	}
	
	
	/**
	 * @memberof			DevaptField
	 * @public
	 * @method				DevaptField.has_one_to_one()
	 * @desc				Test if the given value is part of a one to one link
	 * @return {boolean}
	 */
	var cb_has_one_to_one = function()
	{
		var self = this;
		var context = 'has_one_to_one()';
		self.enter(context, '');
		
		
		var has_one_to_one_link = false;
		
		// TODO RECURSIVE CALLS TO HAS ASSOCIATION
		// if ( self.has_association() )
		// {
			// var asso = self.get_association();
			// has_one_to_one_link = asso.min === 1 && asso.max === 1;
		// }
		self.value(context, 'self.has_one_to_one_link', has_one_to_one_link);
		
		
		self.leave(context, Devapt.msg_success);
		return has_one_to_one_link;
	}
	
	
	/**
	 * @memberof			DevaptField
	 * @public
	 * @method				DevaptField.has_one_to_many()
	 * @desc				Test if the given value is part of a one to many link
	 * @return {boolean}
	 */
	var cb_has_one_to_many = function()
	{
		var self = this;
		var context = 'has_one_to_many()';
		self.enter(context, '');
		
		
		var has_one_to_many_link = false;
		if ( self.has_association() )
		{
			var asso = self.get_association();
			has_one_to_many_link = asso.min >= 1 && ( ! asso.max || asso.max > 1);
		}
		
		
		self.leave(context, Devapt.msg_success);
		return has_one_to_many_link;
	}
	
	
	/**
	 * @memberof			DevaptField
	 * @public
	 * @method				DevaptField.get_available_values()
	 * @desc				Get all field values
	 * @param {boolean}		arg_all_fields	should return all fields (optional, default 'false')
	 * @return {object}		a promise of a RecordSet
	 */
	var cb_get_available_values = function(arg_all_fields)
	{
		var self = this;
		// self.trace = true;
		var context = 'get_available_values(all fields?)';
		self.enter(context, '');
		
		
		// SHOULD RETURN ALL FIELDS OF THE MODEL
		arg_all_fields = !! arg_all_fields;
//		console.debug(arg_all_fields, context + ':arg_all_fields');
		
		// TEST IF ALREADY CALLED
		if ( DevaptTypes.is_object(self.get_available_values_promise) )
		{
			self.leave(context, Devapt.msg_success_promise);
			return self.get_available_values_promise;
		}
		
		
		// HAS AN ASSOCIATION ?
		if ( ! self.has_association() )
		{
			self.leave(context, Devapt.msg_failure_promise);
			return Devapt.promise_rejected();
		}
		
		// GET ASSOCIATION
		var asso = self.get_association();
		var query = asso.query;
//		 self.value(context, 'association', asso);
//		console.log(asso, context + ':association');
			
		// GET VALUES CALLBACK
		var cb_get_values = function(arg_model, arg_query)
		{
			self.step(context, 'get values callback');
			var results_promise = null;
			
			self.get_available_values_model = arg_model;
			
			// UPDATE QUERY IF NEEDED
			if (arg_all_fields)
			{
				self.step(context, 'return all fields');
				
				arg_query = DevaptTypes.clone_object(arg_query);
				arg_query.select_all();
				arg_query.fields = asso.model.get_fields_names();
			}
//			console.log(arg_query, context + ':query');
			
			// READ WITH A QUERY
			if ( DevaptTypes.is_object(arg_query) )
			{
				self.step(context, 'read with query');
				results_promise = arg_model.get_engine().then(
					function (arg_engine)
					{
//						console.log(arg_query, context + ':read query');
						return arg_engine.read_records(arg_query);
					}
				).then(
					function(arg_resultset)
					{
						return DevaptRecordSet.create(self.name + '_recordset_' + Devapt.uid(), {resultset:arg_resultset, model:arg_model});
					}
				);
				self.get_available_values_promise = results_promise;
			}
			// READ ALL
			else
			{
				self.step(context, 'read all');
				results_promise = arg_model.get_engine().then(
					function (arg_engine)
					{
						return arg_engine.read_all_records();
					}
				).then(
					function(arg_resultset)
					{
						return DevaptRecordSet.create(self.name + '_recordset_' + Devapt.uid(), {resultset:arg_resultset, model:arg_model});
					}
				);
				self.get_available_values_promise = results_promise;
			}
			
			
			self.leave(context, Devapt.msg_success_promise);
			return results_promise;
		};
		
		
		
		// MODEL OBJECT IS DEFINED
		if ( DevaptTypes.is_object(asso.model) )
		{
			self.step(context, 'model is an object');
			
			var results_promise = cb_get_values(asso.model, query);
			
			self.leave(context, Devapt.msg_success_promise);
			return results_promise;
		}
		else
		{
			// MODEL NAME IS DEFINED
			if ( DevaptTypes.is_not_empty_str(asso.model_name) )
			{
				self.step(context, 'model name is set');
				
				var model_promise = DevaptResources.get_resource_instance(asso.model_name);
				var results_promise = model_promise.then(
					function(arg_model)
					{
						self.step(context, 'model is found');
						asso.model = arg_model;
						// console.log(asso.model, 'set asso.model');
						return cb_get_values(arg_model, query);
					}
				);
				
				self.leave(context, Devapt.msg_success_promise);
				return results_promise;
			}
		}
		
		
		self.leave(context, Devapt.msg_failure_promise);
		return Devapt.promise_rejected();
	}
	
	
	/**
	 * @memberof			DevaptField
	 * @public
	 * @method				DevaptField.get_available_records()
	 * @desc				Get all field values RecordSet
	 * @param {boolean}		arg_all_fields	should return all fields (optional, default 'false')
	 * @return {object}		a promise of a RecordSet
	 */
/*	var cb_get_available_records = function(arg_all_fields)
	{
		var self = this;
		// self.trace = true;
		var context = 'get_available_records(all fields?)';
		self.enter(context, '');
		
		
		// SHOULD RETURN ALL FIELDS OF THE MODEL
		arg_all_fields = !! arg_all_fields;
//		console.debug(arg_all_fields, context + ':arg_all_fields');
		
		// HAS AN ASSOCIATION ?
		if ( ! self.has_association() )
		{
			self.leave(context, Devapt.msg_failure_promise);
			return Devapt.promise_rejected();
		}
		
		// TEST IF ALREADY CALLED
		if ( DevaptTypes.is_object(self.get_available_records_promise) )
		{
			self.leave(context, Devapt.msg_success_promise);
			return self.get_available_records_promise;
		}
		
		// TEST IF ALREADY CALLED
		if ( DevaptTypes.is_object(self.get_available_values_promise) )
		{
			self.get_available_records_promise = self.get_available_values_promise.then(
				function(arg_resultset)
				{
					var resultset_model = self.get_available_values_model;
					return DevaptRecordSet.create(self.name + '_recordset_' + Devapt.uid(), {resultset:arg_resultset, model:resultset_model});
				}
			);
			
			self.leave(context, Devapt.msg_success_promise);
			return self.get_available_records_promise;
		}
		
		
		
		
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	}
	*/
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-12',
			'updated':'2014-12-13',
			'description':'Datas field class.'
		},
		mixins:[]
	};
	
	// CLASS CREATION
	var parent_class = DevaptObject;
	var DevaptFieldClass = new DevaptClass('DevaptField', parent_class, class_settings);
	
	// METHODS
	DevaptFieldClass.infos.ctor = cb_constructor;
	DevaptFieldClass.add_public_method('is_value_valid', {}, cb_is_value_valid);
	DevaptFieldClass.add_public_method('get_available_values', {}, cb_get_available_values);
	DevaptFieldClass.add_public_method('has_association', {}, cb_has_association);
	DevaptFieldClass.add_public_method('get_association', {}, cb_get_association);
	DevaptFieldClass.add_public_method('has_foreign', {}, cb_has_foreign);
	DevaptFieldClass.add_public_method('has_join', {}, cb_has_join);
	DevaptFieldClass.add_public_method('has_one_to_one', {}, cb_has_one_to_one);
	DevaptFieldClass.add_public_method('has_one_to_many', {}, cb_has_one_to_many);
	
	// PROPERTIES
	DevaptFieldClass.add_public_str_property('label',			'', null, false, false, []);
	
	DevaptFieldClass.add_public_str_property('source',			'', null, false, false, []);
	DevaptFieldClass.add_public_str_property('hash',			'', null, false, false, []);
	DevaptFieldClass.add_public_str_property('placeholder',		'', null, false, false, []);
	DevaptFieldClass.add_public_int_property('index',			'', null, false, false, []);
	
	DevaptFieldClass.add_public_object_property('field_value',	'', null, false, false, []); // field_value.items, type, validate, default
	// DevaptOptions.register_array_option(DevaptField, 'field_value.items',				[], false, ',', 'String', []);
	// DevaptOptions.register_str_option(DevaptField, 'field_value.type',					null, false, []);	// string, integer, date...
	// DevaptOptions.register_str_option(DevaptField, 'field_value.validate',				null, false, []);	// null or %d%m...
	// DevaptOptions.register_str_option(DevaptField, 'field_value.validate_valid_label',	null, false, []);
	// DevaptOptions.register_str_option(DevaptField, 'field_value.validate_error_label',	null, false, []);
	// DevaptOptions.register_obj_option(DevaptField, 'field_value.validate_regexp',		null, false, []);	// regexp object
	// DevaptOptions.register_str_option(DevaptField, 'field_value.display',				null, false, []);	// null or %d%m...
	// DevaptOptions.register_str_option(DevaptField, 'field_value.default',				null, false, []);
	
	DevaptFieldClass.add_public_bool_property('is_visible',			'', true, false, false, []);
	DevaptFieldClass.add_public_bool_property('is_editable',		'', true, false, false, []);
	DevaptFieldClass.add_public_bool_property('is_crud',			'', true, false, false, []);
	
	DevaptFieldClass.add_public_str_property('type',					'', null, true, false, []);
	DevaptFieldClass.add_public_bool_property('sql_is_primary_key',		'', false, false, false, []);
	DevaptFieldClass.add_public_bool_property('sql_is_expression',		'', false, false, false, []);
	
	DevaptFieldClass.add_public_bool_property('is_pk',					'', false, false, false, []);
	DevaptFieldClass.add_public_bool_property('is_expression',			'', false, false, false, []);
	
	DevaptFieldClass.add_public_str_property('sql_db',					'', null, false, false, []);
	DevaptFieldClass.add_public_str_property('sql_table',				'', null, false, false, []);
	DevaptFieldClass.add_public_str_property('sql_column',				'', null, false, false, []);
	DevaptFieldClass.add_public_str_property('sql_alias',				'', null, false, false, []);
	
	DevaptFieldClass.add_public_str_property('sql_foreign_db',			'', null, false, false, []);
	DevaptFieldClass.add_public_str_property('sql_foreign_table',		'', null, false, false, []);
	DevaptFieldClass.add_public_str_property('sql_foreign_key',			'', null, false, false, []);
	DevaptFieldClass.add_public_str_property('sql_foreign_column',		'', null, false, false, []);
	
	// DevaptOptions.register_str_option(DevaptField, 'foreign_model',			null, false, []);
	// DevaptOptions.register_str_option(DevaptField, 'foreign_key_field',		null, false, []);
	// DevaptOptions.register_str_option(DevaptField, 'foreign_value_field',	null, false, []);
	
	// MIXINS
	// DevaptFieldClass.add_public_mixin(DevaptMixinGetModel);
	
	return DevaptFieldClass;
} );

/**
 * @file        datas/mode/model.js
 * @desc        Devapt datas model class
 * 				API:
 * 					Attributes
 * 						fields
 * 					
 * 					Methods
 * 					->constructor()
 * 					->is_valid()
 * 
 * 					->has_field()
 * 					->get_field()
 * 					->get_field_for_column()
 * 					->is_pk_field(field)
 * 					->get_pk_field()
 * 					
 * 					->get_fields()
 * 					->set_fields()
 * 					->get_fields_types()
 * 					
 * 					->get_engine()
 * 					->set_engine()
 * 					->get_server_api()
 * 					
 * 					->get_access()
 * 					->set_access()
 * 					
 * 					->create(records)
 * 					->read(query)
 * 					->read_all()
 * 					->update(records)
 * 					->delete(records)
 * 
 * @see			datas/field.js
 * @ingroup     DEVAPT_DATAS
 * @date        2014-08-12
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'datas/model/model',['Devapt',
	'core/types', 'object/events', 'object/object', 'core/application',
	'datas/field', 'object/class', 'datas/model/record', 'datas/model/recordset'],
function(Devapt,
	DevaptTypes, DevaptEvents, DevaptObject, DevaptApplication,
	DevaptField, DevaptClass, DevaptRecord, DevaptRecordSet)
{
	/**
	 * @class				DevaptModel
	 * @desc				Model class
	 */
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.constructor
	 * @desc				Model constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
//		self.trace = true;
		
		
		var context = 'constructor';
		self.enter(context, '');
		
		
		self.is_model			= true;
		self.crud_api		 	= null;
		self.engine_object 		= null;
		self.engine_deferred	= Devapt.defer();
		self.engine_promise		= Devapt.promise(self.engine_deferred);
		
		// CREATE FIELDS INSTANCES
		if (self.fields)
		{
			self.set_fields(self.fields);
		}
		
		// CREATE ENGINE INSTANCE
		if (self.engine)
		{
			self.set_engine(self.engine);
		}
		
		// UPDATE ACCESS
		if (self.access)
		{
			self.set_access(self.access);
		}
		
		
		// INIT RECORDS COLLECTIONS
		self.all_empty_records = [];
		self.all_records_array = [];
		self.all_records_map = {};
		
		
		self.leave(context, 'success');
	};
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.is_valid()
	 * @desc				Test if the model is valid
	 * @return {boolean}
	 */
	var cb_is_valid = function()
	{
		var self = this;
		var context = 'is_valid()';
		self.enter(context, '');
		
		
		// CHECK STORAGE ENGINE
		if ( ! self.engine_object.is_storage )
		{
			self.leave(context, Devapt.msg_failure + ': bad engine');
			return false;
		}
		if ( ! self.engine_object.is_valid() )
		{
			self.leave(context, Devapt.msg_failure + ': engine isnt valid');
			return false;
		}
		
		// CHECK FIELDS
		if ( DevaptTypes.is_not_empty_array(self.fields) )
		{
			self.leave(context, Devapt.msg_failure + ': bad fields array');
			return false;
		}
		
		// CHECK ACCESS
		if ( ! DevaptTypes.is_object_with(self.access, ['read','create','update','delete']) )
		{
			self.leave(context, Devapt.msg_failure + ': bad access object');
			return false;
		}
		
		
		self.leave(context, Devapt.msg_success);
		return true;
	};
	
	
	
	/* --------------------------------------------- RECORDS OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptModel
	 * @public
	 * @method					self.get_empty_record()
	 * @desc					Get an empty Record object (create it or reuse it)
	 * @return {object}
	 */
	var cb_new_record = function ()
	{
		var self = this;
		
		if( self.all_empty_records.length > 0 )
		{
			return self.all_empty_records.pop();
		}
		
		return DevaptRecord.create(self.name + '_record_' + Devapt.uid(), { recordset:self });
	};
	
	
	/**
	 * @memberof				DevaptModel
	 * @public
	 * @method					self.free_record(record)
	 * @desc					Unuse a Record
	 * @param {object}			arg_record		unused Record object
	 * @return {nothing}
	 */
	var cb_free_record = function (arg_record)
	{
		var self = this;
		var context = 'free_record(record)';
		self.enter(context, '');
		self.assert_object(context, 'record', arg_record);
		
		arg_record.free();
		self.all_empty_records.push(arg_record);
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	/**
	 * @memberof				DevaptModel
	 * @public
	 * @method					self.free_record(records)
	 * @desc					Unuse an array of Record
	 * @param {array}			arg_records		unused Record objects array
	 * @return {nothing}
	 */
	var cb_free_records = function (arg_records)
	{
		var self = this;
		var context = 'free_records(records)';
		self.enter(context, '');
		self.assert_array(context, 'records', arg_records);
		
		for(var record_index in arg_records)
		{
			var record = arg_records[record_index];
			self.assert_object(context, 'record', record);
			
			record.free();
			self.all_empty_records.push(record);
		}
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	/**
	 * @memberof				DevaptModel
	 * @public
	 * @method					self.add_record(record)
	 * @desc					Register a Record
	 * @param {object}			arg_record		a Record object
	 * @return {nothing}
	 */
	var cb_add_record = function (arg_record)
	{
		var self = this;
		var context = 'add_record(record)';
		self.enter(context, '');
		self.assert_object(context, 'record', arg_record);
		
		arg_record.use();
		self.all_records_array.push(arg_record);
		self.all_records_map.push(arg_record);
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	
	/* --------------------------------------------- FIELDS OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.has_field(name)
	 * @desc				Test if model has a field for the given name
	 * @param {string}		arg_field_name		field name
	 * @return {boolean}
	 */
	var cb_has_field = function(arg_field_name)
	{
		var self = this;
		var context = 'has_field(name)';
		self.enter(context, '');
		
		
		self.leave(context, Devapt.msg_success);
		return (arg_field_name in self.fields_map);
	};
	
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.get_field(name)
	 * @desc				Get model field for the given name
	 * @param {string}		arg_field_name		field name
	 * @return {object}
	 */
	var cb_get_field = function(arg_field_name)
	{
		var self = this;
		var context = 'get_field(name)';
		self.enter(context, '');
		
		
		self.leave(context, Devapt.msg_success);
		return (arg_field_name in self.fields_map) ? self.fields_map[arg_field_name] : null;
	};
	
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.get_field_for_column(column)
	 * @desc				Get model field for the given column
	 * @param {string}		arg_column_name		column name
	 * @return {object}
	 */
	var cb_get_field_for_column = function(arg_column_name)
	{
		var self = this;
		var context = 'get_field_for_column(column)';
		self.enter(context, '');
		
		
		for(var field_name in self.fields_map)
		{
			var field = self.fields_map[field_name];
			
			if (field.sql_alias === arg_column_name)
			{
				self.leave(context, Devapt.msg_found);
				return field;
			}
			
			if (field.sql_column === arg_column_name)
			{
				self.leave(context, Devapt.msg_found);
				return field;
			}
			
			if (field.sql_foreign_column === arg_column_name)
			{
				self.leave(context, Devapt.msg_found);
				return field;
			}
		}
		
		
		self.leave(context, Devapt.msg_not_found);
		return null;
	};
	
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.is_pk_field(field)
	 * @desc				Test if given field is the model primary key field
	 * @param {object}		arg_field_obj		field object
	 * @return {boolean}
	 */
	var cb_is_pk_field = function(arg_field_obj)
	{
		var self = this;
		var context = 'is_pk_field(field)';
		self.enter(context, '');
		
		
		var is_pk_field = DevaptTypes.are_object(self.pk_field, arg_field_obj) ? self.pk_field.name === arg_field_obj.name : false;
		
		
		self.leave(context, Devapt.msg_success);
		return is_pk_field;
	};
	
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.get_pk_field()
	 * @desc				Get model primary key field
	 * @return {object}
	 */
	var cb_get_pk_field = function()
	{
		var self = this;
		var context = 'get_pk_field()';
		self.enter(context, '');
		
		self.assert_object(context, 'pk_field', self.pk_field);
		
		self.leave(context, Devapt.msg_found);
		return self.pk_field;
	};
	
	
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.get_fields()
	 * @desc				Get model fields
	 * @return {array}
	 */
	var cb_get_fields = function()
	{
		var self = this;
		var context = 'get_fields()';
		self.enter(context, '');
		
		
		self.leave(context, Devapt.msg_success);
		return self.fields;
	};
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.set_fields(fields)
	 * @desc				Set model fields
	 * @param {array}		arg_fields		fields objects or definitions array
	 * @return {boolean}
	 */
	var cb_set_fields = function(arg_fields)
	{
		var self = this;
		var context = 'set_fields(fields)';
		self.enter(context, '');
		
		
		// console.log(arg_fields, 'arg_fields');
		self.assert_object_size(context, 'fields', arg_fields, 1, 999);
		
		var cb_create_field = function(field_settings)
			{
				// console.log(self, 'model');
				// console.log(field_settings, 'field_settings');
				
				var field = (field_settings && field_settings.class_name && field_settings.class_name === 'DevaptField') ? field_settings : null;
				field = field ? field : DevaptField.create(field_settings.name, field_settings);
				
				field.model = self;
				
				return field;
			};
		
		self.fields = [];
		self.fields_map = {};
		for(var field_name in arg_fields)
		{
			var field_settings = arg_fields[field_name];
			field_settings['name'] = field_name;
			
			field_settings['field_value'] = {
				'type': field_settings.type ? field_settings.type : 'string',
				'items': field_settings.items ? field_settings.items : null,
				'validate': field_settings.validate ? field_settings.validate : ((field_settings.field_value && field_settings.field_value.validate) ? field_settings.field_value.validate : null),
				'valid_label': (field_settings.field_value && field_settings.field_value.validate_valid_label) ? field_settings.field_value.validate_valid_label : null,
				'error_label': (field_settings.field_value && field_settings.field_value.validate_valid_label) ? field_settings.field_value.validate_valid_label : null,
				'display': field_settings.display ? field_settings.display : null,
				'defaults': field_settings.defaults ? field_settings.defaults : null
			};
			field_settings['is_pk'] = DevaptTypes.to_boolean(field_settings.sql_is_primary_key, false) || DevaptTypes.to_boolean(field_settings.is_pk, false);
			field_settings['is_expression'] = DevaptTypes.to_boolean(field_settings.sql_is_expression, false);
			// self.value(context, 'field_settings', field);
			
			// CREATE FIELD OBJECT
			var field = self.do_callback(cb_create_field, [field_settings]);
			// self.value(context, 'field', field);
			
			// REGISTER FIELD
			self.fields.push(field);
			self.fields_map[field_name] = field;
			
			// REGISTER ID KEY FIELD
			if (field.is_pk)
			{
				self.value(context, 'set pk field', field_name);
				self.pk_field_name = field_name;
				self.pk_field = field;
			}
		}
		
		
		self.leave(context, Devapt.msg_success);
		return true;
	};
	
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.get_fields_names()
	 * @desc				Get model fields names
	 * @return {array}		Array of strings
	 */
	var cb_get_fields_names = function()
	{
		var self = this;
		var context = 'get_fields_names()';
		self.enter(context, '');
		
		
		self.leave(context, Devapt.msg_success);
		return Object.keys(self.fields_map);
	};
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.get_fields_types(fields names)
	 * @desc				Get given fields types
	 * @param {array}		arg_fields_names	fields names array
	 * @return {array}
	 */
	var cb_get_fields_types = function(arg_fields_names)
	{
		var self = this;
		var context = 'get_fields_types(fields names)';
		self.enter(context, '');
		
		
		var types = null;
		
		var get_field_type_cb = function(field)
		{
			return field.field_value.type;
		};
		
		if ( ! DevaptTypes.is_array(arg_fields_names) )
		{
			types = self.fields.map(get_field_type_cb);
			
			self.leave(context, Devapt.msg_success_require);
			return types;
		}
		
		var cb_filter = function(element, index, array)
		{
			return arg_fields_names.lastIndexOf(element.name) >= 0;
		};
		
		types = self.fields.filter(cb_filter).map(get_field_type_cb);
		
		
		self.leave(context, Devapt.msg_success);
		return types;
	};
	
	
	
	/* --------------------------------------------- ENGINE OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.get_engine()
	 * @desc				Get model storage engine
	 * @return {object}		promise
	 */
	var cb_get_engine = function()
	{
		var self = this;
		var context = 'get_engine()';
		self.enter(context, '');
		
		self.assert_not_null(context, 'engine promise', self.engine_promise);
		
		self.leave(context, Devapt.msg_success);
		return self.engine_promise;
	};
	
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.set_engine(engine)
	 * @desc				Set model storage engine
	 * @param {object}		arg_engine		engine instance or definition object
	 * @return {object}		promise
	 */
	var cb_set_engine = function(arg_engine)
	{
		var self = this;
		var context = 'set_engine(engine)';
		self.enter(context, '');
		
		
		self.assert_object(context, 'engine', arg_engine);
		self.engine_object = null;
		
		if (arg_engine.is_storage)
		{
			self.step(context, 'engine is created [' + arg_engine.name + ']');
			self.engine_object = arg_engine;
			self.engine_deferred.resolve(self.engine_object);
		}
		else
		{
			self.assert_not_empty_string(context, 'engine.name', arg_engine.name);
			self.assert_not_empty_string(context, 'engine.source', arg_engine.source);
			switch(arg_engine.source)
			{
				case 'json':
					require(['datas/storage/storage-json'],
						function(DevaptJsonStorage)
						{
							self.step(context, 'JSON engine is created');
							
							self.engine.is_local_storage = false;
							self.engine.is_remote_storage = true;
							
							var crud_api = self.get_server_api();
							
							arg_engine.url_read		= crud_api.action_read.url + '?query_api=2';
							arg_engine.url_create	= crud_api.action_create.url + '?query_api=2';
							arg_engine.url_update	= crud_api.action_update.url + '?query_api=2';
							arg_engine.url_delete	= crud_api.action_delete.url + '?query_api=2';
							
							self.engine_object = DevaptJsonStorage.create(arg_engine.name, arg_engine);
							self.engine_deferred.resolve(self.engine_object);
						}
					);
					break;
					
				case 'array':
				case 'memory':
					require(['datas/storage/storage-array'],
						function(DevaptMemoryStorage)
						{
							self.step(context, 'MEMORY engine is created');
							self.engine_object = DevaptMemoryStorage.create(arg_engine.name, arg_engine);
							self.engine_deferred.resolve(self.engine_object);
						}
					);
					break;
					
				default:
					self.step(context, 'BAD engine type');
					self.engine_deferred.reject();
					self.leave(context, Devapt.msg_failure + ': bad source [' + arg_engine.source + ']');
					return self.engine_promise;
			};
		}
		
		
		self.leave(context, Devapt.msg_success_promise);
		return self.engine_promise;
	};
	
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.get_server_api()
	 * @desc				Get CRUD API records
	 * @return {object}		promise
	 */
	var cb_get_server_api = function()
	{
		var self = this;
		var context = 'get_server_api()';
		self.enter(context, '');
		
		
		// TEST IF ALREADY CREATED
		if (self.crud_api && self.crud_api.read)
		{
			self.leave(context, Devapt.msg_success);
			return self.crud_api;
		}
		
		// CREATE API RECORD
		var url_base = DevaptApplication.get_url_base();
		if (self.engine.is_remote_storage)
		{
			self.crud_api = {
				model_name: self.name,
				is_remote:true,
				is_local:false,
				
				action_create: {
					method:'PUT',
					url:url_base + 'rest/' + self.name + '/',
					format:'devapt_query_api_2'
				},
				action_read: {
					method:'GET',
					url:url_base + 'rest/' + self.name + '/',
					format:'devapt_query_api_2'
				},
				action_update: {
					method:'POST',
					url:url_base + 'rest/' + self.name + '/',
					format:'devapt_query_api_2'
				},
				action_delete: {
					method:'DELETE',
					url:url_base + 'rest/' + self.name + '/',
					format:'devapt_query_api_2'
				}
			};
		}
		else
		{
			self.crud_api = {
				model_name: self.name,
				is_local:true,
				is_remote:false
			};
		}
		
		self.leave(context, Devapt.msg_success);
		return self.crud_api;
	};
	
	
	
	/* --------------------------------------------- ACCESS OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.get_access()
	 * @desc				Get model datas access
	 * @return {object}
	 */
	var cb_get_access = function()
	{
		var self = this;
		var context = 'get_access()';
		self.enter(context, '');
		
		self.assert_not_null(context, 'access', self.access);
		
		self.leave(context, Devapt.msg_success);
		return self.access;
	};
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.set_access(arg)
	 * @desc				Set model datas access
	 * @param {object}		arg_access		access as { 'create':bool, 'read':bool, 'update':bool, 'delete':bool };
	 * @return {nothing}
	 */
	var cb_set_access = function(arg_access)
	{
		var self = this;
		var context = 'set_access(engine)';
		self.enter(context, '');
		
		
		// DEFAULT ACCESSES
		var default_access =  { 'create':false, 'read':true, 'update':false, 'delete':false };
		self.access = window.$.extend(default_access, arg_access);
		
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	
	/* --------------------------------------------- CRUD OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptModel
	 * @public
	 * @method					DevaptModel.create(records)
	 * @desc					Create records into the model storage engine
	 * @param {object|array}	arg_records			one record object or an array of objects
	 * @return {object}			Operation promise
	 */
	var cb_create = function(arg_records)
	{
		var self = this;
		var context = 'create(records)';
		self.enter(context, '');
		
		self.assert_object(context, 'engine_promise', self.engine_promise);
		var promise = self.engine_promise.then(
			function(engine)
			{
				return engine.create_records(arg_records);
			}
		);
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	/**
	 * @memberof				DevaptModel
	 * @public
	 * @method					DevaptModel.read(query)
	 * @desc					Read records from the model storage engine
	 * @param {object}			arg_query			model query object
	 * @param {object}			arg_recordset		optional target recordset object
	 * @return {object}			Operation promise
	 */
	var cb_read = function(arg_query, arg_recordset)
	{
		var self = this;
		var context = 'read(query)';
		self.enter(context, '');
		
		self.assert_object(context, 'engine_promise', self.engine_promise);
		
		var promise = self.engine_promise.then(
			function(engine)
			{
				return engine.read_records(arg_query);
			}
		);
		
		promise = promise.then(
			function(resultset_obj)
			{
				if (! arg_recordset)
				{
					return DevaptRecordSet.create(self.name + '_recordset_' + Devapt.uid(), {resultset:resultset_obj, model:self});
				}
				
				arg_recordset.load(resultset_obj);
				
				// TODO REGISTER RECORDSET RECORDS ON MODEL
			}
		);
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	/**
	 * @memberof				DevaptModel
	 * @public
	 * @method					DevaptModel.read_all()
	 * @desc					Read all records from the model storage engine
	 * @return {object}			Operation promise
	 */
	var cb_read_all = function()
	{
		var self = this;
		var context = 'read_all()';
		self.enter(context, '');
		
		self.assert_object(context, 'engine_promise', self.engine_promise);
		
		var promise = self.engine_promise.then(
			function(engine)
			{
				return engine.read_all_records();
			}
		);
		
		promise = promise.then(
			function(resultset_obj)
			{
				return DevaptRecordSet.create(self.name + '_recordset_' + Devapt.uid(), {resultset:resultset_obj});
			}
		);
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	/**
	 * @memberof				DevaptModel
	 * @public
	 * @method					DevaptModel.update()
	 * @desc					Update records into the model storage engine
	 * @param {object|array}	arg_records			one record object or an array of objects
	 * @return {object}			Operation promise
	 */
	var cb_update = function(arg_records)
	{
		var self = this;
		var context = 'update(records)';
		self.enter(context, '');
		
		self.assert_object(context, 'engine_promise', self.engine_promise);
		arg_records = DevaptTypes.is_array(arg_records) ? arg_records : [arg_records];
		
		var promise = self.engine_promise.then(
			function(engine)
			{
				return engine.update_records(arg_records);
			}
		);
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	/**
	 * @memberof				DevaptModel
	 * @public
	 * @method					DevaptModel.delete()
	 * @desc					Create records into the model storage engine
	 * @param {object|array}	arg_records			one record object or an array of objects
	 * @return {object}			Operation promise
	 */
	var cb_delete = function(arg_records)
	{
		var self = this;
		var context = 'delete(records)';
		self.enter(context, '');
		
		self.assert_object(context, 'engine_promise', self.engine_promise);
		arg_records = DevaptTypes.is_array(arg_records) ? arg_records : [arg_records];
		
		var promise = self.engine_promise.then(
			function(engine)
			{
				return engine.delete_records(arg_records);
			}
		);
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-12',
			'updated':'2015-01-03',
			'description':'Datas model controller class.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptObject;
	var DevaptModelClass = new DevaptClass('DevaptModel', parent_class, class_settings);
	
	
	// METHODS
	DevaptModelClass.infos.ctor = cb_constructor;
	DevaptModelClass.add_public_method('is_valid', {}, cb_is_valid);
	
	DevaptModelClass.add_public_method('new_record', {}, cb_new_record);
	DevaptModelClass.add_public_method('add_record', {}, cb_add_record);
	DevaptModelClass.add_public_method('free_record', {}, cb_free_record);
	DevaptModelClass.add_public_method('free_records', {}, cb_free_records);
	
	DevaptModelClass.add_public_method('has_field', {}, cb_has_field);
	DevaptModelClass.add_public_method('get_field', {}, cb_get_field);
	DevaptModelClass.add_public_method('get_field_for_column', {}, cb_get_field_for_column);
	DevaptModelClass.add_public_method('is_pk_field', {}, cb_is_pk_field);
	DevaptModelClass.add_public_method('get_pk_field', {}, cb_get_pk_field);
	DevaptModelClass.add_public_method('get_fields', {}, cb_get_fields);
	DevaptModelClass.add_public_method('set_fields', {}, cb_set_fields);
	DevaptModelClass.add_public_method('get_fields_names', {}, cb_get_fields_names);
	DevaptModelClass.add_public_method('get_fields_types', {}, cb_get_fields_types);
	
	DevaptModelClass.add_public_method('get_engine', {}, cb_get_engine);
	DevaptModelClass.add_public_method('set_engine', {}, cb_set_engine);
	DevaptModelClass.add_public_method('get_server_api', {}, cb_get_server_api);
	
	DevaptModelClass.add_public_method('get_access', {}, cb_get_access);
	DevaptModelClass.add_public_method('set_access', {}, cb_set_access);
	
	DevaptModelClass.add_public_method('create', {}, cb_create);
	DevaptModelClass.add_public_method('read', {}, cb_read);
	DevaptModelClass.add_public_method('read_all', {}, cb_read_all);
	DevaptModelClass.add_public_method('update', {}, cb_update);
	DevaptModelClass.add_public_method('delete', {}, cb_delete);
	
	
	// PROPERTIES
	DevaptModelClass.add_public_str_property('driver',			'', null, true, false, []);
	DevaptModelClass.add_public_str_property('connexion',		'', null, true, false, []);
	DevaptModelClass.add_public_str_property('role_read',		'', null, true, false, []);
	DevaptModelClass.add_public_str_property('role_create',		'', null, true, false, []);
	DevaptModelClass.add_public_str_property('role_update',		'', null, true, false, []);
	DevaptModelClass.add_public_str_property('role_delete',		'', null, true, false, []);
	DevaptModelClass.add_public_str_property('crud_db',			'', null, false, false, []);
	DevaptModelClass.add_public_str_property('crud_table',		'', null, true, false, []);
	DevaptModelClass.add_public_str_property('pk_field_name',	'', null, true, false, []);
	DevaptModelClass.add_public_object_property('joins',		'', null, false, false, []);
	
	DevaptModelClass.add_public_object_property('engine',		'', null, true, false, []);
	DevaptModelClass.add_public_object_property('fields',		'', null, true, false, []);
	DevaptModelClass.add_public_object_property('fields_map',	'', null, true, false, []);
	DevaptModelClass.add_public_object_property('access',		'', {'create':false,'read':false,'update':false,'delete':false}, false, false, []);
	
	
	
	return DevaptModelClass;
} );

/**
 * @file        datas/model/view_model-mixin-crudable.js
 * @desc        ModelView mixin class for CRUD operations
 * 				
 *              MIXIN API:
 *                  ->constructor(object)     : nothing
 *  
 *                  ->reload()                : Reload records from the model recordset and refresh the view (Promise of the operation end)
 * 					
 *                  ->get_values_recordset()  : Get the recordset (Promise of a RecordSet)
 *                  ->get_values()            : Get the recordset values (Promise of an array of Record or plain object)
 *  				
 *                  ->get_first_record_by_object(object) : Lookup a record with a datas values object (Promise of a Record object)
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2015-02-02
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/model/view_model-mixin-crudable',[
	'Devapt', 'core/types',
	'object/class', 'object/object',
	'datas/model/recordset'],
function(
	Devapt, DevaptTypes,
	DevaptClass, DevaptObject,
	DevaptRecordSet)
{
	/**
	 * @public
	 * @class				DevaptViewModelMixinCrudable
	 * @desc				ModelView mixin class for CRUD operations
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptViewModelMixinCrudable
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		var context = 'DevaptViewModelMixinCrudable.constructor';
		self.enter(context, '');
		
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	
	/* --------------------------------------------- LOAD OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptViewModelMixinCrudable
	 * @public
	 * @method					self.reload()
	 * @desc					Reload records from the model recordset and refresh the view
	 * @return {object}			Promise of the operation
	 */
	var cb_reload = function ()
	{
		var self = this;
		var context = 'reload()';
		self.enter(context, '');
		self.assert_object(context, 'ready_promise', self.ready_promise);
		
		
		// LOAD DATAS
		var promise = self.ready_promise.spread(
			function(arg_model, arg_view)
			{
				var datas_promise = self.recordset.read();
				self.assert_object(context, 'datas_promise', datas_promise);
				
				datas_promise.then(
					function(recordset)
					{
						self.assert_object(context, 'recordset', recordset);
						
						// UPDATE THE VIEW
						self.ready_promise.spread(
							function(arg_model, arg_view)
							{
								self.step(context, 'read success');
								if (arg_view.on_view_model_reload)
								{
									arg_view.on_view_model_reload();
								}
							}
						);
					}
				);
				return datas_promise;
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	
	/**
	 * @memberof				DevaptViewModelMixinCrudable
	 * @public
	 * @method					self.get_values_recordset()
	 * @desc					Get datas values RecordSet promise
	 * @return {promise}		A promise of a RecordSet
	 */
	var cb_get_values_recordset = function ()
	{
		var self = this;
		var context = 'get_values_recordset()';
		self.enter(context, '');
		
		
		var promise = self.ready_promise.spread(
			function(arg_model, arg_view)
			{
				// var items = [];
				self.assert_not_empty_string(context, 'arg_view.items_iterator', arg_view.items_iterator);
				
				switch(arg_view.items_iterator)
				{
					case 'records':
					{
						return Devapt.promise_resolved(self.get_recordset());
					}
					
					case 'fields':
					{
						return Devapt.promise_resolved(self.get_recordset());
					}
					
					case 'field_editor':
					{
						self.assert_not_empty_array(context, 'arg_view.items_fields', arg_view.items_fields);
						
						var field_name = arg_view.items_fields[0];
						self.assert_not_empty_string(context, 'field_name', field_name);
						
						var field_obj = self.recordset.model.get_field(field_name);
						self.assert_object(context, 'field_obj', field_obj);
						
						self.edited_field = field_obj;
						
						// GET FIELD VALUES
						return field_obj.get_available_values(true);
					}
				}
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	
	/**
	 * @memberof				DevaptViewModelMixinCrudable
	 * @public
	 * @method					self.get_values()
	 * @desc					Get datas values array promise
	 * @return {promise}		A promise of an array of values (Record or object)
	 */
	var cb_get_values = function ()
	{
		var self = this;
		var context = 'get_values()';
		self.enter(context, '');
		
		
		var promise = self.ready_promise.spread(
			function(arg_model, arg_view)
			{
				var items = [];
				self.assert_not_empty_string(context, 'arg_view.items_iterator', arg_view.items_iterator);
				
				switch(arg_view.items_iterator)
				{
					case 'records':
					{
						items = self.get_recordset().get_records();
						// self.value(context, 'items', items);
						
						if (arg_view.items_source === 'inline')
						{
							items = items.map(
								function (item) { return ('value' in item) ? item.get('value') : undefined; }
							);
						}
						return Devapt.promise_resolved(items);
					}
					
					case 'fields':
					{
						// GET FIRST RECORD
						var records = self.get_recordset().get_records();
						var record = records.length > 0 ? records[0] : null;
						if ( DevaptTypes.is_object(record) )
						{
							self.step(context, 'current record is found');
							
							self.value(context, 'arg_view.items_fields', arg_view.items_fields);
							items = record.get_fields_values(arg_view.items_fields);
							self.value(context, 'items', items);
						}
						return Devapt.promise_resolved(items);
					}
					
					case 'field_editor':
					{
						self.assert_not_empty_array(context, 'arg_view.items_fields', arg_view.items_fields);
						
						var field_name = arg_view.items_fields[0];
						self.assert_not_empty_string(context, 'field_name', field_name);
						
						var field_obj = self.recordset.model.get_field(field_name);
						self.assert_object(context, 'field_obj', field_obj);
						
						self.edited_field = field_obj;
						
						// GET FIELD VALUES
						var items_promise = field_obj.get_available_values(true);
						items_promise = items_promise.then(
							function(arg_recordset)
							{
								var records = arg_recordset.get_records();
								// self.value(context, 'records', records);
								
								return records;
							}
						);
						
						self.leave(context, Devapt.msg_success_promise);
						return items_promise;
					}
				}
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	
	/**
	 * @memberof				DevaptViewModelMixinCrudable
	 * @public
	 * @method					self.get_first_record_by_object()
	 * @desc					Lookup a record with a datas values object
	 * @param {object}			arg_item_object		datas values object
	 * @return {promise}		A promise of Record
	 */
	var cb_get_first_record_by_object = function (arg_item_object)
	{
		var self = this;
		var context = 'get_first_record_by_object(item)';
		self.enter(context, '');
		
		
		var promise = self.ready_promise.spread(
			function(arg_model, arg_view)
			{
				self.step(context, 'view_model is ready');
				self.assert_not_empty_string(context, 'arg_view.items_iterator', arg_view.items_iterator);
				
				switch(arg_view.items_iterator)
				{
					case 'records':
					{
						self.step(context, 'view_model iterator is records');
						
						var record = self.get_recordset().get_first_record_by_object(arg_item_object);
						self.value(context, 'record', record);
						
						return Devapt.promise_resolved(record);
					}
					
					case 'fields':
					{
						self.step(context, 'view_model iterator is fields');
						
						// GET FIRST RECORD
						var records = self.get_recordset().get_records();
						var record = records.length > 0 ? records[0] : null;
						
						return Devapt.promise_resolved(record);
					}
					
					case 'field_editor':
					{
						self.step(context, 'view_model iterator is field_editor');
						self.assert_not_empty_array(context, 'arg_view.items_fields', arg_view.items_fields);
						
						var field_name = arg_view.items_fields[0];
						self.assert_not_empty_string(context, 'field_name', field_name);
						
						var field_obj = self.recordset.model.get_field(field_name);
						self.assert_object(context, 'field_obj', field_obj);
						
						self.edited_field = field_obj;
						
						// GET FIELD VALUES
						var record_promise = field_obj.get_available_values(true);
						record_promise = record_promise.then(
							function(arg_recordset)
							{
								var record = arg_recordset.get_first_record_by_object(arg_item_object);
								self.value(context, 'record', record);
								
								return record;
							}
						);
						
						self.leave(context, Devapt.msg_success_promise);
						return record_promise;
					}
				}
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-02-02',
			updated:'2015-02-08',
			description:'Mixin for CRUD operation on a model view.'
		}
	};
	var parent_class = null;
	var DevaptViewModelMixinCrudableClass = new DevaptClass('DevaptViewModelMixinCrudable', parent_class, class_settings);
	
	
	// METHODS
	DevaptViewModelMixinCrudableClass.infos.ctor = cb_constructor;
	
	DevaptViewModelMixinCrudableClass.add_public_method('reload', {}, cb_reload);
	
	DevaptViewModelMixinCrudableClass.add_public_method('get_values', {}, cb_get_values);
	DevaptViewModelMixinCrudableClass.add_public_method('get_values_recordset', {}, cb_get_values_recordset);
	
	DevaptViewModelMixinCrudableClass.add_public_method('get_first_record_by_object', {}, cb_get_first_record_by_object);
	
	
	// PROPERTIES
	
	
	return DevaptViewModelMixinCrudableClass;
} );
/**
 * @file        datas/model/view_model-mixin-selectable.js
 * @desc        ModelView mixin class for SELECT/UNSELECT operations
 * 				
 * 				Process:
 * 					A view V detects the selection of one or more of its items.
 * 					V call V.select(item index or item labek or item record) for each selected items.
 * 					promise = V.select(args)
 * 						selected items = V.get_selected_items(args)
 * 						--> V.view_model.on_container_select(selected items) : promise
 * 							--> V.view_model.(un)select_record(record);
 * 							--> V.on_view_model_select(selected item) : promise
 * 					
 *              MIXIN API:
 *                  ->constructor(object)            : nothing
 *  				
 *                  ->get_selected_records()         : Get current selected records (Array of Record objects)
 *                  ->set_selected_records(records)  : Set current selected records (call select_record on all records) (nothing)
 *                  
 * 					->select_record(record)          : Select a record into the ViewModel object (nothing)
 *                  ->unselect_record(record)        : Unselect a recorsinto the ViewModel object (nothing)
 * 					
 * 					->new_selected_record(record)    : Return the given Record or create a Record object with a given plain object (Record object)
 * 					
 * 					->on_container_select(selected_items)   : React on a container selection change
 * 						foreach(selected_items)
 * 							record = self.get_recordset().get_first_record_by_object(selected_item)
 * 							self.select_record(record) or self.unselect_record(record)
 * 							self.recordset.free_record(record) if needed
 * 							view.on_view_model_select(selected_item) or view.on_view_model_unselect(selected_item)
 * 					->on_container_unselect(selected_items) : React on a container selection change
 * 					
 *                  ->on_container_select_all()      : React on a container full selection change
 *                  ->on_container_unselect_all()    : React on a container full selection change
 *        
 * @ingroup     DEVAPT_DATAS
 * @date        2015-02-08
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/model/view_model-mixin-selectable',[
	'Devapt', 'core/types',
	'object/class', 'object/object'
	],
function(
	Devapt, DevaptTypes,
	DevaptClass, DevaptObject)
{
	/**
	 * @public
	 * @class				DevaptViewModelMixinSelectable
	 * @desc				ModelView mixin class for SELECT/UNSELECT operations
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptViewModelMixinSelectable
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = 'DevaptViewModelMixinSelectable.constructor';
		self.enter(context, '');
		
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	
	/* --------------------------------------------- SELECTION OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					DevaptViewModel.get_selected_records()
	 * @desc					Get selected records
	 * @return {array}			Array of Records of the ViewModel Recordset
	 */
	var cb_get_selected_records = function ()
	{
		var self = this;
		self.step('get selected records', '');
		return self.selection;
	};
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					DevaptViewModel.set_selected_records(records)
	 * @desc					Set selected records (unselect all previous records)
	 * @param {array}			arg_records		Record array
	 * @return {nothing}
	 */
	var cb_set_selected_records = function (arg_records)
	{
		var self = this;
		var context = 'set_selected_records(records)';
		self.enter(context, '');
		
		
		// CHECK RECORDS
		self.assert_array(context, 'records', arg_records);
		self.assert_array(context, 'self.selection', self.selection);
		
		// UNSELECT ALL RECORDS
		self.selection.forEach(
			function(record)
			{
				record.unselect();
			}
		);
		
		self.selection = [];
		
		var check_record_cb = function(record)
		{
			var check = DevaptTypes.is_object(record) && record.is_record && record.is_valid();
			if (check)
			{
				self.select_record(record);
			}
			return check;
		};
		
		var check_select_records = self.selection.every(check_record_cb);
		self.assert_true(context, 'check and select records', check_select_records);
		
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					self.selected_record(record)
	 * @desc					Select a record
	 * @param {object}			arg_record		a Record object
	 * @return {nothing}
	 */
	var cb_select_record = function (arg_record)
	{
		var self = this;
		var context = 'select_record(record)';
		self.enter(context, '');
		self.assert_object(context, 'record is object', arg_record);
		self.assert_true(context, 'record.is_record', arg_record.is_record && arg_record.is_valid());
//		self.assert_true(context, 'record is part of this recordset?', self.recordset.has_record(arg_record) );
		
		
		/*var promise = self.ready_promise.spread(
			function(arg_model, arg_view)
			{
				self.assert_not_empty_string(context, 'arg_view.items_iterator', arg_view.items_iterator);
				
				switch(arg_view.items_iterator)
				{
					case 'records':
					{
						self.step(context, 'nothing to do for records view iterator');
						break;
					}
					
					case 'fields':
					{
						self.step(context, 'nothing to do for fields view iterator');
						break;
					}
					
					case 'field_editor':
					{
						self.step(context, 'view iterator is field_editor');
						break;
					}
				}
			}
		);*/
		
		arg_record.select();
		self.selection.push(arg_record);
		
		
		self.leave(context, '');
	};
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					self.selected_record(record)
	 * @desc					Select a record
	 * @param {object}			arg_record		a Record object
	 * @return {nothing}
	 */
	var cb_unselect_record = function (arg_record)
	{
		var self = this;
		var context = 'unselect_record(record)';
		self.enter(context, '');
		self.assert_object(context, 'record is object', arg_record);
		self.assert_true(context, 'record.is_record', arg_record.is_record && arg_record.is_valid());
//		self.assert_true(context, 'record is part of this recordset?', self.recordset.has_record(arg_record) );
		
		
		arg_record.unselect();
		
		// REMOVE RECORD FROM SELECTED RECORDS
		var tmp_selection = [];
		for(var index in self.selection)
		{
			var loop_record = self.selection[index];
			if (loop_record.get_id() !== arg_record.get_id())
			{
				tmp_selection.push(loop_record);
			}
		}
		self.selection = tmp_selection;
		
		
		self.leave(context, '');
	};
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					DevaptViewModel.new_selected_record()
	 * @desc					Get selected records
	 * @param {object}			arg_record	given record or selected item
	 * @return {object}			A Record object promise
	 */
	var cb_new_selected_record = function (arg_record)
	{
		var self = this;
//		self.trace=true;
		var context = 'new_selected_record(record)';
		self.enter(context, '');
		self.assert_object(context, 'arg_record', arg_record);
		
		
		// GIVEN RECORD IS A VALID RECORD
		if (arg_record.is_record)
		{
			if ( self.get_recordset().has_record(arg_record) )
			{
				self.leave(context, Devapt.msg_success_promise);
				return Devapt.promise_resolved(arg_record);
			}
			
			arg_record = arg_record.datas;
		}
		
		// DEBUG
//		console.log(self.linked_record, context + ':self.linked_record');
//		console.log(arg_record, context + ':arg_record');
		
		// INIT
		// var record = null;
		
		// LOOKUP FOR RECORD OF GIVEN VALUES OBJECT
		var record_promise = null;
		if (arg_record.is_record)
		{
			record_promise = Devapt.promise_resolved(arg_record);
		}
		else
		{
			var values_promise = self.get_values();
			record_promise = values_promise.then(
				function(values)
				{
	//				self.trace=true;
					self.step(context, 'values are found');
					console.log(values, context + ':values');
					self.value(context, 'values', values);
					
					for(var index=0 ; index < values.length ; ++index)
					{
						self.value(context, 'values index', index);
						
						var loop_record = values[index];
						if (loop_record.is_record)
						{
							self.step(context, 'current value is a Record');
							
							// TEST ID
							var id_field_name = loop_record.recordset.id_field_name;
							if ( loop_record.get_id() == arg_record[id_field_name])
							{
								self.step(context, Devapt.msg_found);
								return Devapt.promise_resolved(loop_record);
							}
							
							// TEST ALL FIELDS
							for(var field_name in arg_record)
							{
								self.value(context, 'field_name', field_name);
								
								var field_value = arg_record[field_name];
								var found = loop_record.has_field_value(field_name, field_value);
								if (found)
								{
									self.step(context, Devapt.msg_found);
									return Devapt.promise_resolved(loop_record);
								}
							}
							
							continue;
						}
						
						self.step(context, 'current value is not a Record');
						
						// TEST ALL FIELDS
						for(var field_name in arg_record)
						{
							self.value(context, 'field_name', field_name);
							
							var loop_field_value = arg_record[field_name];
							var loop_found = (field_name in loop_record) && loop_record[field_name] == loop_field_value;
							if (loop_found)
							{
								self.step(context, Devapt.msg_found);
								var record = self.recordset.get_first_record_by_object(loop_record);
								if (record)
								{
									self.step(context, 'Record found');
									return Devapt.promise_resolved(record);
								}
								
								self.step(context, 'Record not found');
								console.error(loop_record, self.name + '.' + context + ':not found');
								console.log(self.recordset, self.name + '.' + context + ':recordset');
								return Devapt.promise_rejected(record);
							}
						}
					}
					
					self.step(context, Devapt.msg_not_found);
					return Devapt.promise_rejected(arg_record);
				}
			);
		}
		
		// PROCESS FOUND RECORD
		record_promise = record_promise.then(
			function(arg_found_record)
			{
//				self.trace=true;
//				console.log(arg_found_record, context + ':arg_found_record');
				self.assert_object(context, 'found record', arg_found_record);
				
				return self.ready_promise.spread(
					function(arg_model, arg_view)
					{
						self.assert_not_empty_string(context, 'arg_view.items_iterator', arg_view.items_iterator);
						
						switch(arg_view.items_iterator)
						{
							case 'records':
							{
								self.step(context, 'records iterator');
								return arg_found_record;
							}
							
							case 'fields':
							{
								self.step(context, 'fields iterator');
								return arg_found_record;
							}
							
							case 'field_editor':
							{
								self.step(context, 'field_editor iterator');
								
								// CHECK FIELD EDITOR OBJECT
								self.assert_object(context, 'self.edited_field', self.edited_field);
								
				//				var edited_field_name = self.edited_field.name;
								var edited_field_asso = self.edited_field.get_association();
				//				console.log(edited_field_asso, context + ':edited_field_asso');
								
								var datas = self.linked_record.get_datas();
				//				var model = self.recordset.model;
								
				//				var model_pk_field_name = model.get_pk_field().name;
								var asso_id_field_name = edited_field_asso.model.pk_field_name;
								var datas_id_field_name = self.linked_record.recordset.id_field_name;
								var new_record_fields = [datas_id_field_name, asso_id_field_name];
				//				console.log(new_record_fields, context + ':new_record_fields');
								
								
								var new_record = {};
								for(var field_index in new_record_fields)
								{
									var field_name = new_record_fields[field_index];
									var loop_field_value = null;
									
									if ( arg_found_record.has_field(field_name) )
									{
										loop_field_value = arg_found_record.get(field_name);
										new_record[field_name] = loop_field_value;
										continue;
									}
									
									if (field_name in datas)
									{
										loop_field_value = datas[field_name];
										new_record[field_name] = loop_field_value;
									}
								}
//								console.log(new_record, context + ':new_record');
								
								return self.recordset.append([new_record]).then(
									function(arg_new_records)
									{
										self.step(context, 'new record is added in recordset');
										return self.recordset.read().then(
											function(arg_recordset)
											{
												self.step(context, 'recordset record is found');
												return arg_recordset.get_first_record_by_object(new_record);
											}
										);
									}
								);
							}
						}
					}
				);
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return record_promise;
	};
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					self.on_container_select(items, is unselect)
	 * @desc					React on a container selection change
	 * @param {array}			arg_selected_items		array of selected items attributes
	 * @return {nothing}
	 */
	var cb_on_container_select = function (arg_selected_items, arg_unselect)
	{
		var self = this;
//		self.trace=true;
		arg_unselect = !! arg_unselect;
		var context = arg_unselect ? 'on_container_unselect(items)' : 'on_container_select(items)';
		self.enter(context, '');
		self.assert_array(context, 'arg_selected_items', arg_selected_items);
		self.value(context, 'arg_unselect', arg_unselect);
		
		
		try
		{
			var process_selected_items_results = [];
			var process_selected_item_cb = function(arg_selected_item_promise)
			{
				arg_selected_item_promise.then(
					function(arg_selected_item)
					{
						self.step(context, 'selected item is ready');
						
						// DEBUG
//						self.value(context, 'selected item', arg_selected_item);
//						console.debug(arg_selected_item, context + ':selected item');
						
						var result_promise = null;
						
						// GET SELECTED ITEM
						var item_record = arg_selected_item.record;
//						self.value(context, 'item record', item_record);
						self.assert_object(context, 'item_record', item_record);
						
						// GET MODEL RECORD FOR CURRENT SELECTED ITEM
						var record = item_record.is_record ? item_record : self.get_recordset().get_first_record_by_object(item_record);
//						self.value(context, 'recordset record', record);
//						console.debug(self.get_recordset(), context + ':selected item recordset');
//						console.debug(record, context + ':selected item record');
						if (record && record.is_record && ! item_record.is_record)
						{
							arg_selected_item.record = record;
						}
						
						var saved_trace = self.trace;
//						self.trace=true;
						
						// DO RECORD SELECT OPERATION
						if (arg_selected_item.already_selected)
						{
							self.step(context, 'DO RECORD SELECT OPERATION: item is already selected');
							
							self.assert_object(context, 'recordset record', record);
							self.assert_true(context, 'recordset record.is_record', record.is_record);
							
							self.step(context, 'unselect item with existing record');
							
							if (arg_unselect)
							{
								self.select_record(record);
							}
							else
							{
								self.unselect_record(record);
								
								// REMOVE RECORD
								self.value(context, 'self.view_items_iterator', self.view_items_iterator);
								if (self.view_items_iterator === 'field_editor')
								{
									self.step(context, 'free recordset record');
									self.recordset.free_record(record);
								}
							}
						}
						else
						{
							self.step(context, 'DO RECORD SELECT OPERATION: item is not already selected');
							
							if (record && record.is_record)
							{
								self.step(context, 'select item with existing record');
								if (! arg_unselect)
								{
									self.step(context, 'do select record');
									self.select_record(record);
								}
								else
								{
									self.step(context, 'do unselect record');
									self.unselect_record(record);
									
									// REMOVE RECORD
									self.value(context, 'self.view_items_iterator', self.view_items_iterator);
									if (self.view_items_iterator === 'field_editor')
									{
										self.step(context, 'free recordset record');
										self.recordset.free_record(record);
									}
								}
							}
							else
							{
								self.step(context, 'select item with new record');
								var record_promise = self.new_selected_record(item_record);
								record_promise.then(
									function(arg_record)
									{
										if (arg_record && arg_record.is_record)
										{
											arg_selected_item.record = arg_record;
										}
										else
										{
											console.error(arg_record, self.name + '.' + context + ':not a Record');
										}
										
										if (! arg_unselect)
										{
											self.step(context, 'do select record');
											self.select_record(arg_record);
										}
										else
										{
											self.step(context, 'do select record');
											self.unselect_record(arg_record);
										}
									}
								);
							}
						}
						
						// DO VIEW SELECT OPERATION
						result_promise = self.view_promise.then(
							function(view)
							{
								var saved_trace = self.trace;
//								self.trace=true;
								
								self.step(context, 'view is ready');
								if (arg_selected_item.already_selected)
								{
									if (arg_unselect)
									{
										self.step(context, 'view: select item');
										view.on_view_model_select(arg_selected_item);
									}
									else
									{
										self.step(context, 'view: unselect item');
										view.on_view_model_unselect(arg_selected_item);
									}
								}
								else
								{
									if (! arg_unselect)
									{
										self.step(context, 'view: select item');
										view.on_view_model_select(arg_selected_item);
									}
									else
									{
										self.step(context, 'view: unselect item');
										view.on_view_model_unselect(arg_selected_item);
									}
								}
								
								self.trace=saved_trace;
							}
						);
						self.trace=saved_trace;
						
						process_selected_items_results.push(result_promise);
					}
				);
			};
			
			self.step(context, 'loop on selected items');
			self.batch_promise = self.batch_promise.then(
				function()
				{
					arg_selected_items.forEach(process_selected_item_cb);
					return Devapt.promise_all(process_selected_items_results);
				}
			);
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		self.leave(context, '');
	};
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					self.on_container_select(record)
	 * @desc					Select a record
	 * @param {array}			arg_selected_items		array of selected items attributes
	 * @return {nothing}
	 */
	var cb_on_container_unselect = function (arg_selected_items, arg_unselect)
	{
		var self = this;
		self.on_container_select(arg_selected_items, true);
	};
	
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					self.on_container_select_all()
	 * @desc					Select all selected records
	 * @return {object}			A promise of the operation
	 */
	var cb_on_container_select_all = function ()
	{
		var self = this;
//		self.trace=true;
		var context = 'on_container_select_all()';
		self.enter(context, '');
		
		
		try
		{
			var process_selected_items_results = [];
			var process_selected_record_cb = function(arg_selected_record)
			{
				self.step(context, 'loop on selected record');
//				self.value(context, 'selected record', arg_selected_record);
				
				// DO RECORD SELECT OPERATION
				self.select_record(arg_selected_record);
				
				// DO VIEW SELECT OPERATION
				var promise = self.view_promise.then(
					function(view)
					{
						self.step(context, 'view: on view_model unselect');
						var selected_item_promise = view.get_selected_item(arg_selected_record);
						
						return selected_item_promise.then(
							function(arg_selected_item)
							{
								self.step(context, 'select item is found');
//								self.value(context, 'arg_selected_item', arg_selected_item);
								return view.on_view_model_select(arg_selected_item);
							}
						);
					}
				);
				
				process_selected_items_results.push(promise);
			};
			
			self.step(context, 'loop on selected records');
			self.batch_promise = self.batch_promise.then(
				function()
				{
					self.recordset.get_records().forEach(process_selected_record_cb);
					return Devapt.promise_all(process_selected_items_results);
				}
			);
		}
		catch(e)
		{
			console.error(e, context);
			self.leave(context, Devapt.msg_failure_promise);
			return Devapt.promise_rejected(e);
		}
		
		
		self.leave(context, Devapt.msg_success_promise);
		return self.batch_promise;
	};
	
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					self.on_container_unselect_all()
	 * @desc					Unselect all selected records
	 * @return {object}			A promise of the operation
	 */
	var cb_on_container_unselect_all = function ()
	{
		var self = this;
//		self.trace=true;
		var context = 'on_container_unselect_all()';
		self.enter(context, '');
		
		
		try
		{
			var process_selected_items_results = [];
			var process_selected_record_cb = function(arg_selected_record)
			{
				self.step(context, 'loop on selected record');
//				self.value(context, 'selected record', arg_selected_record);
				
				// DO RECORD SELECT OPERATION
				self.unselect_record(arg_selected_record);
				
				// DO VIEW SELECT OPERATION
				var promise = self.view_promise.then(
					function(view)
					{
						self.step(context, 'view: on view_model unselect');
						var selected_item_promise = view.get_selected_item(arg_selected_record);
						
						return selected_item_promise.then(
							function(arg_selected_item)
							{
								self.step(context, 'select item is found');
//								self.value(context, 'arg_selected_item', arg_selected_item);
								return view.on_view_model_unselect(arg_selected_item);
							}
						);
					}
				);
				
				process_selected_items_results.push(promise);
			};
			
			self.step(context, 'loop on selected records');
			self.batch_promise = self.batch_promise.then(
				function()
				{
					self.selection.forEach(process_selected_record_cb);
					return Devapt.promise_all(process_selected_items_results);
				}
			);
		}
		catch(e)
		{
			console.error(e, context);
			self.leave(context, Devapt.msg_failure_promise);
			return Devapt.promise_rejected(e);
		}
		
		
		self.leave(context, Devapt.msg_success_promise);
		return self.batch_promise;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-02-02',
			updated:'2015-02-08',
			description:'Mixin for SELECT/UNSELECT operation on a model view.'
		}
	};
	var parent_class = null;
	var DevaptViewModelMixinSelectableClass = new DevaptClass('DevaptViewModelMixinSelectable', parent_class, class_settings);
	
	
	// METHODS
	DevaptViewModelMixinSelectableClass.infos.ctor = cb_constructor;
	
		// SELECTION OPERATIONS
	DevaptViewModelMixinSelectableClass.add_public_method('get_selected_records', {}, cb_get_selected_records);
	DevaptViewModelMixinSelectableClass.add_public_method('set_selected_records', {}, cb_set_selected_records);
	
	DevaptViewModelMixinSelectableClass.add_public_method('select_record', {}, cb_select_record);
	DevaptViewModelMixinSelectableClass.add_public_method('unselect_record', {}, cb_unselect_record);
	
	DevaptViewModelMixinSelectableClass.add_public_method('new_selected_record', {}, cb_new_selected_record);
	
	DevaptViewModelMixinSelectableClass.add_public_method('on_container_select', {}, cb_on_container_select);
	DevaptViewModelMixinSelectableClass.add_public_method('on_container_unselect', {}, cb_on_container_unselect);
	
	DevaptViewModelMixinSelectableClass.add_public_method('on_container_select_all', {}, cb_on_container_select_all);
	DevaptViewModelMixinSelectableClass.add_public_method('on_container_unselect_all', {}, cb_on_container_unselect_all);
	
	
	// PROPERTIES
	DevaptViewModelMixinSelectableClass.add_public_array_property('selection', 'Selected model datas records', null, true, false, []);
	
	
	return DevaptViewModelMixinSelectableClass;
} );
/**
 * @file        views/view/view-mixin-renderable.js
 * @desc        Mixin of render methods for view rendering
 * 					API
 * 						STATIC STATE CONSTANTS
 * 							Devapt.STATE_NOT_RENDERED
 * 							Devapt.STATE_BEFORE_RENDERING: before_rendering is running
 * 							Devapt.STATE_RENDERING: render is running
 * 							Devapt.STATE_AFTER_RENDERING: after_rendering is running
 * 							Devapt.STATE_RENDERED: rendering process is finished
 * 						
 * 						STATE METHODS
 * 							get_render_state():string        -> get the render state
 * 							set_render_state(state):boolean  -> set render state
 * 							set_render_state_not():nothing   -> set not_rendered state
 * 							set_render_state_before()        -> set before_rendering state
 * 							set_render_state_rendering()     -> set rendering state
 * 							set_render_state_after()         -> set after_rendering state
 * 							set_render_state_rendered()      -> set rendered state
 * 							
 * 						RENDER METHODS
 * 							mixin_renderable_init(self):nothing -> mixin constructor
 * 							
 * 							render_before():promise
 * 							render_before_self():promise
 * 							
 * 							render():promise
 * 							render_content():promise
 * 							render_content_self():promise
 * 							
 * 							render_after():promise
 * 							render_after_self():promise
 * 						
 * @see			DevaptMixinRenderable
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-02-11
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/view/view-mixin-renderable',['Devapt', 'core/types', 'object/class'],
function(Devapt, DevaptTypes, DevaptClass)
{
	/**
	 * @mixin				DevaptMixinRenderable
	 * @public
	 * @desc				Mixin of render methods
	 */
	var DevaptMixinRenderable = 
	{
		/**
		 * @memberof			DevaptMixinRenderable
		 * @public
		 * @desc				mixin_renderable_state: State of the render process
		 * 							* not_rendered
		 * 							* before_rendering
		 * 							* rendering
		 * 							* after_rendering
		 * 							* rendered
		 */
		// mixin_renderable_state: 'not_rendered',
		
		
		/**
		 * @memberof			DevaptMixinRenderable
		 * @public
		 * @desc				mixin_renderable_render_count: Count of rendering runs
		 */
		// mixin_renderable_render_count: 0,
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Init mixin
		 * @return {nothing}
		 */
		mixin_renderable_init: function(self)
		{
			var context = 'mixin_renderable_init()';
			self.enter(context, '');
			
			
			self.set_render_state_not();
			self.mixin_renderable_count = 0;
			
			
			self.leave(context, '');
		},
		
		
		
		/* --------------------------------------------- RENDER STATE ------------------------------------------------ */
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Get render state string
		 * @return {string}
		 */
		get_render_state: function()
		{
			var self = this;
			var context = 'get_render_state()';
			self.enter(context, '');
			
			
			self.leave(context, self.mixin_renderable_state);
			return self.mixin_renderable_state;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Get render count
		 * @return {integer}
		 */
		// get_render_count: function()
		// {
			// var self = this;
			// var context = 'get_render_count()';
			// self.enter(context, '');
			
			
			// self.leave(context, self.mixin_renderable_count);
			// return self.mixin_renderable_count;
		// },
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Set render state
		 * @param {string}		arg_state		target state
		 * @return {boolean}
		 */
		set_render_state: function(arg_state)
		{
			var self = this;
			var context = 'set_render_state(state)';
			self.enter(context, '');
			
			switch(arg_state)
			{
				case Devapt.STATE_RENDERED:
				case Devapt.STATE_NOT_RENDERED:
				case Devapt.STATE_BEFORE_RENDERING:
				case Devapt.STATE_RENDERING:
				case Devapt.STATE_AFTER_RENDERING:
					self.mixin_renderable_state = arg_state;
					self.leave(context, self.mixin_renderable_state);
					return true;
			}
			
			self.error(context, 'bad state:' + arg_state);
			return false;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Set render state: not rendered
		 * @return {nothing}
		 */
		set_render_state_not: function()
		{
			var self = this;
			self.mixin_renderable_state = Devapt.STATE_NOT_RENDERED;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Test if the render state is not rendered
		 * @return {boolean}
		 */
		is_render_state_not: function()
		{
			var self = this;
			return self.mixin_renderable_state === Devapt.STATE_NOT_RENDERED;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Set render state: before rendering
		 * @return {nothing}
		 */
		set_render_state_before: function()
		{
			var self = this;
			self.mixin_renderable_state = Devapt.STATE_BEFORE_RENDERING;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Test if the render state is before rendering
		 * @return {boolean}
		 */
		is_render_state_before: function()
		{
			var self = this;
			return self.mixin_renderable_state === Devapt.STATE_BEFORE_RENDERING;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Set render state: rendering
		 * @return {nothing}
		 */
		set_render_state_rendering: function()
		{
			var self = this;
			self.mixin_renderable_state = Devapt.STATE_RENDERING;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Test if the render state is rendering
		 * @return {boolean}
		 */
		is_render_state_rendering: function()
		{
			var self = this;
			return self.mixin_renderable_state === Devapt.STATE_RENDERING;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Set render state: state_after_rendering
		 * @return {nothing}
		 */
		set_render_state_after: function()
		{
			var self = this;
			self.mixin_renderable_state = Devapt.STATE_AFTER_RENDERING;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Test if the render state is after rendering
		 * @return {boolean}
		 */
		is_render_state_after: function()
		{
			var self = this;
			return self.mixin_renderable_state === Devapt.STATE_AFTER_RENDERING;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Set render state: not rendered
		 * @return {nothing}
		 */
		set_render_state_rendered: function()
		{
			var self = this;
			self.mixin_renderable_state = Devapt.STATE_RENDERED;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Test if the render state is rendered
		 * @return {boolean}
		 */
		is_render_state_rendered: function()
		{
			var self = this;
			return self.mixin_renderable_state === Devapt.STATE_RENDERED;
		},
		
		
		
		/* --------------------------------------------- RENDER OPERATIONS ------------------------------------------------ */
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Do some operations before the rendering process begins.
		 * @return {object}		A promise object
		 */
		render_before: function()
		{
			var self = this;
			var context = 'render_before()';
			self.enter(context, '');
			
			
			var promise_self = null;
			try {
				self.set_render_state_before();
				promise_self = self.render_before_self();
			}
			catch(e)
			{
				self.error(context, e.toString());
				self.leave(context, Devapt.msg_failure_promise);
				return Devapt.promise_rejected();
			}
			
			
			self.leave(context, Devapt.msg_success_promise);
			return promise_self;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Do some operations before the rendering process begins (addon for child class).
		 * @return {object}		A promise object
		 */
		render_before_self: function()
		{
			var self = this;
			var context = 'render_before_self()';
			self.enter(context, '');
			
			
			// REMOVE EXISTING RENDERED NODES
			if ( DevaptTypes.is_object(self.content_jqo) )
			{
				self.content_jqo.children().remove();
			}
			
			// RUN IF IT EXISTS
			if ( self.template_enabled && DevaptTypes.is_function(self.render_begin) )
			{
				self.render_begin();
			}
			
			
			self.leave(context, Devapt.msg_default_promise);
			return Devapt.promise_resolved(self);
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Render full process
		 * @return {object}		A promise object with 'self' as resolved value
		 */
		render: function()
		{
			var self = this;
			var context = 'render()';
			self.enter(context, '');
			
			
			// INIT DEFER
			self.mixin_renderable_defer = Devapt.defer();
			
			
			// TEST IF ALREADY RENDERED
			if (self.is_render_state_rendered())
			{
				self.step(context, 'already rendered');
				
				self.mixin_renderable_defer.resolve(self);
				
				self.leave(context, Devapt.msg_success_promise);
				return Devapt.promise(self.mixin_renderable_defer);
			}
			
			// UPDATE STATE
			self.set_render_state_rendering();
			++self.mixin_renderable_count;
			
			// BEFORE RENDER
			var promise_before = self.render_before();
			
			// RENDER CONTENT
			var promise_content = promise_before.then(
				function()
				{
					return self.render_content();
				}
			);
			
			// AFTER RENDER
			var promise_after = promise_content.then(
				function()
				{
					return self.render_after();
				}
			);
			
			// UPDATE STATE
			self.set_render_state_rendered();
			
			
			promise_after.then(
				function()
				{
					self.mixin_renderable_defer.resolve(self);
				},
				function()
				{
					self.mixin_renderable_defer.reject();
				}
			);
			
			
			self.leave(context, Devapt.msg_success_promise);
			return Devapt.promise(self.mixin_renderable_defer);
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Render view content (addon for child class).
		 * @return {object}		A promise object
		 */
		render_content: function()
		{
			var self = this;
			var context = 'render_content()';
			self.enter(context, '');
			
			
			// RENDER WITHOUT TEMPLATE
			var promise_self = null;
			try {
				self.set_render_state_rendering();
				
				
				
				// RENDER WITH TEMPLATE
				// TODO INSERT INTO TRY...CATCH
				if ( self.template_enabled && DevaptTypes.is_function(self.render_template) )
				{
					self.step(context, 'render template');
					
					// INIT CONTENT NODE
					if ( ! DevaptTypes.is_object(self.content_jqo) )
					{
						self.step(context, 'has no content node');
						
						self.content_jqo = $('<div>');
						
						if ( DevaptTypes.is_object(self.parent_jqo) )
						{
							self.step(context, 'has parent node');
							
							self.parent_jqo.append(self.content_jqo);
						}
						
						if ( Devapt.is_function(self.get_view_id) )
						{
							self.content_jqo.attr('id', self.get_view_id());
						}
					}
					
					self.step(context, 'render template');
					// TODO CHANGE METHOD API
					var promise = self.render_template( Devapt.defer() );
					
					
					self.leave(context, Devapt.msg_success_promise);
					return promise;
				}
				
				
				if ( DevaptTypes.is_function(self.render_self) )
				{
					var defer = Devapt.defer()
					promise_self = self.render_self(defer);
				}
				else if ( DevaptTypes.is_function(self.render_content_self) )
				{
					promise_self = self.render_content_self();
				}
				else
				{
					self.error(context, 'no rendering function');
					self.leave(context, Devapt.msg_failure_promise);
					return Devapt.promise_rejected();
				}
			}
			catch(e)
			{
				self.error(context, e.toString());
				self.leave(context, Devapt.msg_failure_promise);
				return Devapt.promise_rejected();
			}
			
			
			self.leave(context, Devapt.msg_success_promise);
			return promise_self;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				Render view content (addon for child class).
		 * @return {object}		A promise object
		 */
		render_content_self: function()
		{
			var self = this;
			var context = 'render_content_self()';
			self.enter(context, '');
			
			self.leave(context, Devapt.msg_default_promise);
			return Devapt.promise_resolved(self);
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				After render operation.
		 * @return {object}		A promise object
		 */
		render_after: function()
		{
			var self = this;
			var context = 'render_after()';
			self.enter(context, '');
			
			
			var promise_self = null;
			try {
				self.set_render_state_after();
				promise_self = self.render_after_self();
			}
			catch(e)
			{
				self.error(context, e.toString());
				self.leave(context, Devapt.msg_failure_promise);
				return Devapt.promise_rejected();
			}
			
			
			self.leave(context, Devapt.msg_success_promise);
			return promise_self;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderable
		 * @desc				After render operation (addon for child class).
		 * @return {object}		A promise object
		 */
		render_after_self: function()
		{
			var self = this;
			var context = 'render_after_self()';
			self.enter(context, '');
			
			
			// TODO MOVE THIS FEATURE
			if ( DevaptTypes.is_function(self.applyCssOptions) )
			{
				self.step(context, 'apply CSS');
				self.applyCssOptions(null);
			}
			
			// SET VIEW ID
			if ( self.content_jqo && self.content_jqo !== {} && DevaptTypes.is_function(self.get_view_id) && ! self.content_jqo.attr('id'))
			{
				self.step(context, 'set content id');
				self.content_jqo.attr('id', self.get_view_id());
				// console.log(self.content_jqo, context + ':self.content_jqo');
			}
			
			self.leave(context, Devapt.msg_default_promise);
			return Devapt.promise_resolved(self);
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-02-11',
			'updated':'2015-02-12',
			'description':'Mixin methods for rendering process.'
		}
	};
	
	
	/**
	 * @mixin				DevaptMixinRenderableClass
	 * @public
	 * @desc				Mixin of methods for rendering process
	 */
	var DevaptMixinRenderableClass = new DevaptClass('DevaptMixinRenderable', null, class_settings);
	
	// METHODS
	DevaptMixinRenderableClass.infos.ctor = DevaptMixinRenderable.mixin_renderable_init;
	
	DevaptMixinRenderableClass.add_public_method('get_render_state', {}, DevaptMixinRenderable.get_render_state);
	// DevaptMixinRenderableClass.add_public_method('get_render_count', {}, DevaptMixinRenderable.get_render_count);
	DevaptMixinRenderableClass.add_public_method('set_render_state', {}, DevaptMixinRenderable.set_render_state);
	
	DevaptMixinRenderableClass.add_public_method('set_render_state_not', {}, DevaptMixinRenderable.set_render_state_not);
	DevaptMixinRenderableClass.add_public_method('is_render_state_not', {}, DevaptMixinRenderable.is_render_state_not);
	
	DevaptMixinRenderableClass.add_public_method('set_render_state_before', {}, DevaptMixinRenderable.set_render_state_before);
	DevaptMixinRenderableClass.add_public_method('is_render_state_before', {}, DevaptMixinRenderable.is_render_state_before);
	
	DevaptMixinRenderableClass.add_public_method('set_render_state_rendering', {}, DevaptMixinRenderable.set_render_state_rendering);
	DevaptMixinRenderableClass.add_public_method('is_render_state_rendering', {}, DevaptMixinRenderable.is_render_state_rendering);
	
	DevaptMixinRenderableClass.add_public_method('set_render_state_after', {}, DevaptMixinRenderable.set_render_state_after);
	DevaptMixinRenderableClass.add_public_method('is_render_state_after', {}, DevaptMixinRenderable.is_render_state_after);
	
	DevaptMixinRenderableClass.add_public_method('set_render_state_rendered', {}, DevaptMixinRenderable.set_render_state_rendered);
	DevaptMixinRenderableClass.add_public_method('is_render_state_rendered', {}, DevaptMixinRenderable.set_render_state_rendered);
	
	
	DevaptMixinRenderableClass.add_public_method('render_before', {}, DevaptMixinRenderable.render_before);
	DevaptMixinRenderableClass.add_public_method('render_before_self', {}, DevaptMixinRenderable.render_before_self);
	
	DevaptMixinRenderableClass.add_public_method('render', {}, DevaptMixinRenderable.render);
	DevaptMixinRenderableClass.add_public_method('render_content', {}, DevaptMixinRenderable.render_content);
	DevaptMixinRenderableClass.add_public_method('render_content_self', {}, DevaptMixinRenderable.render_content_self);
	
	DevaptMixinRenderableClass.add_public_method('render_after', {}, DevaptMixinRenderable.render_after);
	DevaptMixinRenderableClass.add_public_method('render_after_self', {}, DevaptMixinRenderable.render_after_self);
	
	
	// PROPERTIES
	DevaptMixinRenderableClass.add_public_str_property('mixin_renderable_state',	'', Devapt.STATE_NOT_RENDERED, false, false, []);
	DevaptMixinRenderableClass.add_public_int_property('mixin_renderable_count',	'', 0, false, false, []);
	DevaptMixinRenderableClass.add_public_object_property('mixin_renderable_defer',	'', null, false, false, []);
	
	
	// BUILD MIXIN CLASS
	DevaptMixinRenderableClass.build_class();
	
	
	return DevaptMixinRenderableClass;
}
);
/**
 * @file        views/view/view-mixin-template.js
 * @desc        Mixin of template methods for view rendering
 * @see			DevaptMixinTemplate
 * @ingroup     DEVAPT_VIEWS
 * @date        2014-07-14
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/view/view-mixin-template',['Devapt', 'core/types', 'object/class', 'core/resources', 'core/template'],
function(Devapt, DevaptTypes, DevaptClass, DevaptResources, DevaptTemplate)
{
	/**
	 * @mixin				DevaptMixinTemplate
	 * @public
	 * @desc				Mixin of template methods
	 */
	var DevaptMixinTemplate = 
	{
		/**
		 * @memberof			DevaptMixinTemplate
		 * @public
		 * @desc				Enable/disable trace for mixin operations
		 */
		mixin_template_trace: true,
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinTemplate
		 * @desc				Init mixin
		 * @return {nothing}
		 */
		mixin_init: function()
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinTemplate.mixin_template_trace);
			var context = 'mixin_init()';
			self.enter(context, '');
			
			
			
			self.leave(context, '');
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinTemplate
		 * @desc				Render template
		 * @param {object}		arg_deferred	deferred object
		 * @return {object}		deferred promise object
		 */
		render_template: function(arg_deferred)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinTemplate.mixin_template_trace);
			var context = 'render_template(deferred)';
			self.enter(context, '');
			
			
			// GET CURRENT BACKEND
			var backend = Devapt.get_current_backend();
			self.assert_not_null(context, 'backend', backend);
			
			
			// CHECK IF TEMPLATE IS ENABLED
			if ( ! self.template_enabled )
			{
				self.step(context, 'deferred.resolve(): template is disabled');
				self.leave(context, 'template isn\'t enabled: render is resoved');
				self.pop_trace();
				arg_deferred.resolve();
				return Devapt.promise(arg_deferred);
			}
			
			
			// GET TEMPLATE STRING
			if ( ! DevaptTypes.is_not_empty_str(self.template_string) )
			{
				self.step(context, 'deferred.resolve(null)');
				self.leave(context, 'template string is empty: render is resoved');
				self.pop_trace();
				arg_deferred.resolve();
				return Devapt.promise(arg_deferred);
			}
			// console.log(self.template_string);
			// console.log(self.template_bindings);
			
			// INIT AFTER RENDER CALLBACKS
			// var after_render_cb_array = [];
			
			
			// GET STANDARD TAGS
			self.step(context, 'get std tags');
			var std_tags_object = backend.get_template_std_tags();
			
			
			// GET VIEW TAGS
			self.step(context, 'get view tags');
			var view_tags_object = self.get_view_tags();
			
			
			// GET VIEW TAGS ARRAYS
			self.step(context, 'get view tags array');
			var view_tags_arrays_object = self.get_view_tags_arrays();
			
			
			// GET VIEW BINDINGS
			self.step(context, 'get view bindings');
			var view_bindings_object = self.get_view_bindings(arg_deferred);
			
			
			// THIS TAG
			self.step(context, 'get this tag');
			var this_tag = self.get_this_tag(arg_deferred);
			
			
			// MERGE TAGS
			self.step(context, 'merge tags');
			var $ = Devapt.jQuery();
			var tags_object = $.extend({}, this_tag, std_tags_object, view_tags_object, view_tags_arrays_object, view_bindings_object);
			// console.log(tags_object);
			
			
			// RENDER TEMPLATE
			self.step(context, 'render template string');
			var str = DevaptTemplate.render(self.template_string, tags_object);
			self.step(context, 'set content jqo html');
			self.template_jqo = $('<div>');
			self.template_jqo.html(str);
			// console.log(self.template_jqo, 'self.template_jqo');
			
			// NO THIS IN TEMPLATE
			var this_regexp = /.*[{]this[}].*/gm;
			if ( ! this_regexp.test(self.template_string) )
			{
				self.step(context, 'no {this} in template');
				
				var this_id = self.get_view_id();
				var this_tag_id = 'this_' + this_id;
				var this_tag_jqo = $('#' + this_tag_id);
				
				self.content_jqo.append(self.template_jqo);
				
				// console.log(self.parent_jqo, 'self.parent_jqo');
				// console.log(self.content_jqo, 'self.content_jqo');
				// console.log(self.template_jqo, 'self.template_jqo');
			}
			else
			{
				self.step(context, '{this} found in template');
			}
			
			// RESOVE RENDER
			self.step(context, 'deferred.resolve()');
			arg_deferred.resolve();
			
			
			self.leave(context, 'success: render is resolved');
			self.pop_trace();
			return Devapt.promise(arg_deferred);
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinTemplate
		 * @desc				Get view tags
		 * @return {object}		tags map
		 */
		get_view_tags: function()
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinTemplate.mixin_template_trace);
			var context = 'get_view_tags()';
			self.enter(context, '');
			
			
			var view_tags = self.template_tags;
			var view_tags_object = null;
			
			if ( DevaptTypes.is_object(view_tags) )
			{
				self.step(context, 'view_tags is object');
				view_tags_object = view_tags;
			}
			else if ( DevaptTypes.is_string(view_tags) )
			{
				self.step(context, 'view_tags is string');
				view_tags = view_tags.split(',');
				if ( DevaptTypes.is_array(view_tags) )
				{
					self.step(context, 'view_tags split is array');
					view_tags_object = {};
					for(var view_tag_index in view_tags)
					{
						var view_tag_record = view_tags[view_tag_index].split('=');
						if ( DevaptTypes.is_array(view_tag_record) && view_tag_record.length === 2 )
						{
							var tag_name = view_tag_record[0];
							var tag_value = view_tag_record[1];
							view_tags_object[tag_name] = tag_value;
						}
					}
				}
			}
			else
			{
				self.step(context, 'view_tags is unknow');
			}
			
			
			self.leave(context, 'success');
			self.pop_trace();
			return view_tags_object;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinTemplate
		 * @desc				Get view tags arrays
		 * @return {object}		tags arrays map
		 */
		get_view_tags_arrays: function()
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinTemplate.mixin_template_trace);
			var context = 'get_view_tags_arrays()';
			self.enter(context, '');
			
			
			var view_tags_arrays_1 = self.template_arrays_1;
			var view_tags_arrays_object = null;
			
			if ( DevaptTypes.is_array(view_tags_arrays_1) )
			{
				self.step(context, 'loop on view_tags_arrays_1 is an array');
				view_tags_arrays_object = {};
				view_tags_arrays_object['array1'] = view_tags_arrays_1;
			}
			else
			{
				self.step(context, 'view_tags_arrays_1 is unknow');
			}
			
			
			self.leave(context, 'success');
			self.pop_trace();
			return view_tags_arrays_object;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinTemplate
		 * @desc				Get view bindings
		 * @return {object}		bindings map
		 */
		get_view_bindings: function(arg_deferred)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinTemplate.mixin_template_trace);
			var context = 'get_view_bindings()';
			self.enter(context, '');
			
			
			// GET CURRENT BACKEND
			var backend = Devapt.get_current_backend();
			self.assert_not_null(context, 'backend', backend);
			
			
			var view_bindings = self.template_bindings;
			var view_bindings_object = null;
			
			if ( DevaptTypes.is_object(view_bindings) )
			{
				self.step(context, 'view_bindings is object');
				view_bindings_object = view_bindings;
			}
			else if ( DevaptTypes.is_string(view_bindings) )
			{
				self.step(context, 'view_bindings is string');
				view_bindings = view_bindings.split(',');
				if ( DevaptTypes.is_array(view_bindings) )
				{
					self.step(context, 'view_bindings split is array');
					
					var view_bindings_object = {};
					for(var view_binding_index in view_bindings)
					{
						self.step(context, 'view_binding at index [' + view_binding_index + ']');
						var view_tag_record = view_bindings[view_binding_index].split('=');
						if ( DevaptTypes.is_array(view_tag_record) && view_tag_record.length === 2 )
						{
							var tag_name = view_tag_record[0];
							var tag_value = view_tag_record[1];
							self.value(context, 'tag_name', tag_name);
							self.value(context, 'tag_value', tag_value);
							
							self.step(context, 'view_binding is a view name');
							view_bindings_object[tag_name] =
							(
								function(view_name,backend_object)
								{
									var view_tag_id = view_name + '_view_id';
									return function()
									{
										var closure_cb =
											(
												function(view_tag_id,view_name,backend_object)
												{
													return function()
													{
														var tag_jqo = $('#' + view_tag_id);
														var promise = backend_object.render_view(tag_jqo, view_name);
														
														// DEBUG
														// console.log(view_name, 'view_name');
														// console.log(view_tag_id, 'view_tag_id');
														// console.log(tag_jqo, 'view_tag_jqo');
													}
												}
											) (view_tag_id,view_name,backend_object);
										
										// REGISTER RENDER CALLBACK
										Devapt.promise(arg_deferred).then( function() { self.do_callback(closure_cb); } );
										
										// CREATE VIEW CONTENT TAG
										return '<div id="' + view_tag_id + '" devapt-type="container"></div>';
									}
								}
							) (tag_value,backend);
						}
					}
				}
			}
			else
			{
				self.step(context, 'view_bindings is unknow');
			}
			
			
			self.leave(context, 'success');
			self.pop_trace();
			return view_bindings_object;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinTemplate
		 * @desc				Get 'this' tag
		 * @return {object}		'this' tag
		 */
		get_this_tag: function(arg_deferred)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinTemplate.mixin_template_trace);
			var context = 'get_this_tag()';
			self.enter(context, '');
			
			
			// console.log(context, self.name);
			
			var this_id = self.get_view_id();
			var this_tag_id = 'this_' + this_id;
			var this_tag = {
				'this': function()
					{
						// console.log(context + ':this_tag');
						
						// CREATE RENDER CALLBACK
						var closure_cb =
							(
								function(view, content_id)
								{
									return function()
									{
										// console.log(context + ':this_tag:closure_cb');
										
										view.render_self( Devapt.defer() ).then(
											function()
											{
												
												var content_children = view.content_jqo.children();
												content_children.detach();
												
												view.content_jqo.append(view.template_jqo);
												var this_tag_jqo = $('#' + content_id);
												
												this_tag_jqo.append(content_children);
												
												// console.log($(content_children[0]), 'content_children');
												// console.log(this_tag_jqo, 'this_tag_jqo');
												// console.log(view.template_jqo, 'view.template_jqo');
												// console.log(view.content_jqo, 'view.content_jqo');
												// console.log(view.parent_jqo, 'view.parent_jqo');
											}
										);
									}
								}
							) (self,this_tag_id);
						
						// REGISTER RENDER CALLBACK
						Devapt.promise(arg_deferred).then( function() { self.do_callback(closure_cb); } );
						
						// CREATE VIEW CONTENT TAG
						// console.log('returns this tag');
						return '<div id="' + this_tag_id + '"></div>';
					}
				};
			
			
			self.leave(context, 'success');
			self.pop_trace();
			return this_tag;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-07-14',
			'updated':'2014-12-06',
			'description':'Mixin methods for template rendering.'
		}
	};
	
	
	/**
	 * @mixin				DevaptMixinTemplateClass
	 * @public
	 * @desc				Mixin of methods for template rendering
	 */
	var DevaptMixinTemplateClass = new DevaptClass('DevaptMixinTemplate', null, class_settings);
	
	DevaptMixinTemplateClass.add_public_method('mixin_template_init', {}, DevaptMixinTemplate.mixin_init);
	DevaptMixinTemplateClass.add_public_method('render_template', {}, DevaptMixinTemplate.render_template);
	DevaptMixinTemplateClass.add_public_method('get_view_tags', {}, DevaptMixinTemplate.get_view_tags);
	DevaptMixinTemplateClass.add_public_method('get_view_tags_arrays', {}, DevaptMixinTemplate.get_view_tags_arrays);
	DevaptMixinTemplateClass.add_public_method('get_view_bindings', {}, DevaptMixinTemplate.get_view_bindings);
	DevaptMixinTemplateClass.add_public_method('get_this_tag', {}, DevaptMixinTemplate.get_this_tag);
	
	DevaptMixinTemplateClass.add_public_bool_property('template_enabled',		'', false, false, false, ['view_template_enabled']);
	DevaptMixinTemplateClass.add_public_str_property('template_string',			'', null, false, false, ['view_template_string']);
	DevaptMixinTemplateClass.add_public_str_property('template_file_name',		'', null, false, false, ['view_template_file_name']);
	DevaptMixinTemplateClass.add_public_str_property('template_tags',			'', null, false, false, ['view_template_tags']);
	DevaptMixinTemplateClass.add_public_str_property('template_bindings',		'', null, false, false, ['view_template_bindings']);
	DevaptMixinTemplateClass.add_public_array_property('template_arrays_1',		'', null, false, false, [], 'string', ',');
	DevaptMixinTemplateClass.add_public_array_property('template_arrays_2',		'', null, false, false, [], 'string', ',');
	DevaptMixinTemplateClass.add_public_array_property('template_arrays_3',		'', null, false, false, [], 'string', ',');
	
	DevaptMixinTemplateClass.build_class();
	
	
	return DevaptMixinTemplateClass;
}
);
/**
 * @file        views/view/view-mixin-bind.js
 * @desc        Mixin for bind feature
 * 
 * 		[application.views.viewVVV]
 * 		on_event.e0.event='devapt.events.container.selected,devapt.events.container.unselected'
 * 		on_event.e0.log.level='ERROR'
 * 		on_event.e0.log.message='profile is selected/unselected'
 * 		on_event.e0.log.loggers='console'
 * 		
 * 		on_event.e1.event='devapt.events.container.selected'
 * 		on_event.e1.filter.mode='replace'
 * 		on_event.e1.filter.source.field='profiles_id_profile'
 * 		on_event.e1.filter.target.name='view_access_user_inspector_profiles_roles'
 * 		on_event.e1.filter.target.field='profiles_id_profile'
 * 		
 * 		on_event.e1.event='devapt.events.container.selected'
 * 		on_event.e1.value.mode='replace'
 * 		on_event.e1.value.target.name='view_access_user_inspector_profiles_roles'
 * 
 * @see			DevaptView
 * @ingroup     DEVAPT_VIEWS
 * @date        2014-08-23
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/view/view-mixin-bind',['Devapt', 'core/types', 'core/traces', 'object/class', 'core/resources'],
function(Devapt, DevaptTypes, DevaptTraces, DevaptClass, DevaptResources)
{
	/**
	 * @mixin				DevaptMixinBind
	 * @public
	 * @desc				Mixin of template methods
	 */
	var DevaptMixinBind = 
	{
		/**
		 * @memberof			DevaptMixinBind
		 * @public
		 * @desc				Enable/disable trace for mixin operations
		 */
		mixin_bind_trace: false,
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinBind
		 * @desc				Init mixin
		 * @return {nothing}
		 */
		mixin_init_bind: function(self)
		{
			self.push_trace(self.trace, DevaptMixinBind.mixin_bind_trace);
			var context = 'mixin_init_bind()';
			self.enter(context, '');
			
			self.on_event_forwards = {};
			self.mixin_bind_initialized = false;
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
		},
		
		
		
		/* --------------------------------------------- ON EVENT BINDINGS ------------------------------------------------ */
		
		/**
		 * @public
		 * @memberof			DevaptMixinBind
		 * @desc				Enable bindings with 'on_event' setting
		 * 	application.views.ViewVVV.on_event: on event actions
		 * 		.EventEEE.log: trace a message
		 * 			level: log level string ('DEBUG', 'INFO', ...)
		 * 			message: string message to log
		 * 			template: string template to log
		 * 			loggers: list of loggers
		 * 		.EventEEE.do_crud: run a CRUD method on a model resource object
		 * 			TO BE DEFINED
		 * 		.EventEEE.do_method: run a resource object method
		 * 			object: object name
		 * 			method: method name
		 * 			operands: operands list of the method call with {1} for the first source event operand...
		 * 		.EventEEE.emit: emit an other event
		 * 			event: event name
		 * 			operands: operands list of the method call with {1} for the first source event operand...
		 * @return {promise}
		 */
		init_on_event: function()
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinBind.mixin_bind_trace);
			var context = 'init_on_event()';
			self.enter(context, '');
			
			
			// TEST IF AN OPTION IS SET
			if ( ! DevaptTypes.is_object(self.on_event) )
			{
				self.leave(context, 'no on_event bindings');
				self.pop_trace();
				return Devapt.promise_resolved();
			}
			
			// LOOP ON LINKS
			var all_bind_promises = [];
			for(var bind_key in self.on_event)
			{
				self.value(context, 'bind_key', bind_key);
				
				// GET LINK SETTINGS
				var bind_settings = self.on_event[bind_key];
				self.value(context, 'bind_settings', bind_settings);
				
				// INIT SETTING
				var setting_promise = self.init_on_event_setting(bind_settings);
				all_bind_promises.push(setting_promise);
			}
			
			// CREATE ALL PROMISE
			var promise = Devapt.promise_all(all_bind_promises);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return promise;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinBind
		 * @desc				Add an 'on_event' binding
		 * @param {object}		arg_setting		'on_event' setting object
		 * @return {promise}
		 */
		init_on_event_setting: function(arg_setting)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinBind.mixin_bind_trace);
			var context = 'init_on_event_setting(setting)';
			self.enter(context, '');
			self.assert_object(context, 'setting', arg_setting);
			
			
			// CHECK EVENT NAME
			self.assert_true(context, 'event name', 'event' in arg_setting);
			self.assert_not_empty_string(context, 'event name', arg_setting['event']);
			var event_names = arg_setting['event'];
			self.value(context, 'event_names', event_names);
			event_names = event_names.split(',');
			
			// LOOP ON LINKS
			var all_bind_promises = [];
			for(var bind_action in arg_setting)
			{
				self.value(context, 'bind_action', bind_action);
				
				// SKIP EVENT NAME
				if (bind_action === 'event')
				{
					continue;
				}
				
				// GET LINK SETTINGS
				var action_settings = arg_setting[bind_action];
				self.value(context, 'action_settings', action_settings);
				
				// LOOP ON EVENTS
				for(var event_index in event_names)
				{
					var event_name = event_names[event_index];
					self.value(context, 'event_name', event_name);
					
					// SWITCH ON ACTION
					var setting_promise = null;
					switch(bind_action)
					{
						case 'forward':
						{
							// INIT SETTING
//							setting_promise = self.init_on_event_setting_forward(event_name, action_settings);
//							all_bind_promises.push(setting_promise);
							if ( ! DevaptTypes.is_array(self.on_event_forwards[event_name]) )
							{
								self.on_event_forwards[event_name] = [];
							}
							self.on_event_forwards[event_name].push(action_settings);
							break;
						}
						case 'log':
						{
							// INIT SETTING
							setting_promise = self.init_on_event_setting_log(event_name, action_settings);
							all_bind_promises.push(setting_promise);
							break;
						}
						case 'method':
						{
							// INIT SETTING
							setting_promise = self.init_on_event_setting_method(event_name, action_settings);
							all_bind_promises.push(setting_promise);
							break;
						}
						case 'value':
						{
							// INIT SETTING
							setting_promise = self.init_on_event_setting_value(event_name, action_settings);
							all_bind_promises.push(setting_promise);
							break;
						}
						case 'filter':
						{
							// INIT SETTING
							setting_promise = self.init_on_event_setting_filter(event_name, action_settings);
							all_bind_promises.push(setting_promise);
							break;
						}
						case 'do_crud':
						{
							break;
						}
						case 'emit':
						{
							break;
						}
					}
				}
			}
			
			// CREATE ALL PROMISE
			var promise = Devapt.promise_all(all_bind_promises);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return promise;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinBind
		 * @desc				Add an 'on_event' log binding action
		 * @param {string|array}	arg_event_name	'on_event' event name
		 * @param {object}			arg_setting		'on_event' action setting object
		 * @return {promise}
		 */
		init_on_event_setting_log: function(arg_event_name, arg_setting)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinBind.mixin_bind_trace);
			var context = 'init_on_event_setting_log(event,setting)';
			self.enter(context, '');
			self.assert_not_null(context, 'event name', arg_event_name);
			self.assert_object(context, 'setting', arg_setting);
			self.assert_true(context, 'level', ('level' in arg_setting));
			self.assert_true(context, 'message', ('message' in arg_setting));
			self.assert_true(context, 'loggers', ('loggers' in arg_setting));
			
			
			// GET LOG LEVEL
			var level = arg_setting['level'];
			if ( ! DevaptTypes.is_not_empty_str(level) )
			{
				self.error(context, 'bad log level');
				self.leave(context, Devapt.msg_failure);
				self.pop_trace();
				return Devapt.promise_rejected();
			}
			
			// GET LOG MESSAGE
			var message = arg_setting['message'];
			if ( ! DevaptTypes.is_not_empty_str(message) )
			{
				self.error(context, 'bad log message');
				self.leave(context, Devapt.msg_failure);
				self.pop_trace();
				return Devapt.promise_rejected();
			}
			
			// GET LOG LOGGERS
			var loggers = arg_setting['loggers'];
			if ( ! DevaptTypes.is_not_empty_str(loggers) )
			{
				self.error(context, 'bad log loggers');
				self.leave(context, Devapt.msg_failure);
				self.pop_trace();
				return Devapt.promise_rejected();
			}
			loggers = loggers.split(',');
			
			// GET EVENT HAS UNIQUE CALLBACK
			var unique_event_callback = ('unique_event_callback' in arg_setting) ? DevaptTypes.to_boolean(arg_setting['unique_event_callback'], false) : false;
			
			// REGISTER ACTION
			var action_cb = function(arg_resource_obj)
			{
				return function(arg_event_obj, arg_source_obj, arg_event_operands)
				{
					return (
						function(arg_self, arg_loggers, arg_level, arg_event, arg_message)
						{
							self.step(context, 'ON ACTION CALLBACK');
	//						console.log(arguments, context + ':ON ACTION CALLBACK');
							
							// TODO format message with arg_event_operands and a template message
							var log_object = {
								level:arg_level,
								step:'',
								class_name:arg_self.class_name,
								object_name:arg_self.name,
								method_name:'on_event:',
								context: DevaptTypes.is_string(arg_event) ? arg_event : 'array of events',
								text:arg_message
							};
							
							DevaptTraces.log_appenders(log_object, arg_loggers);
							
							return true;
						}
					)(arg_resource_obj, loggers, level, arg_event_name, message);
				};
			};
			
			var promise = self.init_on_event_callback(self, arg_event_name, action_cb, unique_event_callback);
			
			
			self.leave(context, Devapt.msg_success_promise);
			self.pop_trace();
			return promise;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinBind
		 * @desc				Add an 'on_event' binding action with an event call
		 * @param {string|array}	arg_event_name	'on_event' event name
		 * @param {object}			arg_setting		'on_event' action setting object
		 * @return {promise}
		 */
		init_on_event_setting_method: function(arg_event_name, arg_setting)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinBind.mixin_bind_trace);
			var context = 'init_on_event_setting_method(event,setting)';
			self.enter(context, '');
			
			self.assert_not_null(context, 'event name', arg_event_name);
			self.assert_object(context, 'setting', arg_setting);
			
			self.assert_true(context, 'target', ('target' in arg_setting));
			
			self.assert_object(context, 'target', arg_setting['target']);
			
			self.assert_true(context, 'target.name', ('name' in arg_setting['target']));
			self.assert_not_empty_string(context, 'target.name', arg_setting['target']['name']);
			
			self.assert_true(context, 'target.method', ('method' in arg_setting['target']));
			self.assert_not_empty_string(context, 'target.method', arg_setting['target']['method']);
			
			
			
			// GET FILTER TARGET NAMES AND METHOD
			var target_names = arg_setting['target']['name'];
			target_names = target_names.split(',');
			var method_name = arg_setting['target']['method'];
			
			// GET EVENT HAS UNIQUE CALLBACK
			var unique_event_callback = ('unique_event_callback' in arg_setting) ? DevaptTypes.to_boolean(arg_setting['unique_event_callback'], false) : false;
			
			// REGISTER ACTION
			var action_cb = function(arg_resource_obj)
			{
				return function(arg_event_obj, arg_source_obj, arg_event_operands)
				{
					return (
						function(arg_target_obj, arg_event, arg_method_name)
						{
							self.step(context, 'ON ACTION CALLBACK');
	//						console.log(arguments, context + ':ON ACTION CALLBACK');
							
							// CHECK METHOD
							// console.log(arg_method_name, context + ':ON ACTION CALLBACK:method name');
							var method_cb = arg_method_name in arg_target_obj ? arg_target_obj[arg_method_name] : null;
							self.assert_function(context, 'method', method_cb);
							
							// GET EVENT OPERANDS MAP
							var args = arg_event_operands.length > 1 ? arg_event_operands.slice(1) : [];
							// console.log(record, context + ':ON ACTION CALLBACK:record');
							
							// CALL METHOD
							var result = arg_target_obj.do_callback([arg_target_obj, method_cb], args);
							// console.log(result, context + ':ON ACTION CALLBACK:do call result');
							result = null;
							
							return true;
						}
					)(arg_resource_obj, arg_event_name, method_name);
				};
			};
			
			
			// REGISTER ACTION CALLBACK
			var register_cb = function(arg_resource_obj)
			{
				self.step(context, 'REGISTER ACTION CALLBACK for event name [' + arg_event_name + ']');
				
				// CHECK METHOD
				var method_cb = method_name in arg_resource_obj ? arg_resource_obj[method_name] : null;
				self.assert_function(context, 'method', method_cb);
				
				return self.init_on_event_callback(arg_resource_obj, arg_event_name, action_cb, unique_event_callback);
			};
			
			// LOOP ON TARGETS NAMES
			self.step(context, 'LOOP ON TARGETS NAMES');
			var all_bind_promises = [];
			for(var target_name_key in target_names)
			{
				var target_name = target_names[target_name_key];
				
				self.step(context, 'loop on binding target name [' + target_name + ']');
				
				var loop_promise = DevaptResources.get_resource_instance(target_name);
				loop_promise.then(register_cb);
				
				all_bind_promises.push(loop_promise);
			}
			
			// CREATE ALL PROMISE
			var promise = Devapt.promise_all(all_bind_promises);
			
			
			self.leave(context, Devapt.msg_success_promise);
			self.pop_trace();
			return promise;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinBind
		 * @desc				Add an 'on_event' value binding action
		 * @param {string|array}	arg_event_name	'on_event' event name
		 * @param {object}			arg_setting		'on_event' action setting object
		 * @return {promise}
		 */
		init_on_event_setting_value: function(arg_event_name, arg_setting)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinBind.mixin_bind_trace);
			var context = 'init_on_event_setting_value(event,setting)';
			self.enter(context, '');
			
			self.assert_not_null(context, 'event name', arg_event_name);
			self.assert_object(context, 'setting', arg_setting);
			
			self.assert_true(context, 'mode', ('mode' in arg_setting));
			self.assert_true(context, 'target', ('target' in arg_setting));
			
			self.assert_object(context, 'target', arg_setting['target']);
			
			self.assert_not_empty_string(context, 'mode', arg_setting['mode']);
			
			self.assert_true(context, 'target.name', ('name' in arg_setting['target']));
			self.assert_not_empty_string(context, 'target.name', arg_setting['target']['name']);
			
			
			
			// GET FILTER MODE
			var mode = arg_setting['mode'];
			// TOOD DEFINE OTHERS VALUE MODES : REPLACE, APPEND, REMOVE, MERGE...
			// console.log(arg_setting, context + ':settings')
			self.assert_true(context, 'mode', mode === 'replace');
				
			// GET FILTER TARGET NAMES
			var target_names = arg_setting['target']['name'];
			target_names = target_names.split(',');
			
			// GET EVENT HAS UNIQUE CALLBACK
			var unique_event_callback = ('unique_event_callback' in arg_setting) ? DevaptTypes.to_boolean(arg_setting['unique_event_callback'], false) : false;
			
			// REGISTER ACTION
			var action_cb = function(arg_resource_obj)
			{
				return function(arg_event_obj, arg_source_obj, arg_event_operands)
				{
					return (
						function(arg_self, arg_event)
						{
							self.step(context, 'ON ACTION CALLBACK');
	//						console.log(arguments, context + ':ON ACTION CALLBACK');
							
							// CHECK METHOD
							var set_value_cb = 'set_value' in arg_resource_obj ? arg_resource_obj['set_value'] : null;
							self.assert_function(context, 'set_value', set_value_cb);
							
							// GET SOURCE OBJECT
							// var source_object = arg_event_operands[0];
							// console.log(source_object.name, context + 'ON ACTION CALLBACK:source_object');
							
							// GET EVENT OPERANDS MAP
							var event_opds_map = arg_event_operands[1];
							console.log(event_opds_map, context + ':ON ACTION CALLBACK:event_opds_map');
							
							// GET RECORD
							// TODO CONFIGURE THE OPERAND NAME TO GET FROM THE MAP
							var item_record = 'record' in event_opds_map ? event_opds_map.record : ( 'value' in event_opds_map ? event_opds_map.Value : null);
							// console.log(item_record, context + 'ON ACTION CALLBACK:record');
							
							// CALL METHOD
							if (item_record)
							{
								arg_resource_obj.set_value(item_record);
							}
							
							return true;
						}
					)(arg_resource_obj, arg_event_name);
				};
			};
			
			
			// REGISTER ACTION CALLBACK
			var register_cb = function(arg_resource_obj)
			{
				self.step(context, 'REGISTER ACTION CALLBACK for event name [' + arg_event_name + ']');
				
				// CHECK METHOD
				var set_value_cb = 'set_value' in arg_resource_obj ? arg_resource_obj['set_value'] : null;
				self.assert_function(context, 'set_value', set_value_cb);

				return self.init_on_event_callback(arg_resource_obj, arg_event_name, action_cb, unique_event_callback);
			};
			
			// LOOP ON TARGETS NAMES
			self.step(context, 'LOOP ON TARGETS NAMES');
			var all_bind_promises = [];
			for(var target_name_key in target_names)
			{
				var target_name = target_names[target_name_key];
				
				self.step(context, 'loop on binding target name [' + target_name + ']');
				
				var loop_promise = DevaptResources.get_resource_instance(target_name);
				loop_promise.then(register_cb);
				
				all_bind_promises.push(loop_promise);
			}
			
			// CREATE ALL PROMISE
			var promise = Devapt.promise_all(all_bind_promises);
			
			
			self.leave(context, Devapt.msg_success_promise);
			self.pop_trace();
			return promise;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinBind
		 * @desc				Add an 'on_event' filter binding action
		 * @param {string|array}	arg_event_name	'on_event' event name
		 * @param {object}			arg_setting		'on_event' action setting object
		 * @return {promise}
		 */
		init_on_event_setting_filter: function(arg_event_name, arg_setting)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinBind.mixin_bind_trace);
			var context = 'init_on_event_setting_filter(event,setting)';
			self.enter(context, '');
			
			self.assert_not_null(context, 'event name', arg_event_name);
			self.assert_object(context, 'setting', arg_setting);
			
			self.assert_true(context, 'mode', ('mode' in arg_setting));
			self.assert_true(context, 'source', ('source' in arg_setting));
			self.assert_true(context, 'target', ('target' in arg_setting));
			
			self.assert_object(context, 'source', arg_setting['source']);
			self.assert_object(context, 'target', arg_setting['target']);
			
			self.assert_not_empty_string(context, 'mode', arg_setting['mode']);
			
			self.assert_true(context, 'source.field', ('field' in arg_setting['source']));
			self.assert_not_empty_string(context, 'source.field', arg_setting['source']['field']);
			
			self.assert_true(context, 'target.name', ('name' in arg_setting['target']));
			self.assert_not_empty_string(context, 'target.name', arg_setting['target']['name']);
			self.assert_true(context, 'target.field', ('field' in arg_setting['target']));
			self.assert_not_empty_string(context, 'target.field', arg_setting['target']['field']);
			
			
			// GET FILTER MODE
			var mode = arg_setting['mode'];
			
			// GET FILTER SOURCE FIELD
			var source_field = arg_setting['source']['field'];
			
			// GET FILTER TARGET NAMES
			var target_names = arg_setting['target']['name'];
			target_names = target_names.split(',');
			
			// GET FILTER TARGET FIELD
			var target_field = arg_setting['target']['field'];
			
			// GET EVENT HAS UNIQUE CALLBACK
			var unique_event_callback = ('unique_event_callback' in arg_setting) ? DevaptTypes.to_boolean(arg_setting['unique_event_callback'], false) : false;
			
			
			// ACTION CALLBACK
			var action_cb = function(arg_resource_obj)
			{
				return function(arg_event_obj, arg_source_obj, arg_event_operands)
				{
					return (
						function(arg_closure_self, arg_closure_resource_obj)
						{
							var context = 'init_on_event_setting_filter.callback(' + arg_closure_resource_obj.name + ')';
							
//							arg_closure_self.trace=true;
							arg_closure_self.step(context, 'ON ACTION CALLBACK');
							
//							console.log(arguments, context + ':ON ACTION CALLBACK');
//							console.log(mode, context + ':ON ACTION CALLBACK:mode');
//							console.log(target_names, context + ':ON ACTION CALLBACK:target_names');
//							console.log(source_field, context + ':ON ACTION CALLBACK:source_field');
//							console.log(target_field, context + ':ON ACTION CALLBACK:target_field');
//							console.log(unique_event_callback, context + ':ON ACTION CALLBACK:unique_event_callback');
							
							// TARGET OBJECT
//							console.log(arg_resource_obj.name, context + 'ON ACTION CALLBACK:target');
							
							// GET SOURCE OBJECT
							// var source_object = arg_event_operands[0];
//							console.log(source_object.name, context + 'ON ACTION CALLBACK:source_object');
							
							// GET EVENT OPERANDS MAP
							var event_opds_map = arg_event_operands[1];
//							console.log(event_opds_map, context + 'ON ACTION CALLBACK:event_opds_map');
							
							// GET RECORD
							var item_record = event_opds_map['record'];
							console.log(item_record, context + 'ON ACTION CALLBACK:record');
							
							// ADD FILTER
							arg_closure_self.step(context, 'ON ACTION CALLBACK:add field value filter');
							var filter_added_promise = arg_resource_obj.view_model_promise.then(
								function(arg_view_model)
								{
									arg_closure_self.step(context, 'ON ACTION CALLBACK:view model is found');
									
//									arg_view_model.trace=true;
									
									// GET MODEL RECORD FOR CURRENT SELECTED ITEM
									var record_promise = arg_closure_self.view_model_promise.then(
										function(arg_self_view_model)
										{
//											arg_self_view_model.trace=true;
											
											return arg_self_view_model.get_first_record_by_object(item_record);
										}
									);
									
									return record_promise.then(
										function(record)
										{
											// TODO NEWLY CREATED ITEM
											if (!record)
											{
												return Devapt.promise_rejected();
											}
											
											arg_closure_self.value(context, 'recordset record', record);
											arg_closure_self.assert_object(context, 'record', record);
											arg_closure_self.assert_true(context, 'record.is_record', record.is_record);
											
											// GET FIELD VALUE
											arg_closure_self.step(context, 'get field value');
											var field_value = event_opds_map['field_value'] ? event_opds_map['field_value'] : record.get(source_field);
//											console.log(field_value, context + 'ON ACTION CALLBACK:field_value');
											
											
											return arg_view_model.ready_promise.spread(
												function(arg_model, arg_view)
												{
													arg_closure_self.step(context, 'ON ACTION CALLBACK:model and view are found');
													
													arg_closure_self.step(context, 'view_model is ready');
													var replace = mode === 'replace';
													arg_view_model.recordset.add_field_value_filter(target_field, field_value, replace);
													arg_view_model.set_linked_record(record);
												}
											);
										}
									);
								}
							);
							
							filter_added_promise.then(
								function()
								{
									arg_closure_self.step(context, 'filter is added');
									
									arg_resource_obj.on_recordset_filter_change();
								}
							);
							
//							arg_closure_self.trace=false;
							return true;
						}
					)(self, arg_resource_obj);
				};
			};
			
			// REGISTER ACTION CALLBACK
			var register_cb = function(arg_resource_obj)
			{
				self.step(context, 'REGISTER ACTION CALLBACK for event name [' + arg_event_name + ']');
				
				return self.init_on_event_callback(arg_resource_obj, arg_event_name, action_cb, unique_event_callback);
			};
			
			// LOOP ON TARGETS NAMES
			var all_bind_promises = [];
			for(var target_name_key in target_names)
			{
				var target_name = target_names[target_name_key];
				
				self.step(context, 'loop on binding target name [' + target_name + ']');
				
				var loop_promise = DevaptResources.get_resource_instance(target_name);
				loop_promise.then(register_cb);
				
				all_bind_promises.push(loop_promise);
			}
			
			// CREATE ALL PROMISE
			var promise = Devapt.promise_all(all_bind_promises);
			
			
			self.leave(context, Devapt.msg_success_promise);
			self.pop_trace();
			return promise;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinBind
		 * @desc				Add an 'on_event' forward binding action
		 * @param {string|array}	arg_event_name	'on_event' event name
		 * @param {object}			arg_callback	'on_event' action callback
		 * @param {boolean}			arg_unique		'on_event' action is a unique callback for this event
		 * @param {object}			arg_setting		'on_event' forward setting object
		 * @return {promise}
		 */
		init_on_event_setting_forward: function(arg_event_name, arg_callback, arg_unique, arg_setting)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinBind.mixin_bind_trace);
			var context = 'init_on_event_setting_forward(event,setting)';
			self.enter(context, '');
			
			
			// CHECK ARG: EVENT NAME
			self.assert_not_null(context, 'event name', arg_event_name);
			
			// CHECK ARG: EVENT ACTION CALLBACK
			self.assert_function(context, 'event action callback', arg_callback);
			
			// CHECK ARG: EVENT LISTENER IS UNIQUE
			self.assert_true(context, 'listener is unique', DevaptTypes.is_boolean(arg_unique) );
			
			// CHECK ARG: FORWARD SETTINGS
			self.assert_object(context, 'setting', arg_setting);
			
			self.assert_true(context, 'source', ('source' in arg_setting));
			self.assert_true(context, 'target', ('target' in arg_setting));
			
			self.assert_object(context, 'source', arg_setting['source']);
			self.assert_object(context, 'target', arg_setting['target']);
			
			self.assert_true(context, 'source.name', ('name' in arg_setting['source']));
			self.assert_not_empty_string(context, 'source.name', arg_setting['source']['name']);
			
			self.assert_true(context, 'target.name', ('name' in arg_setting['target']));
			self.assert_not_empty_string(context, 'target.name', arg_setting['target']['name']);
			
			
			// GET FILTER SOURCE NAMES
			var source_names = arg_setting['source']['name'];
			source_names = source_names.split(',');
			self.value(context, 'source_names', source_names);
			
			
			// TEST IF CURRENT OBJECT IS IN THE ENABLED SOURCES OBJECTS
			var source_is_found = false;
			for(var source_name_key in source_names)
			{
				var source_name = source_names[source_name_key];
				self.step(context, 'TEST IF CURRENT OBJECT IS IN THE ENABLED SOURCES OBJECTS at [' + source_name + ']');
						
				if (self.name === source_name)
				{
					self.step(context, 'TEST IF CURRENT OBJECT IS IN THE ENABLED SOURCES OBJECTS: found');
					source_is_found = true;
					break;
				}
			}
			if (!source_is_found)
			{
				self.step(context, 'TEST IF CURRENT OBJECT IS IN THE ENABLED SOURCES OBJECTS: not found');
				
				self.leave(context, Devapt.msg_success_promise);
				return Devapt.promise_resolved();
			}
			
			
			// GET FILTER TARGET NAMES
			var target_names = arg_setting['target']['name'];
			target_names = target_names.split(',');
			self.value(context, 'target_names', target_names);
			
			
			
			// LOOP ON TARGET NAMES
			var all_bind_promises = [];
			for(var target_name_key in target_names)
			{
				var target_name = target_names[target_name_key];
				
				self.step(context, 'loop on binding target name [' + target_name + ']');
				
				var promise = DevaptResources.get_resource_instance(target_name);
				promise.then(
					function(arg_target_obj)
					{
						self.step(context, 'REGISTER FORWAD ACTION CALLBACK for target [' + arg_target_obj.name + ']');
						
						var loop_promise = self.init_on_event_callback(arg_target_obj, arg_event_name, arg_callback, arg_unique);
						all_bind_promises.push(loop_promise);
					}
				);
			}
			
			// CREATE ALL PROMISE
			var all_promise = Devapt.promise_all(all_bind_promises);
			
			
			self.leave(context, Devapt.msg_success_promise);
			self.pop_trace();
			return all_promise;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinBind
		 * @desc				Register an event binding action callback
		 * @param {object}			arg_target_obj	'on_event' target object
		 * @param {string|array}	arg_event_name	'on_event' event name(s)
		 * @param {function}		arg_callback	'on_event' action callback with the 
		 * @param {boolean}			arg_unique		'on_event' action is a unique callback for this event
		 * @return {promise}
		 */
		init_on_event_callback: function(arg_target_obj, arg_event_name, arg_callback, arg_unique)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinBind.mixin_bind_trace);
			var context = 'init_on_event_callback(target,event,callback,unique)';
			self.enter(context, '');
			
			
			// CHECK ARGS
			self.assert_object(context, 'arg_target_obj', arg_target_obj);
			self.assert_not_empty_string(context, 'arg_event_name', arg_event_name);
			self.assert_function(context, 'arg_callback', arg_callback);
			arg_unique = DevaptTypes.to_boolean(arg_unique, false);
			
			
			if ( DevaptTypes.is_object(arg_target_obj.on_event_forwards) )
			{
				self.step(context, 'TARGET OBJECT HAS FORWARDS ?');
				
				var has_event_forward = (arg_event_name in arg_target_obj.on_event_forwards) && DevaptTypes.is_not_empty_array( arg_target_obj.on_event_forwards[arg_event_name] );
				var has_all_forward = ('*' in arg_target_obj.on_event_forwards) && DevaptTypes.is_not_empty_array( arg_target_obj.on_event_forwards['*'] );
				
				// DEBUG
				self.value(context, 'has_event_forward', has_event_forward);
				self.value(context, 'has_all_forward', has_all_forward);
//				console.log(arg_target_obj.on_event_forwards, 'arg_target_obj.on_event_forwards');
				
				var all_promises = [];
				
				// PROCESS GIVEN EVENT FORWARD
				if (has_event_forward)
				{
					self.step(context, 'REGISTER ACTION CALLBACK with event forwards for [' + arg_event_name + ']');
					
					var forwards_settings = arg_target_obj.on_event_forwards[arg_event_name];
					
					// LOOP ON FORWARDS SETTINGS
					for(var forward_index in forwards_settings)
					{
						self.step(context, 'REGISTER ACTION CALLBACK with event forward at [' + forward_index + ']');
						
						var forward_settings = forwards_settings[forward_index];
						
						var setting_promise = self.init_on_event_setting_forward(arg_event_name, arg_callback, arg_unique, forward_settings);
						all_promises.push(setting_promise);
					}
				}
				
				// PROCESS ALL EVENTS FORWARD
				if (has_all_forward)
				{
					self.step(context, 'REGISTER ACTION CALLBACK with all events forwards for [' + '*' + ']');
					
					var all_forwards_settings = arg_target_obj.on_event_forwards['*'];
					
					// LOOP ON FORWARDS SETTINGS
					for(var forward_index in all_forwards_settings)
					{
						self.step(context, 'REGISTER ACTION CALLBACK with all forward at [' + forward_index + ']');
						
						var loop_forward_settings = all_forwards_settings[forward_index];
						
						var loop_setting_promise = self.init_on_event_setting_forward('*', arg_callback, arg_unique, loop_forward_settings);
						all_promises.push(loop_setting_promise);
					}
				}
				
				if (all_promises.length > 0)
				{
					var promise = Devapt.promise_all(all_promises);
					
					self.leave(context, Devapt.msg_success_promise);
					self.pop_trace();
					return promise;
				}
			}
			
			
			// DEFINE ON EVENT CALLBACK
			var on_event_cb = function(arg_cb_event_obj, arg_cb_source_obj, arg_cb_opd_record)
			{
				return (
					function(arg_self, target_obj, event_obj, source_obj, opd_record)
					{
						arg_self.step(context, 'ON EVENT CALLBACK');
						
//						console.log(arg_self.name, 'ON EVENT CALLBACK: self');
//						console.log(event_obj.name, 'ON EVENT CALLBACK: event');
//						console.log(source_obj.name, 'ON EVENT CALLBACK: source');
//						console.log(target_obj.name, 'ON EVENT CALLBACK: target');
//						console.log(opd_record, 'ON EVENT CALLBACK: opds');
						
						var operands = [source_obj, opd_record];
		//				console.log(operands, context + ':bind.cb.operands for event [' + arg_event_name + ']');
						
						if ( target_obj.is_view )
						{
							arg_self.step(context, 'target object is a view');
							
							if ( target_obj.is_render_state_rendering() )
							{
								arg_self.step(context, 'view is rendering (wait)');
								
								var target_render_promise = Devapt.promise(target_obj.mixin_renderable_defer);
								
								return target_render_promise.then(
									function(arg_rendered_view)
									{
										arg_self.step(context, 'target object is a view and is ready to process bind');
										return arg_callback(arg_rendered_view)(event_obj, source_obj, operands);
									}
								);
							}
						}
						
						arg_self.step(context, 'run event callback without waiting for rendering for target [' + target_obj.name + ']');
//						console.log(target_obj.name, context + 'run event callback without waiting for rendering for target');
						
						return arg_callback(target_obj)(event_obj, source_obj, operands);
					}
				)(self, arg_target_obj, arg_cb_event_obj, arg_cb_source_obj, arg_cb_opd_record);
			};
			
			// ADD EVENT CALLBACK
			self.step(context,'add event callback for [' + arg_event_name + ']');
			self.step(context,'event callback is unique ? [' + arg_unique + ']');
			var bool_result = false;
			if ( DevaptTypes.is_not_empty_string(arg_event_name) )
			{
				bool_result = self.add_event_callback(arg_event_name, on_event_cb, arg_unique);
			}
			else if ( DevaptTypes.is_not_empty_array(arg_event_name) )
			{
				for(var event_name_key in arg_event_name)
				{
					var event_name = arg_event_name[event_name_key];
					bool_result = self.add_event_callback(event_name, on_event_cb, arg_unique);
					if (!bool_result)
					{
						break;
					}
				}
			}
			
			self.step(context,'create promise with result [' + bool_result + '] for target [' + arg_target_obj.name + ']');
			var result_promise = bool_result ? Devapt.promise_resolved() : Devapt.promise_rejected();
			
			
			self.leave(context, bool_result ? Devapt.msg_success_promise : Devapt.msg_failure_promise);
			self.pop_trace();
			return result_promise;
		},
		
		
		
		/* --------------------------------------------- ENABLE BINDINGS ------------------------------------------------ */
		
		/**
		 * @public
		 * @memberof			DevaptMixinBind
		 * @desc				Enable bindings
		 * @return {promise}
		 */
		enable_bindings: function()
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinBind.mixin_bind_trace);
			var context = 'enable_bindings()';
			self.enter(context, '');
			
			
			// CHECK IF ALREADY INITIALIZED
			if (self.mixin_bind_initialized)
			{
				self.leave(context, Devapt.msg_success_promise);
				self.pop_trace();
				return Devapt.promise_resolved();
			}
			
			// ENABLE 'on_event' BINDINGS
			self.mixin_bind_initialized = true;
			var promise = self.init_on_event();
			promise.then(
				function()
				{
					self.fire_event('devapt.render.bind_finished', []);
				}
			);
			
			
			self.leave(context, Devapt.msg_success_promise);
			self.pop_trace();
			return promise;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-07-14',
			'updated':'2015-05-23',
			'description':'Mixin methods for bindings features.'
		}
	};
	var DevaptMixinBindClass = new DevaptClass('DevaptMixinBind', null, class_settings);
	
	// METHODS
	DevaptMixinBindClass.infos.ctor = DevaptMixinBind.mixin_init_bind;
	
	DevaptMixinBindClass.add_public_method('init_on_event', {}, DevaptMixinBind.init_on_event);
	DevaptMixinBindClass.add_public_method('init_on_event_setting', {}, DevaptMixinBind.init_on_event_setting);
	DevaptMixinBindClass.add_public_method('init_on_event_setting_log', {}, DevaptMixinBind.init_on_event_setting_log);
	DevaptMixinBindClass.add_public_method('init_on_event_setting_method', {}, DevaptMixinBind.init_on_event_setting_method);
	DevaptMixinBindClass.add_public_method('init_on_event_setting_value', {}, DevaptMixinBind.init_on_event_setting_value);
	DevaptMixinBindClass.add_public_method('init_on_event_setting_filter', {}, DevaptMixinBind.init_on_event_setting_filter);
	DevaptMixinBindClass.add_public_method('init_on_event_setting_forward', {}, DevaptMixinBind.init_on_event_setting_forward);
	DevaptMixinBindClass.add_public_method('init_on_event_callback', {}, DevaptMixinBind.init_on_event_callback);
	
	DevaptMixinBindClass.add_public_method('enable_bindings', {}, DevaptMixinBind.enable_bindings);
	
	// PROPERTIES
	DevaptMixinBindClass.add_public_object_property('on_event',				'', null, false, false, []);
	
	// BUID MIXIN CLASS
	DevaptMixinBindClass.build_class();
	
	
	return DevaptMixinBindClass;
}
);
/**
 * @file        views/view/view-mixin-options-css.js
 * @desc        Mixin for CSS rendering options
 * @see			DevaptView
 * @ingroup     DEVAPT_VIEWS
 * @date        2014-07-14
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/view/view-mixin-options-css',['Devapt', 'core/types', 'object/class'],
function(Devapt, DevaptTypes, DevaptClass)
{
	/**
	 * @mixin				DevaptMixinOptionsCSS
	 * @public
	 * @desc				Mixin of template methods
	 */
	var DevaptMixinOptionsCSS = 
	{
		/**
		 * @memberof			DevaptMixinOptionsCSS
		 * @public
		 * @desc				Enable/disable trace for mixin operations
		 */
		mixin_options_css_trace: false,
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinOptionsCSS
		 * @desc				Init mixin (register options)
		 * @return {nothing}
		 */
		mixin_init: function()
		{
			var self = this;
			self.push_trace(self.trace, self.mixin_options_css_trace);
			var context = 'mixin_init()';
			self.enter(context, '');
			
			
			
			self.leave(context, '');
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinOptionsCSS
		 * @desc				Render CSS options to the view
		 * @param {object}		arg_deferred	deferred object
		 * @return {nothing}
		 */
		applyCssOptions: function()
		{
			var self = this;
			self.push_trace(self.trace, self.mixin_options_css_trace);
			var context = 'applyCssOptions()';
			self.enter(context, '');
			
			
			// CSS PARENT STYLES
			if ( DevaptTypes.is_not_empty_str(self.parent_css_styles) )
			{
				// GET TARGET NODE
				var target_jqo = self.parent_jqo;
				self.value(context, 'CSS options parent styles', self.parent_css_styles);
				self.assert_not_null(context, 'target_jqo', target_jqo);
				
				// APPEND NODE STYLES
				var style = target_jqo.attr('style');
				style = (style ? style : '') + self.css_styles;
				target_jqo.attr('style', style);
			}
			
			
			// CSS PARENT CLASSES
			if ( DevaptTypes.is_not_empty_str(self.parent_css_classes) )
			{
				// GET TARGET NODE
				var target_jqo = self.parent_jqo;
				self.value(context, 'CSS options parent classes', self.parent_css_classes);
				self.assert_not_null(context, 'target_jqo', target_jqo);
				
				// APPEND OR REMOVE NODE CLASSES
				var classes = self.parent_css_classes.split(',');
				classes.forEach(
					function(css_class, index, array)
					{
						if (css_class && css_class.length > 0)
						{
							if (css_class.slice(0, 1) === '-')
							{
								target_jqo.removeClass(css_class);
								return;
							}
							target_jqo.addClass(css_class);
						}
					}
				);
			}
			
			
			// GET TARGET NODE
			var target_jqo = self.content_jqo ? self.content_jqo : self.parent_jqo;
			self.assert_not_null(context, 'target_jqo', target_jqo);
			
			
			// CSS CONTENT STYLES
			if ( DevaptTypes.is_not_empty_str(self.css_styles) )
			{
				// APPEND NODE STYLES
				self.value(context, 'set css_styles', self.css_styles);
				var style = target_jqo.attr('style');
				style = (style ? style : '') + self.css_styles;
				target_jqo.attr('style', style);
			}
			
			
			// CSS CONTENT CLASSES
			if ( DevaptTypes.is_not_empty_str(self.css_classes) )
			{
				// APPEND OR REMOVE NODE CLASSES
				var classes = self.css_classes.split(',');
				classes.forEach(
					function(css_class, index, array)
					{
						if (css_class && css_class.length > 0)
						{
							if (css_class.slice(0, 1) === '-')
							{
								self.value(context, 'remove css_class', css_class);
								target_jqo.removeClass(css_class);
								return;
							}
							self.value(context, 'add css_class', css_class);
							target_jqo.addClass(css_class);
						}
					}
				);
			}
			
			
			// CSS CONTENT WIDTH
			if ( DevaptTypes.is_not_empty_str(self.width) )
			{
				self.value(context, 'set width', self.width);
				target_jqo.css('width', self.width);
			}
			
			
			// CSS CONTENT WIDTH MIN
			if ( DevaptTypes.is_not_empty_str(self.width_min) )
			{
				self.value(context, 'set width_min', self.width_min);
				target_jqo.css('min-width', self.width_min);
			}
			
			
			// CSS CONTENT WIDTH MAX
			if ( DevaptTypes.is_not_empty_str(self.width_max) )
			{
				self.value(context, 'set width_max', self.width_max);
				target_jqo.css('max-width', self.width_max);
			}
			
			
			// CSS CONTENT HEIGHT
			if ( DevaptTypes.is_not_empty_str(self.height) )
			{
				self.value(context, 'set height', self.height);
				target_jqo.css('height', self.height);
			}
			
			
			// CSS CONTENT HEIGHT MIN
			if ( DevaptTypes.is_not_empty_str(self.height_min) )
			{
				self.value(context, 'set height_min', self.height_min);
				target_jqo.css('min-height', self.height_min);
			}
			
			
			// CSS CONTENT HEIGHT MAX
			if ( DevaptTypes.is_not_empty_str(self.height_max) )
			{
				self.value(context, 'set height_max', self.height_max);
				target_jqo.css('max-height', self.height_max);
			}
			
			
			// CSS CONTENT PADDING
			if ( DevaptTypes.is_not_empty_str(self.css_padding) )
			{
				self.value(context, 'set css_padding', self.css_padding);
				target_jqo.css('padding', self.css_padding);
			}
			
			
			// CSS CONTENT MARGIN
			if ( DevaptTypes.is_not_empty_str(self.css_margin) )
			{
				self.value(context, 'set css_margin', self.css_margin);
				target_jqo.css('margin', self.css_margin);
			}
			
			
			// DISPLAY
			var display_class = null;
			
			// DISPLAY ONLY ON SMALL
			if (self.display_on_small && ! self.display_on_medium && ! self.display_on_large)
			{
				display_class = 'show-for-small-only';
			}
			
			// DISPLAY ONLY ON MEDIUM
			if (! self.display_on_small && self.display_on_medium && ! self.display_on_large)
			{
				display_class = 'show-for-medium-only';
			}
			
			// DISPLAY ONLY ON LARGE
			if (! self.display_on_small && ! self.display_on_medium && self.display_on_large)
			{
				display_class = 'hide-for-small-only show-for-large-up';
			}
			
			// DISPLAY ON SMALL AND MEDIUM AND LARGE
			if (self.display_on_small && self.display_on_medium && self.display_on_large)
			{
				display_class = null;
			}
			
			// DISPLAY ON SMALL AND MEDIUM
			if (self.display_on_small && ! self.display_on_medium && ! self.display_on_large)
			{
				display_class = 'show-for-medium-only show-for-medium-only hide-for-large-up';
			}
			
			// DISPLAY ON MEDIUM AND LARGE
			if (! self.display_on_small && self.display_on_medium && self.display_on_large)
			{
				display_class = 'hide-for-small-only show-for-medium-up';
			}
			
			self.value(context, 'display on classes', display_class);
			if (display_class)
			{
				target_jqo.addClass(display_class);
			}
			
			// DISPLAY ON LANDSCAPE
			// if (self.display_on_landscape)
			// {
				// display_class = 'show-for-landscape';
				// target_jqo.addClass(display_class);
			// }
			// else
			// {
				// display_class = 'hide-for-landscape';
				// target_jqo.addClass(display_class);
			// }
			
			// DISPLAY ON PORTRAIT
			// if (self.display_on_portrait)
			// {
				// display_class = 'show-for-portrait';
				// target_jqo.addClass(display_class);
			// }
			// else
			// {
				// display_class = 'hide-for-portrait';
				// target_jqo.addClass(display_class);
			// }
			
			// DISPLAY ON TOUCH
			if ( target_jqo.hasClass('touch') )
			{
				if (self.display_on_touch)
				{
					display_class = 'show-for-touch';
					target_jqo.addClass(display_class);
				}
				else
				{
					display_class = 'hide-for-touch';
					target_jqo.addClass(display_class);
				}
			}
			
			
			// TOOLTIP
			if ( DevaptTypes.is_not_empty_str(self.toolip) )
			{
				// APPEND NODE STYLES
				self.value(context, 'set toolip', self.tooltip);
				target_jqo.attr('title', self.tooltip);
				target_jqo.attr('data-tooltip');
				target_jqo.addClass('has-tip');
			}
			
			// SCROLLING X
			target_jqo.css('overflow-x', 'none');
			if ( DevaptTypes.to_boolean(self.is_scrolling_x, false) )
			{
				target_jqo.css('overflow-x', 'scroll');
			}
			
			// SCROLLING Y
			target_jqo.css('overflow-y', 'none');
			if ( DevaptTypes.to_boolean(self.is_scrolling_y, false) )
			{
				target_jqo.css('overflow-y', 'scroll');
			}
			
			
			self.leave(context, 'render CSS options');
			self.pop_trace();
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-07-14',
			'updated':'2014-12-06',
			'description':'Mixin methods for  CSS rendering options.'
		}
	};
	
	
	/**
	 * @mixin				DevaptMixinOptionsCSSClass
	 * @public
	 * @desc				Mixin of methods for  CSS rendering options
	 */
	var DevaptMixinOptionsCSSClass = new DevaptClass('DevaptMixinOptionsCSS', null, class_settings);
	
	DevaptMixinOptionsCSSClass.add_public_method('mixin_options_css_init', {}, DevaptMixinOptionsCSS.mixin_init);
	DevaptMixinOptionsCSSClass.add_public_method('applyCssOptions', {}, DevaptMixinOptionsCSS.applyCssOptions);
	DevaptMixinOptionsCSSClass.add_public_method('apply_css_options', {}, DevaptMixinOptionsCSS.applyCssOptions);
	
	DevaptMixinOptionsCSSClass.add_public_bool_property('template_enabled',	'', false, false, false, ['view_template_enabled']);
	DevaptMixinOptionsCSSClass.add_public_str_property('template_string',	'', null, false, false, ['view_template_string']);
	
	// SIZE
	DevaptMixinOptionsCSSClass.add_public_bool_property('is_resizable',		'', true, false, false, ['view_is_resizable']);	// TODO
	DevaptMixinOptionsCSSClass.add_public_str_property('width',				'', null, false, false, ['view_width']);
	DevaptMixinOptionsCSSClass.add_public_str_property('width_min',			'', null, false, false, ['view_width_min']);
	DevaptMixinOptionsCSSClass.add_public_str_property('width_max',			'', null, false, false, ['view_width_max']);
	DevaptMixinOptionsCSSClass.add_public_str_property('height',			'', null, false, false, ['view_height']);
	DevaptMixinOptionsCSSClass.add_public_str_property('height_min',		'', null, false, false, ['view_height_min']);
	DevaptMixinOptionsCSSClass.add_public_str_property('height_max',		'', null, false, false, ['view_height_max']);
	
	// VIBILITY
	DevaptMixinOptionsCSSClass.add_public_str_property('is_visible',			'', true, false, false, ['view_is_visible']);	// TODO
	
	// CSS
	DevaptMixinOptionsCSSClass.add_public_str_property('css_styles',			'', null, false, false, ['view_css_styles']);
	DevaptMixinOptionsCSSClass.add_public_str_property('css_classes',			'', null, false, false, ['view_css_classes']);
	DevaptMixinOptionsCSSClass.add_public_str_property('parent_css_styles',		'', null, false, false, ['view_parent_css_styles']);
	DevaptMixinOptionsCSSClass.add_public_str_property('parent_css_classes',	'', null, false, false, ['view_parent_css_classes']);
	DevaptMixinOptionsCSSClass.add_public_str_property('css_margin',			'', null, false, false, ['view_margin']);
	DevaptMixinOptionsCSSClass.add_public_str_property('css_padding',			'', null, false, false, ['view_padding']);
	
	DevaptMixinOptionsCSSClass.add_public_str_property('display_on_small',		'', true, false, false, ['view_display_on_small']);
	DevaptMixinOptionsCSSClass.add_public_str_property('display_on_medium',		'', true, false, false, ['view_display_on_medium']);
	DevaptMixinOptionsCSSClass.add_public_str_property('display_on_large',		'', true, false, false, ['view_display_on_large']);
	// DevaptMixinOptionsCSSClass.add_public_str_property('display_on_landscape',	'', true, false, false, ['view_display_on_landscape']); // TODO
	// DevaptMixinOptionsCSSClass.add_public_str_property('display_on_portrait',	'', false, false, false, ['view_display_on_portrait']); // TODO
	DevaptMixinOptionsCSSClass.add_public_str_property('display_on_touch',		'', true, false, false, ['view_display_on_touch']);
	
	// SCROLLING
	DevaptMixinOptionsCSSClass.add_public_bool_property('is_scrolling_x',	'',		false, false, false, []);
	DevaptMixinOptionsCSSClass.add_public_bool_property('is_scrolling_y',	'',		false, false, false, []);
	
	// BUILD CLASS
	DevaptMixinOptionsCSSClass.build_class();
	
	
	return DevaptMixinOptionsCSSClass;
}
);
/**
 * @file        views/view.js
 * @desc        View base class
 * 		API
 * 			PUBLIC ATTRIBUTES
 * 				
 * 				
 * 			PUBLIC METHODS
 * 				
 * 				
 * 			
 * @ingroup     DEVAPT_VIEWS
 * @date        2014-05-10
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('views/view',[
	'Devapt', 'core/types', 'object/class', 'object/object', 'core/resources', 'core/application',
	'views/view/view-mixin-renderable', 'views/view/view-mixin-template', 'views/view/view-mixin-bind', 'views/view/view-mixin-options-css'
],
function(
	Devapt, DevaptTypes, DevaptClass, DevaptObject, DevaptResources, DevaptApplication,
	DevaptMixinRenderable, DevaptMixinTemplate, DevaptMixinBind, DevaptMixinOptionsCSS)
{
	/**
	 * @public
	 * @class				DevaptView
	 * @desc				View class
	 */
	
	var $ = window.$;
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				Set view parent
	 * @param {object}		arg_jquery_object	JQuery object to attach the view to (object)
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_set_parent = function(arg_jquery_object)
	{
		var self = this;
		// self.trace = true;
		var context = 'set_parent(jqo)';
		self.enter(context, '');
		
		
		// DEBUG
		if (self.trace)
		{
			console.log(arg_jquery_object, 'arg_jquery_object');
			// console.log(self.content_jqo, 'content_jqo');
			// console.log(self.parent_jqo, 'parent_jqo');
		}
		
		
		// INIT DEFAULT PARENT NODE IF NO PARENT IS GIVEN
		if ( ! DevaptTypes.is_object(arg_jquery_object) )
		{
			self.step(context, 'set default view container');
			arg_jquery_object = $('<div class="row" devapt-comment="set default parent">');
			$('body').append(arg_jquery_object);
		}
		
		
		// SET CONTAINER JQUERY OBJECT
		self.parent_jqo = arg_jquery_object;
		self.assert_not_null(context, 'self.parent_jqo null ?', self.parent_jqo);
		if ( DevaptTypes.is_object(self.content_jqo) )
		{
			self.step(context, 'detach content jqo');
			self.content_jqo.detach();
			
			self.step(context, 'attach content jqo');
			if (! self.prepend_content)
			{
				self.parent_jqo.append(self.content_jqo);
			}
			else
			{
				self.parent_jqo.prepend(self.content_jqo);
			}
		}
		// console.log(self.parent_jqo, 'parent_jqo');
		
		
		// SET PARENT ID
		if ( DevaptTypes.is_not_empty_str(self.parent_html_id) )
		{
			self.step(context, 'parent node node has an html id');
			self.parent_jqo.attr('id', self.parent_html_id);
		}
		
		
		// SEND EVENT
		self.fire_event('devapt.view.parent.changed');
		
		
		self.leave(context, Devapt.msg_success);
		// self.trace = false;
		return true;
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// DEBUG
		// self.trace=true;
		
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// SET OBJECT TYPE
		self.is_view = true;
		
		// INIT CONTENT NODE
		self.content_jqo = $('<div>');
		self.content_jqo.attr('id', self.get_view_id());
		
		// SEND EVENT
		self.fire_event('devapt.view.ready');
		
		// ON READY HANDLER
		if ( self.class_name === 'DevaptView')
		{
			if ( DevaptTypes.is_function(self.on_ready) )
			{
				self.on_ready();
			}
		}
		
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				Get view id
	 * @return {string}		HTML tag id
	 */
	var cb_get_view_id = function()
	{
		var self = this;
		return DevaptTypes.is_not_empty_str(self.view_id) ? self.view_id : self.name + '_view_id';
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				Render view
	 * @return {object}		deferred promise object
	 */
/*	var cb_render = function()
	{
		var self = this;
		// self.trace = true;
		var context = 'render()';
		self.enter(context, '');
		
		
		// CREATE REFERRED OBJECT
		var deferred = Devapt.defer();
		// deferred.view_name = self.name;
		// deferred.view_uid = self.uid;
		if (self.is_render_state_rendered())
		{
			self.step(context, 'is rendered');
			deferred.resolve();
			
			self.leave(context, 'render with template');
			return Devapt.promise(arg_deferred);
		}
		
		
		// SEND EVENT
		self.step(context, 'fire render begin');
		self.fire_event('devapt.view.render.begin');
		
		
		// RENDER END CALLBACK
		var render_end_cb = function() {
			// console.log('render_end_cb');
			self.step(context, 'render end cb');
			
			if ( DevaptTypes.is_function(self.applyCssOptions) )
			{
				self.step(context, 'apply CSS');
				self.applyCssOptions(deferred);
			}
			
			// SEND EVENT
			self.step(context, 'fire render end');
			self.fire_event('devapt.view.render.end');
			
			// self.is_rendered = true;
		};
		
		
		// RENDER WITH TEMPLATE
		if ( self.template_enabled && DevaptTypes.is_function(self.render_template) )
		{
			self.step(context, 'has template');
			// console.log('render with template');
			
			if ( ! DevaptTypes.is_object(self.content_jqo) )
			{
				self.step(context, 'has no content node');
				// console.info('set default content jqo');
				
				self.content_jqo = $('<div>');
				
				if ( DevaptTypes.is_object(self.parent_jqo) )
				{
					self.step(context, 'has parent node');
					// console.info('set parent for content jqo');
					self.parent_jqo.append(self.content_jqo);
				}
				
				self.content_jqo.attr('id', self.get_view_id());
			}
			
			self.step(context, 'render template');
			// console.log('call render_template(deferred)');
			var promise = self.render_template(deferred);
			
			// APPLY CSS OPTIONS AND FIRE END EVENT
			self.step(context, 'call render end cb');
			// console.log('call render_template(deferred) done');
			promise = promise.then(render_end_cb);
			
			self.leave(context, 'render with template');
			return promise;
		}
		
		// RENDER WITHOUT TEMPLATE
		self.step(context, 'render self');
		// console.log('render without template', context);
		var promise = self.render_self(deferred);
		if (! promise)
		{
			console.log(promise, 'promise');
			console.error(self, 'render_self promise is bad');
		}
		promise = promise.then(
			function()
			{
				self.step(context, 'render self done');
				// console.log('render_self done');
				
				if (self.content_jqo && self.content_jqo !== {})
				{
					self.step(context, 'has content');
					self.content_jqo.attr('id', self.get_view_id());
				}
			}
		);
		
		// APPLY CSS OPTIONS AND FIRE END EVENT
		self.step(context, 'call render end cb');
		promise.then(render_end_cb);
		
		
		self.leave(context, 'render without template');
		return promise;
	};*/
	
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				Render view content without template
	 * @param {object}		arg_deferred	deferred object
	 * @return {object}		deferred promise object
	 */
/*	var cb_render_self = function(arg_deferred)
	{
		var self = this;
		var context = 'render_self(deferred)';
		self.enter(context, '');
		
		
		// NOT YET IMPLEMENTED
		self.step(context, 'not implemented in this base class : implement in child classes');
		
		// RESOVE RENDER
		self.step(context, 'resolve()');
		arg_deferred.resolve();
		
		
		self.leave(context, 'success (not implemented)');
		return Devapt.promise(arg_deferred);
	};*/
	
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				Edit view settings
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_edit_settings = function()
	{
		var self = this;
		var context = 'edit_settings()';
		self.enter(context, '');
		
		
		self.step(context, 'not implemented in this base class : implement in child classes');
		
		
		// SEND EVENT
		self.fire_event('devapt.view.settings.changed');
		
		
		self.leave(context, Devapt.msg_success);
		return true;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				Edit view settings
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_show = function()
	{
		var self = this;
		var context = 'show()';
		self.enter(context, '');
		
		if ( ! self.content_jqo || self.content_jqo === {})
		{
			self.leave(context, Devapt.msg_failure);
			return false;
		}
		
		self.content_jqo.show();
		
		self.leave(context, Devapt.msg_success);
		return true;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				Edit view settings
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_hide = function()
	{
		var self = this;
		var context = 'hide()';
		self.enter(context, '');
		
		if ( ! self.content_jqo || self.content_jqo === {})
		{
			self.leave(context, Devapt.msg_failure);
			return false;
		}
		
		self.content_jqo.hide();
		
		self.leave(context, Devapt.msg_success);
		return true;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				Translation feature : Translate given string in active language
	 * @param {string}		arg_sentance_str		String to translate
	 * @param {string}		arg_translation_context	Tags associative array as string key/string value
	 * @return {string}		Translated string
	 */
	var cb_translate = function(arg_sentance_str, arg_translation_context)
	{
		var self = this;
		var context = 'translate(sentance,translation context)';
		self.enter(context, '');
		
		self.step(context, 'not yet implemented');
		
		self.leave(context, Devapt.msg_success);
		return arg_sentance_str;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				On change event
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_on_change = function()
	{
		var self = this;
		var context = 'on_change()';
		self.enter(context, '');
		
		// ON CHANGE HANDLER
		if ( ! DevaptTypes.is_null(self.js_on_change) )
		{
			eval(self.js_on_change);
		}
		
		self.leave(context, Devapt.msg_success);
		return true;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				On refresh event
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_on_refresh = function()
	{
		var self = this;
		var context = 'on_refresh()';
		self.enter(context, '');
		
		
		// ON CHANGE HANDLER
		if ( ! DevaptTypes.is_null(self.js_on_refresh) )
		{
			eval(self.js_on_refresh);
		}
		
		
		self.leave(context, Devapt.msg_success);
		return true;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				On filled event
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_on_filled = function()
	{
		var self = this;
		var context = 'on_filled()';
		self.enter(context, '');
		
		// ON CHANGE HANDLER
		if ( ! DevaptTypes.is_null(self.js_on_filled) )
		{
			eval(self.js_on_filled);
		}
		
		self.leave(context, Devapt.msg_success);
		return true;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @desc				On ready
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_on_ready = function()
	{
		var self = this;
		var context = 'on_ready()';
		self.enter(context, '');
		
		// ON READY HANDLER
		if ( ! DevaptTypes.is_null(self.js_on_ready) )
		{
			eval(self.js_on_ready);
		}
		
		self.leave(context, Devapt.msg_success);
		return true;
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @method				to_string_self()
	 * @desc				Get a string dump of the object
	 * @return {string}		String dump
	 */
	var cb_to_string_self = function()
	{
		// var self = this;
		return 'base view class';
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @method				notify_error(arg_message)
	 * @desc				Notify user with an error message
	 * @param {string}		arg_message			notification message
	 * @return {nothing}
	 */
	var cb_notify_error = function(arg_message)
	{
		if ( Devapt.has_current_backend() )
		{
			var backend = Devapt.get_current_backend();
			if (backend.notify_error)
			{
				backend.notify_error(arg_message);
				return;
			}
		}
		
		alert('error:' + arg_message);
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @method				notify_alert(arg_message)
	 * @desc				Notify user with an alert message
	 * @param {string}		arg_message			notification message
	 * @return {nothing}
	 */
	var cb_notify_alert = function(arg_message)
	{
		if ( Devapt.has_current_backend() )
		{
			var backend = Devapt.get_current_backend();
			if (backend.notify_alert)
			{
				backend.notify_alert(arg_message);
				return;
			}
		}
		
		alert('alert:' + arg_message);
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptView
	 * @method				notify_info(arg_message)
	 * @desc				Notify user with an information message
	 * @param {string}		arg_message			notification message
	 * @return {nothing}
	 */
	var cb_notify_info = function(arg_message)
	{
		if ( Devapt.has_current_backend() )
		{
			var backend = Devapt.get_current_backend();
			if (backend.notify_info)
			{
				backend.notify_info(arg_message);
				return;
			}
		}
		
		alert('info:' + arg_message);
	};
	
	
	
	/**
	 * @memberof			DevaptModel
	 * @public
	 * @method				DevaptModel.get_server_api()
	 * @desc				Get servetr API records
	 * @return {object}		promise
	 */
	var cb_get_server_api = function()
	{
		var self = this;
		var context = 'get_server_api()';
		self.enter(context, '');
		
		
		// TEST IF ALREADY CREATED
		if (self.server_ap)
		{
			self.leave(context, Devapt.msg_success);
			return self.server_api;
		}
		
		// CREATE API RECORD
		var url_base = DevaptApplication.get_url_base();
		self.server_api = {
			view_name: self.name,
			
			 action_view: {
				 method:'GET',
				 url:url_base + 'views/' + self.name + '/html_view',
				 format:'devapt_view_api_2'
			 },
			action_page: {
				method:'GET',
				url:url_base + 'views/' + self.name + '/html_page',
				format:'devapt_view_api_2'
			}
		};
		
		
		self.leave(context, Devapt.msg_success);
		return self.server_api;
	};
	
	
	
	/*
	
	
	// FEATURES
	DevaptOptions.register_bool_option(DevaptView, 'has_title_bar',		true, false, ['view_has_title_bar']);	// TODO
	DevaptOptions.register_bool_option(DevaptView, 'has_edit_toolbar',	true, false, ['view_has_edit_toolbar']);	// TODO
	DevaptOptions.register_bool_option(DevaptView, 'is_collapsable',	true, false, ['view_is_collapsable']);	// TODO
	DevaptOptions.register_bool_option(DevaptView, 'is_editable',		true, false, ['view_is_editable']);	// TODO
	DevaptOptions.register_bool_option(DevaptView, 'is_portlet',		false, false, ['view_is_portlet']);	// TODO
	
	// LAYOUT
	DevaptOptions.register_str_option(DevaptView, 'position',			null, false, ['view_position']);	// TODO
	
	// EVENTS
	DevaptOptions.register_str_option(DevaptView, 'js_on_ready',		null, false, ['view_js_on_ready']);	// TODO
	DevaptOptions.register_str_option(DevaptView, 'js_on_change',		null, false, ['view_js_on_change']);	// TODO
	DevaptOptions.register_str_option(DevaptView, 'js_on_filled',		null, false, ['view_js_on_filled']);	// TODO
	DevaptOptions.register_str_option(DevaptView, 'js_on_refresh',		null, false, ['view_js_on_refresh']);	// TODO
	*/
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2014-05-10',
			updated:'2014-12-06',
			description:'View base class.'
		},
		properties:{
			
		}
	};
	var parent_class = DevaptObject;
	var DevaptViewClass = new DevaptClass('DevaptView', parent_class, class_settings);
	
	
	// METHODS
	DevaptViewClass.infos.ctor = cb_constructor;
	DevaptViewClass.add_public_method('set_parent', {}, cb_set_parent);
	DevaptViewClass.add_public_method('get_view_id', {}, cb_get_view_id);
	DevaptViewClass.add_public_method('edit_settings', {}, cb_edit_settings);
	
	DevaptViewClass.add_public_method('show', {}, cb_show);
	DevaptViewClass.add_public_method('hide', {}, cb_hide);
	
	DevaptViewClass.add_public_method('translate', {}, cb_translate);
	DevaptViewClass.add_public_method('on_change', {}, cb_on_change);
	DevaptViewClass.add_public_method('on_refresh', {}, cb_on_refresh);
	DevaptViewClass.add_public_method('on_filled', {}, cb_on_filled);
	DevaptViewClass.add_public_method('on_ready', {}, cb_on_ready);
	DevaptViewClass.add_public_method('to_string_self', {}, cb_to_string_self);
	DevaptViewClass.add_public_method('notify_error', {}, cb_notify_error);
	DevaptViewClass.add_public_method('notify_alert', {}, cb_notify_alert);
	DevaptViewClass.add_public_method('notify_info', {}, cb_notify_info);
	DevaptViewClass.add_public_method('get_server_api', {}, cb_get_server_api);
	
	
	// PROPERTIES
	DevaptViewClass.add_public_bool_property('is_view',			'is a view flag', true, false, false, []);
	DevaptViewClass.add_public_str_property('access_role',		'required role to display the view', null, true, false, ['role_display']);
	
	DevaptViewClass.add_public_str_property('parent_html_id',	'content jQuery parent ndoe id (html attribute) ', null, false, false, ['view_parent_html_id']);
	DevaptViewClass.add_public_str_property('html_id',			'content jQuery node id (html attribute)', null, false, false, ['view_html_id']);
	DevaptViewClass.add_public_str_property('label',			'view label for window title or menu', null, false, false, ['view_label']);
	DevaptViewClass.add_public_str_property('tooltip',			'view tooltip for menu item', null, false, false, ['view_tooltip']);
	
	DevaptViewClass.add_public_bool_property('prepend_content',	'should prepend content jqo on the parent jqo?', false, false, false, []);
	DevaptViewClass.add_public_object_property('parent_jqo',	'content parent jQuery node',		null, false, false, []);
	DevaptViewClass.add_public_object_property('content_jqo',	'content jQuery node',				null, false, false, []);
	
	/*
	 * application.views.ViewVVV.on_event: on event actions
	 * 		.EventEEE.log: trace a message
	 * 		.EventEEE.runjs: run a JavaScript expression
	 * 		.EventEEE.do_crud: run a CRUD method on a model resource object
	 * 		.EventEEE.do_method: run a resource object method
	 * 		.EventEEE.emit: emit an other event
	**/
	DevaptViewClass.add_public_object_property('on_event',	'Event reactors',	null, false, false, []);
	
	
	// MIXINS
	DevaptViewClass.add_public_mixin(DevaptMixinTemplate);
	DevaptViewClass.add_public_mixin(DevaptMixinRenderable);
	DevaptViewClass.add_public_mixin(DevaptMixinBind);
	DevaptViewClass.add_public_mixin(DevaptMixinOptionsCSS);
	
	
	return DevaptViewClass;
});
/**
 * @file        datas/model/view_model.js
 * @desc        ModelView class to interact with a model and a view and to deal with functional rules
 * 				
 * 				Principle:
 * 					... <--[Datas]--> Storage Engine <--[ResultSet]--> Model
 * 					Model <--[RecordSet]--> ViewModel <--[RecordSet]--> View
 * 				
 * 					A ViewModel contains the common state of a View and a Model.
 * 						A View.
 * 						Current datas records: a datas Recordset.
 * 						Current selected records: a selection Recordset.
 * 						Formulas, aliases, rules.
 * 					
 * 				Example:
 * 					A view V receive a refresh event.
 * 					V call its ViewModel VM reload operation.
 * 					VM call its Model M read() operation.
 * 					Model call its storage engine SE read() operation.
 * 					M receives a ResultSet from SE.
 * 					VM receives a SharedRecordSet R2 from M.
 * 					VM replace its previous SharedRecordSet R1 by R2 (if R1<>R2).
 * 					VM call refresh operation on V with R2 (if R1<>R2).
 * 				
 *              API: see MIXINS API for DevaptViewModelMixinCrudable and DevaptViewModelMixinSelectable
 *                  ->constructor(object)     : nothing
 *  				
 * 					->is_valid()              : Test if the object properties are valid (boolean)
 * 					
 *  				->get_recordset()         : Get the ViewModel datas set of records (Recordset)
 * 					
 *                  ->get_linked_record()       : Get linked record object (Object)
 *                  ->set_linked_record(record) : Set linked record object (nothing)
 * 					
 *                  ->get_items_types()       : Get container view items types (html, view, text...) (Array)
 *                  ->get_fields_types()      : Get record fields types array with type in 'string', 'integer', 'object'... (Array)
 *  				
 *              TODO    ->create(records)     : Create given records into the model and update the view
 *              TODO    ->read()              : Get records from the model with the query
 *              TODO    ->read_all()          : Get all records from the model
 *              TODO    ->update(records)     : Update given records into the model and update the view
 *              TODO    ->delete(records)     : Delete given records into the model and update the view
 *  				
 * @ingroup     DEVAPT_DATAS
 * @date        2015-02-02
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/model/view_model',[
	'Devapt', 'core/types', 'core/resources',
	'object/class', 'object/object',
	'datas/model/model', 'datas/datasource/datasources', 'datas/query', 'datas/model/recordset', 'datas/model/view_model-mixin-crudable', 'datas/model/view_model-mixin-selectable',
	'views/view'],
function(
	Devapt, DevaptTypes, DevaptResources,
	DevaptClass, DevaptObject,
	DevaptModel, DevaptDatasources, DevaptQuery, DevaptRecordSet, DevaptViewModelMixinCrudable, DevaptViewModelMixinSelectable,
	DevaptView)
{
	/**
	 * @public
	 * @class				DevaptViewModel
	 * @desc				ModelView class to interact with a model and a view and to deal with functional rules
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptViewModel
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// DEBUG
//		self.trace=true;
		
		// CONSTRUCTOR BEGIN
		var context = 'constructor';
		self.enter(context, '');
		
		
		// INIT PROMISES
		self.model_promise = null;
		self.view_promise = null;
		self.ready_promise = null;
		self.batch_promise = Devapt.promise_resolved();
		
		// INIT THE MODEL
		cb_init_model(self);
		
		// INIT THE VIEW
		cb_init_view(self);
		
		// INIT READY PROMISE
		self.assert_object(context, 'model_promise', self.model_promise);
		self.assert_object(context, 'view_promise', self.view_promise);
		self.ready_promise = Devapt.promise_all([self.model_promise, self.view_promise]);
		
		// INIT THE RECORDSET
		cb_init_recordset(self);
		
		// INIT ITEMS TYPES
		cb_init_items_types(self);
		
		// INIT FIELDS TYPES
		cb_init_fields_types(self);
		
		// INIT THE SELECTED RECORDS
		cb_init_selection(self);
		
		
		// CONSTRUCTOR END
		self.leave(context, Devapt.msg_success);
	};
	
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					DevaptViewModel.is_valid()
	 * @desc					Test if the object properties are valid
	 * @return {boolean}		Is valid ?
	 */
	var cb_is_valid = function()
	{
		var self = this;
		self.step('is valid ?', '');
		
		var result = self.is_ok()
			&& DevaptTypes.is_object(self.ready_promise) && Devapt.is_promise(self.ready_promise)
			&& DevaptTypes.is_object(self.model_promise) && Devapt.is_promise(self.model_promise)
			&& DevaptTypes.is_object(self.view_promise) && Devapt.is_promise(self.view_promise)
			&& DevaptTypes.is_object(self.recordset) && self.recordset.is_recordset
			;
		self.value('is valid ?', 'result', result);
		return result;
	};
	
	
	
	/* --------------------------------------------- INIT OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					cb_init_model()
	 * @desc					Init a promise for a Model
	 * @return {nothing}
	 */
	var cb_init_model = function (self)
	{
		var context = 'cb_init_model';
		self.enter(context, '');
		
		
		try
		{
			if ( ! DevaptTypes.is_object(self.model) || ! self.model.is_model )
			{
				self.step(context, 'set model');
				
				self.value(context, 'source', self.source);
				switch(self.source)
				{
					case 'model':
					{
						self.step(context, 'source is model');
						
						if ( ! DevaptTypes.is_string(self.model_name) )
						{
							console.log(self.model_name, 'self.model_name');
							self.error(context, 'bad model name');
							return;
						}
						
						self.model_promise = DevaptResources.get_resource_instance(self.model_name);
						
						break;
					}
					
					case 'inline':
					{
						self.step(context, 'source is inline datas');
						// console.log(self.view.items_inline, self.name + '.' + context + '.view.items_inline');
						
						var items = [];
						if ( self.source_format === 'json' )
						{
							self.step(context, 'inline source format is json');
							
							var json_str = self.view.items_inline.join(',');
							var json_obj = window.$.parseJSON(json_str);
							
							items = json_obj;
						}
						else if ( self.source_format === 'array' )
						{
							self.step(context, 'inline source format is array');
							
							items = [];
							for(var item_index in self.view.items_inline)
							{
								var item_obj = self.view.items_inline[item_index];
								if ( ! DevaptTypes.is_object(item_obj) )
								{
									item_obj = { value: item_obj };
								}
								
								items.push(item_obj);
							}
							// console.log(items, self.name + '.' + context + '.items');
						}
						else
						{
							self.error(context, 'bad inline source format');
							return;
						}
						
						var engine_settings = {
							name:self.name + '_engine',
							records_array:items
						};
						
						var engine_promise = Devapt.create('StorageArray', engine_settings);
						self.assert_object(context, 'engine_promise', engine_promise);
						
						self.model_promise = engine_promise.then(
							function(engine_obj)
							{
								self.step(context, 'array engine is created');
								
								var view_name = DevaptTypes.is_string(self.view) ? self.view : ( (DevaptTypes.is_object(self.view) && self.view.is_view) ? self.view.name : 'unknow');
								var model_name = view_name + '_model';
								var model_settings = {
									name: model_name,
									engine:engine_obj,
									fields:{
										value:{
											type:'String',
											label:'Inline value',
											is_pk:true
										}
									}
								};
								
								return Devapt.create('Model', model_settings);
							}
						);
						
						break;
					}
				}
				
				
				// GET THE MODEL FROM DATASOURCES
				if ( ! self.model_promise)
				{
					self.model_promise = DevaptDatasources.get_datasource_model(self.source);
				}
			}
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		self.leave(context, '');
	};
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					cb_init_view(self)
	 * @desc					Init a promise for a View
	 * @return {nothing}
	 */
	var cb_init_view = function (self)
	{
		var context = 'cb_init_view';
		self.enter(context, '');
		
		
		try
		{
			// GET VIEW
			var has_valid_view = DevaptTypes.is_object(self.view) && self.view.is_view;
			if ( ! has_valid_view)
			{
				self.step(context, 'set view');
				
				self.assert_not_empty_str(context, 'view name', self.view);
				
				self.view_promise = DevaptResources.get_resource_instance(self.view);
				self.view_promise.then(
					function(arg_view)
					{
						self.view_items_iterator = self.view.items_iterator;
					}
				);
			}
			else
			{
				self.step(context, 'view is set');
				self.view_promise = Devapt.promise_resolved(self.view);
				self.view_items_iterator = self.view.items_iterator;
			}
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		self.leave(context, '');
	};
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					cb_init_selection()
	 * @desc					Init the selected records
	 * @return {nothing}
	 */
	var cb_init_selection = function (self)
	{
		var context = 'cb_init_selection';
		self.enter(context, '');
		
		
		try
		{
			// TODO
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		self.leave(context, '');
	};
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					cb_init_recordset()
	 * @desc					Init the records set
	 * @return {nothing}
	 */
	var cb_init_recordset = function (self)
	{
		var context = 'cb_init_recordset';
		self.enter(context, '');
		
		
		try
		{
			var has_valid_recordset = DevaptTypes.is_object(self.recordset) && self.recordset.is_recordset;
			if ( ! has_valid_recordset)
			{
				self.step(context, 'init recordset');
				
				self.ready_promise = self.ready_promise.spread(
					function(arg_model, arg_view)
					{
						// CREATE ITEMS RECORDSET
						var recordset_name = self.name + '_recordset';
						var recordset_settings = {
							model:arg_model
						};
						
						self.recordset = DevaptRecordSet.create(recordset_name, recordset_settings);
						
						// GET PK FIELD NAME
						var pk_field = arg_model.get_pk_field();
						var pk_field_name = pk_field ? pk_field.name : null;
						
						// SET FIELDS LIST
						var pk_field_found = false;
						self.recordset.query.fields = [];
						for(var index in arg_view.items_fields)
						{
							var field_name = arg_view.items_fields[index];
							self.recordset.query.fields.push(field_name);
							
							if (pk_field_name && field_name === pk_field_name)
							{
								pk_field_found = true;
							}
						}
						
						// ADD ID FIELD IF NEEDED
						self.recordset.query.fields;
						if (!pk_field_found)
						{
							self.recordset.query.fields.push(pk_field_name);
						}
						
						// SELECT DISTINCT CASE
						if (arg_view.items_distinct)
						{
							self.step(context, 'read distinct records');
							if ( DevaptTypes.is_not_empty_str(arg_view.items_distinct_field) )
							{
								self.step(context, 'read distinct one records');
								
								self.recordset.query.set_select_distinct_one();
								self.recordset.query.set_one_field(arg_view.items_distinct_field);
							}
							else
							{
								self.step(context, 'read distinct many records');
								
								self.recordset.query.set_select_distinc();
							}
						}
						else
						{
							self.step(context, 'set select query');
							self.recordset.query.set_select();
						}
						
						return [arg_model, arg_view];
					}
				);
			}
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		self.leave(context, '');
	};
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					cb_init_items_types()
	 * @desc					Init the records set
	 * @return {nothing}
	 */
	var cb_init_items_types = function (self)
	{
		var context = 'cb_init_items_types';
		self.enter(context, '');
		
		
		try
		{
			self.ready_promise = self.ready_promise.spread(
				function(arg_model, arg_view)
				{
					self.step(context, 'init items types');
					
					self.items_types = [];
					
					// GET ITEMS TYPES FROM INLINE SOURCE
					if (self.source === 'inline')
					{
						self.step(context, 'inline source');
						
						if ( DevaptTypes.is_not_empty_array(arg_view.items_types) )
						{
							self.items_types = arg_view.items_types;
						}
					}
					
					// GET ITEMS TYPES FROM MODEL SOURCE
					else if (self.source === 'model')
					{
						self.step(context, 'model source');
						
						if (arg_view.items_iterator === 'field_editor' || arg_view.items_iterator === 'records' || arg_view.items_iterator === 'fields')
						{
							self.step(context, 'iterator is ' + arg_view.items_iterator);
							
							self.items_types = ['object'];
						}
					}
					
					return [arg_model, arg_view];
				}
			);
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		self.leave(context, '');
	};
	
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					cb_init_fields_types()
	 * @desc					Init the records set
	 * @return {nothing}
	 */
	var cb_init_fields_types = function (self)
	{
		var context = 'cb_init_fields_types';
		self.enter(context, '');
		
		
		try
		{
			self.ready_promise = self.ready_promise.spread(
				function(arg_model, arg_view)
				{
					self.step(context, 'init fields types');
					
					self.fields_types = [];
					
					// ITERATE ON ONE FIELD RECORDS
					if (arg_view.items_iterator === 'field_editor')
					{
						self.step(context, 'iterator is field_editor');
						
						self.fields_types = ['object'];
					}
					
					// ITERATE ON RECORDS
					else if (arg_view.items_iterator === 'records')
					{
						self.step(context, 'iterator is records');
						
						self.fields_types = arg_model.get_fields_types(arg_view.items_fields);
					}
					
					// ITERATE ON FIELDS
					else if (arg_view.items_iterator === 'fields')
					{
						self.step(context, 'iterator is fields');
						
						// FIELD NAME / FIELD VALUE
						self.fields_types = ['string', 'anything'];
					}
					
					else 
					{
						self.step(context, 'iterator is unknow');
					}
					
					return [arg_model, arg_view];
				}
			);
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		self.leave(context, '');
	};
	
	
	
	/* --------------------------------------------- RECORDSET OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					self.get_recordset()
	 * @desc					Get recordset object
	 * @return {object}			RecordSet object
	 */
	var cb_get_recordset = function ()
	{
		var self = this;
		self.step('get_recordset', '');
		
		return self.recordset;
	};
	
	
	
	/* --------------------------------------------- LINK OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					self.get_linked_record()
	 * @desc					Get linked record object
	 * @return {object}			Record object
	 */
	var cb_get_linked_record = function ()
	{
		var self = this;
		self.step('get linked record', '');
		return self.linked_record;
	};
	
	/**
	 * @memberof				DevaptViewModel
	 * @public
	 * @method					self.set_linked_record(record)
	 * @desc					Set linked record object
	 * @param					arg_record		linked record
	 * @return {nothing}
	 */
	var cb_set_linked_record = function (arg_record)
	{
		var self = this;
		var context = 'set_linked_record(record)';
		self.enter(context, '');
		self.assert_object(context, 'record', arg_record);
		self.assert_true(context, 'record.is_record', arg_record.is_record);
		
		self.linked_record = arg_record;
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	
	/* --------------------------------------------- TYPES OPERATIONS ------------------------------------------------ */
	
	/**
	 * @public
	 * @memberof			DevaptViewModel
	 * @method				DevaptViewModel.get_items_types()
	 * @desc				Get container items types array with type in 'view', 'text', 'object'
	 * @return {array}
	 */
	var cb_get_items_types = function()
	{
		var self = this;
		var context = 'get_items_types()';
		self.enter(context, '');
		
		self.value(context, 'types', self.items_types);
		
		self.leave(context, Devapt.msg_success);
		return self.items_types;
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptViewModel
	 * @method				DevaptViewModel.get_fields_types()
	 * @desc				Get record fields types array with type in 'string', 'integer', 'object'...
	 * @return {array}
	 */
	var cb_get_fields_types = function()
	{
		var self = this;
		var context = 'get_fields_types()';
		self.enter(context, '');
		self.value(context, 'types', self.fields_types);
		
		
		self.leave(context, Devapt.msg_success);
		return self.fields_types;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-02-02',
			updated:'2015-05-02',
			description:'Link between model and view.'
		},
		mixins: [DevaptViewModelMixinCrudable, DevaptViewModelMixinSelectable]
	};
	var parent_class = DevaptObject;
	var DevaptViewModelClass = new DevaptClass('DevaptViewModel', parent_class, class_settings);
	
	
	// METHODS
	DevaptViewModelClass.infos.ctor = cb_constructor;
	DevaptViewModelClass.add_public_method('is_valid', {}, cb_is_valid);
	
		// RECORDSET OPERATIONS
	DevaptViewModelClass.add_public_method('get_recordset', {}, cb_get_recordset);
	
		// LINK OPERATIONS
	DevaptViewModelClass.add_public_method('get_linked_record', {}, cb_get_linked_record);
	DevaptViewModelClass.add_public_method('set_linked_record', {}, cb_set_linked_record);
	
		// TYPES OPERATIONS
	DevaptViewModelClass.add_public_method('get_items_types', {}, cb_get_items_types);
	DevaptViewModelClass.add_public_method('get_fields_types', {}, cb_get_fields_types);
	
	
	// PROPERTIES
	DevaptViewModelClass.add_public_bool_property('is_view_model', 'object is a ViewModel', true, false, true, []);
	
	DevaptViewModelClass.add_public_str_property('source', 'model datas source', 'inline', true, false, []);
	DevaptViewModelClass.add_public_str_property('source_format', 'model datas source format', 'array', false, false, []);
	
	DevaptViewModelClass.add_public_object_property('view', 'View object linked with the model', null, true, false, []);
	DevaptViewModelClass.add_public_object_property('recordset', 'Model datas result for the items query', null, true, false, []);
	
	DevaptViewModelClass.add_public_object_property('linked_record', 'Linked record', null, true, false, []);
	
	DevaptViewModelClass.add_public_array_property('items_types', 'Items types', null, true, false, [], 'string', '|');
	DevaptViewModelClass.add_public_array_property('fields_types', 'Fields types', null, true, false, [], 'string', '|');
	
	
	// SETTINGS
	DevaptViewModelClass.add_public_object_property('model', 'Model object linked with the view', null, false, false, []);
	DevaptViewModelClass.add_public_str_property('model_name', 'Model name linked with the view', null, false, false, []);
	
	
	return DevaptViewModelClass;
} );
/**
 * @file        datas/model/all.js
 * @desc        Load all Devapt datas classes
 * @ingroup     DEVAPT_DATAS
 * @date        2015-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
	'datas/model/all',[
		'datas/model/model',
		'datas/model/record',
		'datas/model/recordset',
		'datas/model/view_model',
		'datas/model/view_model-mixin-crudable',
		'datas/model/view_model-mixin-selectable'
	],
	function()
	{
	}
);
/**
 * @file        datas/storage/resultset.js
 * @desc        Read only result set fot storage engines
 *              API:
 *                  ->constructor(object)     : nothing
 *  				
 *                  ->get_records()     	  : array
 *                  ->get_count()             : integer
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2015-02-02
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/storage/resultset',['Devapt', 'core/types', 'object/class', 'object/object', 'object/mixin-status'],
function(Devapt, DevaptTypes, DevaptClass, DevaptObject, DevaptMixinStatus)
{
	/**
	 * @public
	 * @class				DevaptResultSet
	 * @desc				Read only result set fot storage engines
	 * @return {nothing}
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptResultSet
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// self.trace=true;
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	/**
	 * @memberof				DevaptResultSet
	 * @public
	 * @method					DevaptResultSet.is_valid()
	 * @desc					Test if the storage engine is valid
	 * @return {boolean}		Is valid ?
	 */
	var cb_is_valid = function()
	{
		var self = this;
		switch(self.status)
		{
			case 'ok':
				return self.error_msg === null && self.count === self.records.length;
			
			case 'error':
				return self.error_msg !== null && self.count === 0 && self.records.length === 0;
		}
		
		return false;
	};
	
	
	/**
	 * @memberof				DevaptResultSet
	 * @public
	 * @method					DevaptResultSet.get_records()
	 * @desc					Get all result records
	 * @return {array}
	 */
	var cb_get_records = function ()
	{
		var self = this;
		return self.records;
	};
	
	
	/**
	 * @memberof				DevaptResultSet
	 * @public
	 * @method					DevaptResultSet.get_count()
	 * @desc					Get result records count
	 * @return {string}
	 */
	var cb_get_count = function ()
	{
		var self = this;
		return self.count;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-02-02',
			updated:'2015-02-02',
			description:'Read only result set fot storage engines'
		},
		mixins:[DevaptMixinStatus]
	};
	var parent_class = DevaptObject;
	var DevaptResultSetClass = new DevaptClass('DevaptResultSet', parent_class, class_settings);
	
	// METHODS
	DevaptResultSetClass.infos.ctor = cb_constructor;
	// DevaptResultSetClass.add_public_method('get_status', {}, cb_get_status);
	// DevaptResultSetClass.add_public_method('get_error', {}, cb_get_error);
	
	DevaptResultSetClass.add_public_method('is_valid', {}, cb_is_valid);
	// DevaptResultSetClass.add_public_method('is_ok', {}, cb_is_ok);
	// DevaptResultSetClass.add_public_method('is_error', {}, cb_is_error);
	
	DevaptResultSetClass.add_public_method('get_records', {}, cb_get_records);
	DevaptResultSetClass.add_public_method('get_count', {}, cb_get_count);
	
	// MIXINS
	
	// PROPERTIES
	DevaptResultSetClass.add_public_bool_property('is_resultset', 'object is a resultset', true, false, true, []);
	// DevaptResultSetClass.add_public_str_property('status', 'operation status', null, true, true, []);
	// DevaptResultSetClass.add_public_str_property('error', 'error message for failed operation', null, true, true, []);
	DevaptResultSetClass.add_public_int_property('count', 'records count', null, true, true, []);
	DevaptResultSetClass.add_public_array_property('records', 'records array', [], false, false, [], 'object', '|');
	
	
	return DevaptResultSetClass;
} );
/**
 * @file        datas/storage.js
 * @desc        Devapt storage engines base class features
 *              API:
 *                  ->is_valid()              : boolean
 *                  ->read_all_records()      : promise of a ResultSet
 *                  ->read_all_records_self() : promise of a ResultSet (internal method)
 *                  ->read_records(query)     : promise of a ResultSet
 *                  ->read_records_self(query): promise of a ResultSet (internal method)
 *                  ->create_records(query)   : promise of a ResultSet
 *                  ->update_records(query)   : promise of a ResultSet
 *                  ->delete_records(query)   : promise of a ResultSet
 *  
 * @ingroup     DEVAPT_DATAS
 * @date        2014-08-11
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/storage/storage',['Devapt', 'core/types', 'object/class', 'object/object', 'datas/storage/resultset'],
function(Devapt, DevaptTypes, DevaptClass, DevaptObject, DevaptResultSet)
{
	/**
	 * @public
	 * @class				DevaptStorage
	 * @desc				Storage engine base class
	 * @return {nothing}
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptStorage
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// self.trace=true;
		
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// self.trace=true;
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	/**
	 * @memberof				DevaptStorage
	 * @public
	 * @method					DevaptStorage.is_valid()
	 * @desc					Test if the storage engine is valid
	 * @return {boolean}		Is valid ?
	 */
	var cb_is_valid = function()
	{
		return false;
	};
	
	
	/**
	 * @memberof				DevaptStorage
	 * @public
	 * @method					DevaptStorage.read_all_records()
	 * @desc					Read all records along storage strategy
	 * @return {object}			A promise
	 */
	var cb_read_all_records = function ()
	{
		var self = this;
		
		// USE CACHED QUERIES
		var query_key = 'all';
		if (self.use_cached_queries)
		{
			var query_promise = self.cached_queries[query_key];
			if (query_promise)
			{
				return query_promise;
			}
			
			var promise = self.read_all_records_self();
			promise.then(
				function(resultset)
				{
					self.cached_queries[query_key] = promise;
				}
			);
			
			return promise;
		}
		
		// DON'T USE CACHED QUERIES
		var result_promise = self.read_all_records_self();
		// console.log(result_promise);
		return result_promise;
	};
	
	
	/**
	 * @memberof				DevaptStorage
	 * @public
	 * @method					DevaptStorage.read_all_records_self()
	 * @desc					Read all records along storage strategy
	 * @return {object}			A promise
	 */
	var cb_read_all_records_self = function ()
	{
		var self = this;
		return Devapt.promise_rejected(Devapt.msg_default_empty_implementation);
	};
	
	
	/**
	 * @memberof				DevaptStorage
	 * @public
	 * @method					DevaptStorage.read_records(arg_query)
	 * @desc					Read records of the given query along storage strategy (async mode)
	 * @param {object}			arg_query		Read query
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_read_records = function (arg_query)
	{
		var self = this;
		
		// USE CACHED QUERIES
		var query_key = DevaptTypes.is_object(arg_query) ? arg_query.get_key() : null;
		if (self.use_cached_queries && query_key)
		{
			var query_promise = self.cached_queries[query_key];
			if (query_promise)
			{
				return query_promise;
			}
			
			var promise = self.read_records_self(arg_query);
			promise.then(
				function(resultset)
				{
					self.cached_queries[query_key] = promise;
				}
			);
			
			return promise;
		}
		
		// DON'T USE CACHED QUERIES
		var result_promise = self.read_records_self(arg_query);
		// console.log(result_promise);
		return result_promise;
	};
	
	
	/**
	 * @memberof				DevaptStorage
	 * @public
	 * @method					DevaptStorage.read_records_self(arg_query)
	 * @desc					Read records of the given query along storage strategy (async mode)
	 * @param {object}			arg_query		Read query
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_read_records_self = function (arg_query)
	{
		var self = this;
		// console.log(arg_query, 'storage.read_records_self.arg_query');
		return Devapt.promise_rejected(Devapt.msg_default_empty_implementation);
	};
	
	
	/**
	 * @memberof				DevaptStorage
	 * @public
	 * @method					DevaptStorage.create_records(arg_records)
	 * @desc					Create one or more records with the given values (async mode)
	 * @param {object|array}	arg_records		Records of values
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_create_records = function (arg_records)
	{
		var self = this;
		return Devapt.promise_rejected(Devapt.msg_default_empty_implementation);
	};
	
	
	/**
	 * @memberof				DevaptStorage
	 * @public
	 * @method					DevaptStorage.update_records(arg_records)
	 * @desc					Update one or more records with the given values (async mode)
	 * @param {object|array}	arg_records		Records of values
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_update_records = function (arg_records)
	{
		var self = this;
		return Devapt.promise_rejected(Devapt.msg_default_empty_implementation);
	};
	
	
	/**
	 * @memberof				DevaptStorage
	 * @public
	 * @method					DevaptStorage.delete_records(arg_records)
	 * @desc					Delete one or more records with the given values (async mode)
	 * @param {object|array}	arg_records		Records of values
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_delete_records = function (arg_records)
	{
		var self = this;
		return Devapt.promise_rejected(Devapt.msg_default_empty_implementation);
	};
	
	
	/**
	 * @memberof				DevaptStorage
	 * @public
	 * @method					DevaptStorage.touch_cached_records(arg_records, arg_action)
	 * @desc					Update cached values with given records and action
	 * @param {object|array}	arg_records		Records of values
	 * @param {object|array}	arg_action		Action name
	 * @return {nothing}
	 */
	var cb_touch_cached_records = function (arg_records, arg_action)
	{
		var self = this;
		var context = 'touch_cached_records(records, action)';
		self.enter(context, '');
		
		
		self.cached_queries = {};
		
		
		self.leave(context, Devapt.msg_success_promise);
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2014-08-11',
			updated:'2015-02-02',
			description:'Storage engines base class.'
		}
	};
	var parent_class = DevaptObject;
	var DevaptStorageClass = new DevaptClass('DevaptStorage', parent_class, class_settings);
	
	// METHODS
	DevaptStorageClass.infos.ctor = cb_constructor;
	DevaptStorageClass.add_public_method('is_valid', {}, cb_is_valid);
	DevaptStorageClass.add_public_method('read_all_records', {}, cb_read_all_records);
	DevaptStorageClass.add_public_method('read_all_records_self', {}, cb_read_all_records_self);
	DevaptStorageClass.add_public_method('read_records', {}, cb_read_records);
	DevaptStorageClass.add_public_method('read_records_self', {}, cb_read_records_self);
	DevaptStorageClass.add_public_method('create_records', {}, cb_create_records);
	DevaptStorageClass.add_public_method('update_records', {}, cb_update_records);
	DevaptStorageClass.add_public_method('delete_records', {}, cb_delete_records);
	DevaptStorageClass.add_public_method('touch_cached_records', {}, cb_touch_cached_records);
	
	// MIXINS
	
	// PROPERTIES
	DevaptStorageClass.add_public_bool_property('use_cached_queries', 'should cache query results', false, false, false, []);
	DevaptStorageClass.add_public_obj_property('cached_queries', 'query results cache', {}, false, false, []);
	
	DevaptStorageClass.add_public_bool_property('is_storage', 'class instance is a storage engine', true, false, true, []);
	DevaptStorageClass.add_public_bool_property('is_sync', 'storage engine has synchronous operations', false, false, false, []);
	DevaptStorageClass.add_public_bool_property('is_cached', 'storage engine has cached operations', false, false, false, []);
	DevaptStorageClass.add_public_int_property('cache_ttl', 'storage engine cache TTL (time to leave)', null, false, false, []);
	DevaptStorageClass.add_public_bool_property('is_local_storage', 'storage engine has local datas on browser', true, false, false, []);
	DevaptStorageClass.add_public_bool_property('is_remote_storage', 'storage engine has remote datas on server', false, false, false, []);
	
	DevaptStorageClass.add_public_str_property('notify_create', 'notify user on create operations', true, false, false, []);
	DevaptStorageClass.add_public_str_property('notify_read', 'notify user on read operations', false, false, false, []);
	DevaptStorageClass.add_public_str_property('notify_update', 'notify user on update operations', true, false, false, []);
	DevaptStorageClass.add_public_str_property('notify_delete', 'notify user on delete operations', true, false, false, []);
	
	
	return DevaptStorageClass;
} );
/**
 * @file        datas/storage/storage-array.js
 * @desc        Devapt ARRAY storage engine
 *                  ->is_valid()              : boolean
 *                  ->read_all_records()      : promise of a ResultSet
 *                  ->read_all_records_self() : promise of a ResultSet (internal method)
 *                  ->read_records(query)     : promise of a ResultSet
 *                  ->read_records_self(query): promise of a ResultSet (internal method)
 *                  ->create_records(query)   : promise of a ResultSet
 *                  ->update_records(query)   : promise of a ResultSet
 *                  ->delete_records(query)   : promise of a ResultSet
 * 
 * @ingroup     DEVAPT_DATAS
 * @date        2014-08-12
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/storage/storage-array',['Devapt', 'core/types', 'object/class', 'datas/storage/storage', 'datas/storage/resultset'],
function(Devapt, DevaptTypes, DevaptClass, DevaptStorage, DevaptResultSet)
{
	/**
	 * @public
	 * @class				DevaptArrayStorage
	 * @desc				ARRAY storage engine class
	 * @return {nothing}
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptArrayStorage
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// DEBUG
		// self.trace=true;
		
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// CALL SUPER CLASS CONSTRUCTOR
		self._parent_class.infos.ctor(self);
		self.is_remote_storage = false;
		self.is_local_storage = true;
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	/**
	 * @memberof				DevaptArrayStorage
	 * @public
	 * @method					DevaptArrayStorage.is_valid()
	 * @desc					Test if the storage engine is valid
	 * @return {boolean}		Is valid ?
	 */
	var cb_is_valid = function()
	{
		return DevaptTypes.is_array(self.records_array) || ( DevaptTypes.is_object(self.provider) && self.provider.is_provider );
	};
	
	
	/**
	 * @memberof				DevaptArrayStorage
	 * @public
	 * @method					DevaptArrayStorage.get_array()
	 * @desc					Get storage array
	 * @return {array}
	 */
	var cb_get_array = function()
	{
		var self = this;
		var context = 'get_array()';
		self.enter(context, '');
		
		
		// DEBUG
		// self.value(context, 'self.records_array', self.records_array);
		// self.value(context, 'self.provider', self.provider);
		// console.log(self.records_array, context);
		// console.log(self.provider, context);
		
		// PROVIDER
		if ( DevaptTypes.is_object(self.provider) && self.provider.is_provider )
		{
			self.leave(context, 'has an provider');
			return self.provider.get_records();
		}
		
		// OWNED RECORDS ARRAY
		if ( DevaptTypes.is_array(self.records_array) )
		{
			self.leave(context, 'has locale array');
			return self.records_array;
		}
		
		
		self.leave(context, 'default empty array');
		return [];
	};
	
	
	/**
	 * @memberof				DevaptArrayStorage
	 * @public
	 * @method					DevaptArrayStorage.set_item(item,index)
	 * @desc					Add or set storage array item
	 * @param {anything}		arg_item
	 * @param {integer}			arg_index (optional)
	 * @return {array}
	 */
	var cb_set_item = function(arg_item, arg_index)
	{
		var self = this;
		var context = 'set_item()';
		self.enter(context, '');
		
		
		// DEBUG
		// self.value(context, 'self.records_array', self.records_array);
		// self.value(context, 'self.provider_cb', self.provider_cb);
		
		
		// PROVIDER
		if ( DevaptTypes.is_null(arg_index) && DevaptTypes.is_object(self.provider) && self.provider.is_provider )
		{
			self.provider.add(arg_item);
			
			self.leave(context, 'add with a provider');
			return self.provider.get_records();
		}
		if ( DevaptTypes.is_integer(arg_index) && arg_index > 0 && DevaptTypes.is_object(self.provider) && self.provider.is_provider )
		{
			self.provider.set(arg_index, arg_item);
			
			self.leave(context, 'set with a provider');
			return self.provider.get_records();
		}

		// OWNED RECORDS ARRAY
		if ( DevaptTypes.is_array(self.records_array) )
		{
			self.step(context, 'has locale array');
			
			// APPEND
			if ( DevaptTypes.is_null(arg_index) )
			{
				self.records_array.push(arg_item);
				
				self.leave(context, 'add with a owned array');
				return self.records_array;
			}
			
			// UPDATE
			if ( DevaptTypes.is_integer(arg_index) && arg_index > 0 && arg_index < self.records_array.length)
			{
				self.records_array[arg_index] = arg_item;
				
				self.leave(context, 'set with a owned array');
				return self.records_array;
			}
			
			return null;
		}
		
		
		self.leave(context, 'default null array');
		return null;
	};
	
	
	
	/**
	 * @memberof				DevaptArrayStorage
	 * @public
	 * @method					DevaptArrayStorage.read_all_records()
	 * 
	 * 		USE:
	 * 			require(['datas/storage-array'],
	 * 				function(DevaptArrayStorage)
	 * 				{
	 * 					var store_opts = {
	 * 						records_array = [{name:'a', age=5},{name:'b', age=15},{name:'c', age=25}]
	 * 					};
	 * 					var store = new DevaptArrayStorage('store', store_opts);
	 * 					store.read_all_records().then( function(result) { console.log(result, 'result'); } );
	 * 				}
	 * 			);
	 * 
	 * @desc					Read all records along storage strategy
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_read_all_records_self = function ()
	{
		var self = this;
		// self.trace=true;
		var context = 'read_all_records_self()';
		self.enter(context, '');
		
		
		// GET DATAS ARRAY
		var datas = self.get_array();
		self.value(context, 'datas', datas);
		
		// FILTERED DATAS
		var filtered_datas = datas;
		console.log(filtered_datas, context + ':filtered_datas');
		
		// NOTIFY
		if (self.notify_read)
		{
			Devapt.get_current_backend().notify_info('storage array: read all is done for [' + self.name + ']');
		}
		
		// RETURN A RESULT SET
		var resultset = DevaptResultSet.create(self.name + '_result_read_all', {status:'ok', records:filtered_datas, count:filtered_datas.length});
		var resultset_promise = Devapt.promise_resolved(resultset);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return resultset_promise;
	};
	
	
	
	/**
	 * @memberof				DevaptArrayStorage
	 * @public
	 * @method					DevaptArrayStorage.read_records(arg_query)
	 * @desc					Read records of the given query along storage strategy (async mode)
	 * 
	 * 		USE:
	 * 			require(['datas/storage-array'],
	 * 				function(DevaptArrayStorage)
	 * 				{
	 * 					var store_opts = {
	 * 						records_array = [{name:'a', age=5},{name:'b', age=15},{name:'c', age=25}]
	 * 					};
	 * 					var store = new DevaptArrayStorage('store', store_opts);
	 * 					var query = DevaptQuery.create('query_1', {...});
	 * 					store.read_records(query).then( function(result) { console.log(result, 'result'); } );
	 * 				}
	 * 			);
	 * 
	 * @param {object}			arg_query		Read query
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_read_records_self = function (arg_query)
	{
		var self = this;
		// self.trace=true;
		var context = 'read_records_self(query)';
		self.enter(context, '');
		
		
		// DEBUG
		// self.value(context, 'self.records_array', self.records_array);
		// self.value(context, 'self.provider_cb', self.provider_cb);
		
		
		// FILTERED DATAS
		var filtered_datas = []; // TODO USE query to filter array datas
		// console.log(filtered_datas, self.name + '.' + context + '.filtered_datas');
		
		
		// SLICE ARRAY
		if (arg_query && arg_query.slice && arg_query.slice.offset > 0 )
		{
			self.step(context, 'has slice filter');
			
			// PROVIDER
			if ( DevaptTypes.is_object(self.provider) && self.provider.is_provider )
			{
				self.leave(context, 'has a provider');
				filtered_datas = self.provider.get_records(arg_query.slice.offset, arg_query.slice.length);
			}
			
			// OWNED RECORDS ARRAY
			else
			{
				self.step(context, 'apply valid slice filter');
				
				filtered_datas = self.get_array();
				if ( arg_query.slice.offset < datas.length )
				{
					// console.log(datas, self.name + '.' + context + '.records_array');
					filtered_datas = Array.prototype.slice.call(filtered_datas, arg_query.slice.offset);
					// console.log(filtered_datas, self.name + '.' + context + '.filtered_datas with slice');
				}
				console.log(arg_query.slice.offset, context + '.arg_query');
				console.log(filtered_datas.length, self.name + '.' + context + '.filtered_datas with slice');
			}
		}
		else
		{
			filtered_datas = self.get_array();
		}
		
		
		// NOTIFY
		if (self.notify_read)
		{
			Devapt.get_current_backend().notify_info('storage array: read query is done for [' + self.name + ']');
		}
		
		// RETURN A RESULT SET
		var resultset = DevaptResultSet.create(self.name + '_result_read_' + arg_query.name, {status:'ok', records:filtered_datas, count:filtered_datas.length});
		var resultset_promise = Devapt.promise_resolved(resultset);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return resultset_promise;
	};
	
	
	
	/**
	 * @memberof				DevaptArrayStorage
	 * @public
	 * @method					DevaptArrayStorage.create_records(arg_records)
	 * @desc					Create one or more records with the given values (async mode)
	 * 
	 * 		USE:
	 * 			require(['datas/storage-array'],
	 * 				function(DevaptArrayStorage)
	 * 				{
	 * 					var store_opts = {
	 * 						records_array = [{name:'a', age=5},{name:'b', age=15},{name:'c', age=25}]
	 * 					};
	 * 					var record = {"id_user":null,"login":"jcarter","lastname":"CARTER","firstname":"Jimmy","email":"jcarter@usa.us","password":"mypass"};
	 * 					var store = new DevaptArrayStorage('store', store_opts);
	 * 					store.create_records(record).then( function(result) { console.log(result, 'result'); } );
	 * 				}
	 * 			);
	 * 
	 * @param {object|array}	arg_records		Records of values
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_create_records = function (arg_records)
	{
		var self = this;
		var context = 'create_records(records)';
		self.enter(context, '');
		
		
		// GET DATAS ARRAY
		var datas = self.get_array();
		
		
		// CREATE RECORDS
		if ( DevaptTypes.is_object(arg_records) )
		{
			arg_records = [arg_records];
		}
		if ( DevaptTypes.is_array(arg_records) )
		{
			for(var record_index in arg_records)
			{
				var record = arg_records[record_index];
				if ( DevaptTypes.is_object(record) )
				{
					self.set_item(record, undefined);
				}
			}
		}
		
		// NOTIFY
		if (self.notify_create)
		{
			Devapt.get_current_backend().notify_info('storage array: create is done for [' + self.name + ']');
		}
		
		// RETURN A RESULT SET
		var resultset = DevaptResultSet.create(self.name + '_result_create', {status:'ok', records:[], count:0});
		var resultset_promise = Devapt.promise_resolved(resultset);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return resultset_promise;
	};
	
	
	
	/**
	 * @memberof				DevaptArrayStorage
	 * @public
	 * @method					DevaptArrayStorage.update_records(arg_records)
	 * @desc					Update one or more records with the given values (async mode)
	 * 
	 * 		USE:
	 * 			require(['datas/storage-array'],
	 * 				function(DevaptArrayStorage)
	 * 				{
	 * 					var store_opts = {
	 * 						records_array = [{name:'a', age=5},{name:'b', age=15},{name:'c', age=25}]
	 * 					};
	 * 					var store = new DevaptArrayStorage('store', store_opts);
	 * 					var record = {"id_user":"31","password":"mypass2"};
	 * 					store.update_records(record).then( function(result) { console.log(result, 'result'); } );
	 * 				}
	 * 			);
	 * 
	 * @param {object|array}	arg_records		Records of values
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_update_records = function (arg_records)
	{
		var self = this;
		var context = 'update_records(records)';
		self.enter(context, '');
		
		
		// GET DATAS ARRAY
		var datas = self.get_array();
		
		// UPDATE DATAS
		var filtered_datas = datas; // TODO USE query to filter array datas
		// console.log(filtered_datas, 'filtered_datas');
		// TODO UDPATE DATAS
		
		// NOTIFY
		if (self.notify_update)
		{
			Devapt.get_current_backend().notify_info('storage array: update is done for [' + self.name + ']');
		}
		
		// RETURN A RESULT SET
		var resultset = DevaptResultSet.create(self.name + '_result_update', {status:'ok', records:[], count:0});
		var resultset_promise = Devapt.promise_resolved(resultset);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return resultset_promise;
	};
	
	
	
	/**
	 * @memberof				DevaptArrayStorage
	 * @public
	 * @method					DevaptArrayStorage.delete_records(arg_records)
	 * @desc					Delete one or more records with the given values (async mode)
	 * 
	 * 		USE:
	 * 			require(['datas/storage-array'],
	 * 				function(DevaptArrayStorage)
	 * 				{
	 * 					var store_opts = {
	 * 						url_read:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_create:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_update:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_delete:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/'
	 * 					};
	 * 					var store = new DevaptArrayStorage('store', store_opts);
	 * 					var record = {"id_user":"31"};
	 * 					store.delete_records(record).then( function(result) { console.log(result, 'result'); } );
	 * 				}
	 * 			);
	 * 
	 * @param {object|array}	arg_records		Records of values
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_delete_records = function (arg_records)
	{
		var self = this;
		var context = 'delete_records(records)';
		self.enter(context, '');
		
		
		// GET DATAS ARRAY
		var datas = self.get_array();
		
		// DELETE DATAS
		var filtered_datas = datas; // TODO USE query to filter array datas
		// console.log(filtered_datas, 'filtered_datas');
		// TODO DELETE DATAS
		
		// NOTIFY
		if (self.notify_delete)
		{
			Devapt.get_current_backend().notify_info('storage array: delete is done for [' + self.name + ']');
		}
		
		// RETURN A RESULT SET
		var resultset = DevaptResultSet.create(self.name + '_result_delete', {status:'ok', records:[], count:0});
		var resultset_promise = Devapt.promise_resolved(resultset);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return resultset_promise;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2014-08-12',
			updated:'2015-02-02',
			description:'ARRAY storage engine.'
		},
		properties:{
		}
	};
	var parent_class = DevaptStorage;
	var DevaptStorageClass = new DevaptClass('DevaptArrayStorage', parent_class, class_settings);
	
	// METHODS
	DevaptStorageClass.infos.ctor = cb_constructor;
	DevaptStorageClass.add_public_method('is_valid', {}, cb_is_valid);
	DevaptStorageClass.add_public_method('get_array', {}, cb_get_array);
	DevaptStorageClass.add_public_method('set_item', {}, cb_set_item);
	DevaptStorageClass.add_public_method('read_all_records_self', {}, cb_read_all_records_self);
	DevaptStorageClass.add_public_method('read_records_self', {}, cb_read_records_self);
	DevaptStorageClass.add_public_method('create_records', {}, cb_create_records);
	DevaptStorageClass.add_public_method('update_records', {}, cb_update_records);
	DevaptStorageClass.add_public_method('delete_records', {}, cb_delete_records);
	
	// MIXINS
	
	// PROPERTIES
	DevaptStorageClass.add_public_str_property('source', '', [], false, false, []);
	DevaptStorageClass.add_public_object_property('provider', '', null, false, false, []);
	DevaptStorageClass.add_public_array_property('records_array', 'records array', [], false, false, [], 'object', '|');
	
		// COLLECTION OPERATIONS
	// DevaptStorageClass.add_public_cb_property('get_records', '', null, false, false, []);
	// DevaptStorageClass.add_public_cb_property('set_records', '', null, false, false, []);
	// DevaptStorageClass.add_public_cb_property('remove_records', '', null, false, false, []);
		// ITEM OPERATIONS
	// DevaptStorageClass.add_public_cb_property('filter_record', '', null, false, false, []);
	// DevaptStorageClass.add_public_cb_property('get_record', '', null, false, false, []);
	// DevaptStorageClass.add_public_cb_property('set_record', '', null, false, false, []);
	// DevaptStorageClass.add_public_cb_property('remove_record', '', null, false, false, []);
	// DevaptStorageClass.add_public_cb_property('add_record', '', null, false, false, []);
		// READ/WRITE OPERATIONS
	// DevaptStorageClass.add_public_cb_property('encode', '', null, false, false, []);
	// DevaptStorageClass.add_public_cb_property('decode', '', null, false, false, []);
	
	
	return DevaptStorageClass;
} );
/**
 * @file        datas/storage/storage-json.js
 * @desc        Devapt JSON storage engine
 *                  ->is_valid()              : boolean
 *                  ->read_all_records()      : promise of a ResultSet
 *                  ->read_all_records_self() : promise of a ResultSet (internal method)
 *                  ->read_records(query)     : promise of a ResultSet
 *                  ->read_records_self(query): promise of a ResultSet (internal method)
 *                  ->create_records(records) : promise of a ResultSet
 *                  ->update_records(records) : promise of a ResultSet
 *                  ->delete_records(records) : promise of a ResultSet
 * 
 * @ingroup     DEVAPT_DATAS
 * @date        2014-08-12
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('datas/storage/storage-json',['Devapt', 'core/types', 'object/class', 'datas/storage/storage', 'datas/storage/resultset'],
function(Devapt, DevaptTypes, DevaptClass, DevaptStorage, DevaptResultSet)
{
	/**
	 * @public
	 * @class				DevaptJsonStorage
	 * @desc				JSON storage engine class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptJsonStorage
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// DEBUG
		// self.trace=true;
		
		// CONSTRUCTOR BEGIN
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// STORAGE ATTRIBUTES
		self.is_sync = false;
		self.is_remote_storage = true;
		self.is_local_storage = false;
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	/**
	 * @memberof				DevaptJsonStorage
	 * @public
	 * @method					DevaptJsonStorage.is_valid()
	 * @desc					Test if the storage engine is valid
	 * @return {boolean}		Is valid ?
	 */
	var cb_is_valid = function()
	{
		// TODO
		return true;
	};
	
	
	
	/**
	 * @memberof				DevaptJsonStorage
	 * @public
	 * @method					DevaptJsonStorage.read_all_records()
	 * 
	 * 		USE:
	 * 			require(['datas/storage-json'],
	 * 				function(DevaptJsonStorage)
	 * 				{
	 * 					var store_opts = {
	 * 						url_read:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_create:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_update:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_delete:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/'
	 * 					};
	 * 					var store = new DevaptJsonStorage('store', store_opts);
	 * 					store.read_all_records().then( function(result) { console.log(result, 'result'); } );
	 * 				}
	 * 			);
	 * 
	 * @desc					Read all records along storage strategy
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_read_all_records_self = function ()
	{
		var self = this;
		// self.trace=true;
		var context = 'read_all_records_self()';
		self.enter(context, '');
		
		
		try
		{
			// INIT URL AND DATAS
			var url = self.url_read;
			var json_datas = {};
			var token = Devapt.app.get_security_token();
			
			// INIT REQUEST SETTINGS
			var ajax_settings = {
				contentType	: self.http_format + '; charset=' + self.http_charset,
				dataType	: self.http_data_type,
				async		: ! self.is_sync,
				cache		: self.is_cached,
				timeout		: self.http_timeout
			};
			var method = (! self.http_method_read || self.is_cached) ? 'GET' : self.http_method_read;
			self.value(context, 'method', method);
			
			// SEND REQUEST
			var ajax_promise = Devapt.ajax(method, url, JSON.stringify(json_datas), ajax_settings, token);
			
			// ON SUCCESS
			if (self.notify_read)
			{
				ajax_promise.then(
					function(result)
					{
						// console.log(result, 'storage-json.result');
						Devapt.get_current_backend().notify_info('storage json: read all is done for [' + self.name + ']');
					}
				);
			}
			
			
			// ON FAILURE
			ajax_promise.fail(
				function(result)
				{
					// console.log(result, 'storage-json.result');
					
					self.cached_queries[query_key] = null;
					delete self.cached_queries[query_key];
					
					Devapt.get_current_backend().notify_error('storage json: read all has failed for [' + self.name + ']');
				}
			);
			
			// RETURN A RESULT SET
			var resultset_promise = ajax_promise.then(
				function(result)
				{
					return DevaptResultSet.create(self.name + '_result_read_all', result);
				}
			);
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		self.leave(context, Devapt.msg_success_promise);
		return resultset_promise;
	};
	
	
	
	/**
	 * @memberof				DevaptJsonStorage
	 * @public
	 * @method					DevaptJsonStorage.read_records(arg_query)
	 * @desc					Read records of the given query along storage strategy (async mode)
	 * 
	 * 		USE:
	 * 			require(['datas/storage-json'],
	 * 				function(DevaptJsonStorage)
	 * 				{
	 * 					var store_opts = {
	 * 						url_read:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_create:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_update:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_delete:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/'
	 * 					};
	 * 					var store = new DevaptJsonStorage('store', store_opts);
	 * 					var query = DevaptQuery.create('query_1', {...});
	 * 					store.read_records(query).then( function(result) { console.log(result, 'result'); } );
	 * 				}
	 * 			);
	 * 
	 * @param {object}			arg_query		Read query
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_read_records_self = function (arg_query)
	{
		var self = this;
		// self.trace=true;
		var context = 'read_records_self(query)';
		self.enter(context, '');
		// console.log(arg_query, 'jsonstorage.arg_query');
		
		
		try
		{
			// CREATE AJAX REQUEST
			var json_datas = arg_query ? arg_query.get_json() : null;
			var token = Devapt.app.get_security_token();
			
			var url = self.url_read;
			
			var ajax_settings = {
				contentType	: self.http_format + '; charset=' + self.http_charset,
				dataType	: self.http_data_type,
				async		: ! self.is_sync,
				cache		: self.is_cached,
				timeout		: self.http_timeout
			};
			var method = (! self.http_method_read || self.is_cached) ? 'GET' : self.http_method_read;
			var ajax_promise = Devapt.ajax(method, url, { query_json: JSON.stringify(json_datas['query_json'] ) }, ajax_settings, token);
			
			// ON SUCCESS
			if (self.notify_read)
			{
				ajax_promise.then(
					function(result)
					{
						// console.log(result, 'storage-json.result');
						
						Devapt.get_current_backend().notify_info('storage json: read query is done for [' + self.name + ']');
					}
				);
			}
			
			
			// ON FAILURE
			ajax_promise.fail(
				function(result)
				{
					// console.error(result, 'storage-json.result');
					var query_key = 'all';
					self.cached_queries[query_key] = null;
					delete self.cached_queries[query_key];
					
					Devapt.get_current_backend().notify_error('storage json: read query has failed for [' + self.name + ']');
				}
			);
			
			// RETURN A RESULT SET
			var resultset_promise = ajax_promise.then(
				function(result)
				{
					// console.log(result);
					return DevaptResultSet.create(self.name + '_result_read_' + arg_query.name, result);
				}
			);
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		self.leave(context, Devapt.msg_success_promise);
		return resultset_promise;
	};
	
	
	
	/**
	 * @memberof				DevaptJsonStorage
	 * @public
	 * @method					DevaptJsonStorage.create_records(arg_records)
	 * @desc					Create one or more records with the given values (async mode)
	 * 
	 * 		USE:
	 * 			require(['datas/storage-json'],
	 * 				function(DevaptJsonStorage)
	 * 				{
	 * 					var store_opts = {
	 * 						url_read:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_create:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_update:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_delete:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/'
	 * 					};
	 * 					var record = {"id_user":null,"login":"jcarter","lastname":"CARTER","firstname":"Jimmy","email":"jcarter@usa.us","password":"mypass"};
	 * 					var store = new DevaptJsonStorage('store', store_opts);
	 * 					store.create_records(record).then( function(result) { console.log(result, 'result'); } );
	 * 				}
	 * 			);
	 * 
	 * @param {object|array}	arg_records		Records of values
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_create_records = function (arg_records)
	{
		var self = this;
		var context = 'create_records(records)';
		self.enter(context, '');
		self.assert_not_empty_array(context, 'arg_records', arg_records);
		
		
		// INIT
		var fields_values = [];
		
		// LOOP ON ITEMS
		for(var record_index in arg_records)
		{
			var record = arg_records[record_index];
			
			// APPEND RECORD DATAS
			if ( DevaptTypes.is_object(record) && record.is_record )
			{
				fields_values.push(record.get_datas());
				continue;
			}
			
			// APPEND PLAIN OBJECT DATAS
			if ( DevaptTypes.is_plain_object(record) )
			{
				fields_values.push(record);
				continue;
			}
			
			// BAD DATAS
			self.value(context, 'record', record);
			self.error(context, 'bad datas: Record or plain object');
			self.leave(context, Devapt.msg_failure_promise);
			return Devapt.promise_rejected(record);
		}
		
		
		// CREATE AJAX REQUEST
		var json_query =
			{
				action: 'insert',
				query_type: 'insert',
				values: fields_values,
				values_count: fields_values.length
			};
		var token = Devapt.app.get_security_token();
		
		var url = self.url_create;
		var ajax_settings = {
			contentType	: self.http_format + '; charset=' + self.http_charset,
			dataType	: 'json',
			async		: ! self.is_sync,
			cache		: false,
			timeout		: self.http_timeout
		};
		var method = self.http_method_create;
		var ajax_datas = JSON.stringify( { query_json: json_query } );
		var ajax_promise = Devapt.ajax(method, url, ajax_datas, ajax_settings, token);
		
		// NOTIFY ON PROCESSED
		ajax_promise.done(
			function(result)
			{
				// console.log(result, 'storage-json.result');
				if (self.notify_create)
				{
					Devapt.get_current_backend().notify_info('storage json: create is done for [' + self.name + ']');
				}
				
				// Update cache of queries results
				self.touch_cached_records(arg_records, 'create');
			}
		);
		
		ajax_promise.fail(
			function(result)
			{
				// console.log(result, 'storage-json.result');
				Devapt.get_current_backend().notify_error('storage json: create has failed for [' + self.name + ']');
			}
		);
		
		// RETURN A RESULT SET
		var resultset_promise = ajax_promise.then(
			function(result)
			{
				return DevaptResultSet.create(self.name + '_result_create', result);
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return resultset_promise;
	};
	
	
	
	/**
	 * @memberof				DevaptJsonStorage
	 * @public
	 * @method					DevaptJsonStorage.update_records(arg_records)
	 * @desc					Update one or more records with the given values (async mode)
	 * 
	 * 		USE:
	 * 			require(['datas/storage-json'],
	 * 				function(DevaptJsonStorage)
	 * 				{
	 * 					var store_opts = {
	 * 						url_read:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_create:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_update:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_delete:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/'
	 * 					};
	 * 					var store = new DevaptJsonStorage('store', store_opts);
	 * 					var record = {"id_user":"31","password":"mypass2"};
	 * 					store.update_records(record).then( function(result) { console.log(result, 'result'); } );
	 * 				}
	 * 			);
	 * 
	 * @param {array}			arg_records		Records of values
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_update_records = function (arg_records)
	{
		var self = this;
		var context = 'update_records(records)';
		self.enter(context, '');
		self.assert_not_empty_array(context, 'arg_records', arg_records);
		
		
		// INIT
		var fields_values = [];
		
		// LOOP ON ITEMS
		for(var record_index in arg_records)
		{
			var record = arg_records[record_index];
			
			// APPEND RECORD DATAS
			if ( DevaptTypes.is_object(record) && record.is_record )
			{
				fields_values.push(record.get_datas());
				continue;
			}
			
			// APPEND PLAIN OBJECT DATAS
			if ( DevaptTypes.is_plain_object(record) )
			{
				fields_values.push(record);
				continue;
			}
			
			// BAD DATAS
			self.value(context, 'record', record);
			self.error(context, 'bad datas: Record or plain object');
			self.leave(context, Devapt.msg_failure_promise);
			return Devapt.promise_rejected(record);
		}
		
		
		// CREATE AJAX REQUEST
		var json_query =
		{
			action: 'update',
			query_type: 'update',
			values: fields_values,
			values_count: fields_values.length
		};
		var token = Devapt.app.get_security_token();
		
		var url = self.url_update;
		var ajax_settings = {
			contentType	: self.http_format + '; charset=' + self.http_charset,
			dataType	: 'json',
			async		: ! self.is_sync,
			cache		: false,
			timeout		: self.http_timeout
		};
		var method = self.http_method_update;
		var ajax_datas = JSON.stringify( { query_json: json_query } );
		var ajax_promise = Devapt.ajax(method, url, ajax_datas, ajax_settings, token);
		
		// NOTIFY ON PROCESSED
		ajax_promise.done(
			function(result)
			{
				// console.log(result, 'storage-json.result');
				if (self.notify_update)
				{
					Devapt.get_current_backend().notify_info('storage json: update is done for [' + self.name + ']');
				}
				
				// Update cache of queries results
				self.touch_cached_records(arg_records, 'update');
			}
		);
		
		ajax_promise.fail(
			function(result)
			{
				// console.log(result, 'storage-json.result');
				Devapt.get_current_backend().notify_error('storage json: update has failed for [' + self.name + ']');
			}
		);
		
		// RETURN A RESULT SET
		var resultset_promise = ajax_promise.then(
			function(result)
			{
				return DevaptResultSet.create(self.name + '_result_update', result);
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return resultset_promise;
	};
	
	
	
	/**
	 * @memberof				DevaptJsonStorage
	 * @public
	 * @method					DevaptJsonStorage.delete_records(arg_records)
	 * @desc					Delete one or more records with the given values (async mode)
	 * 
	 * 		USE:
	 * 			require(['datas/storage-json'],
	 * 				function(DevaptJsonStorage)
	 * 				{
	 * 					var store_opts = {
	 * 						url_read:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_create:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_update:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/',
	 * 						url_delete:'/devapt-tutorial-1/public/rest/MODEL_AUTH_USERS/'
	 * 					};
	 * 					var store = new DevaptJsonStorage('store', store_opts);
	 * 					var record = {"id_user":"31"};
	 * 					store.delete_records(record).then( function(result) { console.log(result, 'result'); } );
	 * 				}
	 * 			);
	 * 
	 * @param {array}			arg_records		Array of Records object
	 * @return {object}			A promise of a ResultSet
	 */
	var cb_delete_records = function (arg_records)
	{
		var self = this;
		var context = 'update_records(records)';
		self.enter(context, '');
		self.assert_not_empty_array(context, 'arg_records', arg_records);
		
		
		// INIT
		var id_field_name = null;
		var fields_names = [];
		var fields_values = [];
		
		// LOOP ON ITEMS
		for(var record_index in arg_records)
		{
			var record = arg_records[record_index];
			
			// CHECK RECORD
			if ( ! DevaptTypes.is_object(record) || ! record.is_record )
			{
				self.value(context, 'record', record);
				self.error(context, 'bad Reocrd object');
				self.leave(context, Devapt.msg_failure_promise);
				return Devapt.promise_rejected(record);
			}
			
			// SET ID FIELD NAME
			if (! id_field_name)
			{
				id_field_name = record.recordset.id_field_name;
				fields_names = [id_field_name];
			}
			
			// APPEND ID FIELD VALUE
			fields_values.push( record.get_id() );
		}
		
		
		// CREATE AJAX REQUEST
		var json_query =
		{
			action: 'delete',
			query_type: 'delete',
			fields: fields_names,
			values: fields_values,
			values_count: fields_values.length
		};
		var token = Devapt.app.get_security_token();
		
		var url = self.url_delete;
		var ajax_settings = {
			contentType	: self.http_format + '; charset=' + self.http_charset,
			dataType	: 'json',
			async		: ! self.is_sync,
			cache		: false,
			timeout		: self.http_timeout
		};
		var method = self.http_method_delete;
		var ajax_datas = JSON.stringify( { query_json: json_query } );
		var ajax_promise = Devapt.ajax(method, url, ajax_datas, ajax_settings, token);
		
		// NOTIFY ON PROCESSED
		ajax_promise.done(
			function(result)
			{
				// console.log(result, 'storage-json.result');
				if (self.notify_delete)
				{
					Devapt.get_current_backend().notify_info('storage json: delete is done');
				}
				
				// Update cache of queries results
				self.touch_cached_records(arg_records, 'delete');
			}
		);
		
		ajax_promise.fail(
			function(result)
			{
				// console.log(result, 'storage-json.result');
				Devapt.get_current_backend().notify_error('storage json: delete has failed');
			}
		);
		
		// RETURN A RESULT SET
		var resultset_promise = ajax_promise.then(
			function(result)
			{
				return DevaptResultSet.create(self.name + '_result_delete', result);
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return resultset_promise;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2014-08-12',
			updated:'2015-02-02',
			description:'JSON remote storage engine.'
		},
		properties:{
		}
	};
	var parent_class = DevaptStorage;
	var DevaptStorageClass = new DevaptClass('DevaptJsonStorage', parent_class, class_settings);
	
	// METHODS
	DevaptStorageClass.infos.ctor = cb_constructor;
	DevaptStorageClass.add_public_method('is_valid', {}, cb_is_valid);
	DevaptStorageClass.add_public_method('read_all_records_self', {}, cb_read_all_records_self);
	DevaptStorageClass.add_public_method('read_records_self', {}, cb_read_records_self);
	DevaptStorageClass.add_public_method('create_records', {}, cb_create_records);
	DevaptStorageClass.add_public_method('update_records', {}, cb_update_records);
	DevaptStorageClass.add_public_method('delete_records', {}, cb_delete_records);
	
	// MIXINS
	
	// PROPERTIES
	DevaptStorageClass.add_public_str_property('source', 'source of datas', null, true, true, []);
	
	DevaptStorageClass.add_public_str_property('url_create', 'url for create operation', null, true, true, []);
	DevaptStorageClass.add_public_str_property('url_read', 'url for create operation', null, true, true, []);
	DevaptStorageClass.add_public_str_property('url_update', 'url for create operation', null, true, true, []);
	DevaptStorageClass.add_public_str_property('url_delete', 'url for create operation', null, true, true, []);
	
	DevaptStorageClass.add_public_str_property('http_method_create', 'HTTP method for create operation', 'PUT', false, true, []);
	DevaptStorageClass.add_public_str_property('http_method_read', 'HTTP method for create operation', 'GET', false, true, []);
	DevaptStorageClass.add_public_str_property('http_method_update', 'HTTP method for create operation', 'POST', false, true, []);
	DevaptStorageClass.add_public_str_property('http_method_delete', 'HTTP method for create operation', 'DELETE', false, true, []);
	
	DevaptStorageClass.add_public_str_property('http_timeout', 'timeout of HTTP requests (milliseconds)', 5000, false, false, []);
	DevaptStorageClass.add_public_str_property('http_charset', 'charset of HTTP requests', 'utf-8', false, false, []);
	DevaptStorageClass.add_public_str_property('http_format', 'data result format of HTTP requests', 'application/x-www-form-urlencoded', false, false, []);
	DevaptStorageClass.add_public_str_property('http_data_type', 'data request type of HTTP requests', 'jsonp', false, false, []);
	DevaptStorageClass.add_public_str_property('http_data_name', 'data request type of HTTP requests', 'json_datas', false, false, []);
	
	
	return DevaptStorageClass;
} );
/**
 * @file        datas/storage/all.js
 * @desc        Load all Devapt datas classes
 * @ingroup     DEVAPT_DATAS
 * @date        2015-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
	'datas/storage/all',[
		'datas/storage/storage',
		'datas/storage/storage-array',
		'datas/storage/storage-json'
	],
	function()
	{
	}
);
/**
 * @file        datas/all.js
 * @desc        Load all Devapt datas classes
 * @ingroup     DEVAPT_DATAS
 * @date        2015-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
	'datas/all',[
		'datas/datasource/all',
		'datas/model/all',
		'datas/storage/all',
		'datas/field',
		'datas/query'
	],
	function()
	{
	}
);
/**
 * @file        object/factory.js
 * @desc        Devapt factory template
 * @ingroup     DEVAPT_OBJECT
 * @date        2015-01-29
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'object/factory',['Devapt', 'core/traces'],
function(Devapt, DevaptTraces)
{
	/**
	 * @memberof	DevaptFactory
	 * @public
	 * @class
	 * @desc		Devapt factory container
	 */
	var DevaptFactory = function() {};
	
	
	/**
	 * @memberof	DevaptFactory
	 * @public
	 * @static
	 * @desc		Trace flag
	 */
	DevaptFactory.factory_trace = false;
	
	
	
	/**
	 * @memberof				DevaptFactory
	 * @public
	 * @static
	 * @method					DevaptFactory.get_class_require(arg_class_name)
	 * @desc					Get resource dependencies
	 * @param {string}			arg_class_name		resource class name
	 * @param {string}			arg_backend_path	backend relative path
	 * @return {array}			array of require file paths
	 */
	DevaptFactory.get_class_require = function(arg_class_name, arg_backend_path)
	{
		var context = 'DevaptFactory.get_class_require(class name,path)';
		DevaptTraces.trace_enter(context, '', DevaptFactory.factory_trace);
		
		
		
		
		DevaptTraces.trace_leave(context, Devapt.msg_default_empty_implementation, DevaptFactory.factory_trace);
		return [];
	}
	
	
	return DevaptFactory;
} );
/**
 * @file        object/plugin.js
 * @desc        Base plugin class
 * @ingroup     DEVAPT_CORE
 * @date        2015-02-23
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'object/plugin',['Devapt', 'core/types', 'object/class', 'object/object'],
function(Devapt, DevaptTypes, DevaptClass, DevaptObject)
{
	/**
	 * @public
	 * @class				DevaptPlugin
	 * @desc				Plugin base class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptPlugin
	 * @desc				Has class dependancies ?
	 * @param {string}		arg_class_name	class name
	 * @return {boolean}
	 */
	var cb_has_class_depds = function(arg_class_name)
	{
		var self = this;
		var context = 'has_class_depds(class name)';
		self.enter(context, '');
		
		
		
		self.leave(context, Devapt.msg_default_implementation);
		return false;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPlugin
	 * @desc				Get plugin classes dependancies
	 * @param {string}		arg_class_name	class name
	 * @return {array}		Requires urls strings
	 */
	var cb_get_class_depds = function(arg_class_name)
	{
		var self = this;
		var context = 'get_class_depds(class name)';
		self.enter(context, '');
		
		
		
		self.leave(context, Devapt.msg_default_implementation);
		return null;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-02-23',
			'updated':'2015-02-23',
			'description':'Plugin features for Devapt applications.',
			'is_abstract':true
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptObject;
	var DevaptPluginClass = new DevaptClass('DevaptPlugin', parent_class, class_settings);
	
	// METHODS
	DevaptPluginClass.add_public_method('has_class_depds', {}, cb_has_class_depds);
	DevaptPluginClass.add_public_method('get_class_depds', {}, cb_get_class_depds);
	
	// PROPERTIES
	DevaptPluginClass.add_public_bool_property('is_plugin',	'flag to determine if current instance is a plugin',	true, false, true, []);
	
	
	return DevaptPluginClass;
} );
/**
 * @file        object/all.js
 * @desc        Load all Devapt object classes
 * @ingroup     DEVAPT_OBJECT
 * @date        2014-12-26
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'object/all',['object/class', 'object/classes', 'object/event', 'object/events', 'object/factory',
	'object/mixin-assertion', 'object/mixin-callback', 'object/mixin-event-listener', 'object/mixin-event-sender', 'object/mixin-trace',
	'object/object', 'object/object-base', 'object/plugin'],
function()
{
} );
/**
 * @file        plugins/plugins.js
 * @desc        Declare all available plugins urls
 * @ingroup     DEVAPT_CORE
 * @date        2015-02-28
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */

define(
	'plugins/plugins',['Devapt'],
	function(Devapt)
	{
		var cb = function()
		{
			var plugin_manager = Devapt.get_plugin_manager();
			
			plugin_manager.declare_plugin_url('foundation5', 'plugins/backend-foundation5/plugin');
			plugin_manager.declare_plugin_url('jquery-ui', 'plugins/backend-jquery-ui/plugin');
		};
		setTimeout(cb, 100);
		
		return ['foundation5', 'jquery-ui'];
	}
);
/*!
 * Modernizr v2.8.3
 * www.modernizr.com
 *
 * Copyright (c) Faruk Ates, Paul Irish, Alex Sexton
 * Available under the BSD and MIT licenses: www.modernizr.com/license/
 */
window.Modernizr=function(a,b,c){function d(a){t.cssText=a}function e(a,b){return d(x.join(a+";")+(b||""))}function f(a,b){return typeof a===b}function g(a,b){return!!~(""+a).indexOf(b)}function h(a,b){for(var d in a){var e=a[d];if(!g(e,"-")&&t[e]!==c)return"pfx"==b?e:!0}return!1}function i(a,b,d){for(var e in a){var g=b[a[e]];if(g!==c)return d===!1?a[e]:f(g,"function")?g.bind(d||b):g}return!1}function j(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+z.join(d+" ")+d).split(" ");return f(b,"string")||f(b,"undefined")?h(e,b):(e=(a+" "+A.join(d+" ")+d).split(" "),i(e,b,c))}function k(){o.input=function(c){for(var d=0,e=c.length;e>d;d++)E[c[d]]=!!(c[d]in u);return E.list&&(E.list=!(!b.createElement("datalist")||!a.HTMLDataListElement)),E}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),o.inputtypes=function(a){for(var d,e,f,g=0,h=a.length;h>g;g++)u.setAttribute("type",e=a[g]),d="text"!==u.type,d&&(u.value=v,u.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(e)&&u.style.WebkitAppearance!==c?(q.appendChild(u),f=b.defaultView,d=f.getComputedStyle&&"textfield"!==f.getComputedStyle(u,null).WebkitAppearance&&0!==u.offsetHeight,q.removeChild(u)):/^(search|tel)$/.test(e)||(d=/^(url|email)$/.test(e)?u.checkValidity&&u.checkValidity()===!1:u.value!=v)),D[a[g]]=!!d;return D}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var l,m,n="2.8.3",o={},p=!0,q=b.documentElement,r="modernizr",s=b.createElement(r),t=s.style,u=b.createElement("input"),v=":)",w={}.toString,x=" -webkit- -moz- -o- -ms- ".split(" "),y="Webkit Moz O ms",z=y.split(" "),A=y.toLowerCase().split(" "),B={svg:"http://www.w3.org/2000/svg"},C={},D={},E={},F=[],G=F.slice,H=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,l=k||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:r+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',r,'">',a,"</style>"].join(""),j.id=r,(k?j:l).innerHTML+=f,l.appendChild(j),k||(l.style.background="",l.style.overflow="hidden",i=q.style.overflow,q.style.overflow="hidden",q.appendChild(l)),g=c(j,a),k?j.parentNode.removeChild(j):(l.parentNode.removeChild(l),q.style.overflow=i),!!g},I=function(b){var c=a.matchMedia||a.msMatchMedia;if(c)return c(b)&&c(b).matches||!1;var d;return H("@media "+b+" { #"+r+" { position: absolute; } }",function(b){d="absolute"==(a.getComputedStyle?getComputedStyle(b,null):b.currentStyle).position}),d},J=function(){function a(a,e){e=e||b.createElement(d[a]||"div"),a="on"+a;var g=a in e;return g||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(a,""),g=f(e[a],"function"),f(e[a],"undefined")||(e[a]=c),e.removeAttribute(a))),e=null,g}var d={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return a}(),K={}.hasOwnProperty;m=f(K,"undefined")||f(K.call,"undefined")?function(a,b){return b in a&&f(a.constructor.prototype[b],"undefined")}:function(a,b){return K.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=G.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(G.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(G.call(arguments)))};return d}),C.flexbox=function(){return j("flexWrap")},C.flexboxlegacy=function(){return j("boxDirection")},C.canvas=function(){var a=b.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},C.canvastext=function(){return!(!o.canvas||!f(b.createElement("canvas").getContext("2d").fillText,"function"))},C.webgl=function(){return!!a.WebGLRenderingContext},C.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:H(["@media (",x.join("touch-enabled),("),r,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c},C.geolocation=function(){return"geolocation"in navigator},C.postmessage=function(){return!!a.postMessage},C.websqldatabase=function(){return!!a.openDatabase},C.indexedDB=function(){return!!j("indexedDB",a)},C.hashchange=function(){return J("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},C.history=function(){return!(!a.history||!history.pushState)},C.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},C.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},C.rgba=function(){return d("background-color:rgba(150,255,150,.5)"),g(t.backgroundColor,"rgba")},C.hsla=function(){return d("background-color:hsla(120,40%,100%,.5)"),g(t.backgroundColor,"rgba")||g(t.backgroundColor,"hsla")},C.multiplebgs=function(){return d("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(t.background)},C.backgroundsize=function(){return j("backgroundSize")},C.borderimage=function(){return j("borderImage")},C.borderradius=function(){return j("borderRadius")},C.boxshadow=function(){return j("boxShadow")},C.textshadow=function(){return""===b.createElement("div").style.textShadow},C.opacity=function(){return e("opacity:.55"),/^0.55$/.test(t.opacity)},C.cssanimations=function(){return j("animationName")},C.csscolumns=function(){return j("columnCount")},C.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return d((a+"-webkit- ".split(" ").join(b+a)+x.join(c+a)).slice(0,-a.length)),g(t.backgroundImage,"gradient")},C.cssreflections=function(){return j("boxReflect")},C.csstransforms=function(){return!!j("transform")},C.csstransforms3d=function(){var a=!!j("perspective");return a&&"webkitPerspective"in q.style&&H("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),a},C.csstransitions=function(){return j("transition")},C.fontface=function(){var a;return H('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&0===g.indexOf(d.split(" ")[0])}),a},C.generatedcontent=function(){var a;return H(["#",r,"{font:0/0 a}#",r,':after{content:"',v,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},C.video=function(){var a=b.createElement("video"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(d){}return c},C.audio=function(){var a=b.createElement("audio"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(d){}return c},C.localstorage=function(){try{return localStorage.setItem(r,r),localStorage.removeItem(r),!0}catch(a){return!1}},C.sessionstorage=function(){try{return sessionStorage.setItem(r,r),sessionStorage.removeItem(r),!0}catch(a){return!1}},C.webworkers=function(){return!!a.Worker},C.applicationcache=function(){return!!a.applicationCache},C.svg=function(){return!!b.createElementNS&&!!b.createElementNS(B.svg,"svg").createSVGRect},C.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==B.svg},C.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(w.call(b.createElementNS(B.svg,"animate")))},C.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(w.call(b.createElementNS(B.svg,"clipPath")))};for(var L in C)m(C,L)&&(l=L.toLowerCase(),o[l]=C[L](),F.push((o[l]?"":"no-")+l));return o.input||k(),o.addTest=function(a,b){if("object"==typeof a)for(var d in a)m(a,d)&&o.addTest(d,a[d]);else{if(a=a.toLowerCase(),o[a]!==c)return o;b="function"==typeof b?b():b,"undefined"!=typeof p&&p&&(q.className+=" "+(b?"":"no-")+a),o[a]=b}return o},d(""),s=u=null,function(a,b){function c(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function d(){var a=s.elements;return"string"==typeof a?a.split(" "):a}function e(a){var b=r[a[p]];return b||(b={},q++,a[p]=q,r[q]=b),b}function f(a,c,d){if(c||(c=b),k)return c.createElement(a);d||(d=e(c));var f;return f=d.cache[a]?d.cache[a].cloneNode():o.test(a)?(d.cache[a]=d.createElem(a)).cloneNode():d.createElem(a),!f.canHaveChildren||n.test(a)||f.tagUrn?f:d.frag.appendChild(f)}function g(a,c){if(a||(a=b),k)return a.createDocumentFragment();c=c||e(a);for(var f=c.frag.cloneNode(),g=0,h=d(),i=h.length;i>g;g++)f.createElement(h[g]);return f}function h(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return s.shivMethods?f(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+d().join().replace(/[\w\-]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(s,b.frag)}function i(a){a||(a=b);var d=e(a);return!s.shivCSS||j||d.hasCSS||(d.hasCSS=!!c(a,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),k||h(a,d),a}var j,k,l="3.7.0",m=a.html5||{},n=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,o=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,p="_html5shiv",q=0,r={};!function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",j="hidden"in a,k=1==a.childNodes.length||function(){b.createElement("a");var a=b.createDocumentFragment();return"undefined"==typeof a.cloneNode||"undefined"==typeof a.createDocumentFragment||"undefined"==typeof a.createElement}()}catch(c){j=!0,k=!0}}();var s={elements:m.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:l,shivCSS:m.shivCSS!==!1,supportsUnknownElements:k,shivMethods:m.shivMethods!==!1,type:"default",shivDocument:i,createElement:f,createDocumentFragment:g};a.html5=s,i(b)}(this,b),o._version=n,o._prefixes=x,o._domPrefixes=A,o._cssomPrefixes=z,o.mq=I,o.hasEvent=J,o.testProp=function(a){return h([a])},o.testAllProps=j,o.testStyles=H,o.prefixed=function(a,b,c){return b?j(a,b,c):j(a,"pfx")},q.className=q.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(p?" js "+F.join(" "):""),o}(this,this.document);

define("modernizr", function(){});

/*
 * Foundation Responsive Library
 * http://foundation.zurb.com
 * Copyright 2014, ZURB
 * Free to use under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
*/

(function ($, window, document, undefined) {
  'use strict';

  var header_helpers = function (class_array) {
    var i = class_array.length;
    var head = $('head');

    while (i--) {
      if (head.has('.' + class_array[i]).length === 0) {
        head.append('<meta class="' + class_array[i] + '" />');
      }
    }
  };

  header_helpers([
    'foundation-mq-small',
    'foundation-mq-small-only',
    'foundation-mq-medium',
    'foundation-mq-medium-only',
    'foundation-mq-large',
    'foundation-mq-large-only',
    'foundation-mq-xlarge',
    'foundation-mq-xlarge-only',
    'foundation-mq-xxlarge',
    'foundation-data-attribute-namespace']);

  // Enable FastClick if present

  $(function () {
    if (typeof FastClick !== 'undefined') {
      // Don't attach to body if undefined
      if (typeof document.body !== 'undefined') {
        FastClick.attach(document.body);
      }
    }
  });

  // private Fast Selector wrapper,
  // returns jQuery object. Only use where
  // getElementById is not available.
  var S = function (selector, context) {
    if (typeof selector === 'string') {
      if (context) {
        var cont;
        if (context.jquery) {
          cont = context[0];
          if (!cont) {
            return context;
          }
        } else {
          cont = context;
        }
        return $(cont.querySelectorAll(selector));
      }

      return $(document.querySelectorAll(selector));
    }

    return $(selector, context);
  };

  // Namespace functions.

  var attr_name = function (init) {
    var arr = [];
    if (!init) {
      arr.push('data');
    }
    if (this.namespace.length > 0) {
      arr.push(this.namespace);
    }
    arr.push(this.name);

    return arr.join('-');
  };

  var add_namespace = function (str) {
    var parts = str.split('-'),
        i = parts.length,
        arr = [];

    while (i--) {
      if (i !== 0) {
        arr.push(parts[i]);
      } else {
        if (this.namespace.length > 0) {
          arr.push(this.namespace, parts[i]);
        } else {
          arr.push(parts[i]);
        }
      }
    }

    return arr.reverse().join('-');
  };

  // Event binding and data-options updating.

  var bindings = function (method, options) {
    var self = this,
        bind = function(){
          var $this = S(this),
              should_bind_events = !$this.data(self.attr_name(true) + '-init');
          $this.data(self.attr_name(true) + '-init', $.extend({}, self.settings, (options || method), self.data_options($this)));

          if (should_bind_events) {
            self.events(this);
          }
        };

    if (S(this.scope).is('[' + this.attr_name() +']')) {
      bind.call(this.scope);
    } else {
      S('[' + this.attr_name() +']', this.scope).each(bind);
    }
    // # Patch to fix #5043 to move this *after* the if/else clause in order for Backbone and similar frameworks to have improved control over event binding and data-options updating.
    if (typeof method === 'string') {
      return this[method].call(this, options);
    }

  };

  var single_image_loaded = function (image, callback) {
    function loaded () {
      callback(image[0]);
    }

    function bindLoad () {
      this.one('load', loaded);

      if (/MSIE (\d+\.\d+);/.test(navigator.userAgent)) {
        var src = this.attr( 'src' ),
            param = src.match( /\?/ ) ? '&' : '?';

        param += 'random=' + (new Date()).getTime();
        this.attr('src', src + param);
      }
    }

    if (!image.attr('src')) {
      loaded();
      return;
    }

    if (image[0].complete || image[0].readyState === 4) {
      loaded();
    } else {
      bindLoad.call(image);
    }
  };

  /*
    https://github.com/paulirish/matchMedia.js
  */

  window.matchMedia = window.matchMedia || (function ( doc ) {

    'use strict';

    var bool,
        docElem = doc.documentElement,
        refNode = docElem.firstElementChild || docElem.firstChild,
        // fakeBody required for <FF4 when executed in <head>
        fakeBody = doc.createElement( 'body' ),
        div = doc.createElement( 'div' );

    div.id = 'mq-test-1';
    div.style.cssText = 'position:absolute;top:-100em';
    fakeBody.style.background = 'none';
    fakeBody.appendChild(div);

    return function (q) {

      div.innerHTML = '&shy;<style media="' + q + '"> #mq-test-1 { width: 42px; }</style>';

      docElem.insertBefore( fakeBody, refNode );
      bool = div.offsetWidth === 42;
      docElem.removeChild( fakeBody );

      return {
        matches : bool,
        media : q
      };

    };

  }( document ));

  /*
   * jquery.requestAnimationFrame
   * https://github.com/gnarf37/jquery-requestAnimationFrame
   * Requires jQuery 1.8+
   *
   * Copyright (c) 2012 Corey Frang
   * Licensed under the MIT license.
   */

  (function(jQuery) {


  // requestAnimationFrame polyfill adapted from Erik Mller
  // fixes from Paul Irish and Tino Zijdel
  // http://paulirish.com/2011/requestanimationframe-for-smart-animating/
  // http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating

  var animating,
      lastTime = 0,
      vendors = ['webkit', 'moz'],
      requestAnimationFrame = window.requestAnimationFrame,
      cancelAnimationFrame = window.cancelAnimationFrame,
      jqueryFxAvailable = 'undefined' !== typeof jQuery.fx;

  for (; lastTime < vendors.length && !requestAnimationFrame; lastTime++) {
    requestAnimationFrame = window[ vendors[lastTime] + 'RequestAnimationFrame' ];
    cancelAnimationFrame = cancelAnimationFrame ||
      window[ vendors[lastTime] + 'CancelAnimationFrame' ] ||
      window[ vendors[lastTime] + 'CancelRequestAnimationFrame' ];
  }

  function raf() {
    if (animating) {
      requestAnimationFrame(raf);

      if (jqueryFxAvailable) {
        jQuery.fx.tick();
      }
    }
  }

  if (requestAnimationFrame) {
    // use rAF
    window.requestAnimationFrame = requestAnimationFrame;
    window.cancelAnimationFrame = cancelAnimationFrame;

    if (jqueryFxAvailable) {
      jQuery.fx.timer = function (timer) {
        if (timer() && jQuery.timers.push(timer) && !animating) {
          animating = true;
          raf();
        }
      };

      jQuery.fx.stop = function () {
        animating = false;
      };
    }
  } else {
    // polyfill
    window.requestAnimationFrame = function (callback) {
      var currTime = new Date().getTime(),
        timeToCall = Math.max(0, 16 - (currTime - lastTime)),
        id = window.setTimeout(function () {
          callback(currTime + timeToCall);
        }, timeToCall);
      lastTime = currTime + timeToCall;
      return id;
    };

    window.cancelAnimationFrame = function (id) {
      clearTimeout(id);
    };

  }

  }( $ ));

  function removeQuotes (string) {
    if (typeof string === 'string' || string instanceof String) {
      string = string.replace(/^['\\/"]+|(;\s?})+|['\\/"]+$/g, '');
    }

    return string;
  }

  window.Foundation = {
    name : 'Foundation',

    version : '5.5.1',

    media_queries : {
      'small'       : S('.foundation-mq-small').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ''),
      'small-only'  : S('.foundation-mq-small-only').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ''),
      'medium'      : S('.foundation-mq-medium').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ''),
      'medium-only' : S('.foundation-mq-medium-only').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ''),
      'large'       : S('.foundation-mq-large').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ''),
      'large-only'  : S('.foundation-mq-large-only').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ''),
      'xlarge'      : S('.foundation-mq-xlarge').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ''),
      'xlarge-only' : S('.foundation-mq-xlarge-only').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ''),
      'xxlarge'     : S('.foundation-mq-xxlarge').css('font-family').replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, '')
    },

    stylesheet : $('<style></style>').appendTo('head')[0].sheet,

    global : {
      namespace : undefined
    },

    init : function (scope, libraries, method, options, response) {
      var args = [scope, method, options, response],
          responses = [];

      // check RTL
      this.rtl = /rtl/i.test(S('html').attr('dir'));

      // set foundation global scope
      this.scope = scope || this.scope;

      this.set_namespace();

      if (libraries && typeof libraries === 'string' && !/reflow/i.test(libraries)) {
        if (this.libs.hasOwnProperty(libraries)) {
          responses.push(this.init_lib(libraries, args));
        }
      } else {
        for (var lib in this.libs) {
          responses.push(this.init_lib(lib, libraries));
        }
      }

      S(window).load(function () {
        S(window)
          .trigger('resize.fndtn.clearing')
          .trigger('resize.fndtn.dropdown')
          .trigger('resize.fndtn.equalizer')
          .trigger('resize.fndtn.interchange')
          .trigger('resize.fndtn.joyride')
          .trigger('resize.fndtn.magellan')
          .trigger('resize.fndtn.topbar')
          .trigger('resize.fndtn.slider');
      });

      return scope;
    },

    init_lib : function (lib, args) {
      if (this.libs.hasOwnProperty(lib)) {
        this.patch(this.libs[lib]);

        if (args && args.hasOwnProperty(lib)) {
            if (typeof this.libs[lib].settings !== 'undefined') {
              $.extend(true, this.libs[lib].settings, args[lib]);
            } else if (typeof this.libs[lib].defaults !== 'undefined') {
              $.extend(true, this.libs[lib].defaults, args[lib]);
            }
          return this.libs[lib].init.apply(this.libs[lib], [this.scope, args[lib]]);
        }

        args = args instanceof Array ? args : new Array(args);
        return this.libs[lib].init.apply(this.libs[lib], args);
      }

      return function () {};
    },

    patch : function (lib) {
      lib.scope = this.scope;
      lib.namespace = this.global.namespace;
      lib.rtl = this.rtl;
      lib['data_options'] = this.utils.data_options;
      lib['attr_name'] = attr_name;
      lib['add_namespace'] = add_namespace;
      lib['bindings'] = bindings;
      lib['S'] = this.utils.S;
    },

    inherit : function (scope, methods) {
      var methods_arr = methods.split(' '),
          i = methods_arr.length;

      while (i--) {
        if (this.utils.hasOwnProperty(methods_arr[i])) {
          scope[methods_arr[i]] = this.utils[methods_arr[i]];
        }
      }
    },

    set_namespace : function () {

      // Description:
      //    Don't bother reading the namespace out of the meta tag
      //    if the namespace has been set globally in javascript
      //
      // Example:
      //    Foundation.global.namespace = 'my-namespace';
      // or make it an empty string:
      //    Foundation.global.namespace = '';
      //
      //

      // If the namespace has not been set (is undefined), try to read it out of the meta element.
      // Otherwise use the globally defined namespace, even if it's empty ('')
      var namespace = ( this.global.namespace === undefined ) ? $('.foundation-data-attribute-namespace').css('font-family') : this.global.namespace;

      // Finally, if the namsepace is either undefined or false, set it to an empty string.
      // Otherwise use the namespace value.
      this.global.namespace = ( namespace === undefined || /false/i.test(namespace) ) ? '' : namespace;
    },

    libs : {},

    // methods that can be inherited in libraries
    utils : {

      // Description:
      //    Fast Selector wrapper returns jQuery object. Only use where getElementById
      //    is not available.
      //
      // Arguments:
      //    Selector (String): CSS selector describing the element(s) to be
      //    returned as a jQuery object.
      //
      //    Scope (String): CSS selector describing the area to be searched. Default
      //    is document.
      //
      // Returns:
      //    Element (jQuery Object): jQuery object containing elements matching the
      //    selector within the scope.
      S : S,

      // Description:
      //    Executes a function a max of once every n milliseconds
      //
      // Arguments:
      //    Func (Function): Function to be throttled.
      //
      //    Delay (Integer): Function execution threshold in milliseconds.
      //
      // Returns:
      //    Lazy_function (Function): Function with throttling applied.
      throttle : function (func, delay) {
        var timer = null;

        return function () {
          var context = this, args = arguments;

          if (timer == null) {
            timer = setTimeout(function () {
              func.apply(context, args);
              timer = null;
            }, delay);
          }
        };
      },

      // Description:
      //    Executes a function when it stops being invoked for n seconds
      //    Modified version of _.debounce() http://underscorejs.org
      //
      // Arguments:
      //    Func (Function): Function to be debounced.
      //
      //    Delay (Integer): Function execution threshold in milliseconds.
      //
      //    Immediate (Bool): Whether the function should be called at the beginning
      //    of the delay instead of the end. Default is false.
      //
      // Returns:
      //    Lazy_function (Function): Function with debouncing applied.
      debounce : function (func, delay, immediate) {
        var timeout, result;
        return function () {
          var context = this, args = arguments;
          var later = function () {
            timeout = null;
            if (!immediate) {
              result = func.apply(context, args);
            }
          };
          var callNow = immediate && !timeout;
          clearTimeout(timeout);
          timeout = setTimeout(later, delay);
          if (callNow) {
            result = func.apply(context, args);
          }
          return result;
        };
      },

      // Description:
      //    Parses data-options attribute
      //
      // Arguments:
      //    El (jQuery Object): Element to be parsed.
      //
      // Returns:
      //    Options (Javascript Object): Contents of the element's data-options
      //    attribute.
      data_options : function (el, data_attr_name) {
        data_attr_name = data_attr_name || 'options';
        var opts = {}, ii, p, opts_arr,
            data_options = function (el) {
              var namespace = Foundation.global.namespace;

              if (namespace.length > 0) {
                return el.data(namespace + '-' + data_attr_name);
              }

              return el.data(data_attr_name);
            };

        var cached_options = data_options(el);

        if (typeof cached_options === 'object') {
          return cached_options;
        }

        opts_arr = (cached_options || ':').split(';');
        ii = opts_arr.length;

        function isNumber (o) {
          return !isNaN (o - 0) && o !== null && o !== '' && o !== false && o !== true;
        }

        function trim (str) {
          if (typeof str === 'string') {
            return $.trim(str);
          }
          return str;
        }

        while (ii--) {
          p = opts_arr[ii].split(':');
          p = [p[0], p.slice(1).join(':')];

          if (/true/i.test(p[1])) {
            p[1] = true;
          }
          if (/false/i.test(p[1])) {
            p[1] = false;
          }
          if (isNumber(p[1])) {
            if (p[1].indexOf('.') === -1) {
              p[1] = parseInt(p[1], 10);
            } else {
              p[1] = parseFloat(p[1]);
            }
          }

          if (p.length === 2 && p[0].length > 0) {
            opts[trim(p[0])] = trim(p[1]);
          }
        }

        return opts;
      },

      // Description:
      //    Adds JS-recognizable media queries
      //
      // Arguments:
      //    Media (String): Key string for the media query to be stored as in
      //    Foundation.media_queries
      //
      //    Class (String): Class name for the generated <meta> tag
      register_media : function (media, media_class) {
        if (Foundation.media_queries[media] === undefined) {
          $('head').append('<meta class="' + media_class + '"/>');
          Foundation.media_queries[media] = removeQuotes($('.' + media_class).css('font-family'));
        }
      },

      // Description:
      //    Add custom CSS within a JS-defined media query
      //
      // Arguments:
      //    Rule (String): CSS rule to be appended to the document.
      //
      //    Media (String): Optional media query string for the CSS rule to be
      //    nested under.
      add_custom_rule : function (rule, media) {
        if (media === undefined && Foundation.stylesheet) {
          Foundation.stylesheet.insertRule(rule, Foundation.stylesheet.cssRules.length);
        } else {
          var query = Foundation.media_queries[media];

          if (query !== undefined) {
            Foundation.stylesheet.insertRule('@media ' +
              Foundation.media_queries[media] + '{ ' + rule + ' }');
          }
        }
      },

      // Description:
      //    Performs a callback function when an image is fully loaded
      //
      // Arguments:
      //    Image (jQuery Object): Image(s) to check if loaded.
      //
      //    Callback (Function): Function to execute when image is fully loaded.
      image_loaded : function (images, callback) {
        var self = this,
            unloaded = images.length;

        if (unloaded === 0) {
          callback(images);
        }

        images.each(function () {
          single_image_loaded(self.S(this), function () {
            unloaded -= 1;
            if (unloaded === 0) {
              callback(images);
            }
          });
        });
      },

      // Description:
      //    Returns a random, alphanumeric string
      //
      // Arguments:
      //    Length (Integer): Length of string to be generated. Defaults to random
      //    integer.
      //
      // Returns:
      //    Rand (String): Pseudo-random, alphanumeric string.
      random_str : function () {
        if (!this.fidx) {
          this.fidx = 0;
        }
        this.prefix = this.prefix || [(this.name || 'F'), (+new Date).toString(36)].join('-');

        return this.prefix + (this.fidx++).toString(36);
      },

      // Description:
      //    Helper for window.matchMedia
      //
      // Arguments:
      //    mq (String): Media query
      //
      // Returns:
      //    (Boolean): Whether the media query passes or not
      match : function (mq) {
        return window.matchMedia(mq).matches;
      },

      // Description:
      //    Helpers for checking Foundation default media queries with JS
      //
      // Returns:
      //    (Boolean): Whether the media query passes or not

      is_small_up : function () {
        return this.match(Foundation.media_queries.small);
      },

      is_medium_up : function () {
        return this.match(Foundation.media_queries.medium);
      },

      is_large_up : function () {
        return this.match(Foundation.media_queries.large);
      },

      is_xlarge_up : function () {
        return this.match(Foundation.media_queries.xlarge);
      },

      is_xxlarge_up : function () {
        return this.match(Foundation.media_queries.xxlarge);
      },

      is_small_only : function () {
        return !this.is_medium_up() && !this.is_large_up() && !this.is_xlarge_up() && !this.is_xxlarge_up();
      },

      is_medium_only : function () {
        return this.is_medium_up() && !this.is_large_up() && !this.is_xlarge_up() && !this.is_xxlarge_up();
      },

      is_large_only : function () {
        return this.is_medium_up() && this.is_large_up() && !this.is_xlarge_up() && !this.is_xxlarge_up();
      },

      is_xlarge_only : function () {
        return this.is_medium_up() && this.is_large_up() && this.is_xlarge_up() && !this.is_xxlarge_up();
      },

      is_xxlarge_only : function () {
        return this.is_medium_up() && this.is_large_up() && this.is_xlarge_up() && this.is_xxlarge_up();
      }
    }
  };

  $.fn.foundation = function () {
    var args = Array.prototype.slice.call(arguments, 0);

    return this.each(function () {
      Foundation.init.apply(Foundation, [this].concat(args));
      return this;
    });
  };

}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.slider = {
    name : 'slider',

    version : '5.5.1',

    settings : {
      start : 0,
      end : 100,
      step : 1,
      precision : null,
      initial : null,
      display_selector : '',
      vertical : false,
      trigger_input_change : false,
      on_change : function () {}
    },

    cache : {},

    init : function (scope, method, options) {
      Foundation.inherit(this, 'throttle');
      this.bindings(method, options);
      this.reflow();
    },

    events : function () {
      var self = this;

      $(this.scope)
        .off('.slider')
        .on('mousedown.fndtn.slider touchstart.fndtn.slider pointerdown.fndtn.slider',
        '[' + self.attr_name() + ']:not(.disabled, [disabled]) .range-slider-handle', function (e) {
          if (!self.cache.active) {
            e.preventDefault();
            self.set_active_slider($(e.target));
          }
        })
        .on('mousemove.fndtn.slider touchmove.fndtn.slider pointermove.fndtn.slider', function (e) {
          if (!!self.cache.active) {
            e.preventDefault();
            if ($.data(self.cache.active[0], 'settings').vertical) {
              var scroll_offset = 0;
              if (!e.pageY) {
                scroll_offset = window.scrollY;
              }
              self.calculate_position(self.cache.active, self.get_cursor_position(e, 'y') + scroll_offset);
            } else {
              self.calculate_position(self.cache.active, self.get_cursor_position(e, 'x'));
            }
          }
        })
        .on('mouseup.fndtn.slider touchend.fndtn.slider pointerup.fndtn.slider', function (e) {
          self.remove_active_slider();
        })
        .on('change.fndtn.slider', function (e) {
          self.settings.on_change();
        });

      self.S(window)
        .on('resize.fndtn.slider', self.throttle(function (e) {
          self.reflow();
        }, 300));
    },

    get_cursor_position : function (e, xy) {
      var pageXY = 'page' + xy.toUpperCase(),
          clientXY = 'client' + xy.toUpperCase(),
          position;

      if (typeof e[pageXY] !== 'undefined') {
        position = e[pageXY];
      } else if (typeof e.originalEvent[clientXY] !== 'undefined') {
        position = e.originalEvent[clientXY];
      } else if (e.originalEvent.touches && e.originalEvent.touches[0] && typeof e.originalEvent.touches[0][clientXY] !== 'undefined') {
        position = e.originalEvent.touches[0][clientXY];
      } else if (e.currentPoint && typeof e.currentPoint[xy] !== 'undefined') {
        position = e.currentPoint[xy];
      }

      return position;
    },

    set_active_slider : function ($handle) {
      this.cache.active = $handle;
    },

    remove_active_slider : function () {
      this.cache.active = null;
    },

    calculate_position : function ($handle, cursor_x) {
      var self = this,
          settings = $.data($handle[0], 'settings'),
          handle_l = $.data($handle[0], 'handle_l'),
          handle_o = $.data($handle[0], 'handle_o'),
          bar_l = $.data($handle[0], 'bar_l'),
          bar_o = $.data($handle[0], 'bar_o');

      requestAnimationFrame(function () {
        var pct;

        if (Foundation.rtl && !settings.vertical) {
          pct = self.limit_to(((bar_o + bar_l - cursor_x) / bar_l), 0, 1);
        } else {
          pct = self.limit_to(((cursor_x - bar_o) / bar_l), 0, 1);
        }

        pct = settings.vertical ? 1 - pct : pct;

        var norm = self.normalized_value(pct, settings.start, settings.end, settings.step, settings.precision);

        self.set_ui($handle, norm);
      });
    },

    set_ui : function ($handle, value) {
      var settings = $.data($handle[0], 'settings'),
          handle_l = $.data($handle[0], 'handle_l'),
          bar_l = $.data($handle[0], 'bar_l'),
          norm_pct = this.normalized_percentage(value, settings.start, settings.end),
          handle_offset = norm_pct * (bar_l - handle_l) - 1,
          progress_bar_length = norm_pct * 100,
          $handle_parent = $handle.parent(),
          $hidden_inputs = $handle.parent().children('input[type=hidden]');

      if (Foundation.rtl && !settings.vertical) {
        handle_offset = -handle_offset;
      }

      handle_offset = settings.vertical ? -handle_offset + bar_l - handle_l + 1 : handle_offset;
      this.set_translate($handle, handle_offset, settings.vertical);

      if (settings.vertical) {
        $handle.siblings('.range-slider-active-segment').css('height', progress_bar_length + '%');
      } else {
        $handle.siblings('.range-slider-active-segment').css('width', progress_bar_length + '%');
      }

      $handle_parent.attr(this.attr_name(), value).trigger('change').trigger('change.fndtn.slider');

      $hidden_inputs.val(value);
      if (settings.trigger_input_change) {
          $hidden_inputs.trigger('change');
      }

      if (!$handle[0].hasAttribute('aria-valuemin')) {
        $handle.attr({
          'aria-valuemin' : settings.start,
          'aria-valuemax' : settings.end
        });
      }
      $handle.attr('aria-valuenow', value);

      if (settings.display_selector != '') {
        $(settings.display_selector).each(function () {
          if (this.hasOwnProperty('value')) {
            $(this).val(value);
          } else {
            $(this).text(value);
          }
        });
      }

    },

    normalized_percentage : function (val, start, end) {
      return Math.min(1, (val - start) / (end - start));
    },

    normalized_value : function (val, start, end, step, precision) {
      var range = end - start,
          point = val * range,
          mod = (point - (point % step)) / step,
          rem = point % step,
          round = ( rem >= step * 0.5 ? step : 0);
      return ((mod * step + round) + start).toFixed(precision);
    },

    set_translate : function (ele, offset, vertical) {
      if (vertical) {
        $(ele)
          .css('-webkit-transform', 'translateY(' + offset + 'px)')
          .css('-moz-transform', 'translateY(' + offset + 'px)')
          .css('-ms-transform', 'translateY(' + offset + 'px)')
          .css('-o-transform', 'translateY(' + offset + 'px)')
          .css('transform', 'translateY(' + offset + 'px)');
      } else {
        $(ele)
          .css('-webkit-transform', 'translateX(' + offset + 'px)')
          .css('-moz-transform', 'translateX(' + offset + 'px)')
          .css('-ms-transform', 'translateX(' + offset + 'px)')
          .css('-o-transform', 'translateX(' + offset + 'px)')
          .css('transform', 'translateX(' + offset + 'px)');
      }
    },

    limit_to : function (val, min, max) {
      return Math.min(Math.max(val, min), max);
    },

    initialize_settings : function (handle) {
      var settings = $.extend({}, this.settings, this.data_options($(handle).parent())),
          decimal_places_match_result;

      if (settings.precision === null) {
        decimal_places_match_result = ('' + settings.step).match(/\.([\d]*)/);
        settings.precision = decimal_places_match_result && decimal_places_match_result[1] ? decimal_places_match_result[1].length : 0;
      }

      if (settings.vertical) {
        $.data(handle, 'bar_o', $(handle).parent().offset().top);
        $.data(handle, 'bar_l', $(handle).parent().outerHeight());
        $.data(handle, 'handle_o', $(handle).offset().top);
        $.data(handle, 'handle_l', $(handle).outerHeight());
      } else {
        $.data(handle, 'bar_o', $(handle).parent().offset().left);
        $.data(handle, 'bar_l', $(handle).parent().outerWidth());
        $.data(handle, 'handle_o', $(handle).offset().left);
        $.data(handle, 'handle_l', $(handle).outerWidth());
      }

      $.data(handle, 'bar', $(handle).parent());
      $.data(handle, 'settings', settings);
    },

    set_initial_position : function ($ele) {
      var settings = $.data($ele.children('.range-slider-handle')[0], 'settings'),
          initial = ((typeof settings.initial == 'number' && !isNaN(settings.initial)) ? settings.initial : Math.floor((settings.end - settings.start) * 0.5 / settings.step) * settings.step + settings.start),
          $handle = $ele.children('.range-slider-handle');
      this.set_ui($handle, initial);
    },

    set_value : function (value) {
      var self = this;
      $('[' + self.attr_name() + ']', this.scope).each(function () {
        $(this).attr(self.attr_name(), value);
      });
      if (!!$(this.scope).attr(self.attr_name())) {
        $(this.scope).attr(self.attr_name(), value);
      }
      self.reflow();
    },

    reflow : function () {
      var self = this;
      self.S('[' + this.attr_name() + ']').each(function () {
        var handle = $(this).children('.range-slider-handle')[0],
            val = $(this).attr(self.attr_name());
        self.initialize_settings(handle);

        if (val) {
          self.set_ui($(handle), parseFloat(val));
        } else {
          self.set_initial_position($(this));
        }
      });
    }
  };

}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  var Modernizr = Modernizr || false;

  Foundation.libs.joyride = {
    name : 'joyride',

    version : '5.5.1',

    defaults : {
      expose                   : false,     // turn on or off the expose feature
      modal                    : true,      // Whether to cover page with modal during the tour
      keyboard                 : true,      // enable left, right and esc keystrokes
      tip_location             : 'bottom',  // 'top' or 'bottom' in relation to parent
      nub_position             : 'auto',    // override on a per tooltip bases
      scroll_speed             : 1500,      // Page scrolling speed in milliseconds, 0 = no scroll animation
      scroll_animation         : 'linear',  // supports 'swing' and 'linear', extend with jQuery UI.
      timer                    : 0,         // 0 = no timer , all other numbers = timer in milliseconds
      start_timer_on_click     : true,      // true or false - true requires clicking the first button start the timer
      start_offset             : 0,         // the index of the tooltip you want to start on (index of the li)
      next_button              : true,      // true or false to control whether a next button is used
      prev_button              : true,      // true or false to control whether a prev button is used
      tip_animation            : 'fade',    // 'pop' or 'fade' in each tip
      pause_after              : [],        // array of indexes where to pause the tour after
      exposed                  : [],        // array of expose elements
      tip_animation_fade_speed : 300,       // when tipAnimation = 'fade' this is speed in milliseconds for the transition
      cookie_monster           : false,     // true or false to control whether cookies are used
      cookie_name              : 'joyride', // Name the cookie you'll use
      cookie_domain            : false,     // Will this cookie be attached to a domain, ie. '.notableapp.com'
      cookie_expires           : 365,       // set when you would like the cookie to expire.
      tip_container            : 'body',    // Where will the tip be attached
      abort_on_close           : true,      // When true, the close event will not fire any callback
      tip_location_patterns    : {
        top : ['bottom'],
        bottom : [], // bottom should not need to be repositioned
        left : ['right', 'top', 'bottom'],
        right : ['left', 'top', 'bottom']
      },
      post_ride_callback     : function () {},    // A method to call once the tour closes (canceled or complete)
      post_step_callback     : function () {},    // A method to call after each step
      pre_step_callback      : function () {},    // A method to call before each step
      pre_ride_callback      : function () {},    // A method to call before the tour starts (passed index, tip, and cloned exposed element)
      post_expose_callback   : function () {},    // A method to call after an element has been exposed
      template : { // HTML segments for tip layout
        link          : '<a href="#close" class="joyride-close-tip">&times;</a>',
        timer         : '<div class="joyride-timer-indicator-wrap"><span class="joyride-timer-indicator"></span></div>',
        tip           : '<div class="joyride-tip-guide"><span class="joyride-nub"></span></div>',
        wrapper       : '<div class="joyride-content-wrapper"></div>',
        button        : '<a href="#" class="small button joyride-next-tip"></a>',
        prev_button   : '<a href="#" class="small button joyride-prev-tip"></a>',
        modal         : '<div class="joyride-modal-bg"></div>',
        expose        : '<div class="joyride-expose-wrapper"></div>',
        expose_cover  : '<div class="joyride-expose-cover"></div>'
      },
      expose_add_class : '' // One or more space-separated class names to be added to exposed element
    },

    init : function (scope, method, options) {
      Foundation.inherit(this, 'throttle random_str');

      this.settings = this.settings || $.extend({}, this.defaults, (options || method));

      this.bindings(method, options)
    },

    go_next : function () {
      if (this.settings.$li.next().length < 1) {
        this.end();
      } else if (this.settings.timer > 0) {
        clearTimeout(this.settings.automate);
        this.hide();
        this.show();
        this.startTimer();
      } else {
        this.hide();
        this.show();
      }
    },

    go_prev : function () {
      if (this.settings.$li.prev().length < 1) {
        // Do nothing if there are no prev element
      } else if (this.settings.timer > 0) {
        clearTimeout(this.settings.automate);
        this.hide();
        this.show(null, true);
        this.startTimer();
      } else {
        this.hide();
        this.show(null, true);
      }
    },

    events : function () {
      var self = this;

      $(this.scope)
        .off('.joyride')
        .on('click.fndtn.joyride', '.joyride-next-tip, .joyride-modal-bg', function (e) {
          e.preventDefault();
          this.go_next()
        }.bind(this))
        .on('click.fndtn.joyride', '.joyride-prev-tip', function (e) {
          e.preventDefault();
          this.go_prev();
        }.bind(this))

        .on('click.fndtn.joyride', '.joyride-close-tip', function (e) {
          e.preventDefault();
          this.end(this.settings.abort_on_close);
        }.bind(this))

        .on('keyup.fndtn.joyride', function (e) {
          // Don't do anything if keystrokes are disabled
          // or if the joyride is not being shown
          if (!this.settings.keyboard || !this.settings.riding) {
            return;
          }

          switch (e.which) {
            case 39: // right arrow
              e.preventDefault();
              this.go_next();
              break;
            case 37: // left arrow
              e.preventDefault();
              this.go_prev();
              break;
            case 27: // escape
              e.preventDefault();
              this.end(this.settings.abort_on_close);
          }
        }.bind(this));

      $(window)
        .off('.joyride')
        .on('resize.fndtn.joyride', self.throttle(function () {
          if ($('[' + self.attr_name() + ']').length > 0 && self.settings.$next_tip && self.settings.riding) {
            if (self.settings.exposed.length > 0) {
              var $els = $(self.settings.exposed);

              $els.each(function () {
                var $this = $(this);
                self.un_expose($this);
                self.expose($this);
              });
            }

            if (self.is_phone()) {
              self.pos_phone();
            } else {
              self.pos_default(false);
            }
          }
        }, 100));
    },

    start : function () {
      var self = this,
          $this = $('[' + this.attr_name() + ']', this.scope),
          integer_settings = ['timer', 'scrollSpeed', 'startOffset', 'tipAnimationFadeSpeed', 'cookieExpires'],
          int_settings_count = integer_settings.length;

      if (!$this.length > 0) {
        return;
      }

      if (!this.settings.init) {
        this.events();
      }

      this.settings = $this.data(this.attr_name(true) + '-init');

      // non configureable settings
      this.settings.$content_el = $this;
      this.settings.$body = $(this.settings.tip_container);
      this.settings.body_offset = $(this.settings.tip_container).position();
      this.settings.$tip_content = this.settings.$content_el.find('> li');
      this.settings.paused = false;
      this.settings.attempts = 0;
      this.settings.riding = true;

      // can we create cookies?
      if (typeof $.cookie !== 'function') {
        this.settings.cookie_monster = false;
      }

      // generate the tips and insert into dom.
      if (!this.settings.cookie_monster || this.settings.cookie_monster && !$.cookie(this.settings.cookie_name)) {
        this.settings.$tip_content.each(function (index) {
          var $this = $(this);
          this.settings = $.extend({}, self.defaults, self.data_options($this));

          // Make sure that settings parsed from data_options are integers where necessary
          var i = int_settings_count;
          while (i--) {
            self.settings[integer_settings[i]] = parseInt(self.settings[integer_settings[i]], 10);
          }
          self.create({$li : $this, index : index});
        });

        // show first tip
        if (!this.settings.start_timer_on_click && this.settings.timer > 0) {
          this.show('init');
          this.startTimer();
        } else {
          this.show('init');
        }

      }
    },

    resume : function () {
      this.set_li();
      this.show();
    },

    tip_template : function (opts) {
      var $blank, content;

      opts.tip_class = opts.tip_class || '';

      $blank = $(this.settings.template.tip).addClass(opts.tip_class);
      content = $.trim($(opts.li).html()) +
        this.prev_button_text(opts.prev_button_text, opts.index) +
        this.button_text(opts.button_text) +
        this.settings.template.link +
        this.timer_instance(opts.index);

      $blank.append($(this.settings.template.wrapper));
      $blank.first().attr(this.add_namespace('data-index'), opts.index);
      $('.joyride-content-wrapper', $blank).append(content);

      return $blank[0];
    },

    timer_instance : function (index) {
      var txt;

      if ((index === 0 && this.settings.start_timer_on_click && this.settings.timer > 0) || this.settings.timer === 0) {
        txt = '';
      } else {
        txt = $(this.settings.template.timer)[0].outerHTML;
      }
      return txt;
    },

    button_text : function (txt) {
      if (this.settings.tip_settings.next_button) {
        txt = $.trim(txt) || 'Next';
        txt = $(this.settings.template.button).append(txt)[0].outerHTML;
      } else {
        txt = '';
      }
      return txt;
    },

    prev_button_text : function (txt, idx) {
      if (this.settings.tip_settings.prev_button) {
        txt = $.trim(txt) || 'Previous';

        // Add the disabled class to the button if it's the first element
        if (idx == 0) {
          txt = $(this.settings.template.prev_button).append(txt).addClass('disabled')[0].outerHTML;
        } else {
          txt = $(this.settings.template.prev_button).append(txt)[0].outerHTML;
        }
      } else {
        txt = '';
      }
      return txt;
    },

    create : function (opts) {
      this.settings.tip_settings = $.extend({}, this.settings, this.data_options(opts.$li));
      var buttonText = opts.$li.attr(this.add_namespace('data-button')) || opts.$li.attr(this.add_namespace('data-text')),
          prevButtonText = opts.$li.attr(this.add_namespace('data-button-prev')) || opts.$li.attr(this.add_namespace('data-prev-text')),
        tipClass = opts.$li.attr('class'),
        $tip_content = $(this.tip_template({
          tip_class : tipClass,
          index : opts.index,
          button_text : buttonText,
          prev_button_text : prevButtonText,
          li : opts.$li
        }));

      $(this.settings.tip_container).append($tip_content);
    },

    show : function (init, is_prev) {
      var $timer = null;

      // are we paused?
      if (this.settings.$li === undefined || ($.inArray(this.settings.$li.index(), this.settings.pause_after) === -1)) {

        // don't go to the next li if the tour was paused
        if (this.settings.paused) {
          this.settings.paused = false;
        } else {
          this.set_li(init, is_prev);
        }

        this.settings.attempts = 0;

        if (this.settings.$li.length && this.settings.$target.length > 0) {
          if (init) { //run when we first start
            this.settings.pre_ride_callback(this.settings.$li.index(), this.settings.$next_tip);
            if (this.settings.modal) {
              this.show_modal();
            }
          }

          this.settings.pre_step_callback(this.settings.$li.index(), this.settings.$next_tip);

          if (this.settings.modal && this.settings.expose) {
            this.expose();
          }

          this.settings.tip_settings = $.extend({}, this.settings, this.data_options(this.settings.$li));

          this.settings.timer = parseInt(this.settings.timer, 10);

          this.settings.tip_settings.tip_location_pattern = this.settings.tip_location_patterns[this.settings.tip_settings.tip_location];

          // scroll and hide bg if not modal
          if (!/body/i.test(this.settings.$target.selector)) {
            var joyridemodalbg = $('.joyride-modal-bg');
            if (/pop/i.test(this.settings.tipAnimation)) {
                joyridemodalbg.hide();
            } else {
                joyridemodalbg.fadeOut(this.settings.tipAnimationFadeSpeed);
            }
            this.scroll_to();
          }

          if (this.is_phone()) {
            this.pos_phone(true);
          } else {
            this.pos_default(true);
          }

          $timer = this.settings.$next_tip.find('.joyride-timer-indicator');

          if (/pop/i.test(this.settings.tip_animation)) {

            $timer.width(0);

            if (this.settings.timer > 0) {

              this.settings.$next_tip.show();

              setTimeout(function () {
                $timer.animate({
                  width : $timer.parent().width()
                }, this.settings.timer, 'linear');
              }.bind(this), this.settings.tip_animation_fade_speed);

            } else {
              this.settings.$next_tip.show();

            }

          } else if (/fade/i.test(this.settings.tip_animation)) {

            $timer.width(0);

            if (this.settings.timer > 0) {

              this.settings.$next_tip
                .fadeIn(this.settings.tip_animation_fade_speed)
                .show();

              setTimeout(function () {
                $timer.animate({
                  width : $timer.parent().width()
                }, this.settings.timer, 'linear');
              }.bind(this), this.settings.tip_animation_fade_speed);

            } else {
              this.settings.$next_tip.fadeIn(this.settings.tip_animation_fade_speed);
            }
          }

          this.settings.$current_tip = this.settings.$next_tip;

        // skip non-existant targets
        } else if (this.settings.$li && this.settings.$target.length < 1) {

          this.show(init, is_prev);

        } else {

          this.end();

        }
      } else {

        this.settings.paused = true;

      }

    },

    is_phone : function () {
      return matchMedia(Foundation.media_queries.small).matches &&
        !matchMedia(Foundation.media_queries.medium).matches;
    },

    hide : function () {
      if (this.settings.modal && this.settings.expose) {
        this.un_expose();
      }

      if (!this.settings.modal) {
        $('.joyride-modal-bg').hide();
      }

      // Prevent scroll bouncing...wait to remove from layout
      this.settings.$current_tip.css('visibility', 'hidden');
      setTimeout($.proxy(function () {
        this.hide();
        this.css('visibility', 'visible');
      }, this.settings.$current_tip), 0);
      this.settings.post_step_callback(this.settings.$li.index(),
        this.settings.$current_tip);
    },

    set_li : function (init, is_prev) {
      if (init) {
        this.settings.$li = this.settings.$tip_content.eq(this.settings.start_offset);
        this.set_next_tip();
        this.settings.$current_tip = this.settings.$next_tip;
      } else {
        if (is_prev) {
          this.settings.$li = this.settings.$li.prev();
        } else {
          this.settings.$li = this.settings.$li.next();
        }
        this.set_next_tip();
      }

      this.set_target();
    },

    set_next_tip : function () {
      this.settings.$next_tip = $('.joyride-tip-guide').eq(this.settings.$li.index());
      this.settings.$next_tip.data('closed', '');
    },

    set_target : function () {
      var cl = this.settings.$li.attr(this.add_namespace('data-class')),
          id = this.settings.$li.attr(this.add_namespace('data-id')),
          $sel = function () {
            if (id) {
              return $(document.getElementById(id));
            } else if (cl) {
              return $('.' + cl).first();
            } else {
              return $('body');
            }
          };

      this.settings.$target = $sel();
    },

    scroll_to : function () {
      var window_half, tipOffset;

      window_half = $(window).height() / 2;
      tipOffset = Math.ceil(this.settings.$target.offset().top - window_half + this.settings.$next_tip.outerHeight());

      if (tipOffset != 0) {
        $('html, body').stop().animate({
          scrollTop : tipOffset
        }, this.settings.scroll_speed, 'swing');
      }
    },

    paused : function () {
      return ($.inArray((this.settings.$li.index() + 1), this.settings.pause_after) === -1);
    },

    restart : function () {
      this.hide();
      this.settings.$li = undefined;
      this.show('init');
    },

    pos_default : function (init) {
      var $nub = this.settings.$next_tip.find('.joyride-nub'),
          nub_width = Math.ceil($nub.outerWidth() / 2),
          nub_height = Math.ceil($nub.outerHeight() / 2),
          toggle = init || false;

      // tip must not be "display: none" to calculate position
      if (toggle) {
        this.settings.$next_tip.css('visibility', 'hidden');
        this.settings.$next_tip.show();
      }

      if (!/body/i.test(this.settings.$target.selector)) {
          var topAdjustment = this.settings.tip_settings.tipAdjustmentY ? parseInt(this.settings.tip_settings.tipAdjustmentY) : 0,
              leftAdjustment = this.settings.tip_settings.tipAdjustmentX ? parseInt(this.settings.tip_settings.tipAdjustmentX) : 0;

          if (this.bottom()) {
            if (this.rtl) {
              this.settings.$next_tip.css({
                top : (this.settings.$target.offset().top + nub_height + this.settings.$target.outerHeight() + topAdjustment),
                left : this.settings.$target.offset().left + this.settings.$target.outerWidth() - this.settings.$next_tip.outerWidth() + leftAdjustment});
            } else {
              this.settings.$next_tip.css({
                top : (this.settings.$target.offset().top + nub_height + this.settings.$target.outerHeight() + topAdjustment),
                left : this.settings.$target.offset().left + leftAdjustment});
            }

            this.nub_position($nub, this.settings.tip_settings.nub_position, 'top');

          } else if (this.top()) {
            if (this.rtl) {
              this.settings.$next_tip.css({
                top : (this.settings.$target.offset().top - this.settings.$next_tip.outerHeight() - nub_height + topAdjustment),
                left : this.settings.$target.offset().left + this.settings.$target.outerWidth() - this.settings.$next_tip.outerWidth()});
            } else {
              this.settings.$next_tip.css({
                top : (this.settings.$target.offset().top - this.settings.$next_tip.outerHeight() - nub_height + topAdjustment),
                left : this.settings.$target.offset().left + leftAdjustment});
            }

            this.nub_position($nub, this.settings.tip_settings.nub_position, 'bottom');

          } else if (this.right()) {

            this.settings.$next_tip.css({
              top : this.settings.$target.offset().top + topAdjustment,
              left : (this.settings.$target.outerWidth() + this.settings.$target.offset().left + nub_width + leftAdjustment)});

            this.nub_position($nub, this.settings.tip_settings.nub_position, 'left');

          } else if (this.left()) {

            this.settings.$next_tip.css({
              top : this.settings.$target.offset().top + topAdjustment,
              left : (this.settings.$target.offset().left - this.settings.$next_tip.outerWidth() - nub_width + leftAdjustment)});

            this.nub_position($nub, this.settings.tip_settings.nub_position, 'right');

          }

          if (!this.visible(this.corners(this.settings.$next_tip)) && this.settings.attempts < this.settings.tip_settings.tip_location_pattern.length) {

            $nub.removeClass('bottom')
              .removeClass('top')
              .removeClass('right')
              .removeClass('left');

            this.settings.tip_settings.tip_location = this.settings.tip_settings.tip_location_pattern[this.settings.attempts];

            this.settings.attempts++;

            this.pos_default();

          }

      } else if (this.settings.$li.length) {

        this.pos_modal($nub);

      }

      if (toggle) {
        this.settings.$next_tip.hide();
        this.settings.$next_tip.css('visibility', 'visible');
      }

    },

    pos_phone : function (init) {
      var tip_height = this.settings.$next_tip.outerHeight(),
          tip_offset = this.settings.$next_tip.offset(),
          target_height = this.settings.$target.outerHeight(),
          $nub = $('.joyride-nub', this.settings.$next_tip),
          nub_height = Math.ceil($nub.outerHeight() / 2),
          toggle = init || false;

      $nub.removeClass('bottom')
        .removeClass('top')
        .removeClass('right')
        .removeClass('left');

      if (toggle) {
        this.settings.$next_tip.css('visibility', 'hidden');
        this.settings.$next_tip.show();
      }

      if (!/body/i.test(this.settings.$target.selector)) {

        if (this.top()) {

            this.settings.$next_tip.offset({top : this.settings.$target.offset().top - tip_height - nub_height});
            $nub.addClass('bottom');

        } else {

          this.settings.$next_tip.offset({top : this.settings.$target.offset().top + target_height + nub_height});
          $nub.addClass('top');

        }

      } else if (this.settings.$li.length) {
        this.pos_modal($nub);
      }

      if (toggle) {
        this.settings.$next_tip.hide();
        this.settings.$next_tip.css('visibility', 'visible');
      }
    },

    pos_modal : function ($nub) {
      this.center();
      $nub.hide();

      this.show_modal();
    },

    show_modal : function () {
      if (!this.settings.$next_tip.data('closed')) {
        var joyridemodalbg =  $('.joyride-modal-bg');
        if (joyridemodalbg.length < 1) {
          var joyridemodalbg = $(this.settings.template.modal);
          joyridemodalbg.appendTo('body');
        }

        if (/pop/i.test(this.settings.tip_animation)) {
            joyridemodalbg.show();
        } else {
            joyridemodalbg.fadeIn(this.settings.tip_animation_fade_speed);
        }
      }
    },

    expose : function () {
      var expose,
          exposeCover,
          el,
          origCSS,
          origClasses,
          randId = 'expose-' + this.random_str(6);

      if (arguments.length > 0 && arguments[0] instanceof $) {
        el = arguments[0];
      } else if (this.settings.$target && !/body/i.test(this.settings.$target.selector)) {
        el = this.settings.$target;
      } else {
        return false;
      }

      if (el.length < 1) {
        if (window.console) {
          console.error('element not valid', el);
        }
        return false;
      }

      expose = $(this.settings.template.expose);
      this.settings.$body.append(expose);
      expose.css({
        top : el.offset().top,
        left : el.offset().left,
        width : el.outerWidth(true),
        height : el.outerHeight(true)
      });

      exposeCover = $(this.settings.template.expose_cover);

      origCSS = {
        zIndex : el.css('z-index'),
        position : el.css('position')
      };

      origClasses = el.attr('class') == null ? '' : el.attr('class');

      el.css('z-index', parseInt(expose.css('z-index')) + 1);

      if (origCSS.position == 'static') {
        el.css('position', 'relative');
      }

      el.data('expose-css', origCSS);
      el.data('orig-class', origClasses);
      el.attr('class', origClasses + ' ' + this.settings.expose_add_class);

      exposeCover.css({
        top : el.offset().top,
        left : el.offset().left,
        width : el.outerWidth(true),
        height : el.outerHeight(true)
      });

      if (this.settings.modal) {
        this.show_modal();
      }

      this.settings.$body.append(exposeCover);
      expose.addClass(randId);
      exposeCover.addClass(randId);
      el.data('expose', randId);
      this.settings.post_expose_callback(this.settings.$li.index(), this.settings.$next_tip, el);
      this.add_exposed(el);
    },

    un_expose : function () {
      var exposeId,
          el,
          expose,
          origCSS,
          origClasses,
          clearAll = false;

      if (arguments.length > 0 && arguments[0] instanceof $) {
        el = arguments[0];
      } else if (this.settings.$target && !/body/i.test(this.settings.$target.selector)) {
        el = this.settings.$target;
      } else {
        return false;
      }

      if (el.length < 1) {
        if (window.console) {
          console.error('element not valid', el);
        }
        return false;
      }

      exposeId = el.data('expose');
      expose = $('.' + exposeId);

      if (arguments.length > 1) {
        clearAll = arguments[1];
      }

      if (clearAll === true) {
        $('.joyride-expose-wrapper,.joyride-expose-cover').remove();
      } else {
        expose.remove();
      }

      origCSS = el.data('expose-css');

      if (origCSS.zIndex == 'auto') {
        el.css('z-index', '');
      } else {
        el.css('z-index', origCSS.zIndex);
      }

      if (origCSS.position != el.css('position')) {
        if (origCSS.position == 'static') {// this is default, no need to set it.
          el.css('position', '');
        } else {
          el.css('position', origCSS.position);
        }
      }

      origClasses = el.data('orig-class');
      el.attr('class', origClasses);
      el.removeData('orig-classes');

      el.removeData('expose');
      el.removeData('expose-z-index');
      this.remove_exposed(el);
    },

    add_exposed : function (el) {
      this.settings.exposed = this.settings.exposed || [];
      if (el instanceof $ || typeof el === 'object') {
        this.settings.exposed.push(el[0]);
      } else if (typeof el == 'string') {
        this.settings.exposed.push(el);
      }
    },

    remove_exposed : function (el) {
      var search, i;
      if (el instanceof $) {
        search = el[0]
      } else if (typeof el == 'string') {
        search = el;
      }

      this.settings.exposed = this.settings.exposed || [];
      i = this.settings.exposed.length;

      while (i--) {
        if (this.settings.exposed[i] == search) {
          this.settings.exposed.splice(i, 1);
          return;
        }
      }
    },

    center : function () {
      var $w = $(window);

      this.settings.$next_tip.css({
        top : ((($w.height() - this.settings.$next_tip.outerHeight()) / 2) + $w.scrollTop()),
        left : ((($w.width() - this.settings.$next_tip.outerWidth()) / 2) + $w.scrollLeft())
      });

      return true;
    },

    bottom : function () {
      return /bottom/i.test(this.settings.tip_settings.tip_location);
    },

    top : function () {
      return /top/i.test(this.settings.tip_settings.tip_location);
    },

    right : function () {
      return /right/i.test(this.settings.tip_settings.tip_location);
    },

    left : function () {
      return /left/i.test(this.settings.tip_settings.tip_location);
    },

    corners : function (el) {
      var w = $(window),
          window_half = w.height() / 2,
          //using this to calculate since scroll may not have finished yet.
          tipOffset = Math.ceil(this.settings.$target.offset().top - window_half + this.settings.$next_tip.outerHeight()),
          right = w.width() + w.scrollLeft(),
          offsetBottom =  w.height() + tipOffset,
          bottom = w.height() + w.scrollTop(),
          top = w.scrollTop();

      if (tipOffset < top) {
        if (tipOffset < 0) {
          top = 0;
        } else {
          top = tipOffset;
        }
      }

      if (offsetBottom > bottom) {
        bottom = offsetBottom;
      }

      return [
        el.offset().top < top,
        right < el.offset().left + el.outerWidth(),
        bottom < el.offset().top + el.outerHeight(),
        w.scrollLeft() > el.offset().left
      ];
    },

    visible : function (hidden_corners) {
      var i = hidden_corners.length;

      while (i--) {
        if (hidden_corners[i]) {
          return false;
        }
      }

      return true;
    },

    nub_position : function (nub, pos, def) {
      if (pos === 'auto') {
        nub.addClass(def);
      } else {
        nub.addClass(pos);
      }
    },

    startTimer : function () {
      if (this.settings.$li.length) {
        this.settings.automate = setTimeout(function () {
          this.hide();
          this.show();
          this.startTimer();
        }.bind(this), this.settings.timer);
      } else {
        clearTimeout(this.settings.automate);
      }
    },

    end : function (abort) {
      if (this.settings.cookie_monster) {
        $.cookie(this.settings.cookie_name, 'ridden', {expires : this.settings.cookie_expires, domain : this.settings.cookie_domain});
      }

      if (this.settings.timer > 0) {
        clearTimeout(this.settings.automate);
      }

      if (this.settings.modal && this.settings.expose) {
        this.un_expose();
      }

      // Unplug keystrokes listener
      $(this.scope).off('keyup.joyride')

      this.settings.$next_tip.data('closed', true);
      this.settings.riding = false;

      $('.joyride-modal-bg').hide();
      this.settings.$current_tip.hide();

      if (typeof abort === 'undefined' || abort === false) {
        this.settings.post_step_callback(this.settings.$li.index(), this.settings.$current_tip);
        this.settings.post_ride_callback(this.settings.$li.index(), this.settings.$current_tip);
      }

      $('.joyride-tip-guide').remove();
    },

    off : function () {
      $(this.scope).off('.joyride');
      $(window).off('.joyride');
      $('.joyride-close-tip, .joyride-next-tip, .joyride-modal-bg').off('.joyride');
      $('.joyride-tip-guide, .joyride-modal-bg').remove();
      clearTimeout(this.settings.automate);
      this.settings = {};
    },

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.equalizer = {
    name : 'equalizer',

    version : '5.5.1',

    settings : {
      use_tallest : true,
      before_height_change : $.noop,
      after_height_change : $.noop,
      equalize_on_stack : false
    },

    init : function (scope, method, options) {
      Foundation.inherit(this, 'image_loaded');
      this.bindings(method, options);
      this.reflow();
    },

    events : function () {
      this.S(window).off('.equalizer').on('resize.fndtn.equalizer', function (e) {
        this.reflow();
      }.bind(this));
    },

    equalize : function (equalizer) {
      var isStacked = false,
          vals = equalizer.find('[' + this.attr_name() + '-watch]:visible'),
          settings = equalizer.data(this.attr_name(true) + '-init');

      if (vals.length === 0) {
        return;
      }
      var firstTopOffset = vals.first().offset().top;
      settings.before_height_change();
      equalizer.trigger('before-height-change').trigger('before-height-change.fndth.equalizer');
      vals.height('inherit');
      vals.each(function () {
        var el = $(this);
        if (el.offset().top !== firstTopOffset) {
          isStacked = true;
        }
      });

      if (settings.equalize_on_stack === false) {
        if (isStacked) {
          return;
        }
      };

      var heights = vals.map(function () { return $(this).outerHeight(false) }).get();

      if (settings.use_tallest) {
        var max = Math.max.apply(null, heights);
        vals.css('height', max);
      } else {
        var min = Math.min.apply(null, heights);
        vals.css('height', min);
      }
      settings.after_height_change();
      equalizer.trigger('after-height-change').trigger('after-height-change.fndtn.equalizer');
    },

    reflow : function () {
      var self = this;

      this.S('[' + this.attr_name() + ']', this.scope).each(function () {
        var $eq_target = $(this);
        self.image_loaded(self.S('img', this), function () {
          self.equalize($eq_target)
        });
      });
    }
  };
})(jQuery, window, window.document);
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.dropdown = {
    name : 'dropdown',

    version : '5.5.1',

    settings : {
      active_class : 'open',
      disabled_class : 'disabled',
      mega_class : 'mega',
      align : 'bottom',
      is_hover : false,
      hover_timeout : 150,
      opened : function () {},
      closed : function () {}
    },

    init : function (scope, method, options) {
      Foundation.inherit(this, 'throttle');

      $.extend(true, this.settings, method, options);
      this.bindings(method, options);
    },

    events : function (scope) {
      var self = this,
          S = self.S;

      S(this.scope)
        .off('.dropdown')
        .on('click.fndtn.dropdown', '[' + this.attr_name() + ']', function (e) {
          var settings = S(this).data(self.attr_name(true) + '-init') || self.settings;
          if (!settings.is_hover || Modernizr.touch) {
            e.preventDefault();
            if (S(this).parent('[data-reveal-id]')) {
              e.stopPropagation();
            }
            self.toggle($(this));
          }
        })
        .on('mouseenter.fndtn.dropdown', '[' + this.attr_name() + '], [' + this.attr_name() + '-content]', function (e) {
          var $this = S(this),
              dropdown,
              target;

          clearTimeout(self.timeout);

          if ($this.data(self.data_attr())) {
            dropdown = S('#' + $this.data(self.data_attr()));
            target = $this;
          } else {
            dropdown = $this;
            target = S('[' + self.attr_name() + '="' + dropdown.attr('id') + '"]');
          }

          var settings = target.data(self.attr_name(true) + '-init') || self.settings;

          if (S(e.currentTarget).data(self.data_attr()) && settings.is_hover) {
            self.closeall.call(self);
          }

          if (settings.is_hover) {
            self.open.apply(self, [dropdown, target]);
          }
        })
        .on('mouseleave.fndtn.dropdown', '[' + this.attr_name() + '], [' + this.attr_name() + '-content]', function (e) {
          var $this = S(this);
          var settings;

          if ($this.data(self.data_attr())) {
              settings = $this.data(self.data_attr(true) + '-init') || self.settings;
          } else {
              var target   = S('[' + self.attr_name() + '="' + S(this).attr('id') + '"]'),
                  settings = target.data(self.attr_name(true) + '-init') || self.settings;
          }

          self.timeout = setTimeout(function () {
            if ($this.data(self.data_attr())) {
              if (settings.is_hover) {
                self.close.call(self, S('#' + $this.data(self.data_attr())));
              }
            } else {
              if (settings.is_hover) {
                self.close.call(self, $this);
              }
            }
          }.bind(this), settings.hover_timeout);
        })
        .on('click.fndtn.dropdown', function (e) {
          var parent = S(e.target).closest('[' + self.attr_name() + '-content]');
          var links  = parent.find('a');

          if (links.length > 0 && parent.attr('aria-autoclose') !== 'false') {
              self.close.call(self, S('[' + self.attr_name() + '-content]'));
          }

          if (e.target !== document && !$.contains(document.documentElement, e.target)) {
            return;
          }

          if (S(e.target).closest('[' + self.attr_name() + ']').length > 0) {
            return;
          }

          if (!(S(e.target).data('revealId')) &&
            (parent.length > 0 && (S(e.target).is('[' + self.attr_name() + '-content]') ||
              $.contains(parent.first()[0], e.target)))) {
            e.stopPropagation();
            return;
          }

          self.close.call(self, S('[' + self.attr_name() + '-content]'));
        })
        .on('opened.fndtn.dropdown', '[' + self.attr_name() + '-content]', function () {
          self.settings.opened.call(this);
        })
        .on('closed.fndtn.dropdown', '[' + self.attr_name() + '-content]', function () {
          self.settings.closed.call(this);
        });

      S(window)
        .off('.dropdown')
        .on('resize.fndtn.dropdown', self.throttle(function () {
          self.resize.call(self);
        }, 50));

      this.resize();
    },

    close : function (dropdown) {
      var self = this;
      dropdown.each(function () {
        var original_target = $('[' + self.attr_name() + '=' + dropdown[0].id + ']') || $('aria-controls=' + dropdown[0].id + ']');
        original_target.attr('aria-expanded', 'false');
        if (self.S(this).hasClass(self.settings.active_class)) {
          self.S(this)
            .css(Foundation.rtl ? 'right' : 'left', '-99999px')
            .attr('aria-hidden', 'true')
            .removeClass(self.settings.active_class)
            .prev('[' + self.attr_name() + ']')
            .removeClass(self.settings.active_class)
            .removeData('target');

          self.S(this).trigger('closed').trigger('closed.fndtn.dropdown', [dropdown]);
        }
      });
      dropdown.removeClass('f-open-' + this.attr_name(true));
    },

    closeall : function () {
      var self = this;
      $.each(self.S('.f-open-' + this.attr_name(true)), function () {
        self.close.call(self, self.S(this));
      });
    },

    open : function (dropdown, target) {
      this
        .css(dropdown
        .addClass(this.settings.active_class), target);
      dropdown.prev('[' + this.attr_name() + ']').addClass(this.settings.active_class);
      dropdown.data('target', target.get(0)).trigger('opened').trigger('opened.fndtn.dropdown', [dropdown, target]);
      dropdown.attr('aria-hidden', 'false');
      target.attr('aria-expanded', 'true');
      dropdown.focus();
      dropdown.addClass('f-open-' + this.attr_name(true));
    },

    data_attr : function () {
      if (this.namespace.length > 0) {
        return this.namespace + '-' + this.name;
      }

      return this.name;
    },

    toggle : function (target) {
      if (target.hasClass(this.settings.disabled_class)) {
        return;
      }
      var dropdown = this.S('#' + target.data(this.data_attr()));
      if (dropdown.length === 0) {
        // No dropdown found, not continuing
        return;
      }

      this.close.call(this, this.S('[' + this.attr_name() + '-content]').not(dropdown));

      if (dropdown.hasClass(this.settings.active_class)) {
        this.close.call(this, dropdown);
        if (dropdown.data('target') !== target.get(0)) {
          this.open.call(this, dropdown, target);
        }
      } else {
        this.open.call(this, dropdown, target);
      }
    },

    resize : function () {
      var dropdown = this.S('[' + this.attr_name() + '-content].open');
      var target = $(dropdown.data("target"));

      if (dropdown.length && target.length) {
        this.css(dropdown, target);
      }
    },

    css : function (dropdown, target) {
      var left_offset = Math.max((target.width() - dropdown.width()) / 2, 8),
          settings = target.data(this.attr_name(true) + '-init') || this.settings;

      this.clear_idx();

      if (this.small()) {
        var p = this.dirs.bottom.call(dropdown, target, settings);

        dropdown.attr('style', '').removeClass('drop-left drop-right drop-top').css({
          position : 'absolute',
          width : '95%',
          'max-width' : 'none',
          top : p.top
        });

        dropdown.css(Foundation.rtl ? 'right' : 'left', left_offset);
      } else {

        this.style(dropdown, target, settings);
      }

      return dropdown;
    },

    style : function (dropdown, target, settings) {
      var css = $.extend({position : 'absolute'},
        this.dirs[settings.align].call(dropdown, target, settings));

      dropdown.attr('style', '').css(css);
    },

    // return CSS property object
    // `this` is the dropdown
    dirs : {
      // Calculate target offset
      _base : function (t) {
        var o_p = this.offsetParent(),
            o = o_p.offset(),
            p = t.offset();

        p.top -= o.top;
        p.left -= o.left;

        //set some flags on the p object to pass along
        p.missRight = false;
        p.missTop = false;
        p.missLeft = false;
        p.leftRightFlag = false;

        //lets see if the panel will be off the screen
        //get the actual width of the page and store it
        var actualBodyWidth;
        if (document.getElementsByClassName('row')[0]) {
          actualBodyWidth = document.getElementsByClassName('row')[0].clientWidth;
        } else {
          actualBodyWidth = window.outerWidth;
        }

        var actualMarginWidth = (window.outerWidth - actualBodyWidth) / 2;
        var actualBoundary = actualBodyWidth;

        if (!this.hasClass('mega')) {
          //miss top
          if (t.offset().top <= this.outerHeight()) {
            p.missTop = true;
            actualBoundary = window.outerWidth - actualMarginWidth;
            p.leftRightFlag = true;
          }

          //miss right
          if (t.offset().left + this.outerWidth() > t.offset().left + actualMarginWidth && t.offset().left - actualMarginWidth > this.outerWidth()) {
            p.missRight = true;
            p.missLeft = false;
          }

          //miss left
          if (t.offset().left - this.outerWidth() <= 0) {
            p.missLeft = true;
            p.missRight = false;
          }
        }

        return p;
      },

      top : function (t, s) {
        var self = Foundation.libs.dropdown,
            p = self.dirs._base.call(this, t);

        this.addClass('drop-top');

        if (p.missTop == true) {
          p.top = p.top + t.outerHeight() + this.outerHeight();
          this.removeClass('drop-top');
        }

        if (p.missRight == true) {
          p.left = p.left - this.outerWidth() + t.outerWidth();
        }

        if (t.outerWidth() < this.outerWidth() || self.small() || this.hasClass(s.mega_menu)) {
          self.adjust_pip(this, t, s, p);
        }

        if (Foundation.rtl) {
          return {left : p.left - this.outerWidth() + t.outerWidth(),
            top : p.top - this.outerHeight()};
        }

        return {left : p.left, top : p.top - this.outerHeight()};
      },

      bottom : function (t, s) {
        var self = Foundation.libs.dropdown,
            p = self.dirs._base.call(this, t);

        if (p.missRight == true) {
          p.left = p.left - this.outerWidth() + t.outerWidth();
        }

        if (t.outerWidth() < this.outerWidth() || self.small() || this.hasClass(s.mega_menu)) {
          self.adjust_pip(this, t, s, p);
        }

        if (self.rtl) {
          return {left : p.left - this.outerWidth() + t.outerWidth(), top : p.top + t.outerHeight()};
        }

        return {left : p.left, top : p.top + t.outerHeight()};
      },

      left : function (t, s) {
        var p = Foundation.libs.dropdown.dirs._base.call(this, t);

        this.addClass('drop-left');

        if (p.missLeft == true) {
          p.left =  p.left + this.outerWidth();
          p.top = p.top + t.outerHeight();
          this.removeClass('drop-left');
        }

        return {left : p.left - this.outerWidth(), top : p.top};
      },

      right : function (t, s) {
        var p = Foundation.libs.dropdown.dirs._base.call(this, t);

        this.addClass('drop-right');

        if (p.missRight == true) {
          p.left = p.left - this.outerWidth();
          p.top = p.top + t.outerHeight();
          this.removeClass('drop-right');
        } else {
          p.triggeredRight = true;
        }

        var self = Foundation.libs.dropdown;

        if (t.outerWidth() < this.outerWidth() || self.small() || this.hasClass(s.mega_menu)) {
          self.adjust_pip(this, t, s, p);
        }

        return {left : p.left + t.outerWidth(), top : p.top};
      }
    },

    // Insert rule to style psuedo elements
    adjust_pip : function (dropdown, target, settings, position) {
      var sheet = Foundation.stylesheet,
          pip_offset_base = 8;

      if (dropdown.hasClass(settings.mega_class)) {
        pip_offset_base = position.left + (target.outerWidth() / 2) - 8;
      } else if (this.small()) {
        pip_offset_base += position.left - 8;
      }

      this.rule_idx = sheet.cssRules.length;

      //default
      var sel_before = '.f-dropdown.open:before',
          sel_after  = '.f-dropdown.open:after',
          css_before = 'left: ' + pip_offset_base + 'px;',
          css_after  = 'left: ' + (pip_offset_base - 1) + 'px;';

      if (position.missRight == true) {
        pip_offset_base = dropdown.outerWidth() - 23;
        sel_before = '.f-dropdown.open:before',
        sel_after  = '.f-dropdown.open:after',
        css_before = 'left: ' + pip_offset_base + 'px;',
        css_after  = 'left: ' + (pip_offset_base - 1) + 'px;';
      }

      //just a case where right is fired, but its not missing right
      if (position.triggeredRight == true) {
        sel_before = '.f-dropdown.open:before',
        sel_after  = '.f-dropdown.open:after',
        css_before = 'left:-12px;',
        css_after  = 'left:-14px;';
      }

      if (sheet.insertRule) {
        sheet.insertRule([sel_before, '{', css_before, '}'].join(' '), this.rule_idx);
        sheet.insertRule([sel_after, '{', css_after, '}'].join(' '), this.rule_idx + 1);
      } else {
        sheet.addRule(sel_before, css_before, this.rule_idx);
        sheet.addRule(sel_after, css_after, this.rule_idx + 1);
      }
    },

    // Remove old dropdown rule index
    clear_idx : function () {
      var sheet = Foundation.stylesheet;

      if (typeof this.rule_idx !== 'undefined') {
        sheet.deleteRule(this.rule_idx);
        sheet.deleteRule(this.rule_idx);
        delete this.rule_idx;
      }
    },

    small : function () {
      return matchMedia(Foundation.media_queries.small).matches &&
        !matchMedia(Foundation.media_queries.medium).matches;
    },

    off : function () {
      this.S(this.scope).off('.fndtn.dropdown');
      this.S('html, body').off('.fndtn.dropdown');
      this.S(window).off('.fndtn.dropdown');
      this.S('[data-dropdown-content]').off('.fndtn.dropdown');
    },

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.clearing = {
    name : 'clearing',

    version : '5.5.1',

    settings : {
      templates : {
        viewing : '<a href="#" class="clearing-close">&times;</a>' +
          '<div class="visible-img" style="display: none"><div class="clearing-touch-label"></div><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D" alt="" />' +
          '<p class="clearing-caption"></p><a href="#" class="clearing-main-prev"><span></span></a>' +
          '<a href="#" class="clearing-main-next"><span></span></a></div>'
      },

      // comma delimited list of selectors that, on click, will close clearing,
      // add 'div.clearing-blackout, div.visible-img' to close on background click
      close_selectors : '.clearing-close, div.clearing-blackout',

      // Default to the entire li element.
      open_selectors : '',

      // Image will be skipped in carousel.
      skip_selector : '',

      touch_label : '',

      // event initializers and locks
      init : false,
      locked : false
    },

    init : function (scope, method, options) {
      var self = this;
      Foundation.inherit(this, 'throttle image_loaded');

      this.bindings(method, options);

      if (self.S(this.scope).is('[' + this.attr_name() + ']')) {
        this.assemble(self.S('li', this.scope));
      } else {
        self.S('[' + this.attr_name() + ']', this.scope).each(function () {
          self.assemble(self.S('li', this));
        });
      }
    },

    events : function (scope) {
      var self = this,
          S = self.S,
          $scroll_container = $('.scroll-container');

      if ($scroll_container.length > 0) {
        this.scope = $scroll_container;
      }

      S(this.scope)
        .off('.clearing')
        .on('click.fndtn.clearing', 'ul[' + this.attr_name() + '] li ' + this.settings.open_selectors,
          function (e, current, target) {
            var current = current || S(this),
                target = target || current,
                next = current.next('li'),
                settings = current.closest('[' + self.attr_name() + ']').data(self.attr_name(true) + '-init'),
                image = S(e.target);

            e.preventDefault();

            if (!settings) {
              self.init();
              settings = current.closest('[' + self.attr_name() + ']').data(self.attr_name(true) + '-init');
            }

            // if clearing is open and the current image is
            // clicked, go to the next image in sequence
            if (target.hasClass('visible') &&
              current[0] === target[0] &&
              next.length > 0 && self.is_open(current)) {
              target = next;
              image = S('img', target);
            }

            // set current and target to the clicked li if not otherwise defined.
            self.open(image, current, target);
            self.update_paddles(target);
          })

        .on('click.fndtn.clearing', '.clearing-main-next',
          function (e) { self.nav(e, 'next') })
        .on('click.fndtn.clearing', '.clearing-main-prev',
          function (e) { self.nav(e, 'prev') })
        .on('click.fndtn.clearing', this.settings.close_selectors,
          function (e) { Foundation.libs.clearing.close(e, this) });

      $(document).on('keydown.fndtn.clearing',
          function (e) { self.keydown(e) });

      S(window).off('.clearing').on('resize.fndtn.clearing',
        function () { self.resize() });

      this.swipe_events(scope);
    },

    swipe_events : function (scope) {
      var self = this,
      S = self.S;

      S(this.scope)
        .on('touchstart.fndtn.clearing', '.visible-img', function (e) {
          if (!e.touches) { e = e.originalEvent; }
          var data = {
                start_page_x : e.touches[0].pageX,
                start_page_y : e.touches[0].pageY,
                start_time : (new Date()).getTime(),
                delta_x : 0,
                is_scrolling : undefined
              };

          S(this).data('swipe-transition', data);
          e.stopPropagation();
        })
        .on('touchmove.fndtn.clearing', '.visible-img', function (e) {
          if (!e.touches) {
            e = e.originalEvent;
          }
          // Ignore pinch/zoom events
          if (e.touches.length > 1 || e.scale && e.scale !== 1) {
            return;
          }

          var data = S(this).data('swipe-transition');

          if (typeof data === 'undefined') {
            data = {};
          }

          data.delta_x = e.touches[0].pageX - data.start_page_x;

          if (Foundation.rtl) {
            data.delta_x = -data.delta_x;
          }

          if (typeof data.is_scrolling === 'undefined') {
            data.is_scrolling = !!( data.is_scrolling || Math.abs(data.delta_x) < Math.abs(e.touches[0].pageY - data.start_page_y) );
          }

          if (!data.is_scrolling && !data.active) {
            e.preventDefault();
            var direction = (data.delta_x < 0) ? 'next' : 'prev';
            data.active = true;
            self.nav(e, direction);
          }
        })
        .on('touchend.fndtn.clearing', '.visible-img', function (e) {
          S(this).data('swipe-transition', {});
          e.stopPropagation();
        });
    },

    assemble : function ($li) {
      var $el = $li.parent();

      if ($el.parent().hasClass('carousel')) {
        return;
      }

      $el.after('<div id="foundationClearingHolder"></div>');

      var grid = $el.detach(),
          grid_outerHTML = '';

      if (grid[0] == null) {
        return;
      } else {
        grid_outerHTML = grid[0].outerHTML;
      }

      var holder = this.S('#foundationClearingHolder'),
          settings = $el.data(this.attr_name(true) + '-init'),
          data = {
            grid : '<div class="carousel">' + grid_outerHTML + '</div>',
            viewing : settings.templates.viewing
          },
          wrapper = '<div class="clearing-assembled"><div>' + data.viewing +
            data.grid + '</div></div>',
          touch_label = this.settings.touch_label;

      if (Modernizr.touch) {
        wrapper = $(wrapper).find('.clearing-touch-label').html(touch_label).end();
      }

      holder.after(wrapper).remove();
    },

    open : function ($image, current, target) {
      var self = this,
          body = $(document.body),
          root = target.closest('.clearing-assembled'),
          container = self.S('div', root).first(),
          visible_image = self.S('.visible-img', container),
          image = self.S('img', visible_image).not($image),
          label = self.S('.clearing-touch-label', container),
          error = false;

      // Event to disable scrolling on touch devices when Clearing is activated
      $('body').on('touchmove', function (e) {
        e.preventDefault();
      });

      image.error(function () {
        error = true;
      });

      function startLoad() {
        setTimeout(function () {
          this.image_loaded(image, function () {
            if (image.outerWidth() === 1 && !error) {
              startLoad.call(this);
            } else {
              cb.call(this, image);
            }
          }.bind(this));
        }.bind(this), 100);
      }

      function cb (image) {
        var $image = $(image);
        $image.css('visibility', 'visible');
        // toggle the gallery
        body.css('overflow', 'hidden');
        root.addClass('clearing-blackout');
        container.addClass('clearing-container');
        visible_image.show();
        this.fix_height(target)
          .caption(self.S('.clearing-caption', visible_image), self.S('img', target))
          .center_and_label(image, label)
          .shift(current, target, function () {
            target.closest('li').siblings().removeClass('visible');
            target.closest('li').addClass('visible');
          });
        visible_image.trigger('opened.fndtn.clearing')
      }

      if (!this.locked()) {
        visible_image.trigger('open.fndtn.clearing');
        // set the image to the selected thumbnail
        image
          .attr('src', this.load($image))
          .css('visibility', 'hidden');

        startLoad.call(this);
      }
    },

    close : function (e, el) {
      e.preventDefault();

      var root = (function (target) {
            if (/blackout/.test(target.selector)) {
              return target;
            } else {
              return target.closest('.clearing-blackout');
            }
          }($(el))),
          body = $(document.body), container, visible_image;

      if (el === e.target && root) {
        body.css('overflow', '');
        container = $('div', root).first();
        visible_image = $('.visible-img', container);
        visible_image.trigger('close.fndtn.clearing');
        this.settings.prev_index = 0;
        $('ul[' + this.attr_name() + ']', root)
          .attr('style', '').closest('.clearing-blackout')
          .removeClass('clearing-blackout');
        container.removeClass('clearing-container');
        visible_image.hide();
        visible_image.trigger('closed.fndtn.clearing');
      }

      // Event to re-enable scrolling on touch devices
      $('body').off('touchmove');

      return false;
    },

    is_open : function (current) {
      return current.parent().prop('style').length > 0;
    },

    keydown : function (e) {
      var clearing = $('.clearing-blackout ul[' + this.attr_name() + ']'),
          NEXT_KEY = this.rtl ? 37 : 39,
          PREV_KEY = this.rtl ? 39 : 37,
          ESC_KEY = 27;

      if (e.which === NEXT_KEY) {
        this.go(clearing, 'next');
      }
      if (e.which === PREV_KEY) {
        this.go(clearing, 'prev');
      }
      if (e.which === ESC_KEY) {
        this.S('a.clearing-close').trigger('click').trigger('click.fndtn.clearing');
      }
    },

    nav : function (e, direction) {
      var clearing = $('ul[' + this.attr_name() + ']', '.clearing-blackout');

      e.preventDefault();
      this.go(clearing, direction);
    },

    resize : function () {
      var image = $('img', '.clearing-blackout .visible-img'),
          label = $('.clearing-touch-label', '.clearing-blackout');

      if (image.length) {
        this.center_and_label(image, label);
        image.trigger('resized.fndtn.clearing')
      }
    },

    // visual adjustments
    fix_height : function (target) {
      var lis = target.parent().children(),
          self = this;

      lis.each(function () {
        var li = self.S(this),
            image = li.find('img');

        if (li.height() > image.outerHeight()) {
          li.addClass('fix-height');
        }
      })
      .closest('ul')
      .width(lis.length * 100 + '%');

      return this;
    },

    update_paddles : function (target) {
      target = target.closest('li');
      var visible_image = target
        .closest('.carousel')
        .siblings('.visible-img');

      if (target.next().length > 0) {
        this.S('.clearing-main-next', visible_image).removeClass('disabled');
      } else {
        this.S('.clearing-main-next', visible_image).addClass('disabled');
      }

      if (target.prev().length > 0) {
        this.S('.clearing-main-prev', visible_image).removeClass('disabled');
      } else {
        this.S('.clearing-main-prev', visible_image).addClass('disabled');
      }
    },

    center_and_label : function (target, label) {
      if (!this.rtl && label.length > 0) {
        label.css({
          marginLeft : -(label.outerWidth() / 2),
          marginTop : -(target.outerHeight() / 2)-label.outerHeight()-10
        });
      } else {
        label.css({
          marginRight : -(label.outerWidth() / 2),
          marginTop : -(target.outerHeight() / 2)-label.outerHeight()-10,
          left: 'auto',
          right: '50%'
        });
      }
      return this;
    },

    // image loading and preloading

    load : function ($image) {
      var href;

      if ($image[0].nodeName === 'A') {
        href = $image.attr('href');
      } else {
        href = $image.closest('a').attr('href');
      }

      this.preload($image);

      if (href) {
        return href;
      }
      return $image.attr('src');
    },

    preload : function ($image) {
      this
        .img($image.closest('li').next())
        .img($image.closest('li').prev());
    },

    img : function (img) {
      if (img.length) {
        var new_img = new Image(),
            new_a = this.S('a', img);

        if (new_a.length) {
          new_img.src = new_a.attr('href');
        } else {
          new_img.src = this.S('img', img).attr('src');
        }
      }
      return this;
    },

    // image caption

    caption : function (container, $image) {
      var caption = $image.attr('data-caption');

      if (caption) {
        container
          .html(caption)
          .show();
      } else {
        container
          .text('')
          .hide();
      }
      return this;
    },

    // directional methods

    go : function ($ul, direction) {
      var current = this.S('.visible', $ul),
          target = current[direction]();

      // Check for skip selector.
      if (this.settings.skip_selector && target.find(this.settings.skip_selector).length != 0) {
        target = target[direction]();
      }

      if (target.length) {
        this.S('img', target)
          .trigger('click', [current, target]).trigger('click.fndtn.clearing', [current, target])
          .trigger('change.fndtn.clearing');
      }
    },

    shift : function (current, target, callback) {
      var clearing = target.parent(),
          old_index = this.settings.prev_index || target.index(),
          direction = this.direction(clearing, current, target),
          dir = this.rtl ? 'right' : 'left',
          left = parseInt(clearing.css('left'), 10),
          width = target.outerWidth(),
          skip_shift;

      var dir_obj = {};

      // we use jQuery animate instead of CSS transitions because we
      // need a callback to unlock the next animation
      // needs support for RTL **
      if (target.index() !== old_index && !/skip/.test(direction)) {
        if (/left/.test(direction)) {
          this.lock();
          dir_obj[dir] = left + width;
          clearing.animate(dir_obj, 300, this.unlock());
        } else if (/right/.test(direction)) {
          this.lock();
          dir_obj[dir] = left - width;
          clearing.animate(dir_obj, 300, this.unlock());
        }
      } else if (/skip/.test(direction)) {
        // the target image is not adjacent to the current image, so
        // do we scroll right or not
        skip_shift = target.index() - this.settings.up_count;
        this.lock();

        if (skip_shift > 0) {
          dir_obj[dir] = -(skip_shift * width);
          clearing.animate(dir_obj, 300, this.unlock());
        } else {
          dir_obj[dir] = 0;
          clearing.animate(dir_obj, 300, this.unlock());
        }
      }

      callback();
    },

    direction : function ($el, current, target) {
      var lis = this.S('li', $el),
          li_width = lis.outerWidth() + (lis.outerWidth() / 4),
          up_count = Math.floor(this.S('.clearing-container').outerWidth() / li_width) - 1,
          target_index = lis.index(target),
          response;

      this.settings.up_count = up_count;

      if (this.adjacent(this.settings.prev_index, target_index)) {
        if ((target_index > up_count) && target_index > this.settings.prev_index) {
          response = 'right';
        } else if ((target_index > up_count - 1) && target_index <= this.settings.prev_index) {
          response = 'left';
        } else {
          response = false;
        }
      } else {
        response = 'skip';
      }

      this.settings.prev_index = target_index;

      return response;
    },

    adjacent : function (current_index, target_index) {
      for (var i = target_index + 1; i >= target_index - 1; i--) {
        if (i === current_index) {
          return true;
        }
      }
      return false;
    },

    // lock management

    lock : function () {
      this.settings.locked = true;
    },

    unlock : function () {
      this.settings.locked = false;
    },

    locked : function () {
      return this.settings.locked;
    },

    off : function () {
      this.S(this.scope).off('.fndtn.clearing');
      this.S(window).off('.fndtn.clearing');
    },

    reflow : function () {
      this.init();
    }
  };

}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  var noop = function () {};

  var Orbit = function (el, settings) {
    // Don't reinitialize plugin
    if (el.hasClass(settings.slides_container_class)) {
      return this;
    }

    var self = this,
        container,
        slides_container = el,
        number_container,
        bullets_container,
        timer_container,
        idx = 0,
        animate,
        timer,
        locked = false,
        adjust_height_after = false;

    self.slides = function () {
      return slides_container.children(settings.slide_selector);
    };

    self.slides().first().addClass(settings.active_slide_class);

    self.update_slide_number = function (index) {
      if (settings.slide_number) {
        number_container.find('span:first').text(parseInt(index) + 1);
        number_container.find('span:last').text(self.slides().length);
      }
      if (settings.bullets) {
        bullets_container.children().removeClass(settings.bullets_active_class);
        $(bullets_container.children().get(index)).addClass(settings.bullets_active_class);
      }
    };

    self.update_active_link = function (index) {
      var link = $('[data-orbit-link="' + self.slides().eq(index).attr('data-orbit-slide') + '"]');
      link.siblings().removeClass(settings.bullets_active_class);
      link.addClass(settings.bullets_active_class);
    };

    self.build_markup = function () {
      slides_container.wrap('<div class="' + settings.container_class + '"></div>');
      container = slides_container.parent();
      slides_container.addClass(settings.slides_container_class);

      if (settings.stack_on_small) {
        container.addClass(settings.stack_on_small_class);
      }

      if (settings.navigation_arrows) {
        container.append($('<a href="#"><span></span></a>').addClass(settings.prev_class));
        container.append($('<a href="#"><span></span></a>').addClass(settings.next_class));
      }

      if (settings.timer) {
        timer_container = $('<div>').addClass(settings.timer_container_class);
        timer_container.append('<span>');
        timer_container.append($('<div>').addClass(settings.timer_progress_class));
        timer_container.addClass(settings.timer_paused_class);
        container.append(timer_container);
      }

      if (settings.slide_number) {
        number_container = $('<div>').addClass(settings.slide_number_class);
        number_container.append('<span></span> ' + settings.slide_number_text + ' <span></span>');
        container.append(number_container);
      }

      if (settings.bullets) {
        bullets_container = $('<ol>').addClass(settings.bullets_container_class);
        container.append(bullets_container);
        bullets_container.wrap('<div class="orbit-bullets-container"></div>');
        self.slides().each(function (idx, el) {
          var bullet = $('<li>').attr('data-orbit-slide', idx).on('click', self.link_bullet);;
          bullets_container.append(bullet);
        });
      }

    };

    self._goto = function (next_idx, start_timer) {
      // if (locked) {return false;}
      if (next_idx === idx) {return false;}
      if (typeof timer === 'object') {timer.restart();}
      var slides = self.slides();

      var dir = 'next';
      locked = true;
      if (next_idx < idx) {dir = 'prev';}
      if (next_idx >= slides.length) {
        if (!settings.circular) {
          return false;
        }
        next_idx = 0;
      } else if (next_idx < 0) {
        if (!settings.circular) {
          return false;
        }
        next_idx = slides.length - 1;
      }

      var current = $(slides.get(idx));
      var next = $(slides.get(next_idx));

      current.css('zIndex', 2);
      current.removeClass(settings.active_slide_class);
      next.css('zIndex', 4).addClass(settings.active_slide_class);

      slides_container.trigger('before-slide-change.fndtn.orbit');
      settings.before_slide_change();
      self.update_active_link(next_idx);

      var callback = function () {
        var unlock = function () {
          idx = next_idx;
          locked = false;
          if (start_timer === true) {timer = self.create_timer(); timer.start();}
          self.update_slide_number(idx);
          slides_container.trigger('after-slide-change.fndtn.orbit', [{slide_number : idx, total_slides : slides.length}]);
          settings.after_slide_change(idx, slides.length);
        };
        if (slides_container.outerHeight() != next.outerHeight() && settings.variable_height) {
          slides_container.animate({'height': next.outerHeight()}, 250, 'linear', unlock);
        } else {
          unlock();
        }
      };

      if (slides.length === 1) {callback(); return false;}

      var start_animation = function () {
        if (dir === 'next') {animate.next(current, next, callback);}
        if (dir === 'prev') {animate.prev(current, next, callback);}
      };

      if (next.outerHeight() > slides_container.outerHeight() && settings.variable_height) {
        slides_container.animate({'height': next.outerHeight()}, 250, 'linear', start_animation);
      } else {
        start_animation();
      }
    };

    self.next = function (e) {
      e.stopImmediatePropagation();
      e.preventDefault();
      self._goto(idx + 1);
    };

    self.prev = function (e) {
      e.stopImmediatePropagation();
      e.preventDefault();
      self._goto(idx - 1);
    };

    self.link_custom = function (e) {
      e.preventDefault();
      var link = $(this).attr('data-orbit-link');
      if ((typeof link === 'string') && (link = $.trim(link)) != '') {
        var slide = container.find('[data-orbit-slide=' + link + ']');
        if (slide.index() != -1) {self._goto(slide.index());}
      }
    };

    self.link_bullet = function (e) {
      var index = $(this).attr('data-orbit-slide');
      if ((typeof index === 'string') && (index = $.trim(index)) != '') {
        if (isNaN(parseInt(index))) {
          var slide = container.find('[data-orbit-slide=' + index + ']');
          if (slide.index() != -1) {self._goto(slide.index() + 1);}
        } else {
          self._goto(parseInt(index));
        }
      }

    }

    self.timer_callback = function () {
      self._goto(idx + 1, true);
    }

    self.compute_dimensions = function () {
      var current = $(self.slides().get(idx));
      var h = current.outerHeight();
      if (!settings.variable_height) {
        self.slides().each(function(){
          if ($(this).outerHeight() > h) { h = $(this).outerHeight(); }
        });
      }
      slides_container.height(h);
    };

    self.create_timer = function () {
      var t = new Timer(
        container.find('.' + settings.timer_container_class),
        settings,
        self.timer_callback
      );
      return t;
    };

    self.stop_timer = function () {
      if (typeof timer === 'object') {
        timer.stop();
      }
    };

    self.toggle_timer = function () {
      var t = container.find('.' + settings.timer_container_class);
      if (t.hasClass(settings.timer_paused_class)) {
        if (typeof timer === 'undefined') {timer = self.create_timer();}
        timer.start();
      } else {
        if (typeof timer === 'object') {timer.stop();}
      }
    };

    self.init = function () {
      self.build_markup();
      if (settings.timer) {
        timer = self.create_timer();
        Foundation.utils.image_loaded(this.slides().children('img'), timer.start);
      }
      animate = new FadeAnimation(settings, slides_container);
      if (settings.animation === 'slide') {
        animate = new SlideAnimation(settings, slides_container);
      }

      container.on('click', '.' + settings.next_class, self.next);
      container.on('click', '.' + settings.prev_class, self.prev);

      if (settings.next_on_click) {
        container.on('click', '.' + settings.slides_container_class + ' [data-orbit-slide]', self.link_bullet);
      }

      container.on('click', self.toggle_timer);
      if (settings.swipe) {
        container.on('touchstart.fndtn.orbit', function (e) {
          if (!e.touches) {e = e.originalEvent;}
          var data = {
            start_page_x : e.touches[0].pageX,
            start_page_y : e.touches[0].pageY,
            start_time : (new Date()).getTime(),
            delta_x : 0,
            is_scrolling : undefined
          };
          container.data('swipe-transition', data);
          e.stopPropagation();
        })
        .on('touchmove.fndtn.orbit', function (e) {
          if (!e.touches) {
            e = e.originalEvent;
          }
          // Ignore pinch/zoom events
          if (e.touches.length > 1 || e.scale && e.scale !== 1) {
            return;
          }

          var data = container.data('swipe-transition');
          if (typeof data === 'undefined') {data = {};}

          data.delta_x = e.touches[0].pageX - data.start_page_x;

          if ( typeof data.is_scrolling === 'undefined') {
            data.is_scrolling = !!( data.is_scrolling || Math.abs(data.delta_x) < Math.abs(e.touches[0].pageY - data.start_page_y) );
          }

          if (!data.is_scrolling && !data.active) {
            e.preventDefault();
            var direction = (data.delta_x < 0) ? (idx + 1) : (idx - 1);
            data.active = true;
            self._goto(direction);
          }
        })
        .on('touchend.fndtn.orbit', function (e) {
          container.data('swipe-transition', {});
          e.stopPropagation();
        })
      }
      container.on('mouseenter.fndtn.orbit', function (e) {
        if (settings.timer && settings.pause_on_hover) {
          self.stop_timer();
        }
      })
      .on('mouseleave.fndtn.orbit', function (e) {
        if (settings.timer && settings.resume_on_mouseout) {
          timer.start();
        }
      });

      $(document).on('click', '[data-orbit-link]', self.link_custom);
      $(window).on('load resize', self.compute_dimensions);
      Foundation.utils.image_loaded(this.slides().children('img'), self.compute_dimensions);
      Foundation.utils.image_loaded(this.slides().children('img'), function () {
        container.prev('.' + settings.preloader_class).css('display', 'none');
        self.update_slide_number(0);
        self.update_active_link(0);
        slides_container.trigger('ready.fndtn.orbit');
      });
    };

    self.init();
  };

  var Timer = function (el, settings, callback) {
    var self = this,
        duration = settings.timer_speed,
        progress = el.find('.' + settings.timer_progress_class),
        start,
        timeout,
        left = -1;

    this.update_progress = function (w) {
      var new_progress = progress.clone();
      new_progress.attr('style', '');
      new_progress.css('width', w + '%');
      progress.replaceWith(new_progress);
      progress = new_progress;
    };

    this.restart = function () {
      clearTimeout(timeout);
      el.addClass(settings.timer_paused_class);
      left = -1;
      self.update_progress(0);
    };

    this.start = function () {
      if (!el.hasClass(settings.timer_paused_class)) {return true;}
      left = (left === -1) ? duration : left;
      el.removeClass(settings.timer_paused_class);
      start = new Date().getTime();
      progress.animate({'width' : '100%'}, left, 'linear');
      timeout = setTimeout(function () {
        self.restart();
        callback();
      }, left);
      el.trigger('timer-started.fndtn.orbit')
    };

    this.stop = function () {
      if (el.hasClass(settings.timer_paused_class)) {return true;}
      clearTimeout(timeout);
      el.addClass(settings.timer_paused_class);
      var end = new Date().getTime();
      left = left - (end - start);
      var w = 100 - ((left / duration) * 100);
      self.update_progress(w);
      el.trigger('timer-stopped.fndtn.orbit');
    };
  };

  var SlideAnimation = function (settings, container) {
    var duration = settings.animation_speed;
    var is_rtl = ($('html[dir=rtl]').length === 1);
    var margin = is_rtl ? 'marginRight' : 'marginLeft';
    var animMargin = {};
    animMargin[margin] = '0%';

    this.next = function (current, next, callback) {
      current.animate({marginLeft : '-100%'}, duration);
      next.animate(animMargin, duration, function () {
        current.css(margin, '100%');
        callback();
      });
    };

    this.prev = function (current, prev, callback) {
      current.animate({marginLeft : '100%'}, duration);
      prev.css(margin, '-100%');
      prev.animate(animMargin, duration, function () {
        current.css(margin, '100%');
        callback();
      });
    };
  };

  var FadeAnimation = function (settings, container) {
    var duration = settings.animation_speed;
    var is_rtl = ($('html[dir=rtl]').length === 1);
    var margin = is_rtl ? 'marginRight' : 'marginLeft';

    this.next = function (current, next, callback) {
      next.css({'margin' : '0%', 'opacity' : '0.01'});
      next.animate({'opacity' :'1'}, duration, 'linear', function () {
        current.css('margin', '100%');
        callback();
      });
    };

    this.prev = function (current, prev, callback) {
      prev.css({'margin' : '0%', 'opacity' : '0.01'});
      prev.animate({'opacity' : '1'}, duration, 'linear', function () {
        current.css('margin', '100%');
        callback();
      });
    };
  };

  Foundation.libs = Foundation.libs || {};

  Foundation.libs.orbit = {
    name : 'orbit',

    version : '5.5.1',

    settings : {
      animation : 'slide',
      timer_speed : 10000,
      pause_on_hover : true,
      resume_on_mouseout : false,
      next_on_click : true,
      animation_speed : 500,
      stack_on_small : false,
      navigation_arrows : true,
      slide_number : true,
      slide_number_text : 'of',
      container_class : 'orbit-container',
      stack_on_small_class : 'orbit-stack-on-small',
      next_class : 'orbit-next',
      prev_class : 'orbit-prev',
      timer_container_class : 'orbit-timer',
      timer_paused_class : 'paused',
      timer_progress_class : 'orbit-progress',
      slides_container_class : 'orbit-slides-container',
      preloader_class : 'preloader',
      slide_selector : '*',
      bullets_container_class : 'orbit-bullets',
      bullets_active_class : 'active',
      slide_number_class : 'orbit-slide-number',
      caption_class : 'orbit-caption',
      active_slide_class : 'active',
      orbit_transition_class : 'orbit-transitioning',
      bullets : true,
      circular : true,
      timer : true,
      variable_height : false,
      swipe : true,
      before_slide_change : noop,
      after_slide_change : noop
    },

    init : function (scope, method, options) {
      var self = this;
      this.bindings(method, options);
    },

    events : function (instance) {
      var orbit_instance = new Orbit(this.S(instance), this.S(instance).data('orbit-init'));
      this.S(instance).data(this.name + '-instance', orbit_instance);
    },

    reflow : function () {
      var self = this;

      if (self.S(self.scope).is('[data-orbit]')) {
        var $el = self.S(self.scope);
        var instance = $el.data(self.name + '-instance');
        instance.compute_dimensions();
      } else {
        self.S('[data-orbit]', self.scope).each(function (idx, el) {
          var $el = self.S(el);
          var opts = self.data_options($el);
          var instance = $el.data(self.name + '-instance');
          instance.compute_dimensions();
        });
      }
    }
  };

}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.offcanvas = {
    name : 'offcanvas',

    version : '5.5.1',

    settings : {
      open_method : 'move',
      close_on_click : false
    },

    init : function (scope, method, options) {
      this.bindings(method, options);
    },

    events : function () {
      var self = this,
          S = self.S,
          move_class = '',
          right_postfix = '',
          left_postfix = '';

      if (this.settings.open_method === 'move') {
        move_class = 'move-';
        right_postfix = 'right';
        left_postfix = 'left';
      } else if (this.settings.open_method === 'overlap_single') {
        move_class = 'offcanvas-overlap-';
        right_postfix = 'right';
        left_postfix = 'left';
      } else if (this.settings.open_method === 'overlap') {
        move_class = 'offcanvas-overlap';
      }

      S(this.scope).off('.offcanvas')
        .on('click.fndtn.offcanvas', '.left-off-canvas-toggle', function (e) {
          self.click_toggle_class(e, move_class + right_postfix);
          if (self.settings.open_method !== 'overlap') {
            S('.left-submenu').removeClass(move_class + right_postfix);
          }
          $('.left-off-canvas-toggle').attr('aria-expanded', 'true');
        })
        .on('click.fndtn.offcanvas', '.left-off-canvas-menu a', function (e) {
          var settings = self.get_settings(e);
          var parent = S(this).parent();

          if (settings.close_on_click && !parent.hasClass('has-submenu') && !parent.hasClass('back')) {
            self.hide.call(self, move_class + right_postfix, self.get_wrapper(e));
            parent.parent().removeClass(move_class + right_postfix);
          } else if (S(this).parent().hasClass('has-submenu')) {
            e.preventDefault();
            S(this).siblings('.left-submenu').toggleClass(move_class + right_postfix);
          } else if (parent.hasClass('back')) {
            e.preventDefault();
            parent.parent().removeClass(move_class + right_postfix);
          }
          $('.left-off-canvas-toggle').attr('aria-expanded', 'true');
        })
        .on('click.fndtn.offcanvas', '.right-off-canvas-toggle', function (e) {
          self.click_toggle_class(e, move_class + left_postfix);
          if (self.settings.open_method !== 'overlap') {
            S('.right-submenu').removeClass(move_class + left_postfix);
          }
          $('.right-off-canvas-toggle').attr('aria-expanded', 'true');
        })
        .on('click.fndtn.offcanvas', '.right-off-canvas-menu a', function (e) {
          var settings = self.get_settings(e);
          var parent = S(this).parent();

          if (settings.close_on_click && !parent.hasClass('has-submenu') && !parent.hasClass('back')) {
            self.hide.call(self, move_class + left_postfix, self.get_wrapper(e));
            parent.parent().removeClass(move_class + left_postfix);
          } else if (S(this).parent().hasClass('has-submenu')) {
            e.preventDefault();
            S(this).siblings('.right-submenu').toggleClass(move_class + left_postfix);
          } else if (parent.hasClass('back')) {
            e.preventDefault();
            parent.parent().removeClass(move_class + left_postfix);
          }
          $('.right-off-canvas-toggle').attr('aria-expanded', 'true');
        })
        .on('click.fndtn.offcanvas', '.exit-off-canvas', function (e) {
          self.click_remove_class(e, move_class + left_postfix);
          S('.right-submenu').removeClass(move_class + left_postfix);
          if (right_postfix) {
            self.click_remove_class(e, move_class + right_postfix);
            S('.left-submenu').removeClass(move_class + left_postfix);
          }
          $('.right-off-canvas-toggle').attr('aria-expanded', 'true');
        })
        .on('click.fndtn.offcanvas', '.exit-off-canvas', function (e) {
          self.click_remove_class(e, move_class + left_postfix);
          $('.left-off-canvas-toggle').attr('aria-expanded', 'false');
          if (right_postfix) {
            self.click_remove_class(e, move_class + right_postfix);
            $('.right-off-canvas-toggle').attr('aria-expanded', 'false');
          }
        });
    },

    toggle : function (class_name, $off_canvas) {
      $off_canvas = $off_canvas || this.get_wrapper();
      if ($off_canvas.is('.' + class_name)) {
        this.hide(class_name, $off_canvas);
      } else {
        this.show(class_name, $off_canvas);
      }
    },

    show : function (class_name, $off_canvas) {
      $off_canvas = $off_canvas || this.get_wrapper();
      $off_canvas.trigger('open').trigger('open.fndtn.offcanvas');
      $off_canvas.addClass(class_name);
    },

    hide : function (class_name, $off_canvas) {
      $off_canvas = $off_canvas || this.get_wrapper();
      $off_canvas.trigger('close').trigger('close.fndtn.offcanvas');
      $off_canvas.removeClass(class_name);
    },

    click_toggle_class : function (e, class_name) {
      e.preventDefault();
      var $off_canvas = this.get_wrapper(e);
      this.toggle(class_name, $off_canvas);
    },

    click_remove_class : function (e, class_name) {
      e.preventDefault();
      var $off_canvas = this.get_wrapper(e);
      this.hide(class_name, $off_canvas);
    },

    get_settings : function (e) {
      var offcanvas  = this.S(e.target).closest('[' + this.attr_name() + ']');
      return offcanvas.data(this.attr_name(true) + '-init') || this.settings;
    },

    get_wrapper : function (e) {
      var $off_canvas = this.S(e ? e.target : this.scope).closest('.off-canvas-wrap');

      if ($off_canvas.length === 0) {
        $off_canvas = this.S('.off-canvas-wrap');
      }
      return $off_canvas;
    },

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.alert = {
    name : 'alert',

    version : '5.5.1',

    settings : {
      callback : function () {}
    },

    init : function (scope, method, options) {
      this.bindings(method, options);
    },

    events : function () {
      var self = this,
          S = this.S;

      $(this.scope).off('.alert').on('click.fndtn.alert', '[' + this.attr_name() + '] .close', function (e) {
        var alertBox = S(this).closest('[' + self.attr_name() + ']'),
            settings = alertBox.data(self.attr_name(true) + '-init') || self.settings;

        e.preventDefault();
        if (Modernizr.csstransitions) {
          alertBox.addClass('alert-close');
          alertBox.on('transitionend webkitTransitionEnd oTransitionEnd', function (e) {
            S(this).trigger('close').trigger('close.fndtn.alert').remove();
            settings.callback();
          });
        } else {
          alertBox.fadeOut(300, function () {
            S(this).trigger('close').trigger('close.fndtn.alert').remove();
            settings.callback();
          });
        }
      });
    },

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.reveal = {
    name : 'reveal',

    version : '5.5.1',

    locked : false,

    settings : {
      animation : 'fadeAndPop',
      animation_speed : 250,
      close_on_background_click : true,
      close_on_esc : true,
      dismiss_modal_class : 'close-reveal-modal',
      multiple_opened : false,
      bg_class : 'reveal-modal-bg',
      root_element : 'body',
      open : function(){},
      opened : function(){},
      close : function(){},
      closed : function(){},
      bg : $('.reveal-modal-bg'),
      css : {
        open : {
          'opacity' : 0,
          'visibility' : 'visible',
          'display' : 'block'
        },
        close : {
          'opacity' : 1,
          'visibility' : 'hidden',
          'display' : 'none'
        }
      }
    },

    init : function (scope, method, options) {
      $.extend(true, this.settings, method, options);
      this.bindings(method, options);
    },

    events : function (scope) {
      var self = this,
          S = self.S;

      S(this.scope)
        .off('.reveal')
        .on('click.fndtn.reveal', '[' + this.add_namespace('data-reveal-id') + ']:not([disabled])', function (e) {
          e.preventDefault();

          if (!self.locked) {
            var element = S(this),
                ajax = element.data(self.data_attr('reveal-ajax'));

            self.locked = true;

            if (typeof ajax === 'undefined') {
              self.open.call(self, element);
            } else {
              var url = ajax === true ? element.attr('href') : ajax;

              self.open.call(self, element, {url : url});
            }
          }
        });

      S(document)
        .on('click.fndtn.reveal', this.close_targets(), function (e) {
          e.preventDefault();
          if (!self.locked) {
            var settings = S('[' + self.attr_name() + '].open').data(self.attr_name(true) + '-init') || self.settings,
                bg_clicked = S(e.target)[0] === S('.' + settings.bg_class)[0];

            if (bg_clicked) {
              if (settings.close_on_background_click) {
                e.stopPropagation();
              } else {
                return;
              }
            }

            self.locked = true;
            self.close.call(self, bg_clicked ? S('[' + self.attr_name() + '].open') : S(this).closest('[' + self.attr_name() + ']'));
          }
        });

      if (S('[' + self.attr_name() + ']', this.scope).length > 0) {
        S(this.scope)
          // .off('.reveal')
          .on('open.fndtn.reveal', this.settings.open)
          .on('opened.fndtn.reveal', this.settings.opened)
          .on('opened.fndtn.reveal', this.open_video)
          .on('close.fndtn.reveal', this.settings.close)
          .on('closed.fndtn.reveal', this.settings.closed)
          .on('closed.fndtn.reveal', this.close_video);
      } else {
        S(this.scope)
          // .off('.reveal')
          .on('open.fndtn.reveal', '[' + self.attr_name() + ']', this.settings.open)
          .on('opened.fndtn.reveal', '[' + self.attr_name() + ']', this.settings.opened)
          .on('opened.fndtn.reveal', '[' + self.attr_name() + ']', this.open_video)
          .on('close.fndtn.reveal', '[' + self.attr_name() + ']', this.settings.close)
          .on('closed.fndtn.reveal', '[' + self.attr_name() + ']', this.settings.closed)
          .on('closed.fndtn.reveal', '[' + self.attr_name() + ']', this.close_video);
      }

      return true;
    },

    // PATCH #3: turning on key up capture only when a reveal window is open
    key_up_on : function (scope) {
      var self = this;

      // PATCH #1: fixing multiple keyup event trigger from single key press
      self.S('body').off('keyup.fndtn.reveal').on('keyup.fndtn.reveal', function ( event ) {
        var open_modal = self.S('[' + self.attr_name() + '].open'),
            settings = open_modal.data(self.attr_name(true) + '-init') || self.settings ;
        // PATCH #2: making sure that the close event can be called only while unlocked,
        //           so that multiple keyup.fndtn.reveal events don't prevent clean closing of the reveal window.
        if ( settings && event.which === 27  && settings.close_on_esc && !self.locked) { // 27 is the keycode for the Escape key
          self.close.call(self, open_modal);
        }
      });

      return true;
    },

    // PATCH #3: turning on key up capture only when a reveal window is open
    key_up_off : function (scope) {
      this.S('body').off('keyup.fndtn.reveal');
      return true;
    },

    open : function (target, ajax_settings) {
      var self = this,
          modal;

      if (target) {
        if (typeof target.selector !== 'undefined') {
          // Find the named node; only use the first one found, since the rest of the code assumes there's only one node
          modal = self.S('#' + target.data(self.data_attr('reveal-id'))).first();
        } else {
          modal = self.S(this.scope);

          ajax_settings = target;
        }
      } else {
        modal = self.S(this.scope);
      }

      var settings = modal.data(self.attr_name(true) + '-init');
      settings = settings || this.settings;

      if (modal.hasClass('open') && target.attr('data-reveal-id') == modal.attr('id')) {
        return self.close(modal);
      }

      if (!modal.hasClass('open')) {
        var open_modal = self.S('[' + self.attr_name() + '].open');

        if (typeof modal.data('css-top') === 'undefined') {
          modal.data('css-top', parseInt(modal.css('top'), 10))
            .data('offset', this.cache_offset(modal));
        }

        this.key_up_on(modal);    // PATCH #3: turning on key up capture only when a reveal window is open

        modal.on('open.fndtn.reveal').trigger('open.fndtn.reveal');

        if (open_modal.length < 1) {
          this.toggle_bg(modal, true);
        }

        if (typeof ajax_settings === 'string') {
          ajax_settings = {
            url : ajax_settings
          };
        }

        if (typeof ajax_settings === 'undefined' || !ajax_settings.url) {
          if (open_modal.length > 0) {
            if (settings.multiple_opened) {
              this.to_back(open_modal);
            } else {
              this.hide(open_modal, settings.css.close);
            }
          }

          this.show(modal, settings.css.open);
        } else {
          var old_success = typeof ajax_settings.success !== 'undefined' ? ajax_settings.success : null;

          $.extend(ajax_settings, {
            success : function (data, textStatus, jqXHR) {
              if ( $.isFunction(old_success) ) {
                var result = old_success(data, textStatus, jqXHR);
                if (typeof result == 'string') {
                  data = result;
                }
              }

              modal.html(data);
              self.S(modal).foundation('section', 'reflow');
              self.S(modal).children().foundation();

              if (open_modal.length > 0) {
                if (settings.multiple_opened) {
                  this.to_back(open_modal);
                } else {
                  this.hide(open_modal, settings.css.close);
                }
              }
              self.show(modal, settings.css.open);
            }
          });

          $.ajax(ajax_settings);
        }
      }
      self.S(window).trigger('resize');
    },

    close : function (modal) {
      var modal = modal && modal.length ? modal : this.S(this.scope),
          open_modals = this.S('[' + this.attr_name() + '].open'),
          settings = modal.data(this.attr_name(true) + '-init') || this.settings;

      if (open_modals.length > 0) {
        this.locked = true;
        this.key_up_off(modal);   // PATCH #3: turning on key up capture only when a reveal window is open
        modal.trigger('close').trigger('close.fndtn.reveal');
        
        if ((settings.multiple_opened && open_modals.length === 1) || !settings.multiple_opened || modal.length > 1) {
          this.toggle_bg(modal, false);
          this.to_front(modal);
        }
        
        if (settings.multiple_opened) {
          this.hide(modal, settings.css.close, settings);
          this.to_front($($.makeArray(open_modals).reverse()[1]));
        } else {
          this.hide(open_modals, settings.css.close, settings);
        }
      }
    },

    close_targets : function () {
      var base = '.' + this.settings.dismiss_modal_class;

      if (this.settings.close_on_background_click) {
        return base + ', .' + this.settings.bg_class;
      }

      return base;
    },

    toggle_bg : function (modal, state) {
      if (this.S('.' + this.settings.bg_class).length === 0) {
        this.settings.bg = $('<div />', {'class': this.settings.bg_class})
          .appendTo('body').hide();
      }

      var visible = this.settings.bg.filter(':visible').length > 0;
      if ( state != visible ) {
        if ( state == undefined ? visible : !state ) {
          this.hide(this.settings.bg);
        } else {
          this.show(this.settings.bg);
        }
      }
    },

    show : function (el, css) {
      // is modal
      if (css) {
        var settings = el.data(this.attr_name(true) + '-init') || this.settings,
            root_element = settings.root_element;

        if (el.parent(root_element).length === 0) {
          var placeholder = el.wrap('<div style="display: none;" />').parent();

          el.on('closed.fndtn.reveal.wrapped', function () {
            el.detach().appendTo(placeholder);
            el.unwrap().unbind('closed.fndtn.reveal.wrapped');
          });

          el.detach().appendTo(root_element);
        }

        var animData = getAnimationData(settings.animation);
        if (!animData.animate) {
          this.locked = false;
        }
        if (animData.pop) {
          css.top = $(window).scrollTop() - el.data('offset') + 'px';
          var end_css = {
            top: $(window).scrollTop() + el.data('css-top') + 'px',
            opacity: 1
          };

          return setTimeout(function () {
            return el
              .css(css)
              .animate(end_css, settings.animation_speed, 'linear', function () {
                this.locked = false;
                el.trigger('opened').trigger('opened.fndtn.reveal');
              }.bind(this))
              .addClass('open');
          }.bind(this), settings.animation_speed / 2);
        }

        if (animData.fade) {
          css.top = $(window).scrollTop() + el.data('css-top') + 'px';
          var end_css = {opacity: 1};

          return setTimeout(function () {
            return el
              .css(css)
              .animate(end_css, settings.animation_speed, 'linear', function () {
                this.locked = false;
                el.trigger('opened').trigger('opened.fndtn.reveal');
              }.bind(this))
              .addClass('open');
          }.bind(this), settings.animation_speed / 2);
        }

        return el.css(css).show().css({opacity : 1}).addClass('open').trigger('opened').trigger('opened.fndtn.reveal');
      }

      var settings = this.settings;

      // should we animate the background?
      if (getAnimationData(settings.animation).fade) {
        return el.fadeIn(settings.animation_speed / 2);
      }

      this.locked = false;

      return el.show();
    },
    
    to_back : function(el) {
      el.addClass('toback');
    },
    
    to_front : function(el) {
      el.removeClass('toback');
    },

    hide : function (el, css) {
      // is modal
      if (css) {
        var settings = el.data(this.attr_name(true) + '-init');
        settings = settings || this.settings;

        var animData = getAnimationData(settings.animation);
        if (!animData.animate) {
          this.locked = false;
        }
        if (animData.pop) {
          var end_css = {
            top: - $(window).scrollTop() - el.data('offset') + 'px',
            opacity: 0
          };

          return setTimeout(function () {
            return el
              .animate(end_css, settings.animation_speed, 'linear', function () {
                this.locked = false;
                el.css(css).trigger('closed').trigger('closed.fndtn.reveal');
              }.bind(this))
              .removeClass('open');
          }.bind(this), settings.animation_speed / 2);
        }

        if (animData.fade) {
          var end_css = {opacity : 0};

          return setTimeout(function () {
            return el
              .animate(end_css, settings.animation_speed, 'linear', function () {
                this.locked = false;
                el.css(css).trigger('closed').trigger('closed.fndtn.reveal');
              }.bind(this))
              .removeClass('open');
          }.bind(this), settings.animation_speed / 2);
        }

        return el.hide().css(css).removeClass('open').trigger('closed').trigger('closed.fndtn.reveal');
      }

      var settings = this.settings;

      // should we animate the background?
      if (getAnimationData(settings.animation).fade) {
        return el.fadeOut(settings.animation_speed / 2);
      }

      return el.hide();
    },

    close_video : function (e) {
      var video = $('.flex-video', e.target),
          iframe = $('iframe', video);

      if (iframe.length > 0) {
        iframe.attr('data-src', iframe[0].src);
        iframe.attr('src', iframe.attr('src'));
        video.hide();
      }
    },

    open_video : function (e) {
      var video = $('.flex-video', e.target),
          iframe = video.find('iframe');

      if (iframe.length > 0) {
        var data_src = iframe.attr('data-src');
        if (typeof data_src === 'string') {
          iframe[0].src = iframe.attr('data-src');
        } else {
          var src = iframe[0].src;
          iframe[0].src = undefined;
          iframe[0].src = src;
        }
        video.show();
      }
    },

    data_attr : function (str) {
      if (this.namespace.length > 0) {
        return this.namespace + '-' + str;
      }

      return str;
    },

    cache_offset : function (modal) {
      var offset = modal.show().height() + parseInt(modal.css('top'), 10);

      modal.hide();

      return offset;
    },

    off : function () {
      $(this.scope).off('.fndtn.reveal');
    },

    reflow : function () {}
  };

  /*
   * getAnimationData('popAndFade') // {animate: true,  pop: true,  fade: true}
   * getAnimationData('fade')       // {animate: true,  pop: false, fade: true}
   * getAnimationData('pop')        // {animate: true,  pop: true,  fade: false}
   * getAnimationData('foo')        // {animate: false, pop: false, fade: false}
   * getAnimationData(null)         // {animate: false, pop: false, fade: false}
   */
  function getAnimationData(str) {
    var fade = /fade/i.test(str);
    var pop = /pop/i.test(str);
    return {
      animate : fade || pop,
      pop : pop,
      fade : fade
    };
  }
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.interchange = {
    name : 'interchange',

    version : '5.5.1',

    cache : {},

    images_loaded : false,
    nodes_loaded : false,

    settings : {
      load_attr : 'interchange',

      named_queries : {
        'default'     : 'only screen',
        'small'       : Foundation.media_queries['small'],
        'small-only'  : Foundation.media_queries['small-only'],
        'medium'      : Foundation.media_queries['medium'],
        'medium-only' : Foundation.media_queries['medium-only'],
        'large'       : Foundation.media_queries['large'],
        'large-only'  : Foundation.media_queries['large-only'],
        'xlarge'      : Foundation.media_queries['xlarge'],
        'xlarge-only' : Foundation.media_queries['xlarge-only'],
        'xxlarge'     : Foundation.media_queries['xxlarge'],
        'landscape'   : 'only screen and (orientation: landscape)',
        'portrait'    : 'only screen and (orientation: portrait)',
        'retina'      : 'only screen and (-webkit-min-device-pixel-ratio: 2),' +
          'only screen and (min--moz-device-pixel-ratio: 2),' +
          'only screen and (-o-min-device-pixel-ratio: 2/1),' +
          'only screen and (min-device-pixel-ratio: 2),' +
          'only screen and (min-resolution: 192dpi),' +
          'only screen and (min-resolution: 2dppx)'
      },

      directives : {
        replace : function (el, path, trigger) {
          // The trigger argument, if called within the directive, fires
          // an event named after the directive on the element, passing
          // any parameters along to the event that you pass to trigger.
          //
          // ex. trigger(), trigger([a, b, c]), or trigger(a, b, c)
          //
          // This allows you to bind a callback like so:
          // $('#interchangeContainer').on('replace', function (e, a, b, c) {
          //   console.log($(this).html(), a, b, c);
          // });

          if (/IMG/.test(el[0].nodeName)) {
            var orig_path = el[0].src;

            if (new RegExp(path, 'i').test(orig_path)) {
              return;
            }

            el[0].src = path;

            return trigger(el[0].src);
          }
          var last_path = el.data(this.data_attr + '-last-path'),
              self = this;

          if (last_path == path) {
            return;
          }

          if (/\.(gif|jpg|jpeg|tiff|png)([?#].*)?/i.test(path)) {
            $(el).css('background-image', 'url(' + path + ')');
            el.data('interchange-last-path', path);
            return trigger(path);
          }

          return $.get(path, function (response) {
            el.html(response);
            el.data(self.data_attr + '-last-path', path);
            trigger();
          });

        }
      }
    },

    init : function (scope, method, options) {
      Foundation.inherit(this, 'throttle random_str');

      this.data_attr = this.set_data_attr();
      $.extend(true, this.settings, method, options);
      this.bindings(method, options);
      this.load('images');
      this.load('nodes');
    },

    get_media_hash : function () {
        var mediaHash = '';
        for (var queryName in this.settings.named_queries ) {
            mediaHash += matchMedia(this.settings.named_queries[queryName]).matches.toString();
        }
        return mediaHash;
    },

    events : function () {
      var self = this, prevMediaHash;

      $(window)
        .off('.interchange')
        .on('resize.fndtn.interchange', self.throttle(function () {
            var currMediaHash = self.get_media_hash();
            if (currMediaHash !== prevMediaHash) {
                self.resize();
            }
            prevMediaHash = currMediaHash;
        }, 50));

      return this;
    },

    resize : function () {
      var cache = this.cache;

      if (!this.images_loaded || !this.nodes_loaded) {
        setTimeout($.proxy(this.resize, this), 50);
        return;
      }

      for (var uuid in cache) {
        if (cache.hasOwnProperty(uuid)) {
          var passed = this.results(uuid, cache[uuid]);

          if (passed) {
            this.settings.directives[passed
              .scenario[1]].call(this, passed.el, passed.scenario[0], (function (passed) {
                if (arguments[0] instanceof Array) { 
                  var args = arguments[0];
                } else {
                  var args = Array.prototype.slice.call(arguments, 0);
                }

                return function() {
                  passed.el.trigger(passed.scenario[1], args);
                }
              }(passed)));
          }
        }
      }

    },

    results : function (uuid, scenarios) {
      var count = scenarios.length;

      if (count > 0) {
        var el = this.S('[' + this.add_namespace('data-uuid') + '="' + uuid + '"]');

        while (count--) {
          var mq, rule = scenarios[count][2];
          if (this.settings.named_queries.hasOwnProperty(rule)) {
            mq = matchMedia(this.settings.named_queries[rule]);
          } else {
            mq = matchMedia(rule);
          }
          if (mq.matches) {
            return {el : el, scenario : scenarios[count]};
          }
        }
      }

      return false;
    },

    load : function (type, force_update) {
      if (typeof this['cached_' + type] === 'undefined' || force_update) {
        this['update_' + type]();
      }

      return this['cached_' + type];
    },

    update_images : function () {
      var images = this.S('img[' + this.data_attr + ']'),
          count = images.length,
          i = count,
          loaded_count = 0,
          data_attr = this.data_attr;

      this.cache = {};
      this.cached_images = [];
      this.images_loaded = (count === 0);

      while (i--) {
        loaded_count++;
        if (images[i]) {
          var str = images[i].getAttribute(data_attr) || '';

          if (str.length > 0) {
            this.cached_images.push(images[i]);
          }
        }

        if (loaded_count === count) {
          this.images_loaded = true;
          this.enhance('images');
        }
      }

      return this;
    },

    update_nodes : function () {
      var nodes = this.S('[' + this.data_attr + ']').not('img'),
          count = nodes.length,
          i = count,
          loaded_count = 0,
          data_attr = this.data_attr;

      this.cached_nodes = [];
      this.nodes_loaded = (count === 0);

      while (i--) {
        loaded_count++;
        var str = nodes[i].getAttribute(data_attr) || '';

        if (str.length > 0) {
          this.cached_nodes.push(nodes[i]);
        }

        if (loaded_count === count) {
          this.nodes_loaded = true;
          this.enhance('nodes');
        }
      }

      return this;
    },

    enhance : function (type) {
      var i = this['cached_' + type].length;

      while (i--) {
        this.object($(this['cached_' + type][i]));
      }

      return $(window).trigger('resize').trigger('resize.fndtn.interchange');
    },

    convert_directive : function (directive) {

      var trimmed = this.trim(directive);

      if (trimmed.length > 0) {
        return trimmed;
      }

      return 'replace';
    },

    parse_scenario : function (scenario) {
      // This logic had to be made more complex since some users were using commas in the url path
      // So we cannot simply just split on a comma
      var directive_match = scenario[0].match(/(.+),\s*(\w+)\s*$/),
      media_query         = scenario[1];

      if (directive_match) {
        var path  = directive_match[1],
        directive = directive_match[2];
      } else {
        var cached_split = scenario[0].split(/,\s*$/),
        path             = cached_split[0],
        directive        = '';
      }

      return [this.trim(path), this.convert_directive(directive), this.trim(media_query)];
    },

    object : function (el) {
      var raw_arr = this.parse_data_attr(el),
          scenarios = [],
          i = raw_arr.length;

      if (i > 0) {
        while (i--) {
          var split = raw_arr[i].split(/\(([^\)]*?)(\))$/);

          if (split.length > 1) {
            var params = this.parse_scenario(split);
            scenarios.push(params);
          }
        }
      }

      return this.store(el, scenarios);
    },

    store : function (el, scenarios) {
      var uuid = this.random_str(),
          current_uuid = el.data(this.add_namespace('uuid', true));

      if (this.cache[current_uuid]) {
        return this.cache[current_uuid];
      }

      el.attr(this.add_namespace('data-uuid'), uuid);

      return this.cache[uuid] = scenarios;
    },

    trim : function (str) {

      if (typeof str === 'string') {
        return $.trim(str);
      }

      return str;
    },

    set_data_attr : function (init) {
      if (init) {
        if (this.namespace.length > 0) {
          return this.namespace + '-' + this.settings.load_attr;
        }

        return this.settings.load_attr;
      }

      if (this.namespace.length > 0) {
        return 'data-' + this.namespace + '-' + this.settings.load_attr;
      }

      return 'data-' + this.settings.load_attr;
    },

    parse_data_attr : function (el) {
      var raw = el.attr(this.attr_name()).split(/\[(.*?)\]/),
          i = raw.length,
          output = [];

      while (i--) {
        if (raw[i].replace(/[\W\d]+/, '').length > 4) {
          output.push(raw[i]);
        }
      }

      return output;
    },

    reflow : function () {
      this.load('images', true);
      this.load('nodes', true);
    }

  };

}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs['magellan-expedition'] = {
    name : 'magellan-expedition',

    version : '5.5.1',

    settings : {
      active_class : 'active',
      threshold : 0, // pixels from the top of the expedition for it to become fixes
      destination_threshold : 20, // pixels from the top of destination for it to be considered active
      throttle_delay : 30, // calculation throttling to increase framerate
      fixed_top : 0, // top distance in pixels assigend to the fixed element on scroll
      offset_by_height : true,  // whether to offset the destination by the expedition height. Usually you want this to be true, unless your expedition is on the side.
      duration : 700, // animation duration time
      easing : 'swing' // animation easing
    },

    init : function (scope, method, options) {
      Foundation.inherit(this, 'throttle');
      this.bindings(method, options);
    },

    events : function () {
      var self = this,
          S = self.S,
          settings = self.settings;

      // initialize expedition offset
      self.set_expedition_position();

      S(self.scope)
        .off('.magellan')
        .on('click.fndtn.magellan', '[' + self.add_namespace('data-magellan-arrival') + '] a[href^="#"]', function (e) {
          e.preventDefault();
          var expedition = $(this).closest('[' + self.attr_name() + ']'),
              settings = expedition.data('magellan-expedition-init'),
              hash = this.hash.split('#').join(''),
              target = $('a[name="' + hash + '"]');

          if (target.length === 0) {
            target = $('#' + hash);

          }

          // Account for expedition height if fixed position
          var scroll_top = target.offset().top - settings.destination_threshold + 1;
          if (settings.offset_by_height) {
            scroll_top = scroll_top - expedition.outerHeight();
          }

          $('html, body').stop().animate({
            'scrollTop' : scroll_top
          }, settings.duration, settings.easing, function () {
            if (history.pushState) {
              history.pushState(null, null, '#' + hash);
            } else {
              location.hash = '#' + hash;
            }
          });
        })
        .on('scroll.fndtn.magellan', self.throttle(this.check_for_arrivals.bind(this), settings.throttle_delay));

      $(window)
        .on('resize.fndtn.magellan', self.throttle(this.set_expedition_position.bind(this), settings.throttle_delay));
    },

    check_for_arrivals : function () {
      var self = this;
      self.update_arrivals();
      self.update_expedition_positions();
    },

    set_expedition_position : function () {
      var self = this;
      $('[' + this.attr_name() + '=fixed]', self.scope).each(function (idx, el) {
        var expedition = $(this),
            settings = expedition.data('magellan-expedition-init'),
            styles = expedition.attr('styles'), // save styles
            top_offset, fixed_top;

        expedition.attr('style', '');
        top_offset = expedition.offset().top + settings.threshold;

        //set fixed-top by attribute
        fixed_top = parseInt(expedition.data('magellan-fixed-top'));
        if (!isNaN(fixed_top)) {
          self.settings.fixed_top = fixed_top;
        }

        expedition.data(self.data_attr('magellan-top-offset'), top_offset);
        expedition.attr('style', styles);
      });
    },

    update_expedition_positions : function () {
      var self = this,
          window_top_offset = $(window).scrollTop();

      $('[' + this.attr_name() + '=fixed]', self.scope).each(function () {
        var expedition = $(this),
            settings = expedition.data('magellan-expedition-init'),
            styles = expedition.attr('style'), // save styles
            top_offset = expedition.data('magellan-top-offset');

        //scroll to the top distance
        if (window_top_offset + self.settings.fixed_top >= top_offset) {
          // Placeholder allows height calculations to be consistent even when
          // appearing to switch between fixed/non-fixed placement
          var placeholder = expedition.prev('[' + self.add_namespace('data-magellan-expedition-clone') + ']');
          if (placeholder.length === 0) {
            placeholder = expedition.clone();
            placeholder.removeAttr(self.attr_name());
            placeholder.attr(self.add_namespace('data-magellan-expedition-clone'), '');
            expedition.before(placeholder);
          }
          expedition.css({position :'fixed', top : settings.fixed_top}).addClass('fixed');
        } else {
          expedition.prev('[' + self.add_namespace('data-magellan-expedition-clone') + ']').remove();
          expedition.attr('style', styles).css('position', '').css('top', '').removeClass('fixed');
        }
      });
    },

    update_arrivals : function () {
      var self = this,
          window_top_offset = $(window).scrollTop();

      $('[' + this.attr_name() + ']', self.scope).each(function () {
        var expedition = $(this),
            settings = expedition.data(self.attr_name(true) + '-init'),
            offsets = self.offsets(expedition, window_top_offset),
            arrivals = expedition.find('[' + self.add_namespace('data-magellan-arrival') + ']'),
            active_item = false;
        offsets.each(function (idx, item) {
          if (item.viewport_offset >= item.top_offset) {
            var arrivals = expedition.find('[' + self.add_namespace('data-magellan-arrival') + ']');
            arrivals.not(item.arrival).removeClass(settings.active_class);
            item.arrival.addClass(settings.active_class);
            active_item = true;
            return true;
          }
        });

        if (!active_item) {
          arrivals.removeClass(settings.active_class);
        }
      });
    },

    offsets : function (expedition, window_offset) {
      var self = this,
          settings = expedition.data(self.attr_name(true) + '-init'),
          viewport_offset = window_offset;

      return expedition.find('[' + self.add_namespace('data-magellan-arrival') + ']').map(function (idx, el) {
        var name = $(this).data(self.data_attr('magellan-arrival')),
            dest = $('[' + self.add_namespace('data-magellan-destination') + '=' + name + ']');
        if (dest.length > 0) {
          var top_offset = dest.offset().top - settings.destination_threshold;
          if (settings.offset_by_height) {
            top_offset = top_offset - expedition.outerHeight();
          }
          top_offset = Math.floor(top_offset);
          return {
            destination : dest,
            arrival : $(this),
            top_offset : top_offset,
            viewport_offset : viewport_offset
          }
        }
      }).sort(function (a, b) {
        if (a.top_offset < b.top_offset) {
          return -1;
        }
        if (a.top_offset > b.top_offset) {
          return 1;
        }
        return 0;
      });
    },

    data_attr : function (str) {
      if (this.namespace.length > 0) {
        return this.namespace + '-' + str;
      }

      return str;
    },

    off : function () {
      this.S(this.scope).off('.magellan');
      this.S(window).off('.magellan');
    },

    reflow : function () {
      var self = this;
      // remove placeholder expeditions used for height calculation purposes
      $('[' + self.add_namespace('data-magellan-expedition-clone') + ']', self.scope).remove();
    }
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.accordion = {
    name : 'accordion',

    version : '5.5.1',

    settings : {
      content_class : 'content',
      active_class : 'active',
      multi_expand : false,
      toggleable : true,
      callback : function () {}
    },

    init : function (scope, method, options) {
      this.bindings(method, options);
    },

    events : function () {
      var self = this;
      var S = this.S;
      S(this.scope)
      .off('.fndtn.accordion')
      .on('click.fndtn.accordion', '[' + this.attr_name() + '] > .accordion-navigation > a', function (e) {
        var accordion = S(this).closest('[' + self.attr_name() + ']'),
            groupSelector = self.attr_name() + '=' + accordion.attr(self.attr_name()),
            settings = accordion.data(self.attr_name(true) + '-init') || self.settings,
            target = S('#' + this.href.split('#')[1]),
            aunts = $('> .accordion-navigation', accordion),
            siblings = aunts.children('.' + settings.content_class),
            active_content = siblings.filter('.' + settings.active_class);

        e.preventDefault();

        if (accordion.attr(self.attr_name())) {
          siblings = siblings.add('[' + groupSelector + '] dd > ' + '.' + settings.content_class);
          aunts = aunts.add('[' + groupSelector + '] .accordion-navigation');
        }

        if (settings.toggleable && target.is(active_content)) {
          target.parent('.accordion-navigation').toggleClass(settings.active_class, false);
          target.toggleClass(settings.active_class, false);
          settings.callback(target);
          target.triggerHandler('toggled', [accordion]);
          accordion.triggerHandler('toggled', [target]);
          return;
        }

        if (!settings.multi_expand) {
          siblings.removeClass(settings.active_class);
          aunts.removeClass(settings.active_class);
        }

        target.addClass(settings.active_class).parent().addClass(settings.active_class);
        settings.callback(target);
        target.triggerHandler('toggled', [accordion]);
        accordion.triggerHandler('toggled', [target]);
      });
    },

    off : function () {},

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.topbar = {
    name : 'topbar',

    version : '5.5.1',

    settings : {
      index : 0,
      sticky_class : 'sticky',
      custom_back_text : true,
      back_text : 'Back',
      mobile_show_parent_link : true,
      is_hover : true,
      scrolltop : true, // jump to top when sticky nav menu toggle is clicked
      sticky_on : 'all'
    },

    init : function (section, method, options) {
      Foundation.inherit(this, 'add_custom_rule register_media throttle');
      var self = this;

      self.register_media('topbar', 'foundation-mq-topbar');

      this.bindings(method, options);

      self.S('[' + this.attr_name() + ']', this.scope).each(function () {
        var topbar = $(this),
            settings = topbar.data(self.attr_name(true) + '-init'),
            section = self.S('section, .top-bar-section', this);
        topbar.data('index', 0);
        var topbarContainer = topbar.parent();
        if (topbarContainer.hasClass('fixed') || self.is_sticky(topbar, topbarContainer, settings) ) {
          self.settings.sticky_class = settings.sticky_class;
          self.settings.sticky_topbar = topbar;
          topbar.data('height', topbarContainer.outerHeight());
          topbar.data('stickyoffset', topbarContainer.offset().top);
        } else {
          topbar.data('height', topbar.outerHeight());
        }

        if (!settings.assembled) {
          self.assemble(topbar);
        }

        if (settings.is_hover) {
          self.S('.has-dropdown', topbar).addClass('not-click');
        } else {
          self.S('.has-dropdown', topbar).removeClass('not-click');
        }

        // Pad body when sticky (scrolled) or fixed.
        self.add_custom_rule('.f-topbar-fixed { padding-top: ' + topbar.data('height') + 'px }');

        if (topbarContainer.hasClass('fixed')) {
          self.S('body').addClass('f-topbar-fixed');
        }
      });

    },

    is_sticky : function (topbar, topbarContainer, settings) {
      var sticky     = topbarContainer.hasClass(settings.sticky_class);
      var smallMatch = matchMedia(Foundation.media_queries.small).matches;
      var medMatch   = matchMedia(Foundation.media_queries.medium).matches;
      var lrgMatch   = matchMedia(Foundation.media_queries.large).matches;
      
       if (sticky && settings.sticky_on === 'all') {
          return true;
       }
       if (sticky && this.small() && settings.sticky_on.indexOf('small') !== -1) {
           if (smallMatch && !medMatch && !lrgMatch) { return true; }
       }
       if (sticky && this.medium() && settings.sticky_on.indexOf('medium') !== -1) {
           if (smallMatch && medMatch && !lrgMatch) { return true; }
       }
       if (sticky && this.large() && settings.sticky_on.indexOf('large') !== -1) {
           if (smallMatch && medMatch && lrgMatch) { return true; }
       }

       // fix for iOS browsers
       if (sticky && navigator.userAgent.match(/(iPad|iPhone|iPod)/g)) {
        return true;
       }
       return false;
    },

    toggle : function (toggleEl) {
      var self = this,
          topbar;

      if (toggleEl) {
        topbar = self.S(toggleEl).closest('[' + this.attr_name() + ']');
      } else {
        topbar = self.S('[' + this.attr_name() + ']');
      }

      var settings = topbar.data(this.attr_name(true) + '-init');

      var section = self.S('section, .top-bar-section', topbar);

      if (self.breakpoint()) {
        if (!self.rtl) {
          section.css({left : '0%'});
          $('>.name', section).css({left : '100%'});
        } else {
          section.css({right : '0%'});
          $('>.name', section).css({right : '100%'});
        }

        self.S('li.moved', section).removeClass('moved');
        topbar.data('index', 0);

        topbar
          .toggleClass('expanded')
          .css('height', '');
      }

      if (settings.scrolltop) {
        if (!topbar.hasClass('expanded')) {
          if (topbar.hasClass('fixed')) {
            topbar.parent().addClass('fixed');
            topbar.removeClass('fixed');
            self.S('body').addClass('f-topbar-fixed');
          }
        } else if (topbar.parent().hasClass('fixed')) {
          if (settings.scrolltop) {
            topbar.parent().removeClass('fixed');
            topbar.addClass('fixed');
            self.S('body').removeClass('f-topbar-fixed');

            window.scrollTo(0, 0);
          } else {
            topbar.parent().removeClass('expanded');
          }
        }
      } else {
        if (self.is_sticky(topbar, topbar.parent(), settings)) {
          topbar.parent().addClass('fixed');
        }

        if (topbar.parent().hasClass('fixed')) {
          if (!topbar.hasClass('expanded')) {
            topbar.removeClass('fixed');
            topbar.parent().removeClass('expanded');
            self.update_sticky_positioning();
          } else {
            topbar.addClass('fixed');
            topbar.parent().addClass('expanded');
            self.S('body').addClass('f-topbar-fixed');
          }
        }
      }
    },

    timer : null,

    events : function (bar) {
      var self = this,
          S = this.S;

      S(this.scope)
        .off('.topbar')
        .on('click.fndtn.topbar', '[' + this.attr_name() + '] .toggle-topbar', function (e) {
          e.preventDefault();
          self.toggle(this);
        })
        .on('click.fndtn.topbar', '.top-bar .top-bar-section li a[href^="#"],[' + this.attr_name() + '] .top-bar-section li a[href^="#"]', function (e) {
            var li = $(this).closest('li');
            if (self.breakpoint() && !li.hasClass('back') && !li.hasClass('has-dropdown')) {
              self.toggle();
            }
        })
        .on('click.fndtn.topbar', '[' + this.attr_name() + '] li.has-dropdown', function (e) {
          var li = S(this),
              target = S(e.target),
              topbar = li.closest('[' + self.attr_name() + ']'),
              settings = topbar.data(self.attr_name(true) + '-init');

          if (target.data('revealId')) {
            self.toggle();
            return;
          }

          if (self.breakpoint()) {
            return;
          }

          if (settings.is_hover && !Modernizr.touch) {
            return;
          }

          e.stopImmediatePropagation();

          if (li.hasClass('hover')) {
            li
              .removeClass('hover')
              .find('li')
              .removeClass('hover');

            li.parents('li.hover')
              .removeClass('hover');
          } else {
            li.addClass('hover');

            $(li).siblings().removeClass('hover');

            if (target[0].nodeName === 'A' && target.parent().hasClass('has-dropdown')) {
              e.preventDefault();
            }
          }
        })
        .on('click.fndtn.topbar', '[' + this.attr_name() + '] .has-dropdown>a', function (e) {
          if (self.breakpoint()) {

            e.preventDefault();

            var $this = S(this),
                topbar = $this.closest('[' + self.attr_name() + ']'),
                section = topbar.find('section, .top-bar-section'),
                dropdownHeight = $this.next('.dropdown').outerHeight(),
                $selectedLi = $this.closest('li');

            topbar.data('index', topbar.data('index') + 1);
            $selectedLi.addClass('moved');

            if (!self.rtl) {
              section.css({left : -(100 * topbar.data('index')) + '%'});
              section.find('>.name').css({left : 100 * topbar.data('index') + '%'});
            } else {
              section.css({right : -(100 * topbar.data('index')) + '%'});
              section.find('>.name').css({right : 100 * topbar.data('index') + '%'});
            }

            topbar.css('height', $this.siblings('ul').outerHeight(true) + topbar.data('height'));
          }
        });

      S(window).off('.topbar').on('resize.fndtn.topbar', self.throttle(function () {
          self.resize.call(self);
      }, 50)).trigger('resize').trigger('resize.fndtn.topbar').load(function () {
          // Ensure that the offset is calculated after all of the pages resources have loaded
          S(this).trigger('resize.fndtn.topbar');
      });

      S('body').off('.topbar').on('click.fndtn.topbar', function (e) {
        var parent = S(e.target).closest('li').closest('li.hover');

        if (parent.length > 0) {
          return;
        }

        S('[' + self.attr_name() + '] li.hover').removeClass('hover');
      });

      // Go up a level on Click
      S(this.scope).on('click.fndtn.topbar', '[' + this.attr_name() + '] .has-dropdown .back', function (e) {
        e.preventDefault();

        var $this = S(this),
            topbar = $this.closest('[' + self.attr_name() + ']'),
            section = topbar.find('section, .top-bar-section'),
            settings = topbar.data(self.attr_name(true) + '-init'),
            $movedLi = $this.closest('li.moved'),
            $previousLevelUl = $movedLi.parent();

        topbar.data('index', topbar.data('index') - 1);

        if (!self.rtl) {
          section.css({left : -(100 * topbar.data('index')) + '%'});
          section.find('>.name').css({left : 100 * topbar.data('index') + '%'});
        } else {
          section.css({right : -(100 * topbar.data('index')) + '%'});
          section.find('>.name').css({right : 100 * topbar.data('index') + '%'});
        }

        if (topbar.data('index') === 0) {
          topbar.css('height', '');
        } else {
          topbar.css('height', $previousLevelUl.outerHeight(true) + topbar.data('height'));
        }

        setTimeout(function () {
          $movedLi.removeClass('moved');
        }, 300);
      });

      // Show dropdown menus when their items are focused
      S(this.scope).find('.dropdown a')
        .focus(function () {
          $(this).parents('.has-dropdown').addClass('hover');
        })
        .blur(function () {
          $(this).parents('.has-dropdown').removeClass('hover');
        });
    },

    resize : function () {
      var self = this;
      self.S('[' + this.attr_name() + ']').each(function () {
        var topbar = self.S(this),
            settings = topbar.data(self.attr_name(true) + '-init');

        var stickyContainer = topbar.parent('.' + self.settings.sticky_class);
        var stickyOffset;

        if (!self.breakpoint()) {
          var doToggle = topbar.hasClass('expanded');
          topbar
            .css('height', '')
            .removeClass('expanded')
            .find('li')
            .removeClass('hover');

            if (doToggle) {
              self.toggle(topbar);
            }
        }

        if (self.is_sticky(topbar, stickyContainer, settings)) {
          if (stickyContainer.hasClass('fixed')) {
            // Remove the fixed to allow for correct calculation of the offset.
            stickyContainer.removeClass('fixed');

            stickyOffset = stickyContainer.offset().top;
            if (self.S(document.body).hasClass('f-topbar-fixed')) {
              stickyOffset -= topbar.data('height');
            }

            topbar.data('stickyoffset', stickyOffset);
            stickyContainer.addClass('fixed');
          } else {
            stickyOffset = stickyContainer.offset().top;
            topbar.data('stickyoffset', stickyOffset);
          }
        }

      });
    },

    breakpoint : function () {
      return !matchMedia(Foundation.media_queries['topbar']).matches;
    },

    small : function () {
      return matchMedia(Foundation.media_queries['small']).matches;
    },

    medium : function () {
      return matchMedia(Foundation.media_queries['medium']).matches;
    },

    large : function () {
      return matchMedia(Foundation.media_queries['large']).matches;
    },

    assemble : function (topbar) {
      var self = this,
          settings = topbar.data(this.attr_name(true) + '-init'),
          section = self.S('section, .top-bar-section', topbar);

      // Pull element out of the DOM for manipulation
      section.detach();

      self.S('.has-dropdown>a', section).each(function () {
        var $link = self.S(this),
            $dropdown = $link.siblings('.dropdown'),
            url = $link.attr('href'),
            $titleLi;

        if (!$dropdown.find('.title.back').length) {

          if (settings.mobile_show_parent_link == true && url) {
            $titleLi = $('<li class="title back js-generated"><h5><a href="javascript:void(0)"></a></h5></li><li class="parent-link hide-for-large-up"><a class="parent-link js-generated" href="' + url + '">' + $link.html() +'</a></li>');
          } else {
            $titleLi = $('<li class="title back js-generated"><h5><a href="javascript:void(0)"></a></h5>');
          }

          // Copy link to subnav
          if (settings.custom_back_text == true) {
            $('h5>a', $titleLi).html(settings.back_text);
          } else {
            $('h5>a', $titleLi).html('&laquo; ' + $link.html());
          }
          $dropdown.prepend($titleLi);
        }
      });

      // Put element back in the DOM
      section.appendTo(topbar);

      // check for sticky
      this.sticky();

      this.assembled(topbar);
    },

    assembled : function (topbar) {
      topbar.data(this.attr_name(true), $.extend({}, topbar.data(this.attr_name(true)), {assembled : true}));
    },

    height : function (ul) {
      var total = 0,
          self = this;

      $('> li', ul).each(function () {
        total += self.S(this).outerHeight(true);
      });

      return total;
    },

    sticky : function () {
      var self = this;

      this.S(window).on('scroll', function () {
        self.update_sticky_positioning();
      });
    },

    update_sticky_positioning : function () {
      var klass = '.' + this.settings.sticky_class,
          $window = this.S(window),
          self = this;

      if (self.settings.sticky_topbar && self.is_sticky(this.settings.sticky_topbar, this.settings.sticky_topbar.parent(), this.settings)) {
        var distance = this.settings.sticky_topbar.data('stickyoffset');
        if (!self.S(klass).hasClass('expanded')) {
          if ($window.scrollTop() > (distance)) {
            if (!self.S(klass).hasClass('fixed')) {
              self.S(klass).addClass('fixed');
              self.S('body').addClass('f-topbar-fixed');
            }
          } else if ($window.scrollTop() <= distance) {
            if (self.S(klass).hasClass('fixed')) {
              self.S(klass).removeClass('fixed');
              self.S('body').removeClass('f-topbar-fixed');
            }
          }
        }
      }
    },

    off : function () {
      this.S(this.scope).off('.fndtn.topbar');
      this.S(window).off('.fndtn.topbar');
    },

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.tab = {
    name : 'tab',

    version : '5.5.1',

    settings : {
      active_class : 'active',
      callback : function () {},
      deep_linking : false,
      scroll_to_content : true,
      is_hover : false
    },

    default_tab_hashes : [],

    init : function (scope, method, options) {
      var self = this,
          S = this.S;

      this.bindings(method, options);

      // store the initial href, which is used to allow correct behaviour of the
      // browser back button when deep linking is turned on.
      self.entry_location = window.location.href;

      this.handle_location_hash_change();

      // Store the default active tabs which will be referenced when the
      // location hash is absent, as in the case of navigating the tabs and
      // returning to the first viewing via the browser Back button.
      S('[' + this.attr_name() + '] > .active > a', this.scope).each(function () {
        self.default_tab_hashes.push(this.hash);
      });
    },

    events : function () {
      var self = this,
          S = this.S;

      var usual_tab_behavior =  function (e) {
          var settings = S(this).closest('[' + self.attr_name() + ']').data(self.attr_name(true) + '-init');
          if (!settings.is_hover || Modernizr.touch) {
            e.preventDefault();
            e.stopPropagation();
            self.toggle_active_tab(S(this).parent());
          }
        };

      S(this.scope)
        .off('.tab')
        // Click event: tab title
        .on('focus.fndtn.tab', '[' + this.attr_name() + '] > * > a', usual_tab_behavior )
        .on('click.fndtn.tab', '[' + this.attr_name() + '] > * > a', usual_tab_behavior )
        // Hover event: tab title
        .on('mouseenter.fndtn.tab', '[' + this.attr_name() + '] > * > a', function (e) {
          var settings = S(this).closest('[' + self.attr_name() + ']').data(self.attr_name(true) + '-init');
          if (settings.is_hover) {
            self.toggle_active_tab(S(this).parent());
          }
        });

      // Location hash change event
      S(window).on('hashchange.fndtn.tab', function (e) {
        e.preventDefault();
        self.handle_location_hash_change();
      });
    },

    handle_location_hash_change : function () {

      var self = this,
          S = this.S;

      S('[' + this.attr_name() + ']', this.scope).each(function () {
        var settings = S(this).data(self.attr_name(true) + '-init');
        if (settings.deep_linking) {
          // Match the location hash to a label
          var hash;
          if (settings.scroll_to_content) {
            hash = self.scope.location.hash;
          } else {
            // prefix the hash to prevent anchor scrolling
            hash = self.scope.location.hash.replace('fndtn-', '');
          }
          if (hash != '') {
            // Check whether the location hash references a tab content div or
            // another element on the page (inside or outside the tab content div)
            var hash_element = S(hash);
            if (hash_element.hasClass('content') && hash_element.parent().hasClass('tabs-content')) {
              // Tab content div
              self.toggle_active_tab($('[' + self.attr_name() + '] > * > a[href=' + hash + ']').parent());
            } else {
              // Not the tab content div. If inside the tab content, find the
              // containing tab and toggle it as active.
              var hash_tab_container_id = hash_element.closest('.content').attr('id');
              if (hash_tab_container_id != undefined) {
                self.toggle_active_tab($('[' + self.attr_name() + '] > * > a[href=#' + hash_tab_container_id + ']').parent(), hash);
              }
            }
          } else {
            // Reference the default tab hashes which were initialized in the init function
            for (var ind = 0; ind < self.default_tab_hashes.length; ind++) {
              self.toggle_active_tab($('[' + self.attr_name() + '] > * > a[href=' + self.default_tab_hashes[ind] + ']').parent());
            }
          }
        }
       });
     },

    toggle_active_tab : function (tab, location_hash) {
      var self = this,
          S = self.S,
          tabs = tab.closest('[' + this.attr_name() + ']'),
          tab_link = tab.find('a'),
          anchor = tab.children('a').first(),
          target_hash = '#' + anchor.attr('href').split('#')[1],
          target = S(target_hash),
          siblings = tab.siblings(),
          settings = tabs.data(this.attr_name(true) + '-init'),
          interpret_keyup_action = function (e) {
            // Light modification of Heydon Pickering's Practical ARIA Examples: http://heydonworks.com/practical_aria_examples/js/a11y.js

            // define current, previous and next (possible) tabs

            var $original = $(this);
            var $prev = $(this).parents('li').prev().children('[role="tab"]');
            var $next = $(this).parents('li').next().children('[role="tab"]');
            var $target;

            // find the direction (prev or next)

            switch (e.keyCode) {
              case 37:
                $target = $prev;
                break;
              case 39:
                $target = $next;
                break;
              default:
                $target = false
                  break;
            }

            if ($target.length) {
              $original.attr({
                'tabindex' : '-1',
                'aria-selected' : null
              });
              $target.attr({
                'tabindex' : '0',
                'aria-selected' : true
              }).focus();
            }

            // Hide panels

            $('[role="tabpanel"]')
              .attr('aria-hidden', 'true');

            // Show panel which corresponds to target

            $('#' + $(document.activeElement).attr('href').substring(1))
              .attr('aria-hidden', null);

          },
          go_to_hash = function(hash) {
            // This function allows correct behaviour of the browser's back button when deep linking is enabled. Without it
            // the user would get continually redirected to the default hash.
            var is_entry_location = window.location.href === self.entry_location,
                default_hash = settings.scroll_to_content ? self.default_tab_hashes[0] : is_entry_location ? window.location.hash :'fndtn-' + self.default_tab_hashes[0].replace('#', '')

            if (!(is_entry_location && hash === default_hash)) {
              window.location.hash = hash;
            }
          };

      // allow usage of data-tab-content attribute instead of href
      if (S(this).data(this.data_attr('tab-content'))) {
        target_hash = '#' + S(this).data(this.data_attr('tab-content')).split('#')[1];
        target = S(target_hash);
      }

      if (settings.deep_linking) {

        if (settings.scroll_to_content) {

          // retain current hash to scroll to content
          go_to_hash(location_hash || target_hash);

          if (location_hash == undefined || location_hash == target_hash) {
            tab.parent()[0].scrollIntoView();
          } else {
            S(target_hash)[0].scrollIntoView();
          }
        } else {
          // prefix the hashes so that the browser doesn't scroll down
          if (location_hash != undefined) {
            go_to_hash('fndtn-' + location_hash.replace('#', ''));
          } else {
            go_to_hash('fndtn-' + target_hash.replace('#', ''));
          }
        }
      }

      // WARNING: The activation and deactivation of the tab content must
      // occur after the deep linking in order to properly refresh the browser
      // window (notably in Chrome).
      // Clean up multiple attr instances to done once
      tab.addClass(settings.active_class).triggerHandler('opened');
      tab_link.attr({'aria-selected' : 'true',  tabindex : 0});
      siblings.removeClass(settings.active_class)
      siblings.find('a').attr({'aria-selected' : 'false',  tabindex : -1});
      target.siblings().removeClass(settings.active_class).attr({'aria-hidden' : 'true',  tabindex : -1});
      target.addClass(settings.active_class).attr('aria-hidden', 'false').removeAttr('tabindex');
      settings.callback(tab);
      target.triggerHandler('toggled', [tab]);
      tabs.triggerHandler('toggled', [target]);

      tab_link.off('keydown').on('keydown', interpret_keyup_action );
    },

    data_attr : function (str) {
      if (this.namespace.length > 0) {
        return this.namespace + '-' + str;
      }

      return str;
    },

    off : function () {},

    reflow : function () {}
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.abide = {
    name : 'abide',

    version : '5.5.1',

    settings : {
      live_validate : true,
      validate_on_blur : true,
      focus_on_invalid : true,
      error_labels : true, // labels with a for="inputId" will recieve an `error` class
      error_class : 'error',
      timeout : 1000,
      patterns : {
        alpha : /^[a-zA-Z]+$/,
        alpha_numeric : /^[a-zA-Z0-9]+$/,
        integer : /^[-+]?\d+$/,
        number : /^[-+]?\d*(?:[\.\,]\d+)?$/,

        // amex, visa, diners
        card : /^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,
        cvv : /^([0-9]){3,4}$/,

        // http://www.whatwg.org/specs/web-apps/current-work/multipage/states-of-the-type-attribute.html#valid-e-mail-address
        email : /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/,

        url : /^(https?|ftp|file|ssh):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/,
        // abc.de
        domain : /^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,8}$/,

        datetime : /^([0-2][0-9]{3})\-([0-1][0-9])\-([0-3][0-9])T([0-5][0-9])\:([0-5][0-9])\:([0-5][0-9])(Z|([\-\+]([0-1][0-9])\:00))$/,
        // YYYY-MM-DD
        date : /(?:19|20)[0-9]{2}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-9])|(?:(?!02)(?:0[1-9]|1[0-2])-(?:30))|(?:(?:0[13578]|1[02])-31))$/,
        // HH:MM:SS
        time : /^(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}$/,
        dateISO : /^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/,
        // MM/DD/YYYY
        month_day_year : /^(0[1-9]|1[012])[- \/.](0[1-9]|[12][0-9]|3[01])[- \/.]\d{4}$/,
        // DD/MM/YYYY
        day_month_year : /^(0[1-9]|[12][0-9]|3[01])[- \/.](0[1-9]|1[012])[- \/.]\d{4}$/,

        // #FFF or #FFFFFF
        color : /^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/
      },
      validators : {
        equalTo : function (el, required, parent) {
          var from  = document.getElementById(el.getAttribute(this.add_namespace('data-equalto'))).value,
              to    = el.value,
              valid = (from === to);

          return valid;
        }
      }
    },

    timer : null,

    init : function (scope, method, options) {
      this.bindings(method, options);
    },

    events : function (scope) {
      var self = this,
          form = self.S(scope).attr('novalidate', 'novalidate'),
          settings = form.data(this.attr_name(true) + '-init') || {};

      this.invalid_attr = this.add_namespace('data-invalid');

      form
        .off('.abide')
        .on('submit.fndtn.abide validate.fndtn.abide', function (e) {
          var is_ajax = /ajax/i.test(self.S(this).attr(self.attr_name()));
          return self.validate(self.S(this).find('input, textarea, select').get(), e, is_ajax);
        })
        .on('reset', function () {
          return self.reset($(this));
        })
        .find('input, textarea, select')
          .off('.abide')
          .on('blur.fndtn.abide change.fndtn.abide', function (e) {
            if (settings.validate_on_blur === true) {
              self.validate([this], e);
            }
          })
          .on('keydown.fndtn.abide', function (e) {
            if (settings.live_validate === true && e.which != 9) {
              clearTimeout(self.timer);
              self.timer = setTimeout(function () {
                self.validate([this], e);
              }.bind(this), settings.timeout);
            }
          });
    },

    reset : function (form) {
      form.removeAttr(this.invalid_attr);
      $(this.invalid_attr, form).removeAttr(this.invalid_attr);
      $('.' + this.settings.error_class, form).not('small').removeClass(this.settings.error_class);
    },

    validate : function (els, e, is_ajax) {
      var validations = this.parse_patterns(els),
          validation_count = validations.length,
          form = this.S(els[0]).closest('form'),
          submit_event = /submit/.test(e.type);

      // Has to count up to make sure the focus gets applied to the top error
      for (var i = 0; i < validation_count; i++) {
        if (!validations[i] && (submit_event || is_ajax)) {
          if (this.settings.focus_on_invalid) {
            els[i].focus();
          }
          form.trigger('invalid').trigger('invalid.fndtn.abide');
          this.S(els[i]).closest('form').attr(this.invalid_attr, '');
          return false;
        }
      }

      if (submit_event || is_ajax) {
        form.trigger('valid').trigger('valid.fndtn.abide');
      }

      form.removeAttr(this.invalid_attr);

      if (is_ajax) {
        return false;
      }

      return true;
    },

    parse_patterns : function (els) {
      var i = els.length,
          el_patterns = [];

      while (i--) {
        el_patterns.push(this.pattern(els[i]));
      }

      return this.check_validation_and_apply_styles(el_patterns);
    },

    pattern : function (el) {
      var type = el.getAttribute('type'),
          required = typeof el.getAttribute('required') === 'string';

      var pattern = el.getAttribute('pattern') || '';

      if (this.settings.patterns.hasOwnProperty(pattern) && pattern.length > 0) {
        return [el, this.settings.patterns[pattern], required];
      } else if (pattern.length > 0) {
        return [el, new RegExp(pattern), required];
      }

      if (this.settings.patterns.hasOwnProperty(type)) {
        return [el, this.settings.patterns[type], required];
      }

      pattern = /.*/;

      return [el, pattern, required];
    },

    // TODO: Break this up into smaller methods, getting hard to read.
    check_validation_and_apply_styles : function (el_patterns) {
      var i = el_patterns.length,
          validations = [],
          form = this.S(el_patterns[0][0]).closest('[data-' + this.attr_name(true) + ']'),
          settings = form.data(this.attr_name(true) + '-init') || {};
      while (i--) {
        var el = el_patterns[i][0],
            required = el_patterns[i][2],
            value = el.value.trim(),
            direct_parent = this.S(el).parent(),
            validator = el.getAttribute(this.add_namespace('data-abide-validator')),
            is_radio = el.type === 'radio',
            is_checkbox = el.type === 'checkbox',
            label = this.S('label[for="' + el.getAttribute('id') + '"]'),
            valid_length = (required) ? (el.value.length > 0) : true,
            el_validations = [];

        var parent, valid;

        // support old way to do equalTo validations
        if (el.getAttribute(this.add_namespace('data-equalto'))) { validator = 'equalTo' }

        if (!direct_parent.is('label')) {
          parent = direct_parent;
        } else {
          parent = direct_parent.parent();
        }

        if (validator) {
          valid = this.settings.validators[validator].apply(this, [el, required, parent]);
          el_validations.push(valid);
        }

        if (is_radio && required) {
          el_validations.push(this.valid_radio(el, required));
        } else if (is_checkbox && required) {
          el_validations.push(this.valid_checkbox(el, required));
        } else {

          if (el_patterns[i][1].test(value) && valid_length ||
            !required && el.value.length < 1 || $(el).attr('disabled')) {
            el_validations.push(true);
          } else {
            el_validations.push(false);
          }

          el_validations = [el_validations.every(function (valid) {return valid;})];

          if (el_validations[0]) {
            this.S(el).removeAttr(this.invalid_attr);
            el.setAttribute('aria-invalid', 'false');
            el.removeAttribute('aria-describedby');
            parent.removeClass(this.settings.error_class);
            if (label.length > 0 && this.settings.error_labels) {
              label.removeClass(this.settings.error_class).removeAttr('role');
            }
            $(el).triggerHandler('valid');
          } else {
            this.S(el).attr(this.invalid_attr, '');
            el.setAttribute('aria-invalid', 'true');

            // Try to find the error associated with the input
            var errorElem = parent.find('small.' + this.settings.error_class, 'span.' + this.settings.error_class);
            var errorID = errorElem.length > 0 ? errorElem[0].id : '';
            if (errorID.length > 0) {
              el.setAttribute('aria-describedby', errorID);
            }

            // el.setAttribute('aria-describedby', $(el).find('.error')[0].id);
            parent.addClass(this.settings.error_class);
            if (label.length > 0 && this.settings.error_labels) {
              label.addClass(this.settings.error_class).attr('role', 'alert');
            }
            $(el).triggerHandler('invalid');
          }
        }
        validations.push(el_validations[0]);
      }
      validations = [validations.every(function (valid) {return valid;})];
      return validations;
    },

    valid_checkbox : function (el, required) {
      var el = this.S(el),
          valid = (el.is(':checked') || !required || el.get(0).getAttribute('disabled'));

      if (valid) {
        el.removeAttr(this.invalid_attr).parent().removeClass(this.settings.error_class);
      } else {
        el.attr(this.invalid_attr, '').parent().addClass(this.settings.error_class);
      }

      return valid;
    },

    valid_radio : function (el, required) {
      var name = el.getAttribute('name'),
          group = this.S(el).closest('[data-' + this.attr_name(true) + ']').find("[name='" + name + "']"),
          count = group.length,
          valid = false,
          disabled = false;

      // Has to count up to make sure the focus gets applied to the top error
        for (var i=0; i < count; i++) {
            if( group[i].getAttribute('disabled') ){
                disabled=true;
                valid=true;
            } else {
                if (group[i].checked){
                    valid = true;
                } else {
                    if( disabled ){
                        valid = false;
                    }
                }
            }
        }

      // Has to count up to make sure the focus gets applied to the top error
      for (var i = 0; i < count; i++) {
        if (valid) {
          this.S(group[i]).removeAttr(this.invalid_attr).parent().removeClass(this.settings.error_class);
        } else {
          this.S(group[i]).attr(this.invalid_attr, '').parent().addClass(this.settings.error_class);
        }
      }

      return valid;
    },

    valid_equal : function (el, required, parent) {
      var from  = document.getElementById(el.getAttribute(this.add_namespace('data-equalto'))).value,
          to    = el.value,
          valid = (from === to);

      if (valid) {
        this.S(el).removeAttr(this.invalid_attr);
        parent.removeClass(this.settings.error_class);
        if (label.length > 0 && settings.error_labels) {
          label.removeClass(this.settings.error_class);
        }
      } else {
        this.S(el).attr(this.invalid_attr, '');
        parent.addClass(this.settings.error_class);
        if (label.length > 0 && settings.error_labels) {
          label.addClass(this.settings.error_class);
        }
      }

      return valid;
    },

    valid_oneof : function (el, required, parent, doNotValidateOthers) {
      var el = this.S(el),
        others = this.S('[' + this.add_namespace('data-oneof') + ']'),
        valid = others.filter(':checked').length > 0;

      if (valid) {
        el.removeAttr(this.invalid_attr).parent().removeClass(this.settings.error_class);
      } else {
        el.attr(this.invalid_attr, '').parent().addClass(this.settings.error_class);
      }

      if (!doNotValidateOthers) {
        var _this = this;
        others.each(function () {
          _this.valid_oneof.call(_this, this, null, null, true);
        });
      }

      return valid;
    }
  };
}(jQuery, window, window.document));
;(function ($, window, document, undefined) {
  'use strict';

  Foundation.libs.tooltip = {
    name : 'tooltip',

    version : '5.5.1',

    settings : {
      additional_inheritable_classes : [],
      tooltip_class : '.tooltip',
      append_to : 'body',
      touch_close_text : 'Tap To Close',
      disable_for_touch : false,
      hover_delay : 200,
      show_on : 'all',
      tip_template : function (selector, content) {
        return '<span data-selector="' + selector + '" id="' + selector + '" class="'
          + Foundation.libs.tooltip.settings.tooltip_class.substring(1)
          + '" role="tooltip">' + content + '<span class="nub"></span></span>';
      }
    },

    cache : {},

    init : function (scope, method, options) {
      Foundation.inherit(this, 'random_str');
      this.bindings(method, options);
    },

    should_show : function (target, tip) {
      var settings = $.extend({}, this.settings, this.data_options(target));

      if (settings.show_on === 'all') {
        return true;
      } else if (this.small() && settings.show_on === 'small') {
        return true;
      } else if (this.medium() && settings.show_on === 'medium') {
        return true;
      } else if (this.large() && settings.show_on === 'large') {
        return true;
      }
      return false;
    },

    medium : function () {
      return matchMedia(Foundation.media_queries['medium']).matches;
    },

    large : function () {
      return matchMedia(Foundation.media_queries['large']).matches;
    },

    events : function (instance) {
      var self = this,
          S = self.S;

      self.create(this.S(instance));

      $(this.scope)
        .off('.tooltip')
        .on('mouseenter.fndtn.tooltip mouseleave.fndtn.tooltip touchstart.fndtn.tooltip MSPointerDown.fndtn.tooltip',
          '[' + this.attr_name() + ']', function (e) {
          var $this = S(this),
              settings = $.extend({}, self.settings, self.data_options($this)),
              is_touch = false;

          if (Modernizr.touch && /touchstart|MSPointerDown/i.test(e.type) && S(e.target).is('a')) {
            return false;
          }

          if (/mouse/i.test(e.type) && self.ie_touch(e)) {
            return false;
          }

          if ($this.hasClass('open')) {
            if (Modernizr.touch && /touchstart|MSPointerDown/i.test(e.type)) {
              e.preventDefault();
            }
            self.hide($this);
          } else {
            if (settings.disable_for_touch && Modernizr.touch && /touchstart|MSPointerDown/i.test(e.type)) {
              return;
            } else if (!settings.disable_for_touch && Modernizr.touch && /touchstart|MSPointerDown/i.test(e.type)) {
              e.preventDefault();
              S(settings.tooltip_class + '.open').hide();
              is_touch = true;
            }

            if (/enter|over/i.test(e.type)) {
              this.timer = setTimeout(function () {
                var tip = self.showTip($this);
              }.bind(this), self.settings.hover_delay);
            } else if (e.type === 'mouseout' || e.type === 'mouseleave') {
              clearTimeout(this.timer);
              self.hide($this);
            } else {
              self.showTip($this);
            }
          }
        })
        .on('mouseleave.fndtn.tooltip touchstart.fndtn.tooltip MSPointerDown.fndtn.tooltip', '[' + this.attr_name() + '].open', function (e) {
          if (/mouse/i.test(e.type) && self.ie_touch(e)) {
            return false;
          }

          if ($(this).data('tooltip-open-event-type') == 'touch' && e.type == 'mouseleave') {
            return;
          } else if ($(this).data('tooltip-open-event-type') == 'mouse' && /MSPointerDown|touchstart/i.test(e.type)) {
            self.convert_to_touch($(this));
          } else {
            self.hide($(this));
          }
        })
        .on('DOMNodeRemoved DOMAttrModified', '[' + this.attr_name() + ']:not(a)', function (e) {
          self.hide(S(this));
        });
    },

    ie_touch : function (e) {
      // How do I distinguish between IE11 and Windows Phone 8?????
      return false;
    },

    showTip : function ($target) {
      var $tip = this.getTip($target);
      if (this.should_show($target, $tip)) {
        return this.show($target);
      }
      return;
    },

    getTip : function ($target) {
      var selector = this.selector($target),
          settings = $.extend({}, this.settings, this.data_options($target)),
          tip = null;

      if (selector) {
        tip = this.S('span[data-selector="' + selector + '"]' + settings.tooltip_class);
      }

      return (typeof tip === 'object') ? tip : false;
    },

    selector : function ($target) {
      var id = $target.attr('id'),
          dataSelector = $target.attr(this.attr_name()) || $target.attr('data-selector');

      if ((id && id.length < 1 || !id) && typeof dataSelector != 'string') {
        dataSelector = this.random_str(6);
        $target
          .attr('data-selector', dataSelector)
          .attr('aria-describedby', dataSelector);
      }

      return (id && id.length > 0) ? id : dataSelector;
    },

    create : function ($target) {
      var self = this,
          settings = $.extend({}, this.settings, this.data_options($target)),
          tip_template = this.settings.tip_template;

      if (typeof settings.tip_template === 'string' && window.hasOwnProperty(settings.tip_template)) {
        tip_template = window[settings.tip_template];
      }

      var $tip = $(tip_template(this.selector($target), $('<div></div>').html($target.attr('title')).html())),
          classes = this.inheritable_classes($target);

      $tip.addClass(classes).appendTo(settings.append_to);

      if (Modernizr.touch) {
        $tip.append('<span class="tap-to-close">' + settings.touch_close_text + '</span>');
        $tip.on('touchstart.fndtn.tooltip MSPointerDown.fndtn.tooltip', function (e) {
          self.hide($target);
        });
      }

      $target.removeAttr('title').attr('title', '');
    },

    reposition : function (target, tip, classes) {
      var width, nub, nubHeight, nubWidth, column, objPos;

      tip.css('visibility', 'hidden').show();

      width = target.data('width');
      nub = tip.children('.nub');
      nubHeight = nub.outerHeight();
      nubWidth = nub.outerHeight();

      if (this.small()) {
        tip.css({'width' : '100%'});
      } else {
        tip.css({'width' : (width) ? width : 'auto'});
      }

      objPos = function (obj, top, right, bottom, left, width) {
        return obj.css({
          'top' : (top) ? top : 'auto',
          'bottom' : (bottom) ? bottom : 'auto',
          'left' : (left) ? left : 'auto',
          'right' : (right) ? right : 'auto'
        }).end();
      };

      objPos(tip, (target.offset().top + target.outerHeight() + 10), 'auto', 'auto', target.offset().left);

      if (this.small()) {
        objPos(tip, (target.offset().top + target.outerHeight() + 10), 'auto', 'auto', 12.5, $(this.scope).width());
        tip.addClass('tip-override');
        objPos(nub, -nubHeight, 'auto', 'auto', target.offset().left);
      } else {
        var left = target.offset().left;
        if (Foundation.rtl) {
          nub.addClass('rtl');
          left = target.offset().left + target.outerWidth() - tip.outerWidth();
        }
        objPos(tip, (target.offset().top + target.outerHeight() + 10), 'auto', 'auto', left);
        tip.removeClass('tip-override');
        if (classes && classes.indexOf('tip-top') > -1) {
          if (Foundation.rtl) {
            nub.addClass('rtl');
          }
          objPos(tip, (target.offset().top - tip.outerHeight()), 'auto', 'auto', left)
            .removeClass('tip-override');
        } else if (classes && classes.indexOf('tip-left') > -1) {
          objPos(tip, (target.offset().top + (target.outerHeight() / 2) - (tip.outerHeight() / 2)), 'auto', 'auto', (target.offset().left - tip.outerWidth() - nubHeight))
            .removeClass('tip-override');
          nub.removeClass('rtl');
        } else if (classes && classes.indexOf('tip-right') > -1) {
          objPos(tip, (target.offset().top + (target.outerHeight() / 2) - (tip.outerHeight() / 2)), 'auto', 'auto', (target.offset().left + target.outerWidth() + nubHeight))
            .removeClass('tip-override');
          nub.removeClass('rtl');
        }
      }

      tip.css('visibility', 'visible').hide();
    },

    small : function () {
      return matchMedia(Foundation.media_queries.small).matches &&
        !matchMedia(Foundation.media_queries.medium).matches;
    },

    inheritable_classes : function ($target) {
      var settings = $.extend({}, this.settings, this.data_options($target)),
          inheritables = ['tip-top', 'tip-left', 'tip-bottom', 'tip-right', 'radius', 'round'].concat(settings.additional_inheritable_classes),
          classes = $target.attr('class'),
          filtered = classes ? $.map(classes.split(' '), function (el, i) {
            if ($.inArray(el, inheritables) !== -1) {
              return el;
            }
          }).join(' ') : '';

      return $.trim(filtered);
    },

    convert_to_touch : function ($target) {
      var self = this,
          $tip = self.getTip($target),
          settings = $.extend({}, self.settings, self.data_options($target));

      if ($tip.find('.tap-to-close').length === 0) {
        $tip.append('<span class="tap-to-close">' + settings.touch_close_text + '</span>');
        $tip.on('click.fndtn.tooltip.tapclose touchstart.fndtn.tooltip.tapclose MSPointerDown.fndtn.tooltip.tapclose', function (e) {
          self.hide($target);
        });
      }

      $target.data('tooltip-open-event-type', 'touch');
    },

    show : function ($target) {
      var $tip = this.getTip($target);

      if ($target.data('tooltip-open-event-type') == 'touch') {
        this.convert_to_touch($target);
      }

      this.reposition($target, $tip, $target.attr('class'));
      $target.addClass('open');
      $tip.fadeIn(150);
    },

    hide : function ($target) {
      var $tip = this.getTip($target);

      $tip.fadeOut(150, function () {
        $tip.find('.tap-to-close').remove();
        $tip.off('click.fndtn.tooltip.tapclose MSPointerDown.fndtn.tapclose');
        $target.removeClass('open');
      });
    },

    off : function () {
      var self = this;
      this.S(this.scope).off('.fndtn.tooltip');
      this.S(this.settings.tooltip_class).each(function (i) {
        $('[' + self.attr_name() + ']').eq(i).attr('title', $(this).text());
      }).remove();
    },

    reflow : function () {}
  };
}(jQuery, window, window.document));

define("foundation-min", function(){});

/**
 * @file        foundation-init.js
 * @desc        Devapt adapter for Foundation
 * @ingroup     LIBAPT_FOUNDATION
 * @date        2014-07-27
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('plugins/backend-foundation5/foundation-init',['modernizr', 'Devapt', 'core/application', 'foundation-min'],
function(m, Devapt, DevaptApplication, undefined)
{
	var foundation_version = '5.x.x';
	console.info('Loading Foundation ' + foundation_version + ' Init');
	
	
	function libapt_foundation_init($, window)
	{
		console.info('Init Foundation ' + foundation_version + ' features');
		
		var url_base	= DevaptApplication.get_url_base();
		Devapt.use_css(url_base + '../../devapt-client/lib/foundation-' + foundation_version + '/css/foundation.css');
		Devapt.use_css(url_base + '../modules/home/public/css/app.css');
		
		'use strict';
		
		var $doc = $(document);
		var Modernizr = window.Modernizr;
		
		$.Foundation.global.namespace = false;
		$doc.foundation();
		
		// Hide address bar on mobile devices
		if (Modernizr.touch)
		{
			$(window).load(
				function ()
				{
					setTimeout(
						function ()
						{
							window.scrollTo(0, 1);
						},
						0
					);
				}
			);
		}
	}
	
	
	// INIT WIDGETS
	var $ = Devapt.jQuery();
	$(document).ready(
		function()
		{
			console.info('Init Foundation ' + foundation_version + ' widgets');
			
			var $ = Devapt.jQuery();
			
			var cb = function()
			{
				libapt_foundation_init($, window);
			}
			setTimeout(cb, 100);
		}
	);
	
	return $;
} );

/**
 * @file        plugins/backend-foundation5/backend.js
 * @desc        Foundation 5 Devapt backend
 * 				API:
 * 					DevaptFoundation5Backend.backend_trace: boolean
 * 	
 * 					DevaptFoundation5Backend.backend_template_std_tags: object (a map)
 * 					DevaptFoundation5Backend.get_template_std_tags() returns object (a map)
 * 	
 * 					DevaptFoundation5Backend.get_infos() returns object (a map)
 * 					DevaptFoundation5Backend.build_from_declaration(arg_resource_json)
 * 	
 * 					DevaptFoundation5Backend.render_page(arg_view_name_or_object) returns object (a promise)
 * 					DevaptFoundation5Backend.render_view(arg_jqo_node, arg_view_name_or_object) returns object (a promise)
 * 					DevaptFoundation5Backend.render_login() returns object (a promise)
 * 					DevaptFoundation5Backend.render_logout() returns object (a promise)
 * 					DevaptFoundation5Backend.render_error(arg_error_code) returns object (a promise)
 * 	
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-05-09
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/backend',['Devapt', 'core/traces', 'core/types', 'core/resources', 'factory', 'core/nav-history',
	'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTraces, DevaptTypes, DevaptResources, DevaptFactory, DevaptNavHistory,
	undefined)
{
	/**
	 * @memberof	DevaptFoundation5Backend
	 * @public
	 * @class
	 * @desc		Devapt Foundation5 backend container
	 */
	var DevaptFoundation5Backend = function() {};
	
	
	/**
	 * @memberof	DevaptFoundation5Backend
	 * @public
	 * @static
	 * @desc		Trace flag
	 */
	DevaptFoundation5Backend.backend_trace = false;
	
	
	/**
	 * @memberof	DevaptFoundation5Backend
	 * @public
	 * @static
	 * @desc		Template standard tags
	 */
	DevaptFoundation5Backend.backend_template_std_tags =
		{
			'bct':'<center>',
			'ect':'</center>',
			
			'br':'<div class="row">',
			'begin_row':'<div class="row">',
			
			'er':'</div>',
			'end_row':'</div>',
			
			'b1c': '<div class="small-1  medium-1  large-1  columns">',
			'b2c': '<div class="small-2  medium-2  large-2  columns">',
			'b3c': '<div class="small-3  medium-3  large-3  columns">',
			'b4c': '<div class="small-4  medium-4  large-4  columns">',
			'b5c': '<div class="small-5  medium-5  large-5  columns">',
			'b6c': '<div class="small-6  medium-6  large-6  columns">',
			'b7c': '<div class="small-7  medium-7  large-7  columns">',
			'b8c': '<div class="small-8  medium-8  large-8  columns">',
			'b9c': '<div class="small-9  medium-9  large-9  columns">',
			'b10c':'<div class="small-10 medium-10 large-10 columns">',
			'b11c':'<div class="small-11 medium-11 large-11 columns">',
			'b12c':'<div class="small-12 medium-12 large-12 columns">',
			'ec':'</div>',
		};
	
	
	/**
	 * @memberof			DevaptFoundation5Backend
	 * @public
	 * @static
	 * @method				DevaptFoundation5Backend.get_infos()
	 * @desc				Get a record of backend informations (name, version, description)
	 * @return {object}		Object record
	 */
	DevaptFoundation5Backend.get_template_std_tags = function()
	{
		return DevaptFoundation5Backend.backend_template_std_tags;
	};
	
	
	/**
	 * @memberof			DevaptFoundation5Backend
	 * @public
	 * @static
	 * @method				DevaptFoundation5Backend.get_infos()
	 * @desc				Get a record of backend informations (name, version, description)
	 * @return {object}		Object record
	 */
	DevaptFoundation5Backend.get_infos = function()
	{
		var context = 'DevaptFoundation5Backend.get_infos()';
		DevaptTraces.trace_enter(context, '', DevaptFoundation5Backend.backend_trace);
		
		var record =
			{
				name:			'DevaptFoundation5Backend',
				label:			'Foundation 5 backend',
				description:	'A Devapt backend for Foundation 5',
				version:		'1.0.0'
			};
		
		DevaptTraces.trace_leave(context, '', DevaptFoundation5Backend.backend_trace);
		return record;
	};
	
	
	
	/**
	 * @memberof				DevaptFoundation5Backend
	 * @public
	 * @static
	 * @method					DevaptFoundation5Backend.render_page(arg_view_name_or_object)
	 * @desc					Render HTML page
	 * @param {string|object}	arg_view_name_or_object		view to display in a page
	 * @return {object}			A promise of a resource page render
	 */
	DevaptFoundation5Backend.render_page = function(arg_view_name_or_object)
	{
		var context = 'DevaptFoundation5Backend.render_page(view)';
		DevaptTraces.trace_enter(context, '', DevaptFoundation5Backend.backend_trace);
		
		
		// GET AND CHECK VIEW OBJECT
		var view = arg_view_name_or_object;
		if ( DevaptTypes.is_string(arg_view_name_or_object) )
		{
			view = DevaptResources.get_resource_instance(arg_view_name_or_object);
		}
		if ( ! DevaptTypes.is_object(view) && ! view.is_view )
		{
			DevaptTraces.trace_leave(context, 'promise is rejected: bad view', DevaptFoundation5Backend.backend_trace);
			return Devapt.promise_rejected('object is not a view');
		}
		
		
		// BUILD PAGE
		//...
		
		
		// RENDER VIEW
		var container_jqo = null;
		var promise = Devapt.promise_resolved();
		promise.then(
			function()
			{
				DevaptTraces.trace_step(context, 'promise "then" is running', DevaptFoundation5Backend.backend_trace);
				return DevaptFoundation5Backend.render_view(container_jqo, arg_view_name_or_object);
			}
		);
		
		
		DevaptTraces.trace_leave(context, 'promise is async', DevaptFoundation5Backend.backend_trace);
		return promise;
	};
	
	
	
	/**
	 * @memberof				DevaptFoundation5Backend
	 * @public
	 * @static
	 * @method					DevaptFoundation5Backend.render_view(arg_jqo_node, arg_view_name_or_object)
	 * @desc					Render HTML view
	 * @param {object}			arg_jqo_node				tag node to attach the view (jQuery object)
	 * @param {string|object}	arg_view_name_or_object		view to display in a page
	 * @return {object}			A promise of a resource view render
	 */
	DevaptFoundation5Backend.render_view = function(arg_jqo_node, arg_view_name_or_object)
	{
		var context = 'DevaptFoundation5Backend.render_view(node,view name or object)';
		DevaptTraces.trace_enter(context, '', DevaptFoundation5Backend.backend_trace);
		// console.error(arg_view_name_or_object, context);
		// console.info(arg_jqo_node, 'view parent');
		
		
		// INIT VIEW OBJECT AND PROMISE
		var view = null;
		var promise = null;
		
		
		// VIEW ARG IS AN OBJECT
		if ( DevaptTypes.is_object(arg_view_name_or_object) )
		{
			DevaptTraces.trace_step(context, 'arg is an object', DevaptFoundation5Backend.backend_trace);
			
			view = arg_view_name_or_object;
			context += '[' + view.name + ']';
			
			// CHECK VIEW OBJECT
			if ( ! view.is_view )
			{
				DevaptTraces.trace_leave(context, 'failure: promise is rejected: object is not a view', DevaptFoundation5Backend.backend_trace);
				return Devapt.promise_rejected('object is not a view');
			}
			
			// RESOLVE PROMISE
			DevaptTraces.trace_step(context, 'resolve view', DevaptFoundation5Backend.backend_trace);
			promise = Devapt.promise_resolved(view);
		}
		
		
		// VIEW ARG IS A STRING
		else if ( view === null && DevaptTypes.is_not_empty_str(arg_view_name_or_object) )
		{
			DevaptTraces.trace_step(context, 'arg is a string', DevaptFoundation5Backend.backend_trace);
			DevaptTraces.trace_value(context, 'view_name', arg_view_name_or_object, DevaptFoundation5Backend.backend_trace);
			
			try
			{
				// GET AN EXISTING INSTANCE OR BUILD A NEW ONE
				context += '[' + arg_view_name_or_object + ']';
				DevaptTraces.trace_step(context, 'GET AN EXISTING INSTANCE OR BUILD A NEW ONE', DevaptFoundation5Backend.backend_trace);
				promise = DevaptResources.get_resource_instance(arg_view_name_or_object);
			}
			catch(e)
			{
				console.error(e, context);
				
				DevaptTraces.trace_leave(context, 'failure: promise is rejected: get or build view', DevaptFoundation5Backend.backend_trace);
				return Devapt.promise_rejected('get or build view');
			}
		}
		
		
		// CHECK PROMISE
		if ( ! DevaptTypes.is_object(promise) )
		{
			DevaptTraces.trace_leave(context, 'failure: promise is rejected: bad resource name or object', DevaptFoundation5Backend.backend_trace);
			return Devapt.promise_rejected('bad resource name or object');
		}
		
		
		// RENDER VIEW
		try
		{
			// console.log(arg_jqo_node, 'backend render view: arg_jqo_node');
			// console.log(arg_view_name_or_object, 'backend render view: name or object');
			promise = promise.then(
				function(view)
				{
					DevaptTraces.trace_step(context, 'success: promise is resolved: then callback for [' + view.name + ']', DevaptFoundation5Backend.backend_trace);
					// console.log(view, 'backend render view: object [' + view.name + ']');
					
					try
					{
						// CHECK IF GIVEN OBJECT IS A VIEW
						if ( ! view.is_view )
						{
							// console.error(view, 'backend render view');
							DevaptTraces.trace_error(context, 'failure: promise is resolved: then callback: bad view resource [' + view.name + ']', DevaptFoundation5Backend.backend_trace);
							return Devapt.promise_rejected('object is not a view');
						}
						
						
						// SET PARENT NODE
						if ( DevaptTypes.is_object(arg_jqo_node) )
						{
							DevaptTraces.trace_step(context, 'parent is a valid node', DevaptFoundation5Backend.backend_trace);
							// console.log(arg_jqo_node, 'backend.render_view.has jqo parent for [' + view.name + ']');
							
							if ( ! (view.parent_jqo && view.parent_jqo[0] === arg_jqo_node[0]) )
							{
								DevaptTraces.trace_step(context, 'parent is a different parent', DevaptFoundation5Backend.backend_trace);
								// console.info(view.parent_jqo, 'backend.render_view: existing view parent[' + view.name + ']');
								// console.info(arg_jqo_node, 'backend.render_view: target view parent[' + view.name + ']');
								
								view.set_parent(arg_jqo_node);
							}
						}
						else
						{
							console.info('view has no jqo parent', context);
						}
						
						
						// TEST IF ALREADY RENDERED AND SHOW THE VIEW
						var view_is_rendered = ! view.is_render_state_not();
						// console.log(view.get_render_state(), context + ':view status');
						if ( view_is_rendered ) // && view_jqo && view_jqo.length === 1
						{
							DevaptTraces.trace_step(context, 'view is already rendered', DevaptFoundation5Backend.backend_trace);
							// console.info('backend.render_view: view is already rendered[' + view.name + ']');
							
							// GET VIEW NODE ID
							var view_id = view.get_view_id();
							var view_jqo = window.$('#' + view_id);
							// console.info(view_jqo, 'backend.render_view:view_jqo[' + view.name + ']');
							
							// SHOW EXISTING VIEW
							view_jqo.show();;
							
							DevaptTraces.trace_leave(context, 'success: promise is resolved: view is already created, only "show" [' + view.name + ']', DevaptFoundation5Backend.backend_trace);
							return Devapt.promise_resolved(view);
						}
						
						
						// RENDER THE VIEW
						// console.info(view, 'backend.render_view: view is not rendered[' + view.name + ']');
						DevaptTraces.trace_step(context, 'render view', DevaptFoundation5Backend.backend_trace);
						var render_promise = view.render();
						
						DevaptTraces.trace_leave(context, 'success: promise is resolved: then callback: async render promise [' + view.name + ']', DevaptFoundation5Backend.backend_trace);
						return render_promise;
					}
					catch(e)
					{
						console.error(e, context + ':callback');
					}
					
					DevaptTraces.trace_leave(context, 'failure: for view [' + view.name + ']', DevaptFoundation5Backend.backend_trace);
					return Devapt.promise_rejected();
				}
			);
		}
		catch(e)
		{
			console.error(e, context);
		}
		
		
		DevaptTraces.trace_leave(context, 'async promise render', DevaptFoundation5Backend.backend_trace);
		return promise;
	};
	
	
	/**
	 * @memberof				DevaptFoundation5Backend
	 * @public
	 * @static
	 * @method					DevaptFoundation5Backend.render_login()
	 * @desc					Render HTML login view
	 * @return {object}			A promise of a resource view render
	 */
	DevaptFoundation5Backend.render_login = function()
	{
		var context = 'DevaptFoundation5Backend.render_login()';
		DevaptTraces.trace_enter(context, '', DevaptFoundation5Backend.backend_trace);
		
		
		var content_jqo = window.$('<div id="login_view_id" class="row">');
		var html = '\
	<div class="three columns">\
	</div>\
	\
	<div class="six columns">\
		<center><h4>Login Page</h4></center>\
		\
		<form>\
		<label for="login">Login</label>\
		<input class="input-text" type="text" name="login" id="login" value="" />\
		\
		<label for="password">Password</label>\
		<input class="input-text" type="password" name="password" id="password" value="" />\
		\
		<p style="line-height:64px; height:64px; vertical-align:middle; text-align:center;">\
			<a id="submit" href="#" class="button" style="vertical-align:middle;">Login</a>\
		</p>\
		</form>\
	</div>\
	\
	<div class="three columns">\
	</div>';
	
				// <img src="modules/security/public/images/user-group-icon.png" alt="login icon" style="line-height:64px; height:64px; vertical-align:middle;"></img>\
		
		// TODO GET IDs FROM APP CONFIG
		window.$('#menubars_id').children().hide();
		window.$('#page_breadcrumbs_id').children().hide();
		window.$('#page_content_id').children().hide();
		window.$('#page_content_id').append(content_jqo);
		content_jqo.html(html);
		
		function on_login()
		{
			require(['Devapt', 'core/security'],
				function(Devapt, DevaptSecurity)
				{
					var login = window.$('#login').val();
					var pwd = window.$('#password').val();
					
					content_jqo.remove();
					
					// TODO
					var login_promise = DevaptSecurity.login(login, pwd);
					login_promise = null;
				}
			);
			
			return false;
		}
		
		window.$('#submit').on('click', on_login);
		
		
		DevaptTraces.trace_leave(context, '', DevaptFoundation5Backend.backend_trace);
		return Devapt.promise_resolved();
	};
	
	
	/**
	 * @memberof				DevaptFoundation5Backend
	 * @public
	 * @static
	 * @method					DevaptFoundation5Backend.render_logout()
	 * @desc					Render HTML logout view
	 * @return {object}			A promise of a resource view render
	 */
	DevaptFoundation5Backend.render_logout = function()
	{
		var context = 'DevaptFoundation5Backend.render_logout()';
		DevaptTraces.trace_enter(context, '', DevaptFoundation5Backend.backend_trace);
		
		
		if (DevaptNavHistory.history_breadcrumbs_object)
		{
			DevaptNavHistory.history_breadcrumbs_object.hide();
		}
		if (DevaptNavHistory.current_topbar_object)
		{
			DevaptNavHistory.current_topbar_object.hide();
		}
		var logout_promise = DevaptFoundation5Backend.render_login();
		
		
		DevaptTraces.trace_leave(context, '', DevaptFoundation5Backend.backend_trace);
		return logout_promise;
	};
	
	
	/**
	 * @memberof				DevaptFoundation5Backend
	 * @public
	 * @static
	 * @method					DevaptFoundation5Backend.render_error(arg_error_code)
	 * @desc					Render HTML error view
	 * @param {string|integer}	arg_error_code			error code
	 * @return {object}			A promise of a resource view render
	 */
	DevaptFoundation5Backend.render_error = function(arg_error_code)
	{
		var context = 'DevaptFoundation5Backend.render_error(code)';
		DevaptTraces.trace_enter(context, '', DevaptFoundation5Backend.backend_trace);
		
		
		// CREATE MAIN DEFERRED OBJECT
		var master_deferred = Devapt.defer();
		
		
		// GET MAIN PROMISE
		var promise = master_deferred.promise;
		
		
		
		DevaptTraces.trace_leave(context, '', DevaptFoundation5Backend.backend_trace);
		return promise;
	};
	
	
	/**
	 * @memberof				DevaptFoundation5Backend
	 * @public
	 * @static
	 * @method					DevaptFoundation5Backend.get_input(arg_field_custom, arg_value)
	 * @desc					Get an input tag for the given field
	 * @param {object}			arg_view_object			view object
	 * @param {object}			arg_field_obj			field attributes object
	 * @param {string}			arg_value				field value
	 * @return {object}			jQuery node object
	 */
	DevaptFoundation5Backend.get_input = function(arg_view_object, arg_field_obj, arg_value)
	{
		var context = 'DevaptFoundation5Backend.get_input(field,value)';
		DevaptTraces.trace_enter(context, '', DevaptFoundation5Backend.backend_trace);
		
		
		// GET RESULT INPUT NODE
		var node_jqo = null;
		
		// GET STANDARD INPUT
/*		var field_obj = arg_field_obj;
		var value_str = arg_value;
		var type_str = DevaptTypes.to_string(field_obj.field_value.type, 'string').toLocaleLowerCase();
		var node_jqo = null;
		switch(type_str)
		{
			case 'password':
				node_jqo = arg_view_object.get_password_input(field_obj, value_str);
				break;
			case 'string':
				node_jqo = arg_view_object.get_simple_input(field_obj, value_str);
				// node_jqo.addClass('');
				break;
			case 'integer':
				node_jqo = arg_view_object.get_simple_input(field_obj, value_str);
				node_jqo.addClass('integer');
				break;
			case 'float':
				node_jqo = arg_view_object.get_simple_input(field_obj, value_str);
				// node_jqo.addClass('');
				break;
			case 'boolean':
				node_jqo = arg_view_object.get_simple_input(field_obj, value_str);
				// node_jqo.addClass('');
				break;
			case 'email':
				node_jqo = arg_view_object.get_simple_input(field_obj, value_str);
				node_jqo.addClass('email');
				node_jqo.foundation('abide');
				break;
			case 'date':
				node_jqo = arg_view_object.get_simple_input(field_obj, value_str);
				node_jqo.addClass('dateISO');
				break;
			case 'time':
				node_jqo = arg_view_object.get_simple_input(field_obj, value_str);
				node_jqo.addClass('time');
				break;
			case 'datetime':
				node_jqo = arg_view_object.get_simple_input(field_obj, value_str);
				node_jqo.addClass('datetime');
				break;
		}*/
		
		
		DevaptTraces.trace_leave(context, '', DevaptFoundation5Backend.backend_trace);
		return node_jqo;
	};
	
	
	/**
	 * @memberof				DevaptFoundation5Backend
	 * @public
	 * @static
	 * @method					DevaptFoundation5Backend.notify_error(arg_message)
	 * @desc					Notify user with an error message
	 * @param {string}			arg_message			notification message
	 * @return {nothing}
	 */
	DevaptFoundation5Backend.notify_error = function(arg_message)
	{
		var context = 'DevaptFoundation5Backend.notify_error(msg)';
		DevaptTraces.trace_enter(context, '', DevaptFoundation5Backend.backend_trace);
		
		
		// alert('error:' + arg_message);
		
		var notify_jqo = window.$('#notify_alert_id');
		if ( ! notify_jqo || notify_jqo.length === 0 )
		{
			var div_tag = window.$('<div data-alert class="alert-box warning radius">');
			var a_tag = window.$('<a href="#" class="close">&times;</a>');
			
			window.$('#page_breadcrumbs_id').append(div_tag);
			div_tag.append(a_tag);
			a_tag.click( function()
				{
					div_tag.children('p').remove();
					div_tag.trigger('close').trigger('close.fndtn.alert').hide();
					// console.info('close info box');
				}
			);
			
			notify_jqo = div_tag;
		}
		
		// APPEND A MESSAGE
		notify_jqo.append( window.$('<p>').text(arg_message) );
		notify_jqo.show();
		setTimeout( function()
			{
				notify_jqo.children('p').remove();
				notify_jqo.trigger('close').trigger('close.fndtn.alert').hide();
			},
			2000
		);
		
		
		DevaptTraces.trace_leave(context, '', DevaptFoundation5Backend.backend_trace);
	};
	
	
	/**
	 * @memberof				DevaptFoundation5Backend
	 * @public
	 * @static
	 * @method					DevaptFoundation5Backend.notify_alert(arg_message)
	 * @desc					Notify user with an alert message
	 * @param {string}			arg_message			notification message
	 * @return {nothing}
	 */
	DevaptFoundation5Backend.notify_alert = function(arg_message)
	{
		var context = 'DevaptFoundation5Backend.notify_alert(msg)';
		DevaptTraces.trace_enter(context, '', DevaptFoundation5Backend.backend_trace);
		
		
		// alert('alert:' + arg_message);
		
		var notify_jqo = window.$('#notify_alert_id');
		if ( ! notify_jqo || notify_jqo.length === 0 )
		{
			var div_tag = window.$('<div data-alert class="alert-box alert radius">');
			var a_tag = window.$('<a href="#" class="close">&times;</a>');
			
			window.$('#page_breadcrumbs_id').append(div_tag);
			div_tag.append(a_tag);
			a_tag.click( function()
				{
					div_tag.children('p').remove();
					div_tag.trigger('close').trigger('close.fndtn.alert').hide();
					// console.info('close info box');
				}
			);
			
			notify_jqo = div_tag;
		}
		
		// APPEND A MESSAGE
		notify_jqo.append( window.$('<p>').text(arg_message) );
		notify_jqo.show();
		setTimeout( function()
			{
				notify_jqo.children('p').remove();
				notify_jqo.trigger('close').trigger('close.fndtn.alert').hide();
			},
			2000
		);
		
		
		DevaptTraces.trace_leave(context, '', DevaptFoundation5Backend.backend_trace);
	};
	
	
	/**
	 * @memberof				DevaptFoundation5Backend
	 * @public
	 * @static
	 * @method					DevaptFoundation5Backend.notify_info(arg_message)
	 * @desc					Notify user with an information message
	 * @param {string}			arg_message			notification message
	 * @return {nothing}
	 */
	DevaptFoundation5Backend.notify_info = function(arg_message)
	{
		var context = 'DevaptFoundation5Backend.notify_info(msg)';
		DevaptTraces.trace_enter(context, '', DevaptFoundation5Backend.backend_trace);
		
		
		// alert('info:' + arg_message);
		
		var notify_jqo = window.$('#notify_info_id');
		if ( ! notify_jqo || notify_jqo.length === 0 )
		{
			var div_tag = window.$('<div id="notify_info_id" data-alert class="alert-box info radius">');
			var a_tag = window.$('<a href="#" class="close">&times;</a>');
			
			window.$('#page_breadcrumbs_id').append(div_tag);
			div_tag.append(a_tag);
			a_tag.click( function()
				{
					div_tag.children('p').remove();
					div_tag.trigger('close').trigger('close.fndtn.alert').hide();
					// console.info('close info box');
				}
			);
			
			notify_jqo = div_tag;
		}
		
		// APPEND A MESSAGE
		notify_jqo.append( window.$('<p>').text(arg_message) );
		notify_jqo.show();
		setTimeout( function()
			{
				notify_jqo.children('p').remove();
				notify_jqo.trigger('close').trigger('close.fndtn.alert').hide();
			},
			2000
		);
		
		
		DevaptTraces.trace_leave(context, '', DevaptFoundation5Backend.backend_trace);
	};
	
	
	return DevaptFoundation5Backend;
} );
/**
 * @file        plugins/backend-foundation5/views/breadcrumbs.js
 * @desc        Foundation 5 breadcrumbs class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-06-28
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/views/breadcrumbs',['Devapt', 'core/types', 'object/class', 'views/view', 'core/nav-history', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptView, DevaptNavHistory, undefined)
{
	/**
	 * @public
	 * @class				DevaptBreadcrumbs
	 * @desc				Breadcrumbs view class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptBreadcrumbs
	 * @desc				Render view
	 * @param {object}		arg_deferred	deferred object
	 * @return {object}		deferred promise object
	 */
	var cb_render_self = function(arg_deferred)
	{
		var self = this;
		var context = 'render_self(deferred)';
		self.enter(context, '');
		
		
		// CHECK DEFEREED
		self.assert_not_null(context, 'arg_deferred', arg_deferred);
		
		// CHECK CONTENT NODE
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		
		// RENDER
		self.ul_jqo = $('<ul>');
		self.ul_jqo.addClass('breadcrumbs');
		self.content_jqo.append(self.ul_jqo);
		
		
		// LOOP ON NAV HISTORY
		var nav_stack = DevaptNavHistory.history_stack;
		self.value(context, 'breadcrumbs html content', nav_stack);
		for(var content_key in nav_stack)
		{
			var state = nav_stack[content_key];
			self.assert_not_null(context, 'nav content at [' + content_key + ']', state);
			self.add_history_item(state);
		}
		
		
		// RESOVE RENDER
		arg_deferred.resolve(self);
		
		// GET PROMISE
		var promise = arg_deferred.promise;
		// console.log(promise, 'promise');
		
		
		self.leave(context, 'success: promise is resolved');
		return promise;
	}
	
	
	
	/**
	 * @public
	 * @memberof			DevaptBreadcrumbs
	 * @desc				Add an history item
	* @param {object}		arg_state		[target object, navigation history state object]
	 * @return {nothing}
	 */
	var cb_add_history_item = function(arg_state)
	{
		var self = this;
		var context = 'add_history_item(state)';
		self.enter(context, '');
		
		
		// console.log(arg_state, 'arg_state');
		self.assert_not_null(context, 'arg_state', arg_state);
		self.assert_not_empty_string(context, 'arg_state.content_label', arg_state.content_label);
		if ( self.history_labels[arg_state.content_label] )
		{
			self.leave(context, 'success: already in history');
			return;
		}
		
		self.history_labels[arg_state.content_label] = arg_state;
		
		
		var li_jqo = $('<li>');
		self.ul_jqo.append(li_jqo);
		
		var a_jqo = $('<a>');
		li_jqo.append(a_jqo);
		
		a_jqo.text(arg_state.content_label);
		a_jqo.click(
			(
				function(state)
				{
					return function()
					{
						// console.log(state, context + '.onclick');
						DevaptNavHistory.set_content(state, true);
					}
				}
			)(arg_state)
		);
		
		
		self.leave(context, 'success');
	}
	
	
	
	/**
	 * @public
	 * @memberof			DevaptBreadcrumbs
	 * @desc				On navigation history new item
	* @param {object}		arg_operands_array		[event object, target object, navigation history state object]
	 * @return {nothing}
	 */
	var cb_on_nav_history_add = function(arg_operands_array)
	{
		var self = this;
		var context = 'on_nav_history_add(event opds)';
		self.enter(context, '');
		
		
		var arg_state = arg_operands_array[2];
		self.add_history_item(arg_state);
		
		
		self.leave(context, 'success');
	}
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2014-06-28',
			updated:'2014-12-06',
			description:'Breadrumbs View class.'
		},
		properties:{
			
		}
	};
	var parent_class = DevaptView;
	var DevaptBreadcrumbsClass = new DevaptClass('DevaptBreadcrumbs', parent_class, class_settings);
	
	// METHODS
	DevaptBreadcrumbsClass.add_public_method('render_self', {}, cb_render_self);
	DevaptBreadcrumbsClass.add_public_method('add_history_item', {}, cb_add_history_item);
	DevaptBreadcrumbsClass.add_public_method('on_nav_history_add', {}, cb_on_nav_history_add);
	
	// PROPERTIES
	DevaptBreadcrumbsClass.add_public_obj_property('history_labels',	'',		{}, true, false, []);
	
	
	return DevaptBreadcrumbsClass;
} );
/**
 * @file        plugins/backend-foundation5/views/button.js
 * @desc        Foundation 5 button class
 *				API:
 *					EVENTS:
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-08-05
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/views/button',['Devapt', 'core/types',
	'object/class', 'views/view', 'views/view/view-mixin-bind',
	'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes,
	DevaptClass, DevaptView, DevaptMixinBind,
	undefined)
{
	/**
	 * @public
	 * @class				DevaptButton
	 * @desc				Button view class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptButton
	 * @desc				Render view
	 * @return {object}		deferred promise object
	 */
	var cb_render_content_self = function()
	{
		var self = this;self.trace=true
		var context = 'render_content_self()';
		self.enter(context, '');
		
		// ENABLE BINDINGS
		if ( ! self.mixin_bind_initialized )
		{
			self.enable_bindings();
		}
		
		// GET NODES
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		self.a_jqo = $('<a>');
		self.content_jqo.append(self.a_jqo);
		
		// GET VIEW LABEL
		self.assert_not_empty_value(context, 'self.label', self.label);
		self.a_jqo.html(self.label);
		self.a_jqo.addClass('button small');
		self.a_jqo.css('margin', '0em');
		
		// HANDLE CLICK
		self.a_jqo.click(
			function()
			{
				console.log(self.name, 'clicked');
				self.fire_event('devapt.button.clicked', []);
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return Devapt.promise_resolved();
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-05',
			'updated':'2014-12-13',
			'description':'Button view class to display a text.'
		},
		mixins:[DevaptMixinBind]
	};
	
	// CLASS CREATION
	var parent_class = DevaptView;
	var DevaptButtonClass = new DevaptClass('DevaptButton', parent_class, class_settings);
	
	// METHODS
	DevaptButtonClass.add_public_method('render_content_self', {}, cb_render_content_self);
	
	// PROPERTIES
	
	
	return DevaptButtonClass;
} );
/**
 * @file        plugins/backend-foundation5/views/button-bar.js
 * @desc        Foundation 5 button bar class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-08-05
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/views/button-bar',['Devapt', 'core/types', 'object/class', 'views/view', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptView, undefined)
{
	/**
	 * @public
	 * @class				DevaptButtonBar
	 * @desc				Button bar view class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptButtonBar
	 * @desc				Render view
	 * @return {object}		deferred promise object
	 */
	var cb_render_content_self = function()
	{
		var self = this;self.trace=true
		var context = 'render_content_self()';
		self.enter(context, '');
		
		
		// GET NODES
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		self.content_jqo.addClass('button-bar');
		
		// GET CURRENT BACKEND
		var backend = Devapt.get_current_backend();
		self.assert_not_null(context, 'backend', backend);
		
		// LOOP ON BUTTON GROUPS VIEWS
		self.assert_not_empty_array(context, 'self.buttons', self.button_groups);
		var ordered_promises = [];
		var current_jqo = null;
		for(var group_key in self.button_groups)
		{
			var group_view = self.button_groups[group_key];
			self.value(context, 'group_view', group_view);
			
			current_jqo = $('<div>');
			self.content_jqo.append(current_jqo);
			
			// RENDER CHILD VIEW
			ordered_promises.push( backend.render_view(current_jqo, group_view) );
		}
		
		
		self.leave(context, Devapt.msg_success_promise);
		return Devapt.promise_all(ordered_promises);
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-05',
			'updated':'2014-12-13',
			'description':'A button bar view class.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptView;
	var DevaptButtonBarClass = new DevaptClass('DevaptButtonBar', parent_class, class_settings);
	
	// METHODS
	DevaptButtonBarClass.add_public_method('render_content_self', {}, cb_render_content_self);
	
	// PROPERTIES
	DevaptButtonBarClass.add_public_array_property('button_groups',	'',		null, true, false, ['view_buttons_groups'], 'string', ',');
	
	
	return DevaptButtonBarClass;
} );
/**
 * @file        plugins/backend-foundation5/views/button-group.js
 * @desc        Foundation 5 button group class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-08-05
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/views/button-group',['Devapt', 'core/types', 'object/class', 'views/view', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptView, undefined)
{
	/**
	 * @public
	 * @class				DevaptButtonGroup
	 * @desc				Button group view class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptButtonGroup
	 * @desc				Render view
	 * @return {object}		deferred promise object
	 */
	var cb_render_content_self = function()
	{
		var self = this;self.trace=true
		var context = 'render_content_self()';
		self.enter(context, '');
		
		
		// GET NODES
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		self.ul_jqo = $('<ul>');
		self.content_jqo.append(self.ul_jqo);
		self.ul_jqo.addClass('button-group');
		
		// GET CURRENT BACKEND
		var backend = Devapt.get_current_backend();
		self.assert_not_null(context, 'backend', backend);
		
		// LOOP ON BUTTONS VIEWS
		self.assert_not_empty_array(context, 'self.buttons', self.buttons);
		var ordered_promises = [];
		for(var button_key in self.buttons)
		{
			var button_view = self.buttons[button_key];
			self.value(context, 'button_view', button_view);
			
			var node_jqo = $('<li>');
			self.ul_jqo.append(node_jqo);
			
			// RENDER CHILD VIEW
			ordered_promises.push( backend.render_view(node_jqo, button_view) );
		}
		
		
		self.leave(context, Devapt.msg_success_promise);
		return Devapt.promise_all(ordered_promises);
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-05',
			'updated':'2014-12-13',
			'description':'A button group view class.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptView;
	var DevaptButtonGroupClass = new DevaptClass('DevaptButtonGroup', parent_class, class_settings);
	
	// METHODS
	DevaptButtonGroupClass.add_public_method('render_content_self', {}, cb_render_content_self);
	
	// PROPERTIES
	DevaptButtonGroupClass.add_public_array_property('buttons',	'',		null, true, false, ['view_buttons'], 'string', ',');
	
	
	return DevaptButtonGroupClass;
} );
/**
 * @file        plugins/backend-foundation5/views/image.js
 * @desc        Foundation 5 image class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-05-09
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/views/image',['Devapt', 'core/types', 'object/class', 'views/view', 'core/application', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptView, DevaptApplication, undefined)
{
	/**
	 * @public
	 * @class				DevaptImage
	 * @desc				Image view class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptImage
	 * @desc				Render view
	 * @param {object}		arg_deferred	deferred object
	 * @return {object}		deferred promise object
	 */
	var cb_render_self = function(arg_deferred)
	{
		var self = this;
		var context = 'render_self(deferred)';
		self.enter(context, '');
		
		
		// CHECK DEFEREED
		self.assert_not_null(context, 'arg_deferred', arg_deferred);
		
		// GET NODES
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		self.img_jqo = $('<img>');
		self.content_jqo.append(self.img_jqo);
		
		// GET VIEW URL
		var url = null;
		if ( DevaptTypes.is_not_empty_str(self.image_url) )
		{
			url = DevaptTypes.to_string(self.image_url);
		}
		else if ( DevaptTypes.is_not_empty_str(self.image_pathname) )
		{
			url = DevaptApplication.get_url_base() + '../modules/' + DevaptTypes.to_string(self.image_pathname);
		}
		self.assert_not_empty_value(context, 'img url', url);
		self.img_jqo.attr('src', url);
		
		// RESOLVE AND GET PROMISE
		arg_deferred.resolve();
		var promise = arg_deferred.promise;
		
		
		self.leave(context, 'success: promise is resolved');
		return promise;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-21',
			'updated':'2014-12-13',
			'description':'Simple view class to display an image.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptView;
	var DevaptImageClass = new DevaptClass('DevaptImage', parent_class, class_settings);
	
	// METHODS
	DevaptImageClass.add_public_method('render_self', {}, cb_render_self);
	
	// PROPERTIES
	DevaptImageClass.add_public_str_property('image_url',		'',		null, false, false, []);
	DevaptImageClass.add_public_str_property('image_pathname',	'',		null, false, false, []);
	
	
	return DevaptImageClass;
} );
/**
 * @file        plugins/backend-foundation5/views/label.js
 * @desc        Foundation 5 label class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-05-09
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/views/label',['Devapt', 'core/types', 'object/class', 'views/view', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptView, undefined)
{
	/**
	 * @public
	 * @class				DevaptLabel
	 * @desc				Label view class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptLabel
	 * @desc				Render view
	 * @param {object}		arg_deferred	deferred object
	 * @return {object}		deferred promise object
	 */
	var cb_render_self = function(arg_deferred)
	{
		var self = this;
		var context = 'render_self(deferred)';
		self.enter(context, '');
		
		
		// CHECK DEFEREED
		self.assert_not_null(context, 'arg_deferred', arg_deferred);
		
		// GET NODES
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		self.span_jqo = $('<span>');
		self.content_jqo.append(self.span_jqo);
		
		// GET VIEW LABEL TEXT
		self.assert_not_empty_value(context, 'self.label', self.label);
		self.span_jqo.text(self.label);
		
		// RESOLVE AND GET PROMISE
		arg_deferred.resolve();
		var promise = arg_deferred.promise;
		
		
		self.leave(context, 'success: promise is resolved');
		return promise;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-21',
			'updated':'2014-12-13',
			'description':'Simple view class to display an text.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptView;
	var DevaptLabelClass = new DevaptClass('DevaptLabel', parent_class, class_settings);
	
	// METHODS
	DevaptLabelClass.add_public_method('render_self', {}, cb_render_self);
	
	// PROPERTIES
	// DevaptLabelClass.add_public_str_property('image_url',		'',		null, false, false, []);
	
	
	return DevaptLabelClass;
} );
/**
 * @file        plugins/backend-foundation5/views/menubar.js
 * @desc        Foundation 5 menubar class
 * 		API
 * 			PUBLIC METHODS
 * 				constructor(self):nothing
 * 				render_self(arg_deferred):promise
 * 				render_top_menubar():boolean
 * 				render_top_menubar_title():boolean
 * 				switch_top_menubar(arg_menubar_name):boolean
 * 				render_top_menubar_menu(arg_menu_declaration, arg_parent_menu_jqo):boolean
 * 				render_nav_menubar():boolean
 * 				
 * 			PRIVATE METHODS
 * 				
 * 			ATTRIBUTES
 * 				
 * 				
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-05-09
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/views/menubar',['Devapt', 'core/types', 'object/class', 'object/classes', 'core/resources', 'views/view', 'core/application', 'core/nav-history', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptClasses, DevaptResources, DevaptView, DevaptApplication, DevaptNavHistory, undefined)
{
	/**
	 * @public
	 * @class				DevaptMenubar
	 * @desc				Menubar view class
	 */
	
	var $ = window.$;
	
	/**
	 * @public
	 * @memberof			DevaptMenubar
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		var context = self.class_name + '(' + self.name + ')';
		self.enter(context, 'constructor');
		
		
		// DEBUG
		// self.trace = true;
		// console.log('menubar created', context);
		
		// CALL SUPER CLASS CONSTRUCTOR
		// self.prepend_content = true;
		// self._parent_class.infos.ctor(self);
		
		// INIT ATTRIBUTES
		self.nav_jqo = null;
		
		
		self.leave(context, 'success');
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptMenubar
	 * @desc				Render view
	 * @param {object}		arg_deferred	deferred object
	 * @return {object}		deferred promise object
	 */
	var cb_render_self = function(arg_deferred)
	{
		var self = this;
		// self.trace=true;
		var context = 'render_self(deferred)';
		self.enter(context, '');
		
		
		// GET MAIN PROMISE
		self.menubar_declaration = self;
		
		// MENUBAR DECLARATION IS NOT AN OBJECT
		self.step(context, 'menubar declaration is not an object');
		
		
		// RENDER MENUBAR
		
		// GET NODES
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		self.nav_jqo = $('<nav>');
		self.content_jqo.append(self.nav_jqo);
		
		
		// CHECK MENUBAR DECLARATION
		self.assert_not_empty_value(context, 'self.menubar_declaration', self.menubar_declaration);
		
		
		// GET MENUBAR FORMAT
		if ( DevaptTypes.is_not_empty_str(self.menubar_format) )
		{
			self.menubar_format = self.menubar_format.toLocaleLowerCase();
			self.menubar_format = DevaptTypes.to_list_item(self.menubar_format, ['top', 'nav'], 'nav');
			self.value(context, 'self.menubar_format', self.menubar_format);
		}
		else if ( DevaptTypes.is_not_empty_str(self.menubar_declaration['format']) )
		{
			self.value(context, 'self.menubar_declaration[format].toLocaleLowerCase()', self.menubar_declaration['format'].toLocaleLowerCase());
			self.menubar_format = DevaptTypes.to_list_item(self.menubar_declaration['format'].toLocaleLowerCase(), ['top', 'nav'], 'nav');
			self.value(context, 'self.menubar_format', self.menubar_format);
		}
		self.assert_not_empty_string(context, 'self.menubar_declaration', self.menubar_format);
		
		// self.trace=false;
		// RENDER TOP OR NAV MENUBAR
		switch (self.menubar_format)
		{
			case 'nav' :
			{
				break;
			}
			
			case 'top' :
			{
				try
				{
					if ( ! self.render_top_menubar() )
					{
						console.error('render top menubar failure');
						self.error(context, 'render top menubar failure');
						self.leave(context, 'failure: promise is rejected');
						return Devapt.promise_rejected('render top menubar failure');
					}
					
					// self.is_rendered = true;
					// console.info('menubar rendered', self.name);
					
					$(document).foundation('topbar');
				}
				catch(e)
				{
					console.error(e, context + ':top');
					return Devapt.promise_rejected('render top menubar failure');
				}
				break;
			}
		}
		
		arg_deferred.resolve();
		
		
		self.leave(context, 'success: render promise is async');
		return Devapt.promise(arg_deferred);
	};
	
	
	
	/*
		Exemple : (source=http://foundation.zurb.com/docs/components/topbar.html)
		<nav class="top-bar" data-topbar>
		  <ul class="title-area">
			<li class="name">
			  <h1><a href="#">My Site</a></h1>
			</li>
			 <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
			<li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
		  </ul>

		  <section class="top-bar-section">
			<!-- Right Nav Section -->
			<ul class="right">
			  <li class="active"><a href="#">Right Button Active</a></li>
			  <li class="has-dropdown">
				<a href="#">Right Button Dropdown</a>
				<ul class="dropdown">
				  <li><a href="#">First link in dropdown</a></li>
				</ul>
			  </li>
			</ul>

			<!-- Left Nav Section -->
			<ul class="left">
			  <li><a href="#">Left Nav Button</a></li>
			</ul>
		  </section>
		</nav>
	*/
	
	/**
	 * @public
	 * @memberof			DevaptMenubar
	 * @desc				Render top menu bar view
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_render_top_menubar = function()
	{
		var self = this;
		var context = 'render_top_menubar()';
		self.enter(context, '');
		
		
		// DEBUG DECLARATION
		// console.log(self, 'self');
		// console.log(self.menubar_declaration, 'menubar_declaration');
		
		// CREATE NAV TAG
		// self.content_jqo.attr('id', self.name + '_id');
		self.nav_jqo.addClass('top-bar');
		self.nav_jqo.attr('data-topbar', '');
		self.nav_jqo.attr('role', 'navigation');
		
		
		// OPTION: FIXED
		if ( DevaptTypes.to_boolean( self.menubar_declaration['fixed'] ) )
		{
			self.content_jqo.addClass('fixed');
		}
		
		// OPTION: ONGRID
		if ( DevaptTypes.to_boolean( self.menubar_declaration['ongrid'] ) )
		{
			self.content_jqo.addClass('contain-to-grid');
		}
		
		// OPTION: ONGRID
		if ( DevaptTypes.to_boolean( self.menubar_declaration['float'] ) )
		{
			self.content_jqo.addClass('sticky');
		}
		
		// OPTION: CLICKABLE
		if ( DevaptTypes.to_boolean( self.menubar_declaration['clickable'] ) )
		{
			self.nav_jqo.attr('data-options', 'is_hover: false');
		}
		
		
		// CREATE TITLE AREA
		self.render_top_menubar_title();
		
		// CREATE MENUS
		self.step(context, 'create section');
		var section_jqo = $('<section class="top-bar-section">');
		self.nav_jqo.append(section_jqo);
		
		self.step(context, 'create right');
		var right_jqo = $('<ul class="right">');
		section_jqo.append(right_jqo);
		
		self.step(context, 'create left');
		var left_jqo = $('<ul class="left">');
		section_jqo.append(left_jqo);
		
		self.step(context, 'get menus names');
		var menu_names = self.menubar_declaration['items'];
		// self.value(context, 'menu_names', menu_names);
		self.assert_true(context, 'menu_names is array', DevaptTypes.is_array(menu_names) );
		
		self.step(context, 'get menus resources');
		var menu_resources = self.menubar_declaration['items_resources'];
		// self.value(context, 'menu_resources', menu_resources);
		self.assert_true(context, 'menu_resources is array', DevaptTypes.is_object(menu_resources) );
		
		self.step(context, 'loop on menu names');
		for(var menu_name_index in menu_names)
		{
			var menu_name = menu_names[menu_name_index];
			self.value(context, 'loop.menu_name', menu_name);
			
			var menu_declaration = menu_resources[menu_name];
			// self.value(context, 'menu_declaration', menu_declaration);
			self.assert_true(context, 'menu_declaration is object', DevaptTypes.is_object(menu_declaration) );
			
			menu_declaration['menu_name'] = menu_name;
			
			var position	= DevaptTypes.to_list_item(menu_declaration['position'], ['left', 'right'], 'left');
			var parent_jqo	= (position === 'left') ? left_jqo : right_jqo;
			var menu_render_result = self.render_top_menubar_menu(menu_declaration, parent_jqo);
			// console.log(menu_render_result, 'menu_render_result');
			self.assert_true(context, 'render menu', menu_render_result);
		}
		
		
		self.leave(context, 'success');
		return true;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptMenubar
	 * @desc				Render top menu bar title
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_render_top_menubar_title = function()
	{
		var self = this;
		var context = 'render_top_menubar_title()';
		self.enter(context, '');
		
		
		// CREATE TITLE TAG
		var title_jqo = $('<ul>');
		title_jqo.addClass('title-area');
		self.nav_jqo.append(title_jqo);
		
		// TITLE NAME
		var title = DevaptApplication.get_title();
		
		var title_name_jqo = $('<li>');
		title_name_jqo.addClass('name');
		title_jqo.append(title_name_jqo);
		
		var url = Devapt.url( DevaptApplication.get_url_base(), DevaptApplication.get_security_token() );
		var title_anchor_jqo = $('<a href="' + url + '">');
		title_anchor_jqo.text(title);
		
		var title_h1_jqo = $('<h1>');
		title_h1_jqo.append(title_anchor_jqo);
		title_name_jqo.append(title_h1_jqo);
		
		// TODO TITLE ICON
		
		
		// MOBILE MENU
		var toggle_li_jqo = $('<li class="toggle-topbar menu-icon">');
		title_jqo.append(toggle_li_jqo);
		toggle_li_jqo.append( $('<a href="#">').append( $('<span>').text('menu') ) );
		
		
		self.leave(context, 'success');
		return true;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptMenubar
	 * @desc				Switch current top menu bar with the given menubar
	 * @param {object}		arg_menubar_object		target menubar object	
	 * @param {boolean}		arg_render_view			render default menubar view ?	
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_switch_top_menubar = function(arg_menubar_object, arg_render_view)
	{
		var self = this;
		// self.trace=true;
		var context = 'switch_top_menubar(menubar,render)';
		self.enter(context, '');
		
		
		arg_render_view = arg_render_view ? arg_render_view : false;
		
		
		// DEBUG
		// console.log(self.name, 'self.name');
		// console.log(arg_menubar_object, 'arg_menubar_object');
		// console.log(arg_menubar_object.name, 'arg_menubar_object.name');
		
		
		// REMOVE CURRENT MENUBAR
		self.step(context, 'hide current menubar');
		self.content_jqo.hide();
		
		
		// SET TARGET PARENT IF NEEDED
		if ( arg_menubar_object.parent_jqo.attr('id') !== self.parent_jqo.attr('id') )
		{
			self.step(context, 'set menubar parent');
			// console.log(self.parent_jqo.attr('id'), 'self.parent_jqo.id');
			// console.log(arg_menubar_object.parent_jqo.attr('id'), 'arg_menubar_object.parent_jqo.id');
			
			arg_menubar_object.content_jqo = self.parent_jqo;
			self.parent_jqo.prepend(arg_menubar_object.content_jqo);
		}
		
		
		// SHOW TARGET MENUBAR
		self.step(context, 'show target menubar');
		arg_menubar_object.content_jqo.show();
		DevaptNavHistory.current_topbar_name = arg_menubar_object.name;
		
		
		// RENDER DEFAULT VIEW
		var view_name = arg_menubar_object['default_view'];
		var content_id = arg_menubar_object['default_container'];
		var content_label = arg_menubar_object['default_label'];
		self.value(context, 'view_name', view_name);
		if ( arg_render_view && DevaptTypes.is_not_empty_str(view_name) )
		{
			self.step(context, 'set menubar default view');
			
			// var url_base = DevaptApplication.get_url_base(); 
			// var display_url = url_base + 'views/' + view_name + '/html_page';
			// var force_render = false;
			
			// var promise = DevaptNavHistory.set_page_view_content(content_label, content_id, view_name, content_label, display_url, force_render, arg_menubar_object.name);
		
			var url_base		= DevaptApplication.get_url_base(); 
			var page_title		= content_label;
			var page_location	= url_base + 'views/' + view_name + '/html_page';
			var force_render	= false;
			var menubar_name	= arg_menubar_object.name;
			
			DevaptNavHistory.set_view_content(content_label, content_id, view_name, page_title, page_location, force_render, menubar_name);
		}
		
		
		self.leave(context, 'success');
		// self.trace=false;
		return true;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptMenubar
	 * @desc				Render top menu bar switch
	 * @param {object}		arg_menu_declaration	menu resource declaration (json object)
	 * @param {object}		arg_parent_menu_jqo		parent menu jQuery object	
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_render_top_menubar_switch = function(arg_menu_declaration, arg_parent_menu_jqo)
	{
		var self = this;
		// self.trace=true;
		var context = 'render_top_menubar_switch(menubar declaration,jqo)';
		self.enter(context, '');
		
		
		// CREATE MENU NODE
		var menubar_name	= DevaptTypes.to_string(arg_menu_declaration['name'], '');
		var menu_id			= menubar_name + '_id';
		var label			= DevaptTypes.to_string(arg_menu_declaration['label'], '');
		// var view_name		= DevaptTypes.to_string(arg_menu_declaration['default_view', '']);
		// var view_label		= DevaptTypes.to_string(arg_menu_declaration['default_label'], '');
		
		var menu_jqo		= $('<li>');
		var menu_a_jqo = $('<a>');
		menu_jqo.attr('id', menu_id);
		menu_a_jqo.text(label);
		menu_jqo.append(menu_a_jqo);
		
		// TODO : MOVE TO INDEX
		arg_parent_menu_jqo.append(menu_jqo);
		
		var switch_cb = (
			function(arg_menubar_name, arg_declaration)
			{
				return function()
				{
					// self.trace=true;
					self.step(context, 'switch menubar callback');
					
					
					// NEW MENUBAR EXISTS
					var menubar_object = DevaptClasses.get_instance(arg_menubar_name);
					if (menubar_object && menubar_object.is_render_state_rendered())
					{
						self.step(context, 'menubar already exists and is rendered');
						
						self.switch_top_menubar(menubar_object, true);
						
						self.leave(context, 'success');
						// self.trace=false;
						return true;
					}
					
					
					// CREATE AND RENDER NEW MENUBAR
					self.step(context, 'create menubar and render it');
					var backend = Devapt.get_current_backend();
					var container_id = DevaptApplication.get_topbar_container_id();
					self.assert_not_empty_string(context, 'container_id', container_id);
					
					var container_jqo = $('#' + container_id);
					var topmenubar_promise = backend.render_view(container_jqo, arg_menubar_name);
					topmenubar_promise.then(
						function()
						{
							self.step(context, 'menubar created and rendered');
							
							var menubar_object = DevaptClasses.get_instance(arg_menubar_name);
							self.value(context, 'menubar_object.name', menubar_object.name);
							self.value(context, 'menubar_object.is_rendered', menubar_object.is_rendered);
							
							self.switch_top_menubar(menubar_object, true);
							// self.trace=false;
						}
					);
				};
			}
		)(menubar_name, arg_menu_declaration);
		menu_a_jqo.click(switch_cb);
		
		
		self.leave(context, 'success');
		// self.trace=false;
		return true;
	};
	
		
	
	/*
		Example:
			application.menus.menu1.access_role=ROLE_HELP_READ
			application.menus.menu1.label=Page 1
			application.menus.menu1.tooltip=Tooltip Page 1
			application.menus.menu1.icon.url=
			application.menus.menu1.icon.alt=
			application.menus.menu1.display.url=
			application.menus.menu1.display.page=VIEW_CONTENT_1
			application.menus.menu1.display.js=
			application.menus.menu1.position=left
			application.menus.menu1.index=
	*/
	
	/**
	 * @public
	 * @memberof			DevaptMenubar
	 * @desc				Render top menu bar menu
	 * @param {object}		arg_menu_declaration	menu resource declaration (json object)
	 * @param {object}		arg_parent_menu_jqo		parent menu jQuery object	
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_render_top_menubar_menu = function(arg_menu_declaration, arg_parent_menu_jqo)
	{
		var self = this;
		var context = 'render_top_menubar_menu(json,jqo)';
		self.enter(context, '');
		
		
		// DEBUG
		// self.value(context, 'arg_menu_declaration', arg_menu_declaration);
		// console.log(self, 'self');
		// console.log(arg_menu_declaration);
		// console.log(arg_parent_menu_jqo);
		
		// GET MENU TYPE
		var menu_type	= DevaptTypes.to_string(arg_menu_declaration['class_type'], '');
		if (menu_type === 'menubar')
		{
			self.step(context, 'menu type is menubar');
			var result = self.render_top_menubar_switch(arg_menu_declaration, arg_parent_menu_jqo);
			
			self.leave(context, 'top menubar switched');
			return result;
		}
		
		// GET MENU ATTRIBUTES
		self.step(context, 'get menu attributes');
		// var position	= DevaptTypes.to_list_item(arg_menu_declaration['position'], ['left', 'right'], 'left');
		var menu_name	= DevaptTypes.to_string(arg_menu_declaration['menu_name'], '');
		// var index		= DevaptTypes.to_integer(arg_menu_declaration['index'], -1);
		var label		= DevaptTypes.to_string(arg_menu_declaration['label'], '');
		var tooltip		= DevaptTypes.to_string(arg_menu_declaration['tooltip'], '');
		var type		= DevaptTypes.to_string(arg_menu_declaration['type'], '');
		
		// var icon		= DevaptTypes.is_object(arg_menu_declaration['icon']) ? arg_menu_declaration['icon'] : {};
		// var icon_url	= DevaptTypes.to_string(icon['url'], null);
		// var icon_alt	= DevaptTypes.to_string(icon['alt'], null);
		
		var display		= DevaptTypes.is_object(arg_menu_declaration['display']) ? arg_menu_declaration['display'] : {};
		var display_url	= DevaptTypes.to_string(display['url'], null);
		var display_page= DevaptTypes.to_string(display['page'], null);
		var display_view= DevaptTypes.to_string(display['view'], null);
		var display_cont= DevaptTypes.to_string(display['container'], display_view);
		var display_js	= DevaptTypes.to_string(display['js'], null);
		
		var menu_id		= menu_name + '_id';
		
		var div_button_jqo = null;
		var option_button_url = null;
		var option_button_onclick = null;
		
		
		// GET CONTAINER NODE
		self.step(context, 'get container node');
		var menu_jqo	= $('<li>');
		menu_jqo.attr('id', menu_id);
		
		// TODO : MOVE TO INDEX
		arg_parent_menu_jqo.append(menu_jqo);
		
		
		// OPTION: TYPE IS SEPARATOR
		if (type === 'separator')
		{
			self.step(context, 'type is separator');
			menu_jqo.addClass('divider');
			
			self.leave(context, 'success: separator');
			return true;
		}
		
		
		// OPTION: TYPE IS SEARCH
		if (type === 'button')
		{
			self.step(context, 'type is button');
			menu_jqo.addClass('has-form');
			
			
			// MENU BUTTON
			div_button_jqo = $('<a>');
			menu_jqo.append(div_button_jqo);
			div_button_jqo.addClass('button');
			
			// MENU BUTTON OPTION: LABEL
			div_button_jqo.text(label);
			
			// MENU BUTTON OPTION: URL
			option_button_url = DevaptTypes.to_string(arg_menu_declaration['menu_button_url'], '#');
			div_button_jqo.attr('href', option_button_url);
			
			// MENU BUTTON OPTION: ONCLICK
			option_button_onclick = DevaptTypes.to_string(arg_menu_declaration['menu_button_onclick'], '#');
			div_button_jqo.attr('onclick', option_button_onclick);
			
			
			self.leave(context, 'success: button');
			return true;
		}
		
		
		// OPTION: TYPE IS SEARCH
		if (type === 'search')
		{
			self.step(context, 'type is search');
			menu_jqo.addClass('has-form');
			
			// SEARCH INPUT ROW
			var div_input_row_jqo = $('<div>');
			menu_jqo.append(div_input_row_jqo);
			div_input_row_jqo.addClass('row collapse');
			
			// SEARCH INPUT COLUMN
			var div_input_col_jqo = $('<div>');
			div_input_row_jqo.append(div_input_col_jqo);
			
			// SEARCH INPUT
			var div_input_jqo = $('<input type="text">');
			div_input_col_jqo.append(div_input_jqo);
			
			// SEARCH BUTTON COLUMN
			var div_button_col_jqo = $('<div>');
			div_input_row_jqo.append(div_button_col_jqo);
			
			// SEARCH BUTTON
			div_button_jqo = $('<a>');
			div_button_col_jqo.append(div_button_jqo);
			div_button_jqo.addClass('button expand');
			
			
			// SEARCH INPUT OPTION: PLACEHOLDER
			var option_placeholder = DevaptTypes.to_string(arg_menu_declaration['search_placeholder'], '');
			if (option_placeholder !== '')
			{
				div_input_jqo.attr('placeholder', option_placeholder);
			}
			
			// SEARCH BUTTON OPTION: LABEL
			var option_button_label = DevaptTypes.to_string(arg_menu_declaration['search_button_label'], 'Search');
			div_button_jqo.text(option_button_label);
			
			// SEARCH BUTTON OPTION: URL
			option_button_url = DevaptTypes.to_string(arg_menu_declaration['search_button_url'], '#');
			div_button_jqo.attr('href', option_button_url);
			
			// SEARCH BUTTON OPTION: ONCLICK
			option_button_onclick = DevaptTypes.to_string(arg_menu_declaration['search_button_onclick'], '#');
			div_button_jqo.attr('onclick', option_button_onclick);
			
			// SEARCH INPUT OPTION: WIDTH
			var option_input_width_large = DevaptTypes.to_number(arg_menu_declaration['search_input_width_large'], '8');
			var option_input_width_small = DevaptTypes.to_number(arg_menu_declaration['search_input_width_small'], '9');
			div_input_col_jqo.addClass('large-' + option_input_width_large + ' small-' + option_input_width_small + ' columns');
			
			// SEARCH BUTTON OPTION: WIDTH
			var option_button_width_large = DevaptTypes.to_number(arg_menu_declaration['search_button_width_large'], '8');
			var option_button_width_small = DevaptTypes.to_number(arg_menu_declaration['search_button_width_small'], '9');
			div_button_col_jqo.addClass('large-' + option_button_width_large + ' small-' + option_button_width_small + ' columns');
			
			
			self.leave(context, 'success: search');
			return true;
		}
		
		
		// DEFINE MENU NODE
		self.step(context, 'define menu node');
		var menu_a_jqo = $('<a>');
		if ( DevaptTypes.is_not_empty_str(display_url) )
		{
			self.step(context, 'menu has url');
			
			display_url = Devapt.url(display_url, Devapt.app.get_security_token());
			menu_a_jqo.attr('href', display_url);
		}
		else if ( DevaptTypes.is_not_empty_str(display_view) )
		{
			self.step(context, 'menu has view');
			var view_jqo = $('#' + display_cont);
			if (view_jqo)
			{
				var update_view_cb = (
					function(view_name, content_label, content_id)
					{
						return function()
						{
							var url_base		= DevaptApplication.get_url_base(); 
							var page_title		= content_label;
							// var page_location	= url_base + 'views/' + view_name + '/html_page' + '?security_token=' + DevaptApplication.get_security_token();
							var page_location	= url_base + 'views/' + view_name + '/html_page';
							var force_render	= false;
							var menubar_name	= self.name;
							// DevaptNavHistory.set_page_view_content(content_label, content_id, view_name, page_title, page_location, force_render, menubar_name);
							DevaptNavHistory.set_view_content(content_label, content_id, view_name, page_title, page_location, force_render, menubar_name);
						};
					}
				)(display_view, label, display_cont);
				menu_a_jqo.click(update_view_cb);
			}
		}
		else if ( DevaptTypes.is_not_empty_str(display_page) )
		{
			self.step(context, 'menu has page');
			var url_base	= DevaptApplication.get_url_base(); 
			display_url = url_base + 'views/' + display_page + '/html_page' + '?security_token=' + DevaptApplication.get_security_token();
			menu_a_jqo.attr('href', display_url);
		}
		else
		{
			self.step(context, 'menu has no url/view/page');
			menu_a_jqo.attr('href', '#');
		}
		
		if ( DevaptTypes.is_not_empty_str(display_js) )
		{
			self.step(context, 'menu has js');
			menu_a_jqo.attr('onclick', display_js);
		}
		if ( DevaptTypes.is_not_empty_str(tooltip) )
		{
			self.step(context, 'menu has tooltip');
			menu_a_jqo.attr('title', tooltip);
		}
		menu_a_jqo.text(label);
		menu_jqo.append(menu_a_jqo);
		
		
		// RENDER MENU ITEMS
		self.step(context, 'render menu items');
		var items = null;
		if ( DevaptTypes.is_array(arg_menu_declaration['items']) )
		{
			self.step(context, 'arg declaration items is an array');
			items = arg_menu_declaration['items'];
		}
		else if ( DevaptTypes.is_not_empty_str(arg_menu_declaration['items']) )
		{
			self.step(context, 'arg declaration items is a string');
			items = arg_menu_declaration['items'].split(',');
		}
		
		// self.value(context, 'items', items);
		if (items)
		{
			// CREATE DROPDOWN
			menu_jqo.addClass('has-dropdown');
			var ul_jqo = $('<ul class="dropdown">');
			menu_jqo.append(ul_jqo);
			
			var menus_resources = self.menubar_declaration['items_resources'];
			
			for(var item_key in items)
			{
				var item_name = items[item_key];
				self.value(context, 'item menu at [' + item_key + ']', item_name);
				
				var item_json = menus_resources[item_name];
				if ( DevaptTypes.is_object(item_json) )
				{
					self.assert(context, 'render menu item', self.render_top_menubar_menu(item_json, ul_jqo) );
					continue;
				}
				self.error(context, 'bad item menu json declaration');
			}
		}
		
		
		self.leave(context, 'success');
		return true;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptMenubar
	 * @desc				Render top menu bar view
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_render_nav_menubar = function()
	{
		var context = 'render_nav_menubar()';
		self.enter(context, '');
		
		
		
		self.leave(context, 'success');
		return true;
	};
	
	// TESTS
	/*
		var r = require(['core/object', 'backend-foundation5/views/menubar'],
			function(co, cv) {
				var options= {'class_name':'Menubar', 'class_type':'view', 'trace':true, 'name':'menus' , 'menubar_name':'HOME_MENUBAR'};
				var o = new cv('v1', $('body header'), options);
				console.log(o);
				o.render();
			}
		);
		
		require(['core/resources'],
			function(DevaptResources) {
				var app_declaration = DevaptResources.get_resource_declaration('application');
				console.log(app_declaration);
			}
		);
		
		var r = require(['core/resources'],
			function(DevaptResources) {
				console.log(DevaptResources.resources_providers);
				var menubar_declaration = DevaptResources.get_resource_declaration('HOME_MENUBAR');
				console.log(menubar_declaration);
			}
		);
		
		
	*/
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2013-08-21',
			updated:'2014-12-06',
			description:'Menubar View class.'
		},
		properties:{
			
		}
	};
	var parent_class = DevaptView;
	var DevaptMenubarClass = new DevaptClass('DevaptMenubar', parent_class, class_settings);
	
	// METHODS
	DevaptMenubarClass.infos.ctor = cb_constructor;
	DevaptMenubarClass.add_public_method('render_self', {}, cb_render_self);
	DevaptMenubarClass.add_public_method('render_top_menubar', {}, cb_render_top_menubar);
	DevaptMenubarClass.add_public_method('render_top_menubar_title', {}, cb_render_top_menubar_title);
	DevaptMenubarClass.add_public_method('switch_top_menubar', {}, cb_switch_top_menubar);
	DevaptMenubarClass.add_public_method('render_top_menubar_switch', {}, cb_render_top_menubar_switch);
	DevaptMenubarClass.add_public_method('render_top_menubar_menu', {}, cb_render_top_menubar_menu);
	DevaptMenubarClass.add_public_method('render_nav_menubar', {}, cb_render_nav_menubar);
	
	// PROPERTIES
	DevaptMenubarClass.add_public_str_property('menubar_name',			'',		null, true, false, []);
	DevaptMenubarClass.add_public_str_property('menubar_format',		'',		null, false, false, []); // top, nav
	DevaptMenubarClass.add_public_obj_property('menubar_declaration',	'',		null, false, false, []);
	
	DevaptMenubarClass.add_public_str_property('default_view',			'',	false, false, false, []);
	DevaptMenubarClass.add_public_str_property('default_container',		'',	false, false, false, []);
	DevaptMenubarClass.add_public_str_property('default_label',			'',	false, false, false, []);
	
	DevaptMenubarClass.add_public_str_property('format',				'',	false, false, false, []);
	DevaptMenubarClass.add_public_str_property('orientation',			'',	false, false, false, []);
	DevaptMenubarClass.add_public_bool_property('display_on_landscape',	'',	false, false, false, []);
	DevaptMenubarClass.add_public_bool_property('display_on_portrait',	'',	false, false, false, []);
	
	DevaptMenubarClass.add_public_bool_property('fixed',			'',	false, false, false, []);
	DevaptMenubarClass.add_public_bool_property('ongrid',			'',	false, false, false, []);
	DevaptMenubarClass.add_public_bool_property('float',			'',	false, false, false, []);
	DevaptMenubarClass.add_public_bool_property('clickable',		'',	false, false, false, []);
	
	DevaptMenubarClass.add_public_obj_property('items',				'',	null, false, false, []);
	DevaptMenubarClass.add_public_obj_property('items_resources',	'',	null, false, false, []);
	
	// MIXINS
	
	// BUILD
	DevaptMenubarClass.build_class();
	
	
	return DevaptMenubarClass;
} );
/**
 * @file        plugins/backend-foundation5/views/pagination.js
 * @desc        Foundation 5 pagination class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-05-09
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */

'use strict'
define(
'plugins/backend-foundation5/views/pagination',['Devapt', 'core/types', 'object/class', 'core/resources', 'views/view', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptResources, DevaptView, undefined)
{
	/**
	 * @public
	 * @class				DevaptPagination
	 * @desc				Pagination view class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				Init event handling
	 * @return {nothing}
	 */
	var cb_init_event_handling = function()
	{
		var self = this;
		var context = 'init_event_handling()';
		self.enter(context, '');
		
		
		// PARENT CONSTRUCTOR
		self._parent_class.infos.ctor(self);
		
		
		// INIT PAGINATIONS
		var target_views = self.get_property('pagination_views');
		target_views.forEach(
			function(view_name)
			{
				var promise = DevaptResources.get_resource_instance(view_name);
				promise.then(
					function(view)
					{
						self.step(context, 'link with view [' + view.name + ']');
						
						if ( DevaptTypes.is_function(view.on_pagination_previous_event) )
						{
							self.add_event_callback('devapt.pagination.update_previous', [view, view.on_pagination_previous_event], false);
						}
						
						if ( DevaptTypes.is_function(view.on_pagination_current_event) )
						{
							self.add_event_callback('devapt.pagination.update_current', [view, view.on_pagination_current_event], false);
						}
						
						if ( DevaptTypes.is_function(view.on_pagination_next_event) )
						{
							self.add_event_callback('devapt.pagination.update_next', [view, view.on_pagination_next_event], false);
						}
						
						if ( DevaptTypes.is_function(self.on_update_pagination) )
						{
							view.add_event_callback('devapt.pagination.update_pagination', [self, self.on_update_pagination], false, [], []);
						}
					}
				);
			}
		);
		
		
		self.leave(context, 'success: promise is resolved');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				On update pagination event
	 * @param {array}		arg_event_operands		event operands array
	 * @return {nothing}
	 */
	var cb_on_update_pagination = function(arg_event_operands)
	{
		var self = this;
		var context = 'on_update_pagination(opds)';
		self.enter(context, '');
		
		
		// TEST STATUS
		if (self.pagination_status === 'on_update_pagination')
		{
			self.leave(context, 'already processing event');
			return;
		}
		
		// CHANGE STATUS
		self.pagination_status = 'on_update_pagination';
		
		// console.log(arg_event_operands, context);
		
		var items_first_index = arg_event_operands[2].begin;
		var items_last_index = arg_event_operands[2].end;
		self.value(context, 'items_first_index', items_first_index);
		self.value(context, 'items_last_index', items_last_index);
		self.value(context, 'self.pagination_size', self.pagination_size);
		
		self.pagination_first_page =  Math.floor(items_first_index / self.pagination_size);
		if (self.pagination_first_page*self.pagination_size < items_first_index)
		{
			self.pagination_first_page++; 
		}
		
		self.pagination_last_page = Math.floor(items_last_index / self.pagination_size);
		if (self.pagination_last_page*self.pagination_size < items_last_index)
		{
			self.pagination_last_page++; 
		}
		
		self.pagination_first_page =  Math.max(self.pagination_first_page, 1);
		self.pagination_last_page =  Math.max(self.pagination_last_page, 1);
		self.value(context, 'self.pagination_first_page', self.pagination_first_page);
		self.value(context, 'self.pagination_last_page', self.pagination_last_page);
		
		// console.log(self.pagination_first_page, context + '.pagination_first_page');
		// console.log(self.pagination_last_page, context + '.pagination_last_page');
		
		self.pagination_current_page = Math.min(self.pagination_current_page, self.pagination_last_page);
		self.pagination_current_page = Math.max(self.pagination_current_page, self.pagination_first_page);
		self.value(context, 'self.pagination_current_page', self.pagination_current_page);
		
		// console.log(self.pagination_current_page, context + '.pagination_current_page');
		// console.log(self.pagination_size, context + '.pagination_size');
		
		self.update_pagination_current(self.pagination_current_page);
		
		
		// CHANGE STATUS
		self.pagination_status = 'ready';
		
		
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				On page choice
	 * @param {integer}		arg_current_page	new current index
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_update_pagination_current = function(arg_current_page)
	{
		var self = this;
		var context = 'update_pagination_current(' + arg_current_page + ')';
		self.enter(context, '');
		
		
		// CHECK CURRENT INDEX
		if ( ! DevaptTypes.is_integer(arg_current_page) )
		{
			self.leave(context, 'bad index type');
			return false;
		}
		if ( arg_current_page > self.pagination_last_page || arg_current_page < self.pagination_first_page )
		{
			self.leave(context, 'bad index value');
			return false;
		}
		
		// GET ARROW TAGS
		var prev_arrow_jqo = $('li.arrow:first', self.parent_jqo);
		var next_arrow_jqo = $('li.arrow:last', self.parent_jqo);
		
		// UPDATE ARROWS
		if (self.pagination_current_page == self.pagination_first_page)
		{
			prev_arrow_jqo.removeClass('unavailable');
		}
		if (self.pagination_current_page == self.pagination_last_page)
		{
			next_arrow_jqo.removeClass('unavailable');
		}
		
		
		// WITHOUT PAGE SCROLLING
		if (self.pagination_last_page <= self.pagination_size)
		{
			// SHOW/HIDE NODES
			var nodes_jqo = $('li', self.ul_jqo);
			nodes_jqo = $('li', self.ul_jqo).show();
			for(var li_index = self.pagination_last_page + 1 ; li_index <= self.pagination_size ; li_index++)
			{
				nodes_jqo.eq(li_index).removeClass('current').hide();
			}
			
			self.update_pagination_current_without_scrolling(arg_current_page);
		}
		// WITH PAGE SCROLLING
		else
		{
			self.update_pagination_current_with_scrolling(arg_current_page);
		}
		
		
		// UPDATE ARROWS
		if (self.pagination_current_page == self.pagination_first_page)
		{
			prev_arrow_jqo.addClass('unavailable');
		}
		if (self.pagination_current_page == self.pagination_last_page)
		{
			next_arrow_jqo.addClass('unavailable');
		}
		
		
		// PROPAGATE EVENT
		self.fire_event('devapt.pagination.update_current', [ {page:arg_current_page} ]);
		
		
		self.leave(context, 'success');
		return true;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				Update current page without pages scrolling
	 * @param {integer}		arg_current_page	new current index
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_update_pagination_current_without_scrolling = function(arg_current_page)
	{
		var self = this;
		var context = 'update_pagination_current_without_scrolling(' + arg_current_page + ')';
		self.enter(context, '');
		
		
		// GET PREVIOUS INDEX TAGS
		var prev_li_jqo = $('[devapt-pagination-index=' + self.pagination_current_page + ']', self.parent_jqo)
		prev_li_jqo.removeClass('current');
		
		// SET NEW CURRENT INDEX
		self.pagination_current_page = arg_current_page;
		
		// GET INDEX TAG
		var li_jqo = $('[devapt-pagination-index=' + arg_current_page + ']', self.parent_jqo);
		// console.log(li_jqo);
		
		// UPDATE CURRENT PAGE TAG
		li_jqo.addClass('current');
		
		
		self.leave(context, 'success');
		return true;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				Update current page with pages scrolling
	 * @param {integer}		arg_current_page	new current index
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_update_pagination_current_with_scrolling = function(arg_current_page)
	{
		var self = this;
		var context = 'update_pagination_current_with_scrolling(' + arg_current_page + ')';
		self.enter(context, '');
		
		
		// SET NEW CURRENT INDEX
		self.pagination_current_page = arg_current_page;
		
		// GET PAGES ATTRIBUTES
		var last_page = self.pagination_last_page > 0 ? self.pagination_last_page : 10;
		var first_page = (self.pagination_first_page >=0 && self.pagination_first_page <= last_page) ? self.pagination_first_page : 0;
		var current_page = (self.pagination_current_page >= first_page && self.pagination_current_page <= last_page) ? self.pagination_current_page : first_page;
		self.value(context, 'last_page', last_page);
		self.value(context, 'first_page', first_page);
		self.value(context, 'current_page', current_page);
		
		
		// GET SIZE ATTRIBUTES
		var size_index = self.pagination_size > 0 ? self.pagination_size - 1 : 10;
		var loop_size_index = Math.min(first_page + size_index, last_page);
		var size_half = Math.ceil(loop_size_index / 2);
		self.value(context, 'size_index', size_index);
		self.value(context, 'loop_size_index', loop_size_index);
		self.value(context, 'size_half', size_half);
		
		
		// GET PREFIX/SUFFIX ATTRIBUTES
		if (last_page > self.pagination_size)
		{
			if (self.pagination_prefix_size == 0)
			{
				self.pagination_prefix_size = 1;
			}
			if (self.pagination_suffix_size == 0)
			{
				self.pagination_suffix_size = 1;
			}
		}
		var prefix_size = self.pagination_prefix_size > 0 && self.pagination_prefix_size < (size_index / 2 - 1) ? self.pagination_prefix_size : 0;
		var suffix_size = self.pagination_suffix_size > 0 && self.pagination_suffix_size < (size_index / 2 - 1) ? self.pagination_suffix_size : 0;
		self.value(context, 'prefix_size', prefix_size);
		self.value(context, 'suffix_size', suffix_size);
		
		var prefix_first_index = 1;
		var prefix_first_page = first_page;
		var prefix_last_index = prefix_first_index + prefix_size - 1;
		var prefix_last_page = prefix_first_page + prefix_size - 1;
		self.value(context, 'prefix_first_index', prefix_first_index);
		self.value(context, 'prefix_first_page', prefix_first_page);
		self.value(context, 'prefix_last_index', prefix_last_index);
		self.value(context, 'prefix_last_page', prefix_last_page);
		
		var prefix_sep_index = prefix_last_index + 1;
		var prefix_sep_page = -1;
		self.value(context, 'prefix_sep_index', prefix_sep_index);
		self.value(context, 'prefix_sep_page', prefix_sep_page);
		
		
		var loop_first_index = prefix_sep_index + 1;
		var loop_last_index = loop_size_index - suffix_size - 1;
		var loop_first_page = current_page - size_half + prefix_size + 1;
		if (current_page >= last_page - suffix_size - 3)
		{
			loop_first_page = last_page - size_index + prefix_size + 1;
		}
		var loop_last_page = loop_first_page + (loop_last_index - loop_first_index);
		self.value(context, 'loop_first_index', loop_first_index);
		self.value(context, 'loop_last_index', loop_last_index);
		self.value(context, 'loop_first_page', loop_first_page);
		self.value(context, 'loop_last_page', loop_last_page);
		
		
		var suffix_sep_index = loop_last_index + 1;
		var suffix_sep_page = -1;
		self.value(context, 'suffix_sep_index', suffix_sep_index);
		self.value(context, 'suffix_sep_page', prefix_sep_page);
		
		
		var suffix_first_index = loop_size_index - suffix_size + 1;
		var suffix_first_page = last_page - suffix_size + 1;
		var suffix_last_index = suffix_first_index + suffix_size - 1;
		var suffix_last_page = suffix_first_page + suffix_size - 1;
		self.value(context, 'suffix_first_index', suffix_first_index);
		self.value(context, 'suffix_first_page', suffix_first_page);
		self.value(context, 'suffix_last_index', suffix_last_index);
		self.value(context, 'suffix_last_page', suffix_last_page);
		
		
		// LOOP ON PAGES TAGS PREFIX
		self.step(context, 'loop on prefix tags');
		var loop_page = prefix_first_page;
		for(var li_index = prefix_first_index ; li_index <= prefix_last_index ; li_index++)
		{
			self.value(context, 'loop_page', loop_page);
			self.value(context, 'li_index', li_index);
			
			var is_current = first_page + li_index - 1 === current_page;
			var is_available = true;
			var label = loop_page;
			self.update_pagination_item(li_index, loop_page, label, is_current, is_available);
			++loop_page;
		}
		
		
		// SUFFIX SEPARATOR TAG
		if (prefix_size > 0 && loop_first_page > prefix_last_page + 1)
		{
			self.update_pagination_item(prefix_sep_index, prefix_sep_page, '...', false, false);
		}
		else
		{
			loop_first_index = prefix_sep_index;
			loop_first_page = prefix_last_page + 1;
		}
		
		// LOOP ON PAGES TAGS
		self.step(context, 'loop on core tags');
		loop_page = loop_first_page;
		for(var li_index = loop_first_index ; li_index <= loop_last_index ; li_index++)
		{
			self.value(context, 'loop_page', loop_page);
			self.value(context, 'li_index', li_index);
			
			var is_current = loop_page == current_page;
			var is_available = true;
			var label = loop_page;
			self.update_pagination_item(li_index, loop_page, label, is_current, is_available);
			
			++loop_page;
		}
		
		
		// SUFFIX SEPARATOR TAG
		self.step(context, 'suffix separator');
		self.value(context, 'loop_page', loop_page);
		if (suffix_size > 0 && loop_page < suffix_first_page - 1)
		{
			self.update_pagination_item(suffix_sep_index, suffix_sep_page, '...', false, false);
		}
		else
		{
			suffix_first_index = suffix_sep_index;
			suffix_first_page = loop_page;
		}
		
		
		// LOOP ON PAGES TAGS SUFFIX
		self.step(context, 'loop on suffix tags');
		loop_page = suffix_first_page;
		for(var li_index = suffix_first_index ; li_index <= suffix_last_index ; li_index++)
		{
			self.value(context, 'loop_page', loop_page);
			self.value(context, 'li_index', li_index);
			
			var is_current = loop_page == current_page;
			var is_available = true;
			var label = loop_page;
			self.update_pagination_item(li_index, loop_page, label, is_current, is_available);
			
			++loop_page;
		}
		
		
		self.leave(context, 'success');
		return true;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				Get page label
	 * @param {integer}		page index
	 * @return {string}		page label
	 */
	var cb_get_page_label = function(arg_page_index)
	{
		var self = this;
		var context = 'get_item_label(page_index)';
		// self.enter(context, '');
		
		var step = DevaptTypes.is_integer(self.pagination_range_step) ? self.pagination_range_step : 1;
		var type = self.pagination_type;
		var label = 'unknow';
		// console.log(step, 'step');
		// console.log(type, 'type');
		switch (type)
		{
			case 'alphabet':
			{
				var alphabet = 'abcdefghijklmnopqrstuvwxyz';
				label = DevaptTypes.is_integer(arg_page_index) && arg_page_index > 0 && arg_page_index <= 26 ? alphabet.charAt(arg_page_index - 1) : arg_page_index;
				break;
			}
			
			case 'range':
			{
				label = DevaptTypes.is_integer(arg_page_index) && arg_page_index > 0 ? ((arg_page_index - 1) * step) + '-' + (arg_page_index * step - 1) : arg_page_index;
				break;
			}
			
			case 'index':
			default:
			{
				label = arg_page_index;
				break;
			}
		}
		
		
		// self.leave(context, 'success');
		return label;
	}
		
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				Update page item
	 * @param {integer}		list index
	 * @param {integer}		page index
	 * @param {string}		page label
	 * @param {boolean}		is current page ?
	 * @param {boolean}		is available page ?
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_update_pagination_item = function(arg_item_index, arg_page_index, arg_page_label, arg_is_current, arg_is_available)
	{
		var self = this;
		var context = 'update_pagination_item(item_index,page_index,page_label,is_current,is_available)';
		// self.enter(context, '');
		
		
		// ADD NODE IF NEEDED
		var items_count = $('li', self.ul_jqo).length;
		var current_page = (arg_is_current ? arg_page_index : -1);
		while (arg_item_index >= items_count)
		{
			self.add_item(arg_item_index, current_page);
			++items_count;
		}
		
		// GET NODE
		var li_jqo = $('li:eq(' + arg_item_index + ')', self.parent_jqo);
		li_jqo.show();
		li_jqo.removeClass('current');
		
		// GET NODE ANCHOR
		var a_jqo = $('a', li_jqo);
		var label = self.get_page_label(arg_page_label);
		a_jqo.text(label);
		
		// UPDATE NODE
		li_jqo.attr('devapt-pagination-index', arg_page_index);
		
		if (arg_is_current)
		{
			li_jqo.addClass('current');
		}
		else
		{
			li_jqo.removeClass('current');
		}
		
		if ( arg_is_available )
		{
			li_jqo.removeClass('unavailable');
		}
		else
		{
			li_jqo.addClass('unavailable');
		}
		
		
		// self.leave(context, 'success');
		return true;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				On previous page
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_update_pagination_previous = function()
	{
		var self = this;
		var context = 'update_pagination_previous()';
		self.enter(context, '');
		
		
		if (self.pagination_current_page == self.pagination_first_page)
		{
			self.leave(context, 'already at first page, nothing to do');
			return true;
		}
		
		// UPDATE CURRENT PAGE
		self.update_pagination_current(parseInt(self.pagination_current_page) - 1);
		
		// PROPAGATE EVENT
		self.fire_event('devapt.pagination.update_previous', [ {page:self.pagination_current_page} ] );
		
		
		self.leave(context, 'success');
		return true;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				On next page
	 * @return {boolean}	true:success,false:failure
	 */
	var cb_update_pagination_next = function()
	{
		var self = this;
		var context = 'update_pagination_next()';
		self.enter(context, '');
		
		
		// CHECK INDEX
		if (self.pagination_current_page == self.pagination_last_page)
		{
			self.leave(context, 'already at last page, nothing to do');
			return true;
		}
		
		// UPDATE CURRENT PAGE
		self.update_pagination_current(parseInt(self.pagination_current_page) + 1);
		
		// PROPAGATE EVENT
		self.fire_event('devapt.pagination.update_next', [ { page:self.pagination_current_page} ] );
		
		
		self.leave(context, 'success');
		return true;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				Render view
	 * @param {object}		arg_deferred	deferred object
	 * @return {object}		deferred promise object
	 */
	var cb_render_self = function(arg_deferred)
	{
		var self = this;
		var context = 'render_self(deferred)';
		self.enter(context, '');
		
		
		// CHECK CONTAINER
		self.assert_not_null(context, 'parent_jqo', self.parent_jqo);
		// console.log(self.parent_jqo);
		
		
		// CREATE MAIN NODE
		// var div_jqo = $('<div>');
		// self.parent_jqo.append(div_jqo);
		if ( self.get_property('pagination_centered') )
		{
			self.content_jqo.addClass('pagination-centered');
		}
		self.ul_jqo = $('<ul>');
		self.ul_jqo.addClass('pagination');
		self.content_jqo.append(self.ul_jqo);
		// self.content_jqo = div_jqo;
		
		
		var promise = self.render_items(arg_deferred);
		
		
		self.leave(context, 'success: promise is resolved');
		return promise;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				Remove view items
	 * @return {nothing}
	 */
	var cb_remove_items = function()
	{
		var self = this;
		var context = 'remove_items()';
		self.enter(context, '');
		
		
		$('li', self.ul_jqo).remove();
		
		
		self.leave(context, Devapt.msg_success);
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				Render view items
	 * @param {integer}		arg_index			item index
	 * @param {integer}		arg_current_page	current page
	 * @return {nothing}
	 */
	var cb_add_item = function(arg_index, arg_current_page)
	{
		var self = this;
		var context = 'add_item(index,current)';
		self.enter(context, '');
		
		
		// CREATE LI TAG
		var li_jqo = $('<li>');
		self.ul_jqo.append(li_jqo);
		li_jqo.attr('devapt-pagination-index', arg_index);
		if (arg_index === arg_current_page)
		{
			li_jqo.addClass('current');
		}
		
		// CREATE A TAG
		var a_jqo = $('<a>');
		li_jqo.append(a_jqo);
		var label = self.get_page_label(arg_index);
		a_jqo.text(label);
		
		// ON CLICK
		a_jqo.click(
			function()
			{
				if ( ! $(this).parent().hasClass('unavailable') )
				{
					var index = $(this).parent().attr('devapt-pagination-index');
					self.update_pagination_current( parseInt(index) );
				}
			}
		);
		
		
		self.leave(context, Devapt.msg_success);
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPagination
	 * @desc				Render view items
	 * @param {object}		arg_deferred	deferred object
	 * @return {object}		deferred promise object
	 */
	var cb_render_items = function(arg_deferred)
	{
		var self = this;
		var context = 'render_items(deferred)';
		self.enter(context, '');
		
		
		// GET ATTRIBUTES
		var size_index = self.pagination_size > 0 ? self.pagination_size - 1 : 10;
		var last_page = self.pagination_last_page > 0 ? self.pagination_last_page : 10;
		var first_page = (self.pagination_first_page >=0 && self.pagination_first_page <= last_page) ? self.pagination_first_page : 0;
		var current_page = (self.pagination_current_page >= first_page && self.pagination_current_page <= last_page) ? self.pagination_current_page : first_page;
		size_index = Math.min(first_page + size_index, last_page);
		self.value(context, 'size_index', size_index);
		self.value(context, 'last_page', last_page);
		self.value(context, 'first_page', first_page);
		self.value(context, 'current_page', current_page);
		
		
		// CREATE LEFT ARROW
		var left_arrow_li_jqo = $('<li class="arrow">');
		self.ul_jqo.append(left_arrow_li_jqo);
		if (current_page === first_page)
		{
			left_arrow_li_jqo.addClass('unavailable');
		}
		
		var left_arrow_a_jqo = $('<a>&laquo;</a>');
		left_arrow_li_jqo.append(left_arrow_a_jqo);
		
		// ON CLICK
		left_arrow_a_jqo.click(
			function()
			{
				self.update_pagination_previous();
			}
		);
		
		// CREATE PAGES
		for(var loop_index = first_page ; loop_index <= size_index ; loop_index++)
		{
			self.value(context, 'loop_index', loop_index);
			
			self.add_item(loop_index, current_page);
		}
		
		
		// CREATE LEFT ARROW
		var right_arrow_li_jqo = $('<li class="arrow">');
		self.ul_jqo.append(right_arrow_li_jqo);
		if (current_page === last_page)
		{
			right_arrow_li_jqo.addClass('unavailable');
		}
		
		var right_arrow_a_jqo = $('<a>&raquo;</a>');
		right_arrow_li_jqo.append(right_arrow_a_jqo);
		
		// ON CLICK
		right_arrow_a_jqo.click(
			function()
			{
				self.update_pagination_next();
			}
		);
		
		// RESOLVE AND GET PROMISE
		arg_deferred.resolve();
		
		
		self.leave(context, 'success: promise is resolved');
		return Devapt.promise(arg_deferred);
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-21',
			'updated':'2014-12-13',
			'description':'View class to filter a collection with pages.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptView;
	var DevaptPaginationClass = new DevaptClass('DevaptPagination', parent_class, class_settings);
	
	
	// METHODS
	DevaptPaginationClass.infos.ctor = cb_init_event_handling;
	DevaptPaginationClass.add_static_method('init_event_handling', {}, cb_init_event_handling);
	
	DevaptPaginationClass.add_public_method('on_update_pagination', {}, cb_on_update_pagination);
	DevaptPaginationClass.add_public_method('update_pagination_current', {}, cb_update_pagination_current);
	DevaptPaginationClass.add_public_method('update_pagination_current_without_scrolling', {}, cb_update_pagination_current_without_scrolling);
	DevaptPaginationClass.add_public_method('update_pagination_current_with_scrolling', {}, cb_update_pagination_current_with_scrolling);
	
	DevaptPaginationClass.add_public_method('get_page_label', {}, cb_get_page_label);
	
	DevaptPaginationClass.add_public_method('update_pagination_item', {}, cb_update_pagination_item);
	DevaptPaginationClass.add_public_method('update_pagination_previous', {}, cb_update_pagination_previous);
	DevaptPaginationClass.add_public_method('update_pagination_next', {}, cb_update_pagination_next);
	
	DevaptPaginationClass.add_public_method('render_self', {}, cb_render_self);
	
	DevaptPaginationClass.add_public_method('remove_items', {}, cb_remove_items);
	DevaptPaginationClass.add_public_method('add_item', {}, cb_add_item);
	DevaptPaginationClass.add_public_method('render_items', {}, cb_render_items);
	
	
	// PROPERTIES
	DevaptPaginationClass.add_public_str_property('pagination_type',			'',		'index', false, false, []); //  index / alphabet / range
	DevaptPaginationClass.add_public_int_property('pagination_range_step',		'',		1, false, false, []); //  page = index * range_step
	DevaptPaginationClass.add_public_int_property('pagination_size',			'',		10, false, false, []);
	DevaptPaginationClass.add_public_int_property('pagination_first_page',		'',		1, false, false, []);
	DevaptPaginationClass.add_public_int_property('pagination_current_page',	'',		5, false, false, []);
	DevaptPaginationClass.add_public_int_property('pagination_last_page',		'',		10, false, false, []);
	DevaptPaginationClass.add_public_int_property('pagination_prefix_size',		'',		0, false, false, []);
	DevaptPaginationClass.add_public_int_property('pagination_suffix_size',		'',		0, false, false, []);
	DevaptPaginationClass.add_public_bool_property('pagination_centered',		'',		true, false, false, []);
	DevaptPaginationClass.add_public_array_property('pagination_views',			'',		[], false, false, [], 'string', ',');
	
	
	return DevaptPaginationClass;
} );
/**
 * @file        plugins/backend-foundation5/views/panel.js
 * @desc        Foundation 5 panel class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-05-09
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/views/panel',['Devapt', 'core/types', 'object/class', 'views/view', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptView, undefined)
{
	/**
	 * @public
	 * @class				DevaptPanel
	 * @desc				Panel view class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptPanel
	 * @desc				Render view
	 * @param {object}		arg_deferred	deferred object
	 * @return {object}		deferred promise object
	 */
	var cb_render_self = function(arg_deferred)
	{
		var self = this;
		var context = 'render_self(deferred)';
		self.enter(context, '');
		
		
		// CHECK DEFEREED
		self.assert_not_null(context, 'arg_deferred', arg_deferred);
		
		// GET NODES
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		self.content_jqo.addClass('panel');
		
		// RESOLVE AND GET PROMISE
		self.step(context, 'deferred.resolve()');
		arg_deferred.resolve();
		var promise = arg_deferred.promise;
		
		
		self.leave(context, 'success: promise is resolved');
		return promise;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-21',
			'updated':'2014-12-13',
			'description':'Simple view class to display a panel.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptView;
	var DevaptPanelClass = new DevaptClass('DevaptPanel', parent_class, class_settings);
	
	// METHODS
	DevaptPanelClass.add_public_method('render_self', {}, cb_render_self);
	
	// PROPERTIES
	
	
	
	return DevaptPanelClass;
} );
/**
 * @file        plugins/backend-foundation5/views/all.js
 * @desc        Load all Devapt plugin classes
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2015-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
	'plugins/backend-foundation5/views/all',[	'plugins/backend-foundation5/views/breadcrumbs',
		'plugins/backend-foundation5/views/button',
		'plugins/backend-foundation5/views/button-bar',
		'plugins/backend-foundation5/views/button-group',
		'plugins/backend-foundation5/views/image',
		'plugins/backend-foundation5/views/label',
		'plugins/backend-foundation5/views/menubar',
		'plugins/backend-foundation5/views/pagination',
		'plugins/backend-foundation5/views/panel'
	],
	function()
	{
	}
);
/**
 * @file        views/container/container-mixin-lookupable.js
 * @desc        View mixin class to lookup container node
 * 				
 *              API:
 *  				->get_select_item_by_index(index)   : get a promise of a selected item object from an index
 *  				->get_select_item_by_label(label)   : get a promise of a selected item object from a label
 *  				->get_select_item_by_record(record) : get a promise of a selected item object from a record
 *  				WITH
 *  					selected item object : { index:integer, node_jqo:jQuery object, record:{...}, label:string, already_selected:boolean };
 * 					
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-03-04
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('views/container/container-mixin-lookupable',[
	'Devapt', 'core/types',
	'object/class', 'object/object'
	],
function(
	Devapt, DevaptTypes,
	DevaptClass, DevaptObject)
{
	/**
	 * @public
	 * @class				DevaptContainerMixinLookupable
	 * @desc				View mixin class for SELECT/UNSELECT operations
	 * @return {nothing}
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptContainerMixinLookupable
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = 'constructor';
		self.enter(context, '');
		
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	
	/**
	 * @memberof				DevaptContainerMixinLookupable
	 * @private
	 * @method					cb_get_select_item_by_index(view object, index)
	 * @desc					Get selected item attributes by its index
	 * @param {integer}			arg_index		selected item index
	 * @return {object}			A promise of a selected item record { index:..., node_jqo:..., record:..., label:..., already_selected:... }
	 */
/*	var cb_get_select_item_by_index = function (arg_index)
	{
		var self = this;
		var context = 'get_select_item_by_index(index)';
		self.enter(context, arg_index);
		
		
		// INIT SELECTED ITEM
		var selected_item = { index:arg_index, node_jqo:null, record:null, label:null, already_selected:false };
		
		
		// GET SELECTED INDEX
		
		
		// GET SELECTED JQUERY NODE WITH GIVEN INDEX
		self.step(context, 'get selected jQuery node');
		if ( ! (arg_index in self.mixin_items_collection_by_index) )
		{
			self.error(context + ':node not found');
			self.leave(context, Devapt.msg_failure);
			return Devapt.promise_rejected(context + ':node not found');
		}
		
		// GET CONTAINER ITEM
		var container_item = self.mixin_items_collection_by_index[arg_index];
		if ( ! container_item )
		{
			console.log(arg_index, context + ':index');
			console.error(self, context);
			return Devapt.promise_rejected();
		}
		
		selected_item.node_jqo = container_item.node;
		if ( ! selected_item.node_jqo)
		{
			self.error(context + ':node not found');
			self.leave(context, Devapt.msg_failure);
			return Devapt.promise_rejected(context + ':node not found');
		}
		// console.log(selected_item.node_jqo, context + ':node_jqo [' + self.name + '] at index [' + arg_index + ']');
		
		
		// WAS SELECTED
		self.step(context, 'get already selected');
		selected_item.already_selected = self.has_item_node_css_class(selected_item.node_jqo, 'selected');
		
		
		// GET SELECTED LABEL
		self.step(context, 'get selected label');
		selected_item.label = self.get_item_node_text(selected_item.node_jqo);
		// console.log(selected_item.label, context + '.label');
		
		// GET SELECTED RECORD
		self.step(context, 'get selected record');
		selected_item.record = self.items_records[selected_item.index]; // TODO self.get_record_at(index)
		// console.log(selected_item.record, context + '.record');
		
		
		self.leave(context, Devapt.msg_success);
		return Devapt.promise_resolved(selected_item);
	};*/
	
	
	/**
	 * @memberof				DevaptContainerMixinLookupable
	 * @private
	 * @method					cb_get_select_item_by_label(view object, label)
	 * @desc					Get selected item attributes by its index
	 * @param {string}			arg_label		selected item node label
	 * @return {object}			A promise of a selected item record { index:..., node_jqo:..., record:..., label:... }
	 */
/*	var cb_get_select_item_by_label = function (arg_label)
	{
		var self = this;
		var context = 'get_select_item_by_label(label)';
		self.enter(context, arg_label);
		
		
		// INIT SELECTED ITEM
		var selected_item = { index:null, node_jqo:null, record:null, label:null, already_selected:false };
		
		
		// GET SELECTED JQUERY NODE WITH GIVEN LABEL
		self.step(context, 'get selected jQuery node');
		selected_item.node_jqo = self.get_node_by_content(arg_label);
		if ( ! selected_item.node_jqo)
		{
			self.error(context + ':node not found');
			self.leave(context, Devapt.msg_failure);
			return Devapt.promise_rejected(context + ':node not found');
		}
		// console.log(selected_item.node_jqo, context + ':node_jqo [' + self.name + '] with label [' + arg_label + ']');
		
		
		// GET SELECTED INDEX
		try
		{
			selected_item.index = parseInt( selected_item.node_jqo.index() );
		}
		catch(e)
		{
			self.error(context + ':bad node index');
			self.leave(context, Devapt.msg_failure);
			return Devapt.promise_rejected(context + ':bad node index');
		}
		self.value(context, 'selected_item.index', selected_item.index);
		
		
		// WAS SELECTED
		self.step(context, 'get already selected');
		selected_item.already_selected = self.has_item_node_css_class(selected_item.node_jqo, 'selected');
		self.value(context, 'selected_item.already_selected', selected_item.already_selected);
		
		
		// GET SELECTED LABEL
		self.step(context, 'get selected label');
		selected_item.label = arg_label;
		
		
		// GET SELECTED RECORD
		self.step(context, 'get selected record');
		selected_item.record = self.items_records[selected_item.index]; // TODO self.get_record_at(index)
		// console.log(selected_item.record, context + '.record');
		
		
		self.leave(context, Devapt.msg_success);
		return Devapt.promise_resolved(selected_item);
	};*/
	
	
	/**
	 * @memberof				DevaptContainerMixinLookupable
	 * @private
	 * @method					get_select_item_by_record(record)
	 * @desc					Get selected item attributes by its record
	 * @param {object}			arg_record		selected item node record
	 * @return {object}			A promise of a selected item record { index:..., node_jqo:..., record:..., label:... }
	 */
	var cb_get_select_item_by_record = function (arg_record)
	{
		var self = this;
		var context = 'get_select_item_by_record(record)';
		self.enter(context, '');
		self.value(context, 'arg_record', arg_record);
		
		
		var items_iterator = null;
		
		// GET ITEMS PROMISE
		self.step(context, 'GET ITEMS PROMISE');
		var items_promise = self.view_model_promise.then(
			function(view_model)
			{
				self.step(context, 'VIEW_MODEL IS READY');
				
				items_iterator = view_model.view.items_iterator;
				self.value(context, 'items_iterator', items_iterator);
				
				switch(items_iterator)
				{
					case 'field_editor':
						self.step(context, 'ITERATE ON FIELD EDITOR RECORD');
						
						var field_name = self.items_fields[0];
						self.assert_not_null(context, 'field_name', field_name);
						self.value(context, 'field_name', field_name);
						
						var field_value = arg_record.get(field_name);
						self.value(context, 'value for field name', field_value);
						
						var node_by_label_promise = self.get_select_item_by_label(field_value);
						return node_by_label_promise;
					
					case 'records':
						self.step(context, 'ITERATE ON RECORDS');
						return view_model.get_items_array_model_with_iterator_records();
					
					case 'fields':
						self.step(context, 'ITERATE ON FIELDS');
						return view_model.get_items_array_model_with_iterator_fields();
				}
				
				self.step(context, 'ITERATE ON NOTHING');
				return Devapt.promise_rejected('bad view iterator [' + items_iterator + ']');
			}
		);
		
		
		items_promise = items_promise.then(
			function(recordset)
			{
				try
				{
					self.step(context, 'items are found');
					self.value(context, 'arg_record', arg_record);
					
					// GET ALL ITEMS
					self.step(context, 'GET ALL ITEMS');
					self.value(context, 'recordset or select record', recordset);
					
					// GET ITEMS RECORDS
					var items_records = [];
					self.value(context, 'items_iterator', items_iterator);
					switch(items_iterator)
					{
						case 'field_editor':
							self.step(context, 'RESULT IS ALREADY A SELECTED ITEM ATTRIBUTES OBJECT FOR FIELD EDITOR');
							recordset.record = arg_record;
							return recordset;
							
						case 'records':
						case 'fields':
							items_records = recordset.get_records();
							break;
					}
					
					// GET ITEMS COUNT
					var items_records_count = items_records.length;
					self.value(context, 'items_records', items_records);
					self.value(context, 'items_records_count', items_records_count);
					
					// GET SELECTION FIELD NAME
					self.step(context, 'GET SELECTION FIELD NAME');
					var field_name = self.items_fields[0];
					self.assert_not_null(context, 'field_name', field_name);
					self.value(context, 'field_name', field_name);
					console.log(context, 'field_name', field_name);
					
					// GET SELECTION FIELD VALUE
					self.step(context, 'GET SELECTION FIELD VALUE');
					var record_datas = arg_record.get_datas();
					var field_value = field_name in record_datas ? record_datas[field_name] : null;
					self.assert_not_null(context, 'field_value', field_value);
					self.value(context, 'field_value', field_value);
					
					// GET SELECTION FIELD OBJECT
					self.step(context, 'GET SELECTION FIELD OBJECT');
					var model_promise = self.view_model_promise.get('recordset').get('model');
					var field_obj_promise = model_promise.then(
						function(model)
						{
							return model.get_field(field_name);
						}
					);
//					if ( ! DevaptTypes.is_object(field_obj) )
//					{
//						console.error('bad field object', context);
//						return Devapt.promise_rejected(context + ':bad field object');
//					}
					
					// LOOP ON ITEMS RECORDS
					self.step(context, 'LOOP ON ITEMS RECORDS');
					var selected_record_promise = field_obj_promise.then(
						function(field_obj)
						{
							self.step(context, 'loop on field values records');
							for(var values_index = 0 ; values_index < items_records_count ; values_index++)
							{
								self.value(context, 'loop on values index', values_index);
								
								var loop_value_record = items_records[values_index];
								loop_value_record = loop_value_record.is_record ? items_records[values_index].get_datas() : loop_value_record;
								
								// var loop_value_field = loop_value_record[field_name];
								
								// TEST IF CURRENT ITEM FIELD VALUE IS THE SAME AS THE SELECTION FIELD VALUE
								if (loop_value_record[field_name] === field_value)
								{
									self.step(context, 'selected item is found for field name [' + field_name + '] and value [' + field_value + ']');
									var node_jqo = self.get_node_by_index(values_index);
									
									// CHECK NODE
									if (! node_jqo)
									{
										self.step(context, 'jqo node not found');
										return Devapt.promise_rejected(context + ':jqo node not found');
									}
									
									// UPDATE SELECTED RECORD RESULT
									var selected_item = { 'index':values_index, 'node_jqo':node_jqo, 'record':loop_value_record, label:field_value, already_selected:false };
									self.value(context, 'selected_item', selected_item);
									
									self.step(context, 'SELECTED RECORD RESULT');
									return selected_item;
								}
							}
							
							self.step(context, 'selected record not found');
							return Devapt.promise_rejected(context + ':selected record not found');
						}
					);
					
					self.step(context, 'LOOP ON ITEMS RECORDS: returns promise');
					return selected_record_promise;
				}
				catch(e)
				{
					console.error(context, e);
					return e;
				}
			},
			
			function()
			{
				console.error('items promise failed', context);
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return items_promise;
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-03-06',
			updated:'2015-03-06',
			description:'Mixin to lookup for a node into a container.'
		}
	};
	var parent_class = null;
	var DevaptContainerMixinLookupableClass = new DevaptClass('DevaptContainerMixinLookupable', parent_class, class_settings);
	
	
	// METHODS
	DevaptContainerMixinLookupableClass.infos.ctor = cb_constructor;
	
	// DevaptContainerMixinLookupableClass.add_public_method('get_select_item_by_index', {}, cb_get_select_item_by_index);
	// DevaptContainerMixinLookupableClass.add_public_method('get_select_item_by_label', {}, cb_get_select_item_by_label);
	DevaptContainerMixinLookupableClass.add_public_method('get_select_item_by_record', {}, cb_get_select_item_by_record);
	
	
	// PROPERTIES
	
	// BUILD CLASS
	DevaptContainerMixinLookupableClass.build_class();
	
	
	return DevaptContainerMixinLookupableClass;
} );
/**
 * @file        view/container/container-mixin-selectable.js
 * @desc        View mixin class for SELECT/UNSELECT operations
 * 				
 * 				Process:
 * 					A view V detects the selection of one or more of its items.
 * 					V call V.select(item index or item labek or item record) for each selected items.
 * 					promise = V.select(args)
 * 						selected items = V.get_selected_items(args)
 * 						--> V.view_model.on_container_select(selected items) : promise
 * 							--> V.view_model.(un)select_record(record);
 * 							--> V.on_view_model_select(selected item) : promise
 * 					
 *              API:
 *  				Selected item object:
 *  					{ index:..., node_jqo:..., record:..., label:..., already_selected:... }
 *  				
 *                  ->constructor(object)     : nothing
 *  
 *                  ->get_selected_item(args)     : Get normalized selected item object promise (object)
 *                  ->get_selected_items(args)    : Get an array of normalized selected item object promises (array)
 * 
 *                  ->select(object|array)        : Select one or more records into the view and get the operation promise (object)
 *                  ->unselect(object|array)      : Unselect one or more records into the view and get the operation promise (object)
 * 
 *                  ->select_all()                : All view records are selected into the View object and get the operation promise (object)
 *                  ->unselect_all()              : All view records are unselected into the View object and get the operation promise (object)
 * 
 *                  ->on_view_model_select(item)  : On ViewModel selection change and get the operation promise (object)
 *                  ->on_view_model_unselect(item): On ViewModel selection change and get the operation promise (object)
 *                  ->on_recordset_filter_change(): On Recordset filter added and get the operation promise (object)
 *  			
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-02-08
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define('views/container/container-mixin-selectable',[
	'Devapt', 'core/types',
	'object/class', 'object/object',
	'views/container/container-mixin-lookupable'
	],
function(
	Devapt, DevaptTypes,
	DevaptClass, DevaptObject,
	DevaptContainerMixinLookupable)
{
	/**
	 * @public
	 * @class				DevaptContainerMixinSelectable
	 * @desc				View mixin class for SELECT/UNSELECT operations
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptContainerMixinSelectable
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = 'constructor';
		self.enter(context, '');
		
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	
	/* --------------------------------------------- SELECT OPERATIONS ------------------------------------------------ */
	
	/**
	 * @memberof				DevaptContainerMixinSelectable
	 * @private
	 * @method					get_selected_item(args)
	 * @desc					Get normalized selected item attributes
	 * @param {array}			arg_selection	selected item (record, label or index)
	 * @return {promise}		Selected item attributes promise
	 */
	var cb_get_selected_item = function (arg_selection)
	{
		var self = this;
		var context = 'get_selected_item(args)';
		self.enter(context, '');
		
		
		var selected_item_promise = null;
		var container_item = null;
		
		try
		{
			// GET SELECTED ITEM BY ITS INDEX
			if ( DevaptTypes.to_integer(arg_selection, -1) >= 0 )
			{
				self.value(context, 'selected_value is integer', arg_selection);
				// selected_item_promise = self.get_select_item_by_index(arg_selection);
				container_item = self.get_item_by_index(arg_selection);
				container_item.is_selected = self.is_selected_item_node(container_item);
				selected_item_promise = Devapt.promise_resolved(container_item);
			}
			
			// GET SELECTED ITEM BY ITS LABEL
			else if ( DevaptTypes.is_string(arg_selection) )
			{
				self.value(context, 'selected_value is string', arg_selection);
				// selected_item_promise = self.get_select_item_by_label(arg_selection);
				container_item = self.get_item_by_label(arg_selection);
				selected_item_promise = Devapt.promise_resolved(container_item);
			}
			
			// GET SELECTED ITEM BY ITS RECORD
			else if ( DevaptTypes.is_object(arg_selection) )
			{
	//			self.value(context, 'selected_value is object', arg_selection); // TODO to_string recursive error
				selected_item_promise = self.get_select_item_by_record(arg_selection);
			}
		}
		catch(e)
		{ 
			console.error(e, context);
			self.leave(context, Devapt.msg_failure_promise);
			return Devapt.promise_rejected(e);
		}
		
		
		self.leave(context, Devapt.msg_success_promise);
		return selected_item_promise;
	};
	
	
	/**
	 * @memberof				DevaptContainerMixinSelectable
	 * @private
	 * @method					get_selected_items(args)
	 * @desc					Select one or more records into the view with args is one ore more indices or records or labels
	 * @param {array}			arg_selection	selected items array (record, label or index)
	 * @return {array}			Selected items attributes promises
	 */
	var cb_get_selected_items = function (arg_selection)
	{
		var self = this;
		var context = 'get_selected_items(args)';
		self.enter(context, '');
		
		
		var selected_items_promises = [];
		
		try
		{
			self.step(context, 'NORMALIZE ITEMS');
			
			// LOOP ON SELECTED ITEMS VALUES
			for(var selected_index in arg_selection)
			{
				self.value(context, 'loop on selected_index', selected_index);
				
				var selected_value = arg_selection[selected_index];
				var selected_item_promise = self.get_selected_item(selected_value);
				
				
				// CHECK AND APPEND SELECTED ITEM
				// console.log(selected_items, context + ':CHECK AND APPEND SELECTED ITEM');
				if (selected_item_promise)
				{
					self.step(context, 'selected_value promise is valid');
					
					selected_items_promises.push(selected_item_promise);
				}
				else
				{
					self.error(context, 'selected item not found');
					self.value(context, 'selected value', selected_value);
				}
			}
		}
		catch(e)
		{
			console.error(e, context);
			self.leave(context, Devapt.msg_failure_promise);
			return Devapt.promise_rejected(e);
		}
		
		
		self.leave(context, Devapt.msg_success_promise);
		return selected_items_promises;
	};
	
	
	/**
	 * @memberof				DevaptContainerMixinSelectable
	 * @public
	 * @method					self.select(args)
	 * @desc					Get one or more selected items into the view with args is one ore more indices or records or labels
	 * @param {object|array|integer|string}	arg_selection			one or more selected items record, label or index
	 * @return {object}			Promise of the operation
	 */
	var cb_select = function (arg_selection)
	{
		var self = this;
		var context = 'select(array|object|label|index)';
		self.enter(context, '');
		
		
//		console.log(self, context + ':' + self.name + '[' + self.selection_enabled + ']');
		if (! self.selection_enabled)
		{
			self.leave(context, 'SELECTION IS DISABLED');
			return Devapt.promise_resolved();
		}
		
		// INIT
		var promise = null;
		
		// CREATE AN ARRAY
		if ( ! DevaptTypes.is_array(arg_selection) )
		{
			arg_selection = [arg_selection];
		}
		
		// GET SELECTION ITEMS
		var selected_items = self.get_selected_items(arg_selection);
		
		// PROCESS VIEW MODEL OPERATIONS
		promise = self.view_model_promise.then(
			function(arg_view_model)
			{
				self.step(context, 'view_model is ready');
				try
				{
					arg_view_model.on_container_select(selected_items);
				}
				catch(e)
				{
					console.error(e, context);
					return null;
				}
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	/**
	 * @memberof				DevaptContainerMixinSelectable
	 * @public
	 * @method					DevaptContainerMixinSelectable.unselect(records)
	 * @desc					Unselect one or more records into the view
	 * @param {object|array|integer|string}	arg_selection			one or more selected items record, label or index
	 * @return {object}			Promise of the operation
	 */
	var cb_unselect = function (arg_selection)
	{
		var self = this;
		var context = 'unselect(array|object|label|index)';
		self.enter(context, '');
//		self.value(context, 'arg_selection', arg_selection);
		
		
//		console.log(self, context + ':' + self.name + '[' + self.selection_enabled + ']');
		if (! self.selection_enabled)
		{
			self.leave(context, 'SELECTION IS DISABLED');
			return Devapt.promise_resolved();
		}
		
		// INIT
		var promise = null;
		
		// CREATE AN ARRAY
		if ( ! DevaptTypes.is_array(arg_selection) )
		{
			arg_selection = [arg_selection];
		}
		
		// GET SELECTION ITEMS
		var selected_items = self.get_selected_items(arg_selection);
		
		// PROCESS VIEW MODEL OPERATIONS
		promise = self.view_model_promise.then(
			function(arg_view_model)
			{
				self.step(context, 'view_model is ready');
				try
				{
					arg_view_model.on_container_unselect(selected_items);
				}
				catch(e)
				{
					console.error(e, context);
					return null;
				}
			}
		);
		
		
		self.leave(context, '');
		return promise;
	};
	
	
	
	/**
	 * @memberof				DevaptContainerMixinSelectable
	 * @public
	 * @method					self.select_all(records)
	 * @desc					Select all records into the view
	 * @return {object}			Promise of the operation
	 */
	var cb_select_all = function ()
	{
		var self = this;
		var context = 'select_all()';
		self.enter(context, '');
		self.assert_object(context, 'model', self.model);
		
		
//		console.log(self, context + ':' + self.name + '[' + self.selection_enabled + ']');
		if (! self.selection_enabled)
		{
			self.leave(context, 'SELECTION IS DISABLED');
			return Devapt.promise_resolved();
		}
		
		var promise = self.view_model_promise.then(
			function(arg_view_model)
			{
				self.step(context, 'view_model is ready');
				try
				{
					arg_view_model.on_container_select_all();
				}
				catch(e)
				{
					console.error(e, context);
					return null;
				}
			}
		);
		
		
		self.leave(context, '');
		return promise;
	};
	
	
	/**
	 * @memberof				DevaptContainerMixinSelectable
	 * @public
	 * @method					self.unselect_all()
	 * @desc					Unelect all records into the view
	 * @return {object}			Promise of the operation
	 */
	var cb_unselect_all = function ()
	{
		var self = this;
		var context = 'unselect_all()';
		self.enter(context, '');
		self.assert_object(context, 'view_model_promise', self.view_model_promise);
		
		
//		console.log(self, context + ':' + self.name + '[' + self.selection_enabled + ']');
		if (! self.selection_enabled)
		{
			self.leave(context, 'SELECTION IS DISABLED');
			return Devapt.promise_resolved();
		}
		
		var promise = self.view_model_promise.then(
			function(arg_view_model)
			{
				self.step(context, 'view_model is ready');
				try
				{
					return arg_view_model.on_container_unselect_all();
				}
				catch(e)
				{
					console.error(e, context);
					return Devapt.promise_rejected(e);
				}
			}
		);
		
		
		self.leave(context, '');
		return promise;
	};
	
	
	
	/**
	 * @memberof				DevaptContainerMixinSelectable
	 * @private
	 * @method					self.on_view_model_select(item)
	 * @desc					On ViewModel selection change
	 * @param {object}			arg_selected_item	Selected item object { index:..., node_jqo:..., record:..., label:..., already_selected:... }
	 * @return {object}			Promise of the operation
	 */
	var cb_on_view_model_select = function (arg_selected_item)
	{
		var self = this;
//		self.trace=true;
		var context = 'on_view_model_select(item)';
		self.enter(context, '');
		
		
		// DEBUG
//		console.log(arg_selected_item, 'arg_selected_item');
//		console.log(arg_selected_item.node_jqo, 'arg_selected_item.node_jqo');
		
		// REMOVE PREVIOUS SELECTED ITEM
		if (! self.has_multiple_selection)
		{
			self.step(context, 'remove all css selected');
			self.remove_items_css_class('selected');
		}
		
		self.step(context, 'add css class "selected"');
		self.add_item_node_css_class(arg_selected_item.node_jqo, 'selected');
		
		self.step(context, 'fire event "...selected"');
		self.fire_event('devapt.events.container.selected', [arg_selected_item]);
		
		
		self.leave(context, Devapt.msg_success_promise);
//		self.trace=false;
		return Devapt.promise_resolved(arg_selected_item);
	};
	
	
	
	/**
	 * @memberof				DevaptContainerMixinSelectable
	 * @private
	 * @method					self.on_view_model_unselect(item)
	 * @desc					On ViewModel selection change
	 * @param {object}			arg_selected_item	Selected item object { index:..., node_jqo:..., record:..., label:..., already_selected:... }
	 * @return {object}			Promise of the operation			
	 */
	var cb_on_view_model_unselect = function (arg_selected_item)
	{
		var self = this;
//		self.trace=true;
		var context = 'on_view_model_unselect(item)';
		self.enter(context, '');
		
		
		// DEBUG
//		console.log(arg_selected_item, 'arg_selected_item');
//		console.log(arg_selected_item.node_jqo, 'arg_selected_item.node_jqo');
		
		self.step(context, 'remove css class "selected"');
		self.remove_item_node_css_class(arg_selected_item.node_jqo, 'selected');
		
		self.step(context, 'fire event "unselected"');
		self.fire_event('devapt.events.container.unselected', [arg_selected_item]);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return Devapt.promise_resolved(arg_selected_item);
	};
	
	
	
	/**
	 * @memberof				DevaptContainerMixinSelectable
	 * @private
	 * @method					self.on_recordset_filter_change()
	 * @desc					On Recordset filter added
	 * @return {object}			Promise of the operation			
	 */
	var cb_on_recordset_filter_change = function ()
	{
		var self = this;
//		self.trace=true;
		var context = 'on_recordset_filter_change()';
		self.enter(context, '');
		
		
		try
		{
			self.value(context, 'self.renders_count', self.renders_count);
			self.value(context, 'self.items_iterator', self.items_iterator);
			
			var render_promise = null;
			if (self.items_iterator === 'field_editor')
			{
				self.step(context, 'select items in field editor');
				
				if ( self.is_render_state_not() )
				{
					self.step(context, 'first view rendering');
					
					render_promise = self.render( Devapt.defer() );
				}
				else
				{
					self.step(context, 'view is rendering or rendered');
					
					render_promise = Devapt.promise(self.mixin_renderable_defer);
				}
				
				render_promise = render_promise.then(
					function()
					{
						self.step(context, 'view is rendered');
						
						// UNSELECT ALL IF FIELD EDITOR
						if (self.items_iterator === 'field_editor')
						{
							self.remove_items_css_class('selected');
						}
						
						// PROCESS RECORDS
						return self.view_model_promise.get('recordset').then(
							function(arg_recordset)
							{
								self.step(context, 'view_model recordset is ready');
								
								return self.unselect_all().then(
									function()
									{
										self.step(context, 'view unselect_all is finished');
										return arg_recordset.read().then(
											function()
											{
												self.step(context, 'recordset is read');
												
												var records = arg_recordset.get_records();
												
												return self.select(records);
											}
										);
									}
								);
							}
						);
					}
				);
			}
			else if (self.items_iterator === 'fields')
			{
				self.step(context, 'select items in fields');
				
//				self.reset_items();
//				render_promise = self.fill_items( Devapt.defer() );
				
				self.remove_items();
				render_promise = self.render_items( Devapt.defer() );
			}
			else if (self.items_iterator === 'records')
			{
				self.step(context, 'select items in fields');
				
				if ( self.renders_count === 0)
				{
					self.step(context, 'first view rendering');
					
					render_promise = self.render( Devapt.defer() );
				}
				else
				{
					self.step(context, 'remove previous items and render items');
					
					self.remove_items();
					render_promise = self.render_items( Devapt.defer() );
				}
			}
			else
			{
				self.step(context, 'bad items iterator [' + self.items_iterator + ']');
			}
		}
		catch(e)
		{
			console.error(e, context);
			self.leave(context, Devapt.msg_failure_promise);
			return Devapt.promise_rejected(e);
		}
		
		
		self.leave(context, Devapt.msg_success_promise);
		return render_promise ? render_promise : Devapt.promise_rejected();
	};
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-02-02',
			updated:'2015-05-06',
			description:'Mixin for SELECT/UNSELECT operation on a view.'
		},
		mixins:[DevaptContainerMixinLookupable]
	};
	var parent_class = null;
	var DevaptContainerMixinSelectableClass = new DevaptClass('DevaptContainerMixinSelectable', parent_class, class_settings);
	
	
	// METHODS
	DevaptContainerMixinSelectableClass.infos.ctor = cb_constructor;
	
	DevaptContainerMixinSelectableClass.add_public_method('get_selected_item', { description:'' }, cb_get_selected_item);
	DevaptContainerMixinSelectableClass.add_public_method('get_selected_items', { description:'' }, cb_get_selected_items);
	
	DevaptContainerMixinSelectableClass.add_public_method('select', { description:'Select one or more records into the view with args is one ore more indices or records or labels'}, cb_select);
	DevaptContainerMixinSelectableClass.add_public_method('unselect', {}, cb_unselect);
	
	DevaptContainerMixinSelectableClass.add_public_method('select_all', {}, cb_select_all);
	DevaptContainerMixinSelectableClass.add_public_method('unselect_all', {}, cb_unselect_all);
	
	DevaptContainerMixinSelectableClass.add_public_method('on_view_model_select', { description:'' }, cb_on_view_model_select);
	DevaptContainerMixinSelectableClass.add_public_method('on_view_model_unselect', { description:'' }, cb_on_view_model_unselect);
	DevaptContainerMixinSelectableClass.add_public_method('on_recordset_filter_change', {}, cb_on_recordset_filter_change);
	
	
	// PROPERTIES
	
	// BUILD CLASS
	DevaptContainerMixinSelectableClass.build_class();
	
	
	return DevaptContainerMixinSelectableClass;
} );
/**
 * @file        views/container-mixin-filtered.js
 * @desc        Mixin for datas filtered feature for containers
 * 				API
 * 					SETTINGS
 * 						filtered.enabled: filter processing is enabled ? (boolean)
 * 						filtered.event: event name to run filtering processing when received(string)
 * 						filtered.case_sensitive: filtered value is case sensitive ? (boolean)
 * 						filtered.fields: list of coma separated fields names to look up filtered value (string)
 * 						filtered.source: event emitter name (string)
 * 						
 * 					ATTRIBUTES
 * 						mixin_trace_filtered: mixin trace flag (boolean)
 * 						mixin_filtered_enabled: all filters processing are enabled ? (boolean)
 * 						
 * 					METHODS
 * 						mixin_init_filtered(self): mixin constructor, register events handle (nothing)
 * 						on_filtered_event(arg_event_operands): handle an event and call apply_filtered_value (nothing)
 * 						apply_filtered_value(arg_filtered_value, arg_fields_names): test all nodes and apply a filter (boolean)
 * 						
 * 					PRINCIPLE
 * 						An input view V1 fire an event E1 when its value changed.
 * 						A container view V2 apply the filter value of V1 when E1 is fired.
 * 						V2 has fields: F1, F2, F3, F4
 * 						
 * 						V2.filtered.enabled=true
 * 						V2.filtered.event='devapt.input.changed'
 * 						V2.filtered.case_sensitive=false
 * 						V2.filtered.fields=F2,F3
 * 						V2.filtered.source=V1
 * 						
 * 						Mixin constructor declares:
 * 							V1.add_event_listener('devapt.input.changed', [V2, V2.on_filtered_event], false)
 * 							
 * 						If V2 has a pagination linked view V3, V2 call apply_filtered_value when pagination apply_pagination is run.
 * 						
 * 						If V2 is refreshed, V2 runs apply_pagination after items rendering and so call apply_filtered_value.
 * 						But if an input is changed during a refresh step, two call of apply_filtered_value are run.
 * 						That's why we have a lock to prevent many simultaneous runs.
 * 						An event handling run is delay to wait for the previous run.
 * 						
 * @see			DevaptContainer
 * @ingroup     DEVAPT_VIEWS
 * @date        2014-08-23
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/container-mixin-filtered',['Devapt', 'core/types', 'object/class', 'core/resources'],
function(Devapt, DevaptTypes, DevaptClass, DevaptResources)
{
	/**
	 * @mixin				DevaptMixinFiltered
	 * @public
	 * @desc				Mixin of methods for datas filtered features
	 */
	var DevaptMixinFiltered = 
	{
		/**
		 * @memberof			DevaptMixinFiltered
		 * @public
		 * @desc				Enable/disable trace for mixin operations
		 */
		mixin_trace_filtered: false,
		
		
		
		/**
		 * @memberof			DevaptMixinFiltered
		 * @public
		 * @desc				Enable/disable mixin operations
		 */
//		mixin_filtered_enabled: true,
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinFiltered
		 * @desc				Init mixin
		 * @return {nothing}
		 */
		mixin_init_filtered: function(self)
		{
			self.push_trace(self.trace, DevaptMixinFiltered.mixin_trace_filtered);
			var context = 'mixin_init_filtered()';
			self.enter(context, '');
			
			
			// INIT STATE
//			self.mixin_trace_filtered=true;
			self.mixin_filtered_enabled = true;
			self.mixin_filtered_is_processing = false;
			self.mixin_filtered_fields = null;
			self.mixin_filtered_value = null;
			self.mixin_filtered_delayed_count = 0;
			self.mixin_filtered_delayed_max= 1;
			
			// INIT EVENTS HANDLERS
			if (self.filtered && self.filtered.enabled)
			{
				if ( DevaptTypes.is_not_empty_str(self.filtered.event) && DevaptTypes.is_not_empty_str(self.filtered.source) )
				{
					var promise = DevaptResources.get_resource_instance(self.filtered.source);
					
					promise.then(
						function(view)
						{
							self.filtered.view = view;
							view.add_event_callback(self.filtered.event, [self, self.on_filtered_event], false);
						}
					);
				}
				else
				{
					console.error(self.filtered, 'self.filtered');
				}
			}
			
			
			self.leave(context, '');
			self.pop_trace();
		},
			
		
		/**
		 * @public
		 * @memberof			DevaptMixinFiltered
		 * @desc				Process filtered event
		 * @param {array}		arg_event_operands		event operands array
		 * @return {nothing}
		 */
		on_filtered_event: function(arg_event_operands)
		{
			var self = this;
			var context = 'on_filtered_event(opds)';
			self.push_trace(self.trace, DevaptMixinFiltered.mixin_trace_filtered);
			self.enter(context, '');
			
			
			// GET OPERANDS
//			var event_obj = arg_event_operands[0];
//			var target_obj = arg_event_operands[1];
			var value = arg_event_operands[2].input;
			self.value(context, 'value', value);
			if (value === self.mixin_filtered_value)
			{
				self.leave(context, Devapt.msg_success + ':VALUE IS ALREADY FILTERED');
				self.pop_trace();
				return;
			}
			self.mixin_filtered_value = value;
			
			// GET FILTERED FIELDS
			var fields_names = DevaptTypes.is_not_empty_str(self.filtered.fields) ? self.filtered.fields.split(',') : self.items_fields;
			// console.log(fields_names, 'fields_names');
			self.mixin_filtered_fields = fields_names;
			
			// APPLY FILTERED VALUE ON FILTERED FIELDS
			self.apply_or_delay_filtered_value(value, fields_names);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
		},
		
		
		/**
		 * @public
		 * @memberof				DevaptMixinFiltered
		 * @desc					Apply or delay a filter value on all nodes records
		 * @param {string}			arg_filtered_value		value to filter on fields
		 * @param {array}			arg_fields_names		array of fields names strings
		 * @return {boolean}
		 */
		apply_or_delay_filtered_value: function(arg_filtered_value, arg_fields_names)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinFiltered.mixin_trace_filtered);
			var context = 'apply_or_delay_filtered_value(value,fields)';
			self.enter(context, '');
			
			
			// A FILTERING PROCESS IS ALREADY RUNNING
			if (self.mixin_filtered_is_processing)
			{
				// TEST MAX DELAYED TASKS
				if (self.mixin_filtered_delayed_count >= self.mixin_filtered_delayed_max)
				{
					self.leave(context, Devapt.msg_success + ':NOTHING TO DO, TOO MANY DELAYED TASKS');
					self.pop_trace();
					return true;
				}
				self.mixin_filtered_delayed_count++;
				
				// RECALL EVENT HANDLER AFTER A DELAY
				var task_cb = function()
				{
					console.log(self.mixin_filtered_is_processing , 'self.mixin_filtered_is_processing  6');
					self.apply_or_delay_filtered_value(arg_filtered_value, arg_fields_names);
				};
				setTimeout(task_cb, 10);
				
				self.leave(context, Devapt.msg_success + ':delay event handler');
				self.pop_trace();
				return true;
			}
			
			// UPDATE FILTERING STATE
			self.mixin_filtered_is_processing = true;
			
			// APPLY FILTERED VALUE ON FILTERED FIELDS
			var result = self.apply_filtered_value(arg_filtered_value, arg_fields_names);
			
			
			self.leave(context, result ? Devapt.msg_success : Devapt.msg_failure);
			self.pop_trace();
			return result;
		},
		
		
		/**
		 * @public
		 * @memberof				DevaptMixinFiltered
		 * @desc					Apply a filter value on all nodes records
		 * @param {string}			arg_filtered_value		value to filter on fields
		 * @param {array}			arg_fields_names		array of fields names strings
		 * @return {boolean}
		 */
		apply_filtered_value: function(arg_filtered_value, arg_fields_names)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinFiltered.mixin_trace_filtered);
			var context = 'apply_filtered_value(value,fields)';
			self.enter(context, '');
			
			
			// DEBUG
			self.value(context, 'mixin_filtered_enabled', self.mixin_filtered_enabled);
			self.value(context, 'arg_filtered_value', arg_filtered_value);
			self.value(context, 'arg_fields_names', arg_fields_names);
			self.value(context, 'mixin_filtered_is_processing', self.mixin_filtered_is_processing);
			// debugger;
			
			// FILTERED FEATURE IS DISABLED
			if (! self.mixin_filtered_enabled)
			{
				// UPDATE FILTERING STATE
				self.mixin_filtered_is_processing = false;
				// console.log(self, context + ':FILTERING IS DISABLED');
				
				self.leave(context, Devapt.msg_success + ':FILTERING IS DISABLED');
				self.pop_trace();
				return true;
			}
			
			// VIEW IS RENDERING
			if ( self.is_render_state_rendering() )
			{
				// UPDATE FILTERING STATE
				self.mixin_filtered_is_processing = false;
				
				self.leave(context, Devapt.msg_success + ':view is in rendering mode');
				self.pop_trace();
				return true;
			}
			
			
			// CHECK VALUE
			if (! DevaptTypes.is_string(arg_filtered_value) )
			{
				// UPDATE FILTERING STATE
				self.mixin_filtered_is_processing = false;
				
				self.leave(context, Devapt.msg_failure + ':BAD FILTERED VALUE');
				self.pop_trace();
				return false;
			}
			
			// CHECK FIELDS NAMES
			if (! DevaptTypes.is_not_empty_array(arg_fields_names) )
			{
				// UPDATE FILTERING STATE
				self.mixin_filtered_is_processing = false;
				
				self.leave(context, Devapt.msg_failure + ':BAD FIELDS NAMES');
				self.pop_trace();
				return false;
			}
			
			// GET CONTAINER NODES
			var nodes_jqo = self.get_all_nodes();
			if ( DevaptTypes.is_empty_str(arg_filtered_value) )
			{
				// NO FILTER
				nodes_jqo.show();
				nodes_jqo.addClass('devapt-container-visible');
				
				// UPDATE FILTERING STATE
				self.mixin_filtered_is_processing = false;
				
				self.leave(context, Devapt.msg_success + ':FILTERED VALUE IS EMPTY');
				self.pop_trace();
				return true;
			}
			
			// LOOP ON NODES
			var $ = Devapt.jQuery();
			var is_case_sensitive = DevaptTypes.to_boolean(self.filtered.case_sensitive, false);
			var value_pattern = '.*' + arg_filtered_value + '.*';
			var regex = new RegExp(value_pattern, is_case_sensitive ? '' : 'i');
			var items_count = 0;
			nodes_jqo.each(
				function(index, loop_node, array)
				{
					var loop_node_jqo = $(loop_node);
					loop_node_jqo.show();
					
					var loop_record = self.items_records[index];
//					console.log(loop_record, context + ':loop_record at [' + index + ']');
					
					if ( DevaptTypes.is_object(loop_record) )
					{
						var loop_node_filtered = true;
						
						for(var field_index in arg_fields_names)
						{
							var field_name = arg_fields_names[field_index];
							self.value(context, 'field_name', field_name);
							
							var field_value = loop_record.get(field_name);
							self.value(context, 'field_value', field_value);
							
							if ( DevaptTypes.is_not_empty_str(field_value) && regex.test(field_value) )
							{
								loop_node_filtered = false;
							}
						}
						
						// SHOW/HIDE NODE
						if (loop_node_filtered)
						{
							loop_node_jqo.hide();
							loop_node_jqo.removeClass('devapt-container-visible');
						}
						else
						{
							loop_node_jqo.addClass('devapt-container-visible');
							loop_node_jqo.show();
							items_count++;
						}
					}
				}
			);
			
			// UPDATE FILTERING STATE
			self.mixin_filtered_is_processing = false;
			
			// UPDATE PAGINATION
			self.fire_event('devapt.pagination.update_pagination', [ {'begin':0, 'end':items_count} ]);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return true;
		}
		
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-23',
			'updated':'2015-06-01',
			'description':'Mixin methods for datas filtered feature for containers.'
		}
	};
	var DevaptMixinFilteredClass = new DevaptClass('DevaptMixinFiltered', null, class_settings);
	
	// METHODS
	DevaptMixinFilteredClass.infos.ctor = DevaptMixinFiltered.mixin_init_filtered;
	DevaptMixinFilteredClass.add_public_method('on_filtered_event', {}, DevaptMixinFiltered.on_filtered_event);
	DevaptMixinFilteredClass.add_public_method('apply_filtered_value', {}, DevaptMixinFiltered.apply_filtered_value);
	DevaptMixinFilteredClass.add_public_method('apply_or_delay_filtered_value', {}, DevaptMixinFiltered.apply_or_delay_filtered_value);
	
	// PROPERTIES
	DevaptMixinFilteredClass.add_public_obj_property('filtered',	'',	null, false, false, []);
	
	// BUILD MIXIN CLASS
	DevaptMixinFilteredClass.build_class();
	
	
	return DevaptMixinFilteredClass;
}
);
/**
 * @file        views/container/container-mixin-pagination.js
 * @desc        Mixin for datas pagination feature for containers
 * @see			DevaptContainer
 * @ingroup     DEVAPT_VIEWS
 * @date        2014-08-23
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/container-mixin-pagination',['Devapt', 'core/types', 'object/class'],
function(Devapt, DevaptTypes, DevaptClass)
{
	/**
	 * @mixin				DevaptMixinPagination
	 * @public
	 * @desc				Mixin of methods for datas pagination features
	 */
	var DevaptMixinPagination = 
	{
		/**
		 * @memberof			DevaptMixinPagination
		 * @public
		 * @desc				Enable/disable trace for mixin operations
		 */
		mixin_trace_pagination: false,
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinPagination
		 * @desc				Init mixin
		 * @return {nothing}
		 */
		mixin_init_pagination: function(self)
		{
			self.push_trace(self.trace, DevaptMixinPagination.mixin_trace_pagination);
			var context = 'mixin_init_pagination()';
			self.enter(context, '');
			
			
			self.mixin_pagination_apply_count = 0;
			
			
			self.leave(context, '');
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinPagination
		 * @desc				Process pagination previous update event
		 * @param {array}		arg_event_operands		event operands array
		 * @return {nothing}
		 */
		on_pagination_previous_event: function(arg_event_operands)
		{
			var self = this;
			var context = 'on_pagination_previous_event(opds)';
			self.push_trace(self.trace, DevaptMixinPagination.mixin_trace_pagination);
			self.enter(context, '');
			
			// console.log(arg_event_operands, 'on_pagination_previous_event');
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinPagination
		 * @desc				Process pagination current update event
		 * @param {array}		arg_event_operands		event operands array
		 * @return {nothing}
		 */
		on_pagination_current_event: function(arg_event_operands)
		{
			var self = this;
			var context = 'on_pagination_current_event(opds)';
			self.push_trace(self.trace, DevaptMixinPagination.mixin_trace_pagination);
			self.enter(context, '');
			
			
//			console.log(arg_event_operands, context + ':on_pagination_current_event');
			
			
			var pagination = arg_event_operands[1];
			var page = arg_event_operands[2].page;
			
			var last_index = pagination.pagination_size * page - 1;
			var first_index = Math.max(last_index - pagination.pagination_size + 1, 0);
			// console.log(first_index, context + '.first_index');
			// console.log(last_index, context + '.last_index');
			
			self.apply_pagination(first_index, last_index);
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinPagination
		 * @desc				Process pagination next update event
		 * @param {array}		arg_event_operands		event operands array
		 * @return {nothing}
		 */
		on_pagination_next_event: function(arg_event_operands)
		{
			var self = this;
			var context = 'on_pagination_next_event(opds)';
			self.push_trace(self.trace, DevaptMixinPagination.mixin_trace_pagination);
			self.enter(context, '');
			
			// console.log(arg_event_operands, 'on_pagination_next_event');
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
		},
		
		
		/**
		 * @public
		 * @memberof				DevaptMixinPagination
		 * @desc					Get a filtered array of records
		 * @param {integer}			arg_first_index		page first index
		 * @param {integer}			arg_last_index		page last index
		 * @return {boolean}
		 */
		apply_pagination: function(arg_first_index, arg_last_index)
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinPagination.mixin_trace_pagination);
			var context = 'apply_pagination(first,last)';
			self.enter(context, '');
			self.value(context, 'arg_first_index', arg_first_index);
			self.value(context, 'arg_last_index', arg_last_index);
			
			
			// UPDATE FILTERED
			if (self.apply_or_delay_filtered_value && self.mixin_filtered_value && self.mixin_filtered_value !== '')
			{
				self.apply_or_delay_filtered_value(self.mixin_filtered_value, self.mixin_filtered_fields);
			}
			
			
			// GET CONTAINER NODES
			var nodes_jqo = self.get_all_nodes();
			nodes_jqo.hide();
			
			// LOOP ON NODES
			var $ = Devapt.jQuery();
			nodes_jqo.filter('.devapt-container-visible').each(
				function(index, loop_node, array)
				{
					var loop_node_jqo = $(loop_node);
					
					if (index >= arg_first_index && index <= arg_last_index)
					{	
						loop_node_jqo.show();
					}
					else
					{
						loop_node_jqo.hide();
					}
				}
			);
			self.mixin_pagination_apply_count++;
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return true;
		}
		
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-23',
			'updated':'2014-12-06',
			'description':'Mixin methods for datas pagination feature for containers.'
		}
	};
	var DevaptMixinPaginationClass = new DevaptClass('DevaptMixinPagination', null, class_settings);
	
	// METHODS
	DevaptMixinPaginationClass.infos.ctor = DevaptMixinPagination.mixin_init_pagination;
	DevaptMixinPaginationClass.add_public_method('on_pagination_previous_event', {}, DevaptMixinPagination.on_pagination_previous_event);
	DevaptMixinPaginationClass.add_public_method('on_pagination_current_event', {}, DevaptMixinPagination.on_pagination_current_event);
	DevaptMixinPaginationClass.add_public_method('on_pagination_next_event', {}, DevaptMixinPagination.on_pagination_next_event);
	DevaptMixinPaginationClass.add_public_method('apply_pagination', {}, DevaptMixinPagination.apply_pagination);
	
	// PROPERTIES
	DevaptMixinPaginationClass.add_public_int_property('mixin_pagination_apply_count',	'',		0, false, false, []);
	
	// BUILD CLASS
	DevaptMixinPaginationClass.build_class();
	
	
	return DevaptMixinPaginationClass;
}
);
/**
 * @file        views/container/container-mixin-render-node.js
 * @desc        Mixin for datas items rendering feature for containers
 * @see			DevaptMixinRenderNode
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-02-23
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/container-mixin-render-node',['Devapt', 'core/types', 'object/class', 'core/template'],
function(Devapt, DevaptTypes, DevaptClass, DevaptTemplate)
{
	/**
	 * @mixin				DevaptMixinRenderNode
	 * @public
	 * @desc				Mixin of methods for datas items rendering features
	 */
	var DevaptMixinRenderNode = 
	{
		/**
		 * @public
		 * @memberof			DevaptMixinRenderNode
		 * @desc				Render an divider item content
		 * @param {object}		arg_deferred		deferred object
		 * @param {object}		arg_item_jqo		item node
		 * @param {string}		arg_item_content	item content
		 * @return {object}		jQuery object node
		 */
		render_item_divider: function(arg_deferred, arg_item_jqo, arg_item_content)
		{
			var self = this;
			var context = 'render_item_divider(deferred,jqo,content)';
			self.enter(context, '');
			
			
			
			self.leave(context, Devapt.msg_success);
			return arg_item_jqo;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderNode
		 * @desc				Render an item HTML content
		 * @param {object}		arg_deferred		deferred object
		 * @param {object}		arg_item_jqo		
		 * @param {string}		arg_item_content
		 * @return {object}		jQuery object node
		 */
		render_item_html: function(arg_deferred, arg_item_jqo, arg_item_content)
		{
			var self = this;
			var context = 'render_item_html(deferred,jqo,content)';
			self.enter(context, '');
			
			arg_item_jqo.html(arg_item_content);
			
			self.leave(context, Devapt.msg_success);
			return arg_item_jqo;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderNode
		 * @desc				Render an item TEXT content
		 * @param {object}		arg_deferred		deferred object
		 * @param {object}		arg_item_jqo		
		 * @param {string}		arg_item_content
		 * @return {object}		jQuery object node
		 */
		render_item_text: function(arg_deferred, arg_item_jqo, arg_item_content, arg_item_record)
		{
			var self = this;
			var context = 'render_item_text(deferred,jqo,content)';
			self.enter(context, '');
			
			
			var span_jqo = $('<span>');
			span_jqo.html(arg_item_content);
			arg_item_jqo.append(span_jqo);
			
			
			self.leave(context, Devapt.msg_success);
			return arg_item_jqo;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderNode
		 * @desc				Render an item RECORD content
		 * @param {object}		arg_deferred		deferred object
		 * @param {object}		arg_item_jqo		
		 * @param {array}		arg_item_array
		 * @return {object}		jQuery object node
		 */
		render_item_array: function(arg_deferred, arg_item_jqo, arg_item_array)
		{
			var self = this;
			var context = 'render_item_array(deferred,jqo,content)';
			self.enter(context, '');
			
			
			// BUILD NODE CONTENT
			var tags_object = {};
			for(var field_index in self.items_fields)
			{
				var field_name = self.items_fields[field_index];
				tags_object[field_index] = arg_item_object[field_name];
			}
			
			var content = DevaptTemplate.render(self.items_format, tags_object);
			self.render_item_text(arg_deferred, arg_item_jqo, content);
			
			
			self.leave(context, Devapt.msg_success);
			return arg_item_jqo;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderNode
		 * @desc				Render an item CALLBACK content
		 * @param {object}		arg_deferred		deferred object
		 * @param {object}		arg_item_jqo		
		 * @param {string}		arg_item_content
		 * @return {object}		jQuery object node
		 */
		render_item_callback: function(arg_deferred, arg_item_jqo, arg_item_content)
		{
			var self = this;
			var context = 'render_item_callback(deferred,jqo,content)';
			self.enter(context, '');
			
			// TODO render_item_object
			
			self.leave(context, Devapt.msg_success);
			return arg_item_jqo;
		}
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-02-23',
			'updated':'2015-02-23',
			'description':'Mixin methods for datas items rendering feature for containers.'
		}
	};
	var DevaptMixinRenderNodeClass = new DevaptClass('DevaptMixinRenderNode', null, class_settings);
	
	// METHODS
	DevaptMixinRenderNodeClass.add_public_method('render_item_divider', {}, DevaptMixinRenderNode.render_item_divider);
	DevaptMixinRenderNodeClass.add_public_method('render_item_html', {}, DevaptMixinRenderNode.render_item_html);
	DevaptMixinRenderNodeClass.add_public_method('render_item_text', {}, DevaptMixinRenderNode.render_item_text);
	DevaptMixinRenderNodeClass.add_public_method('render_item_array', {}, DevaptMixinRenderNode.render_item_array);
	DevaptMixinRenderNodeClass.add_public_method('render_item_callback', {}, DevaptMixinRenderNode.render_item_callback);
	
	// PROPERTIES
	
	// BUILD MIXIN CLASS
	DevaptMixinRenderNodeClass.build_class();
	
	
	return DevaptMixinRenderNodeClass;
}
);
/**
 * @file        views/container/container-mixin-render-view.js
 * @desc        Mixin for datas items rendering feature for containers
 * @see			DevaptMixinRenderView
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-02-23
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/container-mixin-render-view',['Devapt', 'core/types', 'object/class'],
function(Devapt, DevaptTypes, DevaptClass)
{
	/**
	 * @mixin				DevaptMixinRenderView
	 * @public
	 * @desc				Mixin of methods for datas items rendering features
	 */
	var DevaptMixinRenderView = 
	{
		/**
		 * @public
		 * @memberof			DevaptMixinRenderView
		 * @desc				Render an item VIEW content
		 * @param {object}		arg_deferred		deferred object
		 * @param {object}		arg_item_jqo		
		 * @param {string}		arg_item_content
		 * @return {object}		Promise
		 */
		render_item_view: function(arg_deferred, arg_item_jqo, arg_item_content)
		{
			var self = this;
			var context = 'render_item_view(deferred,jqo,content)';
			self.enter(context, '');
			self.value(context, 'arg_item_content', arg_item_content);
			
			
			// CHECK ARGS
			self.step(context, 'check args');
			self.assert_not_null(context, 'arg_item_jqo', arg_item_jqo);
			self.assert_not_null(context, 'arg_item_content', arg_item_content);
			// console.log(arg_item_jqo, context + ':jqo:' + self.name + ' for item [' + arg_item_content + ']');
			
			
			// GET CURRENT BACKEND AND RENDER VIEW
			self.step(context, 'get current backend');
			var backend = Devapt.get_current_backend();
			self.assert_not_null(context, 'backend', backend);
			var backend_promise = backend.render_view(arg_item_jqo, arg_item_content);
			
			// SET LABEL
			backend_promise.then(
				function(view)
				{
					self.step(context, 'view is rendered, set label');
					
					arg_item_jqo.attr('devapt-label', view.label);
					
					return view;
				}
			);
			
			
			self.leave(context, Devapt.msg_success);
			return backend_promise;
		}
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-02-23',
			'updated':'2015-02-23',
			'description':'Mixin methods for datas items rendering feature for containers.'
		}
	};
	var DevaptMixinRenderViewClass = new DevaptClass('DevaptMixinRenderView', null, class_settings);
	
	// METHODS
	DevaptMixinRenderViewClass.add_public_method('render_item_view', {}, DevaptMixinRenderView.render_item_view);
	
	// PROPERTIES
	
	// BUILD MIXIN CLASS
	DevaptMixinRenderViewClass.build_class();
	
	
	return DevaptMixinRenderViewClass;
}
);
/**
 * @file        views/container/container-mixin-render-object.js
 * @desc        Mixin for datas items rendering feature for containers
 * @see			DevaptMixinRenderObject
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-02-23
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/container-mixin-render-object',['Devapt', 'core/types', 'object/class', 'core/template'],
function(Devapt, DevaptTypes, DevaptClass, DevaptTemplate)
{
	/**
	 * @mixin				DevaptMixinRenderObject
	 * @public
	 * @desc				Mixin of methods for datas items rendering features
	 */
	var DevaptMixinRenderObject = 
	{
		/**
		 * @public
		 * @memberof			DevaptMixinRenderObject
		 * @desc				Render an item OBJECT content
		 * @param {object}		arg_deferred		deferred object
		 * @param {object}		arg_item_jqo		
		 * @param {object}		arg_item_object
		 * @param {boolean}		arg_update			(optional) if true do not create an other node, only update
		 * @return {object}		jQuery object node
		 */
		render_item_object: function(arg_deferred, arg_item_jqo, arg_item_object, arg_update)
		{
			var self = this;
			var context = 'render_item_object(deferred,jqo,content)';
			self.enter(context, '');
			
			
			// CHECK NODE
			if ( ! DevaptTypes.is_object(arg_item_jqo) )
			{
				self.leave(context, Devapt.msg_failure);
				return null;
			}
			
			// ITERATOR ON FIELDS
			var result_jqo = null;
			if (self.items_iterator === 'fields')
			{
				result_jqo = self.render_item_object_fields(arg_deferred, arg_item_jqo, arg_item_object, arg_update);
				
				self.leave(context, Devapt.msg_success);
				return result_jqo;
			}
			
			if (self.items_iterator === 'records' || self.items_iterator === 'field_editor')
			{
				result_jqo = self.render_item_object_records(arg_deferred, arg_item_jqo, arg_item_object, arg_update);
				
				self.leave(context, Devapt.msg_success);
				return result_jqo;
			}
			
			
			self.leave(context, Devapt.msg_failure);
			return null;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderObject
		 * @desc				Render an item OBJECT content with records iterator
		 * @param {object}		arg_deferred		deferred object
		 * @param {object}		arg_item_jqo		
		 * @param {object}		arg_item_object		plain object
		 * @param {boolean}		arg_update			(optional) if true do not create an other node, only update
		 * @return {object}		jQuery object node
		 */
		render_item_object_records: function(arg_deferred, arg_item_jqo, arg_item_object, arg_update)
		{
			var self = this;
			var context = 'render_item_object_records(deferred,jqo,content)';
			self.enter(context, '');
			
			
			// UPDATE ONLY ?
			arg_update = DevaptTypes.to_boolean(arg_update, false);
			
			
			// BUILD NODE CONTENT
			var tags_object = {};
			for(var field_index in self.items_fields)
			{
				var field_name = self.items_fields[field_index];
				tags_object[field_name] = arg_item_object[field_name];
			}
			
			
			// GET RECORD NODE
			var record_jqo = arg_update ? arg_item_jqo : self.render_item_record_node(arg_item_jqo);
			
			
			// GET HAS INPUTS
			var has_input = self.has_input ? self.has_input() : false;
			self.value(context, 'has inputs', has_input);
			
			
			// SIMPLE ONE SHOT RECORD RENDER
			if (! has_input && ! DevaptTypes.is_not_empty_array(self.items_formats))
			{
				if ( DevaptTypes.is_not_empty_str(self.items_format) )
				{
					self.step(context, 'items_format is a valid string');
					
					var content = DevaptTemplate.render(self.items_format, tags_object);
					self.value(context, 'tags_object', tags_object);
					self.value(context, 'self.items_format', self.items_format);
					self.value(context, 'content', content);
					
					if (arg_update)
					{
						// console.log('remove children', self.name + '.' + context + '.update?');
						record_jqo.children().remove();
					}
					self.render_item_text(arg_deferred, record_jqo, content);
					
					self.leave(context, Devapt.msg_success);
					return arg_item_jqo;
				}
			}
			
			
			// GET ACCESS
			var access = {read:true,update:false,create:false,'delete':false};
			if ( DevaptTypes.is_object(self.items_model_obj) )
			{
				access = self.items_model_obj.get_access();
			}
			self.value(context, 'access', access);
			
			
			// LOOP ON FIELDS
			var field_name = null;
			for(var field_index in self.items_fields)
			{
				// GET FIELD ATTRIBUTES
				field_name = self.items_fields[field_index];
				self.value(context, 'field_name', field_name);
				self.value(context, 'self.items_input_fields', self.items_input_fields);
				
				var field_def_obj = null;
				if ( DevaptTypes.is_object(self.items_model_obj) )
				{
					field_def_obj = self.items_model_obj.get_field(field_name);
				}
				var field_value = tags_object[field_name] ? tags_object[field_name] : (field_def_obj ? field_def_obj.field_value.defaults : '');
				
				
				// GET FIELD NODE
				// TODO NOT YET IMPLEMENTED
				var field_jqo = self.render_item_field_node(record_jqo);
				
				
				// RENDER INPUT
				if ( field_def_obj && has_input && (access.update || access.create || access['delete']) )
				{
					self.step(context, 'has inputs');
					
					// SKIP FIELD VALUE IF NEEDED
					if (self.items_input_fields.indexOf(field_name) < 0)
					{
						self.step(context, 'field is skipped');
						continue;
					}
					
					self.step(context, 'field has input');
					
					// GET INPUT NODE
					var uid = Devapt.uid();
					var input_div_jqo = window.$('<div id="' + field_name + '_' + uid + '_input_id">');
					var input_jqo = self.get_input(arg_deferred, field_def_obj, null, field_value, true, access);
					field_jqo.append(input_div_jqo);
					
					// TEST INPUT NODE
					if (input_jqo)
					{
						input_div_jqo.append(input_jqo);
						continue;
					}
					
					field_jqo = input_div_jqo;
				}
				
				
				// RENDER ITEM WITHOUT INPUT
				if ( DevaptTypes.is_not_empty_array(self.items_formats) )
				{
					self.step(context, 'items_formats is a valid array of strings');
					
					var field_format = self.items_formats.length > field_index ? self.items_formats[field_index] : self.items_formats[ self.items_formats.length - 1 ];
					var content = DevaptTemplate.render(field_format, tags_object);
					self.render_item_text(arg_deferred, field_jqo, content);
				}
				else
				{
					self.step(context, 'items_format is a not valid string');
					
					self.render_item_text(arg_deferred, field_jqo, field_value);
				}
			}
			
			
			self.leave(context, Devapt.msg_success);
			return arg_item_jqo;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderObject
		 * @desc				Render an item OBJECT content with fields iterator
		 * @param {object}		arg_deferred		deferred object
		 * @param {object}		arg_item_jqo		
		 * @param {object}		arg_item_object
		 * @param {boolean}		arg_update			(optional) if true do not create an other node, only update
		 * @return {object}		jQuery object node
		 */
		render_item_object_fields: function(arg_deferred, arg_item_jqo, arg_item_object, arg_update)
		{
			var self = this;
			var context = 'render_item_object_fields(deferred,jqo,content,update)';
			self.enter(context, '');
			
			
			// BUILD NODE CONTENT
			var tags_object = arg_item_object;
			
			
			// GET HAS INPUTS
			var has_input = self.has_input ? self.has_input() : false;
			self.value(context, 'has inputs', has_input);
			
			
			// GET ACCESS
			var access = {read:true,update:false,create:false,'delete':false};
			var field_def_obj = null;
			if ( DevaptTypes.is_object(self.items_model_obj) )
			{
				access = self.items_model_obj.get_access();
			}
			self.value(context, 'access', access);
			
			
			// SHOULD RENDER INPUTS
			if (has_input && (access.update || access.create || access['delete']) )
			{
				self.step(context, 'has inputs');
				
				var field_name = tags_object.field_name;
				self.value(context, 'field_name', field_name);
				self.value(context, 'self.items_input_fields', self.items_input_fields);
				
				if (self.items_input_fields.indexOf(field_name) >= 0)
				{
					self.step(context, 'field has input');
					
					var field_value = tags_object.field_value;
					var field_def_obj = null;
					if ( DevaptTypes.is_object(self.items_model_obj) )
					{
						field_def_obj = self.items_model_obj.get_field(field_name);
					}
					
					// TODO SET AN EXISTING INPUT
//					if (arg_item_jqo.length === 1)
//					{
//						self.set_input(arg_deferred, arg_item_jqo, field_def_obj, null, field_value, true);
//						 
//						tags_object['field_value'] = input_div_html;
//						tags_object[field_name + '_jqo'] = input_jqo;
//					}
//					else
//					{
						// TODO UPDATE WITH EXISTING NODE
						var uid = Devapt.uid();
						var input_div_html = '<div id="' + field_name + '_' + uid +  '_input_id">';
						var input_div_jqo = window.$(input_div_html);
						var input_jqo = self.get_input(arg_deferred, field_def_obj, null, field_value, true);
						
						input_div_jqo.append(input_jqo);
						arg_item_jqo.append(input_div_jqo);
						
						tags_object['field_value'] = input_div_html;
						tags_object[field_name + '_jqo'] = input_jqo;
//					}
				}
				
				
				self.leave(context, Devapt.msg_success);
				return arg_item_jqo;
			}
			
			
			// RENDER ITEM
			if ( DevaptTypes.is_not_empty_str(self.items_format) )
			{
				self.step(context, 'items_format is a valid string');
				
				
				
				// TODO TEMPLATE ON FIELDS INPUTS
				
				
				var content = DevaptTemplate.render(self.items_format, tags_object);
				self.render_item_text(arg_deferred, arg_item_jqo, content);
			}
			else
			{
				self.step(context, 'items_format is a not valid string');
				
				self.render_item_text(arg_deferred, arg_item_jqo, 'todo');
			}
			
			
			self.leave(context, Devapt.msg_success);
			return arg_item_jqo;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-02-23',
			'updated':'2015-02-23',
			'description':'Mixin methods for datas items rendering feature for containers.'
		}
	};
	var DevaptMixinRenderObjectClass = new DevaptClass('DevaptMixinRenderObject', null, class_settings);
	
	// METHODS
	DevaptMixinRenderObjectClass.add_public_method('render_item_object', {}, DevaptMixinRenderObject.render_item_object);
	DevaptMixinRenderObjectClass.add_public_method('render_item_object_records', {}, DevaptMixinRenderObject.render_item_object_records);
	DevaptMixinRenderObjectClass.add_public_method('render_item_object_fields', {}, DevaptMixinRenderObject.render_item_object_fields);
	
	// PROPERTIES
	
	// BUILD MIXIN CLASS
	DevaptMixinRenderObjectClass.build_class();
	
	
	return DevaptMixinRenderObjectClass;
}
);
/**
 * @file        views/container/container-mixin-render-items.js
 * @desc        Mixin for datas items rendering feature for containers
 * @see			DevaptMixinRenderItem
 * @ingroup     DEVAPT_VIEWS
 * @date        2014-11-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/container-mixin-render-item',['Devapt', 'core/types', 'object/class', 'core/template',
	'views/container/container-mixin-render-node', 'views/container/container-mixin-render-view', 'views/container/container-mixin-render-object'],
function(Devapt, DevaptTypes, DevaptClass, DevaptTemplate,
	DevaptMixinRenderNode, DevaptMixinRenderView, DevaptMixinRenderObject)
{
	/**
	 * @mixin				DevaptMixinRenderItem
	 * @public
	 * @desc				Mixin of methods for datas items rendering features
	 */
	var DevaptMixinRenderItem = 
	{
		/**
		 * @public
		 * @memberof			DevaptMixinRenderItem
		 * @desc				Render an empty item node
		 * @param {integer} 	arg_item_index		item index
		 * @return {object}		jQuery object node
		 */
		render_item_node: function(arg_item_index)
		{
			var self = this;
			var context = 'render_item_node(index)';
			self.enter(context, '');
			
			// NOT IMPLEMENTED HERE
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
			return window.$('<div>');
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderItem
		 * @desc				Render an empty record node for the container item
		 * @param {object}		arg_item_jqo		item node
		 * @return {object}		jQuery object node
		 */
		render_item_record_node: function(arg_item_jqo)
		{
			var self = this;
			var context = 'render_item_record_node(item node)';
			self.push_trace(self.trace, DevaptMixinRenderItem.mixin_trace_render_items);
			self.enter(context, '');
			
			// NOT IMPLEMENTED HERE
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
			return arg_item_jqo;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderItem
		 * @desc				Render an empty record field node for the container item
		 * @param {object}		arg_item_jqo		item node
		 * @return {object}		jQuery object node
		 */
		render_item_field_node: function(arg_item_jqo)
		{
			var self = this;
			var context = 'render_item_field_node(item node)';
			self.push_trace(self.trace, DevaptMixinRenderItem.mixin_trace_render_items);
			self.enter(context, '');
			
			// NOT IMPLEMENTED HERE
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
			return arg_item_jqo;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderItem
		 * @desc				Append an item to the view
		 * @param {object}		arg_container_item		A plain object of a container item
		 * @return {boolean}
		 */
		append_item_node: function(arg_container_item)
		{
			var self = this;
			var context = 'append_item_node(item)';
			self.enter(context, '');
			
			
			// CHECK ARGS
			self.assert_object(context, 'item', arg_container_item);
			self.assert_true(context, 'item.is_container_item', arg_container_item.is_container_item);
			
			
			if ( ! self.items_jquery_parent)
			{
				console.error(self.name, 'bad self.items_jquery_parent');
				console.log(arg_container_item.node, 'arg_item_jqo');
				
				self.leave(context, Devapt.msg_failure);
				return false;
			}
			
			self.items_jquery_parent.append(arg_container_item.node);
			
			
			self.leave(context, Devapt.msg_success);
			return true;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinRenderItem
		 * @desc				Test a an item is selected
		 * @param {object}		arg_container_item		A plain object of a container item
		 * @return {boolean}
		 */
		is_selected_item_node: function(arg_container_item)
		{
			var self = this;
			var context = 'is_selected_item_node(item)';
			self.enter(context, '');
			
			
			// CHECK ARGS
			self.assert_object(context, 'item', arg_container_item);
			self.assert_true(context, 'item.is_container_item', arg_container_item.is_container_item);
			self.assert_not_empty_string(context, 'item.id', arg_container_item.id);
			self.assert_integer(context, 'item.index', arg_container_item.index);
			self.assert_true(context, 'item index >= 0', arg_container_item.index >= 0);
			
			
			arg_container_item.is_selected = self.has_item_node_css_class(arg_container_item.node_jqo, 'selected');
			
			
			self.leave(context, Devapt.msg_success);
			return true;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-23',
			'updated':'2015-02-23',
			'description':'Mixin methods for datas items rendering feature for containers.'
		},
		mixins:[DevaptMixinRenderView, DevaptMixinRenderObject, DevaptMixinRenderNode]
	};
	var DevaptMixinRenderItemClass = new DevaptClass('DevaptMixinRenderItem', null, class_settings);
	
	// METHODS
	DevaptMixinRenderItemClass.add_public_method('render_item_node', {}, DevaptMixinRenderItem.render_item_node);
	DevaptMixinRenderItemClass.add_public_method('render_item_record_node', {}, DevaptMixinRenderItem.render_item_record_node);
	DevaptMixinRenderItemClass.add_public_method('render_item_field_node', {}, DevaptMixinRenderItem.render_item_field_node);
	// DevaptMixinRenderItemClass.add_public_method('render_item', {}, DevaptMixinRenderItem.render_item);
	DevaptMixinRenderItemClass.add_public_method('append_item_node', {}, DevaptMixinRenderItem.append_item_node);
	DevaptMixinRenderItemClass.add_public_method('is_selected_item_node', {}, DevaptMixinRenderItem.is_selected_item_node);
	
	// PROPERTIES
	
	// BUILD CLASS
	DevaptMixinRenderItemClass.build_class();
	
	
	return DevaptMixinRenderItemClass;
}
);
/**
 * @file        views/mixin-get nodes.js
 * @desc        Mixin for container get nodes feature for containers
 * @see			DevaptContainer
 * @ingroup     DEVAPT_VIEWS
 * @date        2014-11-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/container-mixin-get-nodes',['Devapt', 'core/types', 'object/class'],
function(Devapt, DevaptTypes, DevaptClass)
{
	/**
	 * @mixin				DevaptMixinGetNodes
	 * @public
	 * @desc				Mixin of methods for container get nodes features
	 */
	var DevaptMixinGetNodes = 
	{
		/**
		 * @memberof			DevaptMixinGetNodes
		 * @public
		 * @desc				Enable/disable trace for mixin operations
		 */
		mixin_trace_get_nodes: false,
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinGetNodes
		 * @desc				Init mixin
		 * @return {nothing}
		 */
		mixin_init_get_nodes: function(self)
		{
			self.push_trace(self.trace, DevaptMixinGetNodes.mixin_trace_get_nodes);
			var context = 'mixin_init_get_nodes()';
			self.enter(context, '');
			
			
			
			
			self.leave(context, '');
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinGetNodes
		 * @desc				Get all container nodes
		 * @return {array}		array of node jQuery objects
		 */
		get_all_nodes: function()
		{
			var self = this;
			var context = 'get_all_nodes()';
			self.push_trace(self.trace, DevaptMixinGetNodes.mixin_trace_get_nodes);
			self.enter(context, '');
			
			
			var nodes_jqo = window.$(self.items_jquery_filter, self.items_jquery_parent);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return nodes_jqo;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinGetNodes
		 * @desc				Get a container item node by the node item index
		 * @param {integer}		arg_node_item_index		node item index
		 * @return {object}		node jQuery object
		 */
		get_node_by_index: function(arg_node_item_index)
		{
			var self = this;
			var context = 'get_node_by_index(index)';
			self.push_trace(self.trace, DevaptMixinGetNodes.mixin_trace_get_nodes);
			self.enter(context, '');
			
			
			var node_jqo = window.$(self.items_jquery_filter, self.items_jquery_parent).eq(arg_node_item_index);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return node_jqo;
		},
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinGetNodes
		 * @desc				Get a container item node by the node item text
		 * @param {string}		arg_node_item_text		node item text
		 * @return {object}		node jQuery object
		 */
		get_node_by_content: function(arg_node_item_text)
		{
			var self = this;
			var context = 'get_node_by_content(text)';
			self.push_trace(self.trace, DevaptMixinGetNodes.mixin_trace_get_nodes);
			self.enter(context, '');
			
			
			var node_jqo = null;
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
			return node_jqo;
		},
			
		
		/**
		 * @public
		 * @memberof			DevaptMixinGetNodes
		 * @desc				Get a container item node by a record
		 * @param {object}		arg_record				record object
		 * @return {object}		node jQuery object
		 */
		get_node_by_record: function(arg_record)
		{
			var self = this;
			var context = 'get_node_by_record(record)';
			self.push_trace(self.trace, DevaptMixinGetNodes.mixin_trace_get_nodes);
			self.enter(context, '');
			
			
			// CHECK RECORD
			if (! arg_record || ! arg_record.is_record)
			{
				console.error(arg_record, self.name + '.' + context + ':record');
				self.leave(context, Devapt.msg_failure);
				self.pop_trace();
				return null;
			}
			
			// LOOKUP NODE
			var node_jqo = null;
			var nodes_jqo = self.get_all_nodes();
			if ( DevaptTypes.is_not_empty_object(nodes_jqo) )
			{
				self.step(context, 'all nodes is an array');
				self.value(context, 'nodes_jqo.length', nodes_jqo.length);
				
				for(var node_index = 0 ; node_index < nodes_jqo.length ; node_index++)
				{
					self.value(context, 'loop on node index', node_index);
					
					var loop_record = self.items_records[node_index];
					self.value(context, 'loop_record', loop_record);
					
					if ( DevaptTypes.is_object(loop_record)  && loop_record.is_record )
					{
						self.step(context, 'loop record is an object');
						
						if ( arg_record.get_id() === loop_record.get_id() )
						{
							self.step(context, 'record if found with its id');
							node_jqo = window.$( nodes_jqo[node_index] );
							break;
						}
					}
					else
					{
						self.step(context, 'loop record is not an object');
					}
				}
			}
			else
			{
				self.step(context, 'all nodes is not an array');
				console.error(nodes_jqo);
			}
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return node_jqo;
		},
			
		
		/**
		 * @public
		 * @memberof			DevaptMixinGetNodes
		 * @desc				Get a container item node by a field value
		 * @param {string}		arg_field_name				field name
		 * @param {string}		arg_field_value				field value
		 * @return {object}		node jQuery object
		 */
		get_node_by_field_value: function(arg_field_name, arg_field_value)
		{
			var self = this;
			var context = 'get_node_by_field_value(field name, field value)';
			self.push_trace(self.trace, DevaptMixinGetNodes.mixin_trace_get_nodes);
			self.enter(context, '');
			
			
			var node_jqo = null;
			var nodes_jqo = self.get_all_nodes();
			if ( DevaptTypes.is_not_empty_object(nodes_jqo) )
			{
				self.step(context, 'all nodes is an array');
				self.value(context, 'nodes_jqo.length', nodes_jqo.length);
				
				for(var node_index = 0 ; node_index < nodes_jqo.length ; node_index++)
				{
					self.value(context, 'loop on node index', node_index);
					
					// var loop_node_jqo = window.$( nodes_jqo[node_index] );
					// var loop_record = loop_node_jqo.data('record');
					var loop_record = self.items_records[node_index];
					self.value(context, 'loop_record', loop_record);
					if ( DevaptTypes.is_object(loop_record) )
					{
						self.step(context, 'loop record is an object');
						var field_value = loop_record[arg_field_name];
						if (field_value === arg_field_value)
						{
							self.step(context, 'record field value = arg field value');
							node_jqo = window.$( nodes_jqo[node_index] );
							break;
						}
					}
					else
					{
						self.step(context, 'loop record is not an object');
					}
				}
			}
			else
			{
				self.step(context, 'all nodes is not an array');
				console.error(nodes_jqo);
			}
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return node_jqo;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-23',
			'updated':'2014-12-06',
			'description':'Mixin methods for get nodes feature for containers.'
		}
	};
	
	
	/**
	 * @mixin				DevaptMixinGetNodesClass
	 * @public
	 * @desc				Mixin of methods for get nodes feature for containers
	 */
	var DevaptMixinGetNodesClass = new DevaptClass('DevaptMixinGetNodes', null, class_settings);
	
	// DevaptMixinGetNodesClass.infos.ctor = DevaptMixinGetNodes.mixin_init_filtered;
	DevaptMixinGetNodesClass.add_public_method('get_all_nodes', {}, DevaptMixinGetNodes.get_all_nodes);
	DevaptMixinGetNodesClass.add_public_method('get_node_by_index', {}, DevaptMixinGetNodes.get_node_by_index);
	DevaptMixinGetNodesClass.add_public_method('get_node_by_content', {}, DevaptMixinGetNodes.get_node_by_content);
	DevaptMixinGetNodesClass.add_public_method('get_node_by_record', {}, DevaptMixinGetNodes.get_node_by_record);
	DevaptMixinGetNodesClass.add_public_method('get_node_by_field_value', {}, DevaptMixinGetNodes.get_node_by_field_value);
	
	DevaptMixinGetNodesClass.build_class();
	
	
	return DevaptMixinGetNodesClass;
}
);
/**
 * @file        views/container/container-mixin-utils.js
 * @desc        Mixin for container utils features
 * @see			DevaptMixinContainerUtils
 * @ingroup     DEVAPT_VIEWS
 * @date        2014-11-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/container-mixin-utils',['Devapt', 'core/types', 'object/class'],
function(Devapt, DevaptTypes, DevaptClass)
{
	/**
	 * @mixin				DevaptMixinContainerUtils
	 * @public
	 * @desc				Mixin of methods for container utils features
	 */
	var DevaptMixinContainerUtils = 
	{
		/**
		 * @memberof			DevaptMixinContainerUtils
		 * @public
		 * @desc				Enable/disable trace for mixin operations
		 */
		mixin_trace_container_utils: false,
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Init mixin
		 * @return {nothing}
		 */
	/*	mixin_init_container_utils: function(self)
		{
			self.push_trace(self.trace, self.mixin_trace_container_utils);
			var context = 'mixin_init_container_utils()';
			self.enter(context, '');
			
			
			
			
			self.leave(context, '');
			self.pop_trace();
		},*/
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Get the item options at given index
		 * @param {integer} 	arg_item_index		item index
		 * @param {object} 		arg_item_defaults	item default options
		 * @return {object}		options map
		 */
		get_item_options: function(arg_item_index, arg_item_defaults)
		{
			var self = this;
			var context = 'get_item_options(index)';
			// self.push_trace(self.trace, DevaptMixinContainerUtils.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			// INIT DEFAULT OPTIONS RECORD
			self.step(context, 'INIT DEFAULT OPTIONS RECORD');
			var options = arg_item_defaults ? arg_item_defaults : {};
			// self.items_options = self.get_property('items_options');
			// console.log(options, context + '.options');
			// console.log(self.items_options, context + '.self.items_options [' + self.name + ']');
			// console.log(arg_item_index, context + '.arg_item_index');
			
			// GET GIVEN OPTIONS RECORD
			if ( DevaptTypes.is_not_empty_array(self.items_options) && self.items_options[arg_item_index] )
			{
				self.step(context, 'GET GIVEN OPTIONS RECORD');
				var item_options = self.items_options[arg_item_index];
				// console.log(item_options, context + '.item_options [' + self.name + ']');
				
				if ( DevaptTypes.is_string(item_options) )
				{
					self.step(context, 'ITEM OPTIONS IS A STRING');
					// console.log(item_options, context + '.item_options is string');
					var options_parts = item_options.split('|');
					for(var part_index in options_parts)
					{
						var record_part_str = options_parts[part_index];
						// console.log(record_part_str, 'at ' + part_index + ' for ' + arg_item_index);
						var record_part = record_part_str.split('=');
						if ( DevaptTypes.is_not_empty_array(record_part) && record_part.length === 2 )
						{
							var option_key = record_part[0];
							var option_value = record_part[1];
							options[option_key] = option_value;
						}
					}
				}
				else if ( DevaptTypes.is_object(item_options) )
				{
					self.step(context, 'ITEM OPTIONS IS AN OBJECT');
					// console.log(item_options, context + '.item_options is object');
					
					var option_key = null;
					for(option_key in item_options)
					{
						var loop_option = item_options[option_key];
						// console.log(loop_option, context + '.loop_option');
						
						if ( DevaptTypes.is_string(loop_option) )
						{
							// console.log(loop_option, context + '.loop_option is string');
							
							var loop_childs = loop_option.split('|');
							if ( loop_childs.length > 1 )
							{
								for(var child_key in loop_childs)
								{
									var loop_child = loop_childs[child_key].split('=');
									var loop_child_key = loop_child[0];
									var loop_child_value = loop_child[1];
									// console.log(loop_child, context + '.loop_child');
									// console.log(loop_child_key, context + '.loop_child_key');
									// console.log(loop_child_value, context + '.loop_child_value');
									
									options[loop_child_key] = loop_child_value;
								}
							}
							else
							{
								options[option_key] = loop_option;
							}
						}
					}
				}
				else
				{
					self.error(item_options, 'container.item_options is unknow');
				}
			}
			
			// UPDATE OPTIONS RECORD WITH GIVEN LABELS
			if ( DevaptTypes.is_not_empty_array(self.items_labels) && self.items_labels.length > arg_item_index )
			{
				options.label = self.items_labels[arg_item_index];
			}
			
			// console.log(options, context + '.options [' + self.name + ']');
			
			
			self.leave(context, self.msq_success);
			// self.pop_trace();
			return options;
		},
		
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Add a CSS class to all items
		 * @param {string}		arg_css_class		CSS class name
		 * @return {nothing}
		 */
		add_items_css_class: function(arg_css_class)
		{
			var self = this;
			var context = 'add_items_css_class(css class)';
			self.push_trace(self.trace, DevaptMixinContainerUtils.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			$(self.items_jquery_filter, self.items_jquery_parent).addClass(arg_css_class);
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Remove a CSS class to all items
		 * @param {string}		arg_css_class		CSS class name
		 * @return {nothing}
		 */
		remove_items_css_class: function(arg_css_class)
		{
			var self = this;
			var context = 'remove_items_css_class(css class)';
			self.push_trace(self.trace, DevaptMixinContainerUtils.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			$(self.items_jquery_filter, self.items_jquery_parent).removeClass(arg_css_class);
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Toggle a CSS class to all items
		 * @param {string}		arg_css_class		CSS class name
		 * @return {nothing}
		 */
		toggle_items_css_class: function(arg_css_class)
		{
			var self = this;
			var context = 'toggle_items_css_class(css class)';
			self.push_trace(self.trace, DevaptMixinContainerUtils.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			$(self.items_jquery_filter, self.items_jquery_parent).toggle(arg_css_class);
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Get item node CSS value
		 * @param {object}		arg_node_jqo	item node jQuery object
		 * @param {string}		arg_css_key		item node CSS key
		 * @return {nothing}
		 */
		get_item_node_css_value: function(arg_node_jqo, arg_css_key)
		{
			var self = this;
			var context = 'get_item_node_css_value(node,css)';
			self.push_trace(self.trace, DevaptMixinContainerUtils.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			var text = arg_node_jqo.css(arg_css_key);
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
			return text;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Set item node CSS value
		 * @param {object}		arg_node_jqo	item node jQuery object
		 * @param {string}		arg_css_key		item node CSS key
		 * @param {string}		arg_css_value	item node CSS value
		 * @return {nothing}
		 */
		set_item_node_css_value: function(arg_node_jqo, arg_css_key, arg_css_value)
		{
			var self = this;
			var context = 'set_item_node_css_value(node,css,value)';
			self.push_trace(self.trace, DevaptMixinContainerUtils.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			arg_node_jqo.css(arg_css_key, arg_css_value);
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Has CSS class to the given item node
		 * @param {object}		arg_node_jqo	item node jQuery object
		 * @param {string}		arg_css_class	item node CSS class
		 * @return {nothing}
		 */
		has_item_node_css_class: function(arg_node_jqo, arg_css_class)
		{
			var self = this;
			var context = 'has_item_node_css_class(node,class)';
			self.push_trace(self.trace, DevaptMixinContainerUtils.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			var result = arg_node_jqo.hasClass(arg_css_class);
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
			return result;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Add CSS class to the given item node
		 * @param {object}		arg_node_jqo	item node jQuery object
		 * @param {string}		arg_css_class	item node CSS class
		 * @return {nothing}
		 */
		add_item_node_css_class: function(arg_node_jqo, arg_css_class)
		{
			var self = this;
			var context = 'add_item_node_css_class(node,class)';
			self.push_trace(self.trace, DevaptMixinContainerUtils.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			arg_node_jqo.addClass(arg_css_class);
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Remove CSS class to the given item node
		 * @param {object}		arg_node_jqo	item node jQuery object
		 * @param {string}		arg_css_class	item node CSS class
		 * @return {nothing}
		 */
		remove_item_node_css_class: function(arg_node_jqo, arg_css_class)
		{
			var self = this;
			var context = 'remove_item_node_css_class(node,class)';
			self.push_trace(self.trace, DevaptMixinContainerUtils.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			arg_node_jqo.removeClass(arg_css_class);
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Toggle CSS class to the given item node
		 * @param {object}		arg_node_jqo	item node jQuery object
		 * @param {string}		arg_css_class	item node CSS class
		 * @return {nothing}
		 */
		toggle_item_node_css_class: function(arg_node_jqo, arg_css_class)
		{
			var self = this;
			var context = 'toggle_item_node_css_class(node,class)';
			self.push_trace(self.trace, DevaptMixinContainerUtils.mixin_trace_container_utils);
			self.enter(context, '');
			
			
//			console.debug(arg_node_jqo, context + ':arg_node_jqo');
//			console.debug(arg_css_class, context + ':arg_css_class');
			
			arg_node_jqo.toggleClass(arg_css_class);
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Get item node text
		 * @param {object}		arg_node_jqo	item node jQuery object
		 * @return {string}
		 */
		get_item_node_text: function(arg_node_jqo)
		{
			var self = this;
			var context = 'get_item_node_text(node)';
			self.push_trace(self.trace, self.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			var text = arg_node_jqo.text();
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
			return text;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Set item node text
		 * @param {object}		arg_node_jqo	item node jQuery object
		 * @param {string}		arg_node_text	item node text
		 * @return {boolean}
		 */
		set_item_node_text: function(arg_node_jqo, arg_node_text)
		{
			var self = this;
			var context = 'set_item_node_text(node,text)';
			self.push_trace(self.trace, self.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			arg_node_jqo.text(arg_node_text);
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
			return true;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Remove all items
		 * @return {boolean}
		 */
		remove_items: function()
		{
			var self = this;
			var context = 'remove_items()';
			self.push_trace(self.trace, self.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			$(self.items_jquery_filter, self.items_jquery_parent).remove();
			
			// EMPTY RECORDS
			self.items_count = 0;
			self.items_records = [];
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
			return true;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinContainerUtils
		 * @desc				Reset all items
		 * @return {boolean}
		 */
		reset_items: function()
		{
			var self = this;
			var context = 'reset_items()';
			self.push_trace(self.trace, self.mixin_trace_container_utils);
			self.enter(context, '');
			
			
			var all_jqo = $(self.items_jquery_filter, self.items_jquery_parent);
			$('a', all_jqo).val('');
			$('input', all_jqo).val('');
			$('span', all_jqo).val('');
			
			
			self.leave(context, Devapt.msg_default_empty_implementation);
			self.pop_trace();
			return true;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-11-15',
			'updated':'2015-05-16',
			'description':'Mixin methods for container utils features.'
		}
	};
	var DevaptMixinContainerUtilsClass = new DevaptClass('DevaptMixinContainerUtils', null, class_settings);
	
	DevaptMixinContainerUtilsClass.add_public_method('get_item_options', {}, DevaptMixinContainerUtils.get_item_options);
	
	DevaptMixinContainerUtilsClass.add_public_method('add_items_css_class', {}, DevaptMixinContainerUtils.add_items_css_class);
	DevaptMixinContainerUtilsClass.add_public_method('remove_items_css_class', {}, DevaptMixinContainerUtils.remove_items_css_class);
	DevaptMixinContainerUtilsClass.add_public_method('toggle_items_css_class', {}, DevaptMixinContainerUtils.toggle_items_css_class);
	DevaptMixinContainerUtilsClass.add_public_method('get_item_node_css_value', {}, DevaptMixinContainerUtils.get_item_node_css_value);
	DevaptMixinContainerUtilsClass.add_public_method('set_item_node_css_value', {}, DevaptMixinContainerUtils.set_item_node_css_value);
	
	DevaptMixinContainerUtilsClass.add_public_method('has_item_node_css_class', {}, DevaptMixinContainerUtils.has_item_node_css_class);
	DevaptMixinContainerUtilsClass.add_public_method('add_item_node_css_class', {}, DevaptMixinContainerUtils.add_item_node_css_class);
	DevaptMixinContainerUtilsClass.add_public_method('remove_item_node_css_class', {}, DevaptMixinContainerUtils.remove_item_node_css_class);
	DevaptMixinContainerUtilsClass.add_public_method('toggle_item_node_css_class', {}, DevaptMixinContainerUtils.toggle_item_node_css_class);
	
	DevaptMixinContainerUtilsClass.add_public_method('get_item_node_text', {}, DevaptMixinContainerUtils.get_item_node_text);
	DevaptMixinContainerUtilsClass.add_public_method('set_item_node_text', {}, DevaptMixinContainerUtils.set_item_node_text);
	DevaptMixinContainerUtilsClass.add_public_method('remove_items', {}, DevaptMixinContainerUtils.remove_items);
	DevaptMixinContainerUtilsClass.add_public_method('reset_items', {}, DevaptMixinContainerUtils.reset_items);
	
	DevaptMixinContainerUtilsClass.build_class();
	
	
	return DevaptMixinContainerUtilsClass;
}
);
/**
 * @file        views/mixin-input-simple.js
 * @desc        Mixin for datas simple input feature for containers
 * @see			DevaptContainer
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-01-04
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/mixin-input-simple',['Devapt', 'core/types', 'object/class', 'md5', 'sha1'],
function(Devapt, DevaptTypes, DevaptClass, MD5, SHA1)
{
	/**
	 * @mixin				DevaptMixinInputSimple
	 * @public
	 * @desc				Mixin of methods for datas form features
	 */
	var DevaptMixinInputSimple = 
	{
		/**
		 * @memberof			DevaptMixinInputSimple
		 * @public
		 * @desc				Enable/disable trace for mixin operations
		 */
		mixin_trace_input_simple: false,
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinInputSimple
		 * @desc				Get a simple input tag for the given field
		 * @param {object}		arg_field_obj			field definition attributes
		 * @param {string}		arg_value				field value
		 * @return {object}		jQuery node object
		 */
		get_simple_input: function(arg_field_obj, arg_value)
		{
			var self = this;
			var context = 'get_simple_input(field, value)';
			self.push_trace(self.trace, DevaptMixinInputSimple.mixin_trace_input_simple);
			self.enter(context, '');
			
			
			// GET FIELD ATTRIBUTES
			var value_str = arg_value;
			var field_obj = arg_field_obj;
			var type_str = DevaptTypes.to_string(field_obj.field_value.type, 'string').toLocaleLowerCase();
			var name_str = DevaptTypes.to_string(field_obj.name, null);
			var label_str = DevaptTypes.to_string(field_obj.label, null);
			self.value(context, 'type_str', type_str);
			self.value(context, 'name_str', name_str);
			self.value(context, 'label_str', label_str);
			
			
			// GET RESULT INPUT NODE
			var node_jqo = null;
			switch(type_str)
			{
				case 'string':		node_jqo = window.$('<input type="text">').attr('name', name_str).addClass('devapt_input_string').val(value_str); break;
				case 'integer':		node_jqo = window.$('<input type="text">').attr('name', name_str).addClass('devapt_input_integer').val(value_str); break;
				case 'float':		node_jqo = window.$('<input type="text">').attr('name', name_str).addClass('devapt_input_float').val(value_str); break;
				case 'boolean':		node_jqo = window.$('<input type="text">').attr('name', name_str).addClass('devapt_input_boolean').val(value_str); break;
				case 'email':		node_jqo = window.$('<input type="text">').attr('name', name_str).addClass('devapt_input_email').val(value_str); break;
				case 'date':		node_jqo = window.$('<input type="text">').attr('name', name_str).addClass('devapt_input_date').val(value_str); break;
				case 'time':		node_jqo = window.$('<input type="text">').attr('name', name_str).addClass('devapt_input_time').val(value_str); break;
				case 'datetime':	node_jqo = window.$('<input type="text">').attr('name', name_str).addClass('devapt_input_datetime').val(value_str); break;
			}
			
			
			// CHECK RESULT INPUT NODE
			if (! node_jqo)
			{
				self.leave(context, Devapt.msg_failure);
				self.pop_trace();
				return null;
			}
			
			
			// SAVE FILLED VALUE
			node_jqo.data('value_filled', value_str);
			// node_jqo.data('value_changed', null);
			
			
			// SET PLACEHOLDER
			if (field_obj.placeholder)
			{
				self.step(context, 'sett placeholder');
				
				node_jqo.attr('placeholder', field_obj.placeholder);
			}
			
			
			// STANDARD INPUT EVENT CALLBACK
			var change_cb = function(event) {
				// self.trace=true;
				self.step(context, 'on change callback');
				
				var event_node_jqo = window.$(event.target);
				var value_filled = event_node_jqo.data('value_filled');
				var value = event_node_jqo.val();
				self.value(context, 'value_filled', value_filled);
				self.value(context, 'value', value);
				
				// ON VALUE CHANGE
				if (value !== value_filled)
				{
					self.step(context, 'values are different');
					
					event_node_jqo.data('value_filled', value);
					// console.log(value, 'input changed');
					
					// VALIDATE VALUE
					var validate_status = self.validate_input(field_obj, value);
					if (! validate_status.is_valid)
					{
						self.step(context, 'validation failure');
						
						event_node_jqo.parent().addClass('devapt_validate_error');
						
						if ( Devapt.has_current_backend() )
						{
							Devapt.get_current_backend().notify_error(validate_status.error_label);
						}
					}
					else
					{
						self.step(context, 'validation success');
						
						event_node_jqo.parent().removeClass('devapt_validate_error');
						
						// EMIT CHANGE EVENTS
						self.fire_event('devapt.input.changed', [field_obj, value_filled, value]);
						self.on_input_changed(field_obj, value_filled, value);
					}
				}
			};
			
			
			// SET EVENTS HANDLES
			node_jqo.on('change', change_cb);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return node_jqo;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinInputSimple
		 * @desc				Get a password input tag for the given field
		 * @param {object}		arg_field_obj			field definition attributes
		 * @param {string}		arg_value				field value
		 * @return {object}		jQuery node object
		 */
		get_password_input: function(arg_field_obj, arg_value)
		{
			var self = this;
			var context = 'get_password_input(field, value)';
			self.push_trace(self.trace, DevaptMixinInputSimple.mixin_trace_input_simple);
			self.enter(context, '');
			
			
			// GET FIELD ATTRIBUTES
			var field_obj = arg_field_obj;
			var value_str = arg_value;
			var name_str = DevaptTypes.to_string(field_obj.name, null);
			var label_str = DevaptTypes.to_string(field_obj.label, null);
			self.value(context, 'name_str', name_str);
			self.value(context, 'label_str', label_str);
			self.value(context, 'value_str', value_str);
			
			
			// GET RESULT INPUT NODE
			var node_jqo = window.$('<div>').attr('name', name_str).addClass('devapt_input_password');
			var pass0_jqo = window.$('<input type="hidden">').attr('name', name_str + '_pass0').val(value_str);
			var pass1_jqo = window.$('<input type="password">').attr('name', name_str + '_pass1');
			var pass2_jqo = window.$('<input type="password">').attr('name', name_str + '_pass2');
			node_jqo.append(pass0_jqo).append(pass1_jqo).append(pass2_jqo);
			
			
			// CHECK RESULT INPUT NODE
			if (! node_jqo)
			{
				self.leave(context, Devapt.msg_failure);
				self.pop_trace();
				return null;
			}
			
			
			
			// SAVE FILLED VALUE
			node_jqo.data('value_filled', value_str);
//			 node_jqo.data('value_changed', null);
			
			
			// SET PLACEHOLDER
			if (field_obj.placeholder)
			{
				pass1_jqo.attr('placeholder', field_obj.placeholder);
				pass2_jqo.attr('placeholder', field_obj.placeholder);
			}
			
			
			// PASSWORD INPUT EVENT CALLBACK
			var change_pass_cb = function(event) {
				self.step(context, 'change password callback');
				
				var node_jqo = window.$(event.target);
				var value_filled = node_jqo.data('value_filled');
				var value = null;
				
				var input0_jqo = window.$('input:eq(0)', node_jqo.parent());
				var input1_jqo = window.$('input:eq(1)', node_jqo.parent());
				var input2_jqo = node_jqo;
				
				// CHECK PASSWORD CONFORMATION
				var value1 = input1_jqo.val();
				var value2 = input2_jqo.val();
				if (value1 !== value2)
				{
					self.notify_alert('password confirmation is different');
					return true;
				}
				
				// HASH PASSWORD IF NEEDED
				value = value1;
				// TODO CHOOSE HASH METHOD
				if (field_obj.hash === 'md5')
				{
					value = window.CryptoJS.MD5(' + value + ').toString();
				}
				else if (field_obj.hash === 'sha1')
				{
					value = window.CryptoJS.SHA1(' + value + ').toString();
				}
				else
				{
					self.error(context, 'unknow HASH method [' + field_obj.hash + ']');
				}
				
				// TEST IF PASSWORD HAS CHANGED
				if (value !== value_filled)
				{
					input0_jqo.val(value);
					node_jqo.data('value_filled', value);
					// console.log(value, 'pass input changed');
					self.fire_event('devapt.input.changed', [field_obj, value_filled, value]);
					self.on_input_changed(field_obj, value_filled, value);
				}
			};
			
			
			// SET EVENTS HANDLES
			pass2_jqo.on('change', change_pass_cb);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return node_jqo;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-01-04',
			'updated':'2015-01-06',
			'description':'Mixin methods for datas simple input feature for containers.'
		}
	};
	var DevaptMixinInputSimpleClass = new DevaptClass('DevaptMixinInputSimple', null, class_settings);
	
	// METHODS
	DevaptMixinInputSimpleClass.add_public_method('get_simple_input', {}, DevaptMixinInputSimple.get_simple_input);
	DevaptMixinInputSimpleClass.add_public_method('get_password_input', {}, DevaptMixinInputSimple.get_password_input);
	
	// BUILD MIXIN CLASS
	DevaptMixinInputSimpleClass.build_class();
	
	
	return DevaptMixinInputSimpleClass;
}
);
/**
 * @file        views/mixin-input-validate.js
 * @desc        Mixin for datas input validation feature for containers
 * @see			DevaptContainer
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-01-04
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/mixin-input-validate',['Devapt', 'core/types', 'object/class'],
function(Devapt, DevaptTypes, DevaptClass)
{
	/**
	 * @mixin				DevaptMixinInputValidation
	 * @public
	 * @desc				Mixin of methods for datas form features
	 */
	var DevaptMixinInputValidation = 
	{
		/**
		 * @memberof			DevaptMixinInputValidation
		 * @public
		 * @desc				Enable/disable trace for mixin operations
		 */
		mixin_trace_input_validation: true,
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinInputValidation
		 * @desc				Get a password input tag for the given field
		 * @param {object}		arg_field_obj			field definition attributes
		 * @param {string}		arg_value				field value
		 * @return {object}		validate status
		 */
		validate_input: function(arg_field_obj, arg_value)
		{
			var self = this;
			var context = 'validate_input(field, value)';
			self.push_trace(self.trace, DevaptMixinInputValidation.mixin_trace_input_validation);
			self.enter(context, '');
			
			
			// SET DEFAULT STATUS
			var validate_status = {
				valid_label:arg_field_obj.field_value.validate_valid_label ? arg_field_obj.field_value.validate_valid_label : 'good value',
				error_label:arg_field_obj.field_value.validate_error_label ? arg_field_obj.field_value.validate_error_label : 'bad value',
				is_valid:true
			};
			
			
			// VALIDATE REGEXP EXISTS
			if ( DevaptTypes.is_object(arg_field_obj.field_value.validate_regexp) )
			{
				self.step(context, 'validation regexp exists');
				
				validate_status.is_valid = arg_field_obj.field_value.validate_regexp.test(arg_value);
				
				self.leave(context, Devapt.msg_success);
				self.pop_trace();
				return validate_status;
			}
			
			
			// TEST VALIDATE
			var validate_pattern = null;
			if ( DevaptTypes.is_not_empty_str(arg_field_obj.field_value.validate) )
			{
				self.step(context, 'validation pattern exists');
				
				switch(arg_field_obj.field_value.validate)
				{
					case 'url': validate_pattern = /^(https?|ftp|file|ssh):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/; break;
					case 'dns': validate_pattern = /^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$/; break;
					
					case 'alpha': validate_pattern = /^[a-z]+$/; break;
					case 'Alpha': validate_pattern = /^[A-Z][a-z]+$/; break;
					case 'alphaALPHA': validate_pattern = /^[a-zA-Z]+$/; break;
					case 'ALPHA': validate_pattern = /^[A-Z]+$/; break;
					
					case 'alpha-': validate_pattern = /^[a-z-]+$/; break;
					case 'Alpha-': validate_pattern = /^[A-Z][a-z-]+$/; break;
					case 'alphaALPHA-': validate_pattern = /^[a-zA-Z-]+$/; break;
					case 'ALPHA-': validate_pattern = /^[A-Z-]+$/; break;
					
					case 'alpha_': validate_pattern = /^[a-z_]+$/; break;
					case 'Alpha_': validate_pattern = /^[A-Z][a-z_]+$/; break;
					case 'alphaALPHA_': validate_pattern = /^[a-zA-Z_]+$/; break;
					case 'ALPHA_': validate_pattern = /^[A-Z_]+$/; break;
					
					case 'alpha_-': validate_pattern = /^[a-z_-]+$/; break;
					case 'Alpha_-': validate_pattern = /^[A-Z][a-z_-]+$/; break;
					case 'alphaALPHA_-': validate_pattern = /^[a-zA-Z_-]+$/; break;
					case 'ALPHA_-': validate_pattern = /^[A-Z_-]+$/; break;
					
					case 'alpha_-space': validate_pattern = /^[a-z_ -]+$/; break; // BE CAREFULL THE "-"" SIGN HAVE TO BE AT THE END
					case 'Alpha_-space': validate_pattern = /^[A-Z][a-z_ -]+$/; break; // BE CAREFULL THE "-"" SIGN HAVE TO BE AT THE END
					case 'alphaALPHA_-space': validate_pattern = /^[a-zA-Z_ -]+$/; break; // BE CAREFULL THE "-"" SIGN HAVE TO BE AT THE END
					case 'ALPHA_-space': validate_pattern = /^[A-Z_ -]+$/; break; // BE CAREFULL THE "-"" SIGN HAVE TO BE AT THE END
					
					case 'alphanum': validate_pattern = /^[a-z0-9]+$/; break;
					case 'Alphanum': validate_pattern = /^[A-Z][a-z0-9]+$/; break;
					case 'alphaALPHAnum': validate_pattern = /^[a-zA-Z0-9]+$/; break;
					case 'ALPHAnum': validate_pattern = /^[A-Z0-9]+$/; break;
					
					case 'alphanum-': validate_pattern = /^[a-z0-9-]+$/; break;
					case 'Alphanum-': validate_pattern = /^[A-Z][a-z0-9-]+$/; break;
					case 'alphaALPHAnum-': validate_pattern = /^[a-zA-Z0-9-]+$/; break;
					case 'ALPHAnum-': validate_pattern = /^[A-Z0-9-]+$/; break;
					
					case 'alphanum_': validate_pattern = /^[a-z0-9_]+$/; break;
					case 'Alphanum_': validate_pattern = /^[A-Z][a-z0-9_]+$/; break;
					case 'alphaALPHAnum_': validate_pattern = /^[a-zA-Z0-9_]+$/; break;
					case 'ALPHAnum_': validate_pattern = /^[A-Z0-9_]+$/; break;
					
					case 'alphanum_-': validate_pattern = /^[a-z0-9_-]+$/; break;
					case 'Alphanum_-': validate_pattern = /^[A-Z][a-z0-9_-]+$/; break;
					case 'alphaALPHAnum_-': validate_pattern = /^[a-zA-Z0-9_-]+$/; break;
					case 'ALPHAnum_-': validate_pattern = /^[A-Z0-9_-]+$/; break;
					
					case 'alphanum_-space': validate_pattern = /^[a-zA-Z][a-z0-9_ -]*$/; break;
					case 'Alphanum_-space': validate_pattern = /^[a-zA-Z][A-Z][a-z0-9_ -]*$/; break;
					case 'alphaALPHAnum_-space': validate_pattern = /^[a-zA-Z][a-zA-Z0-9_ -]*$/; break;
					case 'ALPHAnum_-space': validate_pattern = /^[a-zA-Z][A-Z0-9_ -]*$/; break;
					
					case 'DDMMYYYY': validate_pattern = /^(0[1-9]|[12][0-9]|3[01])(0[1-9]|1[012])\d{4}$/; break;
					case 'DD-MM-YYYY': validate_pattern = /^(0[1-9]|[12][0-9]|3[01])[-](0[1-9]|1[012])[-]\d{4}$/; break;
					case 'DD/MM/YYYY': validate_pattern = /^(0[1-9]|[12][0-9]|3[01])[\/](0[1-9]|1[012])[\/]\d{4}$/; break;
					case 'DD MM YYYY': validate_pattern = /^(0[1-9]|[12][0-9]|3[01])[ ](0[1-9]|1[012])[ ]\d{4}$/; break;
					case 'DD.MM.YYYY': validate_pattern = /^(0[1-9]|[12][0-9]|3[01])[.](0[1-9]|1[012])[.]\d{4}$/; break;
					
					default: validate_pattern = new RegExp(arg_field_obj.field_value.validate); break;
				}
			}
			
			
			// NO VALIDATE PATTERN, CHECK VALUE WITH TYPE
			if (validate_pattern === null)
			{
				self.step(context, 'no validation pattern, check with type');
				
				switch(arg_field_obj.field_value.type)
				{
					case 'integer':		validate_pattern = /^[-+]?[0-9]+$/; break;
					case 'float':		validate_pattern = /^[-+]?\d*(?:[\.\,]\d+)?$/; break;
					case 'boolean':		validate_pattern = /^0|1|true|false|on|off$/i; break;
					case 'email':		validate_pattern = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/; break;
					case 'color':		validate_pattern = /^#?([a-fA-F0-9]{6})|\(\d{1,3},\d{1,3},\d{1,3}\)$/; break; // #FFFFFF or (ddd,ddd,ddd)
					case 'date':		validate_pattern = /^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/; break; // YYYY-MM-DD
					case 'time':		validate_pattern = /^(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}$/; break; // HH:MM:SS
					case 'datetime':	validate_pattern = /^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2} (0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}$/; break; // YYYY-MM-DD HH:MM:SS
				}
			}
			
			// REGISTER REGEXP
			if ( DevaptTypes.is_object(validate_pattern) )
			{
				self.step(context, 'validation pattern exists');
				// console.log(validate_pattern, arg_field_obj.name + ':validate_pattern');
				
				arg_field_obj.field_value.validate_regexp = validate_pattern;
				validate_status.is_valid = arg_field_obj.field_value.validate_regexp.test(arg_value);
				
				self.value(context, 'validation result', validate_status.is_valid);
			}
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return validate_status;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-01-04',
			'updated':'2015-01-06',
			'description':'Mixin methods for datas input validation feature for containers.'
		}
	};
	
	
	/**
	 * @mixin				DevaptMixinInputValidationClass
	 * @public
	 * @desc				Mixin of methods for datas form feature for containers
	 */
	var DevaptMixinInputValidationClass = new DevaptClass('DevaptMixinInputValidation', null, class_settings);
	
	// METHODS
	DevaptMixinInputValidationClass.add_public_method('validate_input', {}, DevaptMixinInputValidation.validate_input);
	
	// BUILD MIXIN CLASS
	DevaptMixinInputValidationClass.build_class();
	
	
	return DevaptMixinInputValidationClass;
}
);
/**
 * @file        views/mixin-input-association.js
 * @desc        Mixin for datas association input feature for containers
 * @see			DevaptContainer
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-01-04
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/mixin-input-association',['Devapt', 'core/types', 'object/class', 'factory'],
function(Devapt, DevaptTypes, DevaptClass, DevaptFactory)
{
	/**
	 * @mixin				DevaptMixinInputAssociation
	 * @public
	 * @desc				Mixin of methods for datas form features
	 */
	var DevaptMixinInputAssociation = 
	{
		/**
		 * @memberof			DevaptMixinInputAssociation
		 * @public
		 * @desc				Enable/disable trace for mixin operations
		 */
		mixin_trace_input_association: true,
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinInputAssociation
		 * @desc				Get an input tag for the given joined field
		 * @param {object}		arg_deferred			deferred object
		 * @param {object}		arg_field_obj			field definition attributes
		 * @param {string}		arg_value				field value
		 * @param {object}		arg_access				access object: {create:bool,read:bool,update:bool,delete:bool}
		 * @return {object}		jQuery node object
		 */
		get_association_input: function(arg_deferred, arg_field_obj, arg_value, arg_access)
		{
			var self = this;
			var context = 'get_association_input(deferred,field,value,access)';
			self.push_trace(self.trace, DevaptMixinInputAssociation.mixin_trace_input_association);
			self.enter(context, '');
			
			
			// STANDARD INPUT EVENT CALLBACK
			var change_cb = function(event) {
				var event_node_jqo = $(event.target);
				var value_filled = event_node_jqo.data('value_filled');
				var value = event_node_jqo.val();
				
				// ON VALUE CHANGE
				if (value !== value_filled)
				{
					event_node_jqo.data('value_filled', value);
					// console.log(value, 'input changed');
					
					// VALIDATE VALUE
					var validate_status = self.validate_input(arg_field_obj, value);
					if (! validate_status.is_valid)
					{
						event_node_jqo.parent().addClass('devapt_validate_error');
						
						if ( Devapt.has_current_backend() )
						{
							Devapt.get_current_backend().notify_error(validate_status.error_label);
						}
					}
					else
					{
						event_node_jqo.parent().removeClass('devapt_validate_error');
						
						// EMIT CHANGE EVENTS
						self.fire_event('devapt.input.changed', [arg_field_obj, value_filled, value]);
						
						// TODO ON JOIN CHANGE
						// self.on_input_changed(arg_field_obj, value_filled, value);
					}
				}
			};
			
			
			
			
			
			
			// TODO GET PREFERRED INPUT
			// var preferred_inputs_array = arg_field_obj.preferred_inputs;
			
			
			
			
			
			// CREATE MAIN INPUT DIV
			var uid = self.name + '_' + arg_field_obj.name + '_' + Devapt.uid();
			var node_jqo = $('<div id="' + uid + '" style="display:block;float:none;">');
			// console.info(node_jqo, 'get_join_input.node with uid[' + uid + ']');
			
			// var input_jqo = self.get_association_input_set(arg_deferred, node_jqo, arg_field_obj, arg_value, arg_access);
			var input_jqo = self.get_association_input_select(arg_deferred, node_jqo, arg_field_obj, arg_value, arg_access);
			input_jqo.on('change', change_cb);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return node_jqo;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinInputAssociation
		 * @desc				Get an input tag for the given joined field
		 * @param {object}		arg_deferred			deferred object
		 * @param {object}		arg_node_jqo			container node jquery object
		 * @param {object}		arg_field_obj			field definition attributes
		 * @param {string}		arg_value				field value
		 * @param {object}		arg_access				access object: {create:bool,read:bool,update:bool,delete:bool}
		 * @return {object}		jQuery node object
		 */
		get_association_input_select: function(arg_deferred, arg_node_jqo, arg_field_obj, arg_value, arg_access)
		{
			var self = this;
			var context = 'get_association_input_set(deferred,node,field,value,access)';
			self.push_trace(self.trace, DevaptMixinInputAssociation.mixin_trace_input_association);
			self.enter(context, '');
			
			
			var view_name = self.name + '_' + arg_field_obj.name + '_select';
			var view_settings = {
				// role_display:self.role_display,
				// template_enabled:false,
				name:view_name,
				items_autoload:false,
				items_types:'record',
				items_labels:[arg_field_obj.label],
				items_fields:[arg_field_obj.name],
				items_inline:[],
				parent_jqo:arg_node_jqo
			};
			// console.log(self, 'self');
			// var view = DevaptSelect.create(view_name, view_settings);
			var view_promise = Devapt.create('DevaptSelect', view_settings);
			
			
			// GET VALUES PROMISE
			var values_promise = arg_field_obj.get_available_values();
			
			
			// FILL LIST
			values_promise.then(
				function(arg_recordset)
				{
					// console.info('values_promise');
					
					// CHECK RESPONSE STATUS
					if (! arg_recordset.is_ok() )
					{
						// input_jqo.text('Error during fetching');
						console.error('Error during fetching');
						return;
					}
					
					// SET EVENTS HANDLES
					arg_node_jqo.data('value_filled', arg_value);
					
					view_promise.then(
						function(arg_view)
						{
							// console.log(arg_view, 'rendered select');
							arg_view.items_inline = result.get_records();
							arg_view.render(arg_deferred);
						}
					);
					
					// FILL ITEMS
				/*	for(var record_index = 0 ; record_index < result.count ; record_index++)
					{
						var record = result.records[record_index];
						var label = record[arg_field_obj.name];
						var item_jqo = $('<li>');
						
						// APPEND ITEM
						input_jqo.append(item_jqo);
						
						// SET ITEM LABEL
						var a_jqo = $('<a href="#">');
						a_jqo.html(label);
						item_jqo.append(a_jqo);
						
						// HANDLE CLICK ON ITEM
						item_jqo.click(
							function()
							{
								var node_index = parseInt( item_jqo.index() );
								self.on_one_to_many_select(arg_deferred, arg_node_jqo, arg_field_obj, item_jqo, node_index);
							}
						);
						
						// IS SELECTED
						if (label === arg_value)
						{
							if ( item_jqo.attr('selected') )
							{
								item_jqo.attr('selected', '');
							}
						}
					}*/
				}
			);
			// console.log(arg_node_jqo, 'arg_node_jqo');
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return arg_node_jqo;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinInputAssociation
		 * @desc				Get an input tag for the given joined field
		 * @param {object}		arg_deferred			deferred object
		 * @param {object}		arg_node_jqo			container node jquery object
		 * @param {object}		arg_field_obj			field definition attributes
		 * @param {string}		arg_value				field value
		 * @param {object}		arg_access				access object: {create:bool,read:bool,update:bool,delete:bool}
		 * @return {object}		jQuery node object
		 */
		get_association_input_set: function(arg_deferred, arg_node_jqo, arg_field_obj, arg_value, arg_access)
		{
			var self = this;
			var context = 'get_association_input_set(deferred,node,field,value,access)';
			self.push_trace(self.trace, DevaptMixinInputAssociation.mixin_trace_input_association);
			self.enter(context, '');
			
			
			var icon_css = 'width:20px;height:20px;text-align:center;padding:0px';
			
			// var main_div_jqo = $('<div class="row collapse">');
			// var main_div_jqo = $('<div>');
			// node_jqo.append(main_div_jqo);
			// var input_div_icons_jqo = $('<div class="small-3 large-2 columns">');
			
			var table_jqo = $('<table style="margin:0px;padding:0px;">');
			arg_node_jqo.append(table_jqo);
			var tr_jqo = $('<tr style="margin:0px;padding:0px;">');
			table_jqo.append(tr_jqo);
			
			var input_div_icons_jqo = $('<div>');
			var td1_jqo = $('<td style="margin:0px;padding:0px;">');
			tr_jqo.append(td1_jqo);
			td1_jqo.append(input_div_icons_jqo);
			
			var input_jqo = $('<div style="margin:0px;padding:0px;">');
			var td2_jqo = $('<td style="margin:0px;padding:0px;">');
			tr_jqo.append(td2_jqo);
			td2_jqo.append(input_jqo);
			
			// CREATE
			if (arg_access.create)
			{
				var div_jqo = $('<div>');
				var create_jqo = $('<a href="#" class="devapt_icon_small" style="' + icon_css + '">&times;</a>');
				div_jqo.append(create_jqo);
				input_div_icons_jqo.append(div_jqo);
			}
			
			// DELETE
			if (arg_access['delete'])
			{
				var div_jqo = $('<div>');
				var delete_jqo = $('<a href="#" class="devapt_icon_small" style="' + icon_css + '">&plus;</a>');
				div_jqo.append(delete_jqo);
				input_div_icons_jqo.append(div_jqo);
			}
			
			// UPDATE
			if (arg_access.update)
			{
				// GET VALUES PROMISE
				var values_promise = arg_field_obj.get_available_values();
				values_promise.then(
					function(arg_recordset)
					{
						// console.info(arg_recordset, 'get_join_input.promise.arg_recordset');
						
						// CHECK RESPONSE STATUS
						if ( ! arg_recordset.is_ok() )
						{
							input_jqo.text('Error during fetching');
							return;
						}
						
						// CREATE SELECT
						var select_jqo = $('<select style="margin:0px;padding:0px;">');
						input_jqo.append(select_jqo);
						
						// SET EVENTS HANDLES
						select_jqo.data('value_filled', arg_value);
						
						// FILL ITEMS
						var records = arg_recordset.get_records();
						for(var record_index = 0 ; record_index < records.length ; record_index++)
						{
							var record = records[record_index];
							var label = record.get(arg_field_obj.name);
							var option = $('<option>');
							
							select_jqo.append(option);
							
							option.text(label);
							if (label === arg_value)
							{
								option.attr('selected', '');
							}
						}
					}
				);
			}
			else
			{
				// RENDER ITEM
				if ( DevaptTypes.is_not_empty_str(self.items_format) )
				{
					self.step(context, 'items_format is a valid string');
					
					var content = DevaptTemplate.render(self.items_format, tags_object);
					self.render_item_text(arg_deferred, input_jqo, content);
				}
				else
				{
					self.step(context, 'items_format is a not valid string');
					
					var field_value = tags_object[field_name] ? tags_object[field_name] : field_def_obj.field_value.defaults;
					self.render_item_text(arg_deferred, input_jqo, field_value);
				}
			}
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return input_jqo;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinInputAssociation
		 * @desc				Handle a selection on a one to many link
		 * @param {object}		arg_deferred			deferred object
		 * @param {object}		arg_node_jqo			container node jquery object
		 * @param {object}		arg_field_obj			field definition attributes
		 * @param {object}		arg_item_jqo			selected node
		 * @param {integer}		arg_item_index			selected node index
		 * @return {nothing}
		 */
		on_one_to_many_select: function(arg_deferred, arg_node_jqo, arg_field_obj, arg_item_jqo, arg_item_index)
		{
			var self = this;
			var context = 'on_one_to_many_select(deferred,node,field,item,index)';
			self.push_trace(self.trace, DevaptMixinInputAssociation.mixin_trace_input_association);
			self.enter(context, '');
			
			
			// CONTAINER HANDLER
			self.select_item_node(arg_item_index);
			// console.log('on_one_to_many_select');
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return input_jqo;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinInputAssociation
		 * @desc				Get an input tag for the given joined field
		 * @param {object}		arg_deferred			deferred object
		 * @param {object}		arg_node_jqo			container node jquery object
		 * @param {object}		arg_field_obj			field definition attributes
		 * @param {string}		arg_value				field value
		 * @param {object}		arg_access				access object: {create:bool,read:bool,update:bool,delete:bool}
		 * @return {object}		jQuery node object
		 */
		get_association_input_single_list: function(arg_deferred, arg_node_jqo, arg_field_obj, arg_value, arg_access)
		{
			var self = this;
			var context = 'get_association_input_single_list(deferred,node,field,value,access)';
			self.push_trace(self.trace, DevaptMixinInputAssociation.mixin_trace_input_association);
			self.enter(context, '');
			
			
			// CREATE SELECT
			
			
			// CREATE LIST
			var input_jqo = $('<ul>');
			arg_node_jqo.append(self.input_jqo);
			input_jqo.addClass('side-nav');
			
			
			// GET VALUES PROMISE
			var values_promise = arg_field_obj.get_available_values();
			
			
			// FILL LIST
			values_promise.then(
				function(arg_recordset)
				{
					// CHECK RESPONSE STATUS
					if ( ! arg_recordset.is_ok() )
					{
						input_jqo.text('Error during fetching');
						return;
					}
					
					// SET EVENTS HANDLES
					arg_node_jqo.data('value_filled', arg_value);
					
					// FILL ITEMS
					var records = arg_recordset.get_records();
					for(var record_index = 0 ; record_index < records.length ; record_index++)
					{
						var record = records[record_index];
						var label = record.get(arg_field_obj.name);
						var item_jqo = $('<li>');
						
						// APPEND ITEM
						input_jqo.append(item_jqo);
						
						// SET ITEM LABEL
						var a_jqo = $('<a href="#">');
						a_jqo.html(label);
						item_jqo.append(a_jqo);
						
						// HANDLE CLICK ON ITEM
						item_jqo.click(
							function()
							{
								var node_index = parseInt( item_jqo.index() );
								self.on_one_to_many_select(arg_deferred, arg_node_jqo, arg_field_obj, item_jqo, node_index);
							}
						);
						
						// IS SELECTED
						if (label === arg_value)
						{
							if ( item_jqo.attr('selected') )
							{
								item_jqo.attr('selected', '');
							}
						}
					}
				}
			);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return ul_jqo;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-01-04',
			'updated':'2015-01-06',
			'description':'Mixin methods for datas association input feature for containers.'
		}
	};
	
	
	/**
	 * @mixin				DevaptMixinInputAssociationClass
	 * @public
	 * @desc				Mixin of methods for datas form feature for containers
	 */
	var DevaptMixinInputAssociationClass = new DevaptClass('DevaptMixinInputAssociation', null, class_settings);
	
	// METHODS
	DevaptMixinInputAssociationClass.add_public_method('get_association_input', {}, DevaptMixinInputAssociation.get_association_input);
	DevaptMixinInputAssociationClass.add_public_method('get_association_input_select', {}, DevaptMixinInputAssociation.get_association_input_select);
	DevaptMixinInputAssociationClass.add_public_method('get_association_input_set', {}, DevaptMixinInputAssociation.get_association_input_set);
	DevaptMixinInputAssociationClass.add_public_method('on_one_to_many_select', {}, DevaptMixinInputAssociation.on_one_to_many_select);
	
	// BUILD MIXIN CLASS
	DevaptMixinInputAssociationClass.build_class();
	
	
	return DevaptMixinInputAssociationClass;
}
);
/**
 * @file        views/container-mixin-input.js
 * @desc        Mixin for datas input feature for containers
 * @see			DevaptContainer
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-01-03
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/container-mixin-input',['Devapt', 'core/types', 'object/class',
	'views/container/mixin-input-simple', 'views/container/mixin-input-validate', 'views/container/mixin-input-association'],
function(Devapt, DevaptTypes, DevaptClass,
	DevaptMixinInputSimple, DevaptMixinInputValidation, DevaptMixinInputAssociation)
{
	/**
	 * @mixin				DevaptMixinInput
	 * @public
	 * @desc				Mixin of methods for datas form features
	 */
	var DevaptMixinInput = 
	{
		/**
		 * @memberof			DevaptMixinInput
		 * @public
		 * @desc				Enable/disable trace for mixin operations
		 */
		mixin_input_trace: false,
		
		
		/**
		 * @memberof			DevaptMixinInput
		 * @public
		 * @desc				Enable/disable mixin operations
		 */
		mixin_input_enabled: false, // ignored value (see instance value)
		
		
		/**
		 * @memberof			DevaptMixinInput
		 * @public
		 * @desc				Map of HTML input tags
		 */
		// mixin_input_inputs_map: {}, // ignored value (see instance value)
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinInput
		 * @desc				Init mixin
		 * @return {nothing}
		 */
		mixin_input_init: function(self)
		{
			self.push_trace(self.trace, DevaptMixinInput.mixin_input_trace);
			var context = 'mixin_input_init()';
			self.enter(context, '');
			
			
			var inputs = self.get_property('items_input_fields');
			// console.log(inputs, 'inputs');
			self.value(context, 'inputs', inputs);
			
			self.mixin_input_enabled = inputs ? inputs.length > 0 : false;
			// console.log(self.mixin_input_enabled, 'self.mixin_input_enabled');
			self.value(context, 'self.mixin_input_enabled', self.mixin_input_enabled);
			
			if (self.mixin_input_enabled)
			{
				self.step(context, 'is enabled');
				
				if (inputs.length === 1 && inputs[0] === 'all' && self.items_fields && self.items_fields.length > 0)
				{
					self.step(context, 'set input fields');
					
					self.items_input_fields = self.items_fields;
					self.value(context, 'self.items_input_fields', self.items_input_fields);
				}
			}
			// console.log(self.items_input_fields, 'self.items_input_fields');
			// self.mixin_input_inputs_map = {};
			
			
			self.leave(context, '');
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinInput
		 * @desc				Test if the view has input fields
		 * @return {nothing}
		 */
		has_input: function()
		{
			var self = this;
			self.push_trace(self.trace, DevaptMixinInput.mixin_input_trace);
			var context = 'has_input()';
			self.enter(context, '');
			
			self.value(context, 'enabled', self.mixin_input_enabled);
			
			self.leave(context, '');
			self.pop_trace();
			return self.mixin_input_enabled;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinInput
		 * @desc				On input value changed
		 * @param {object}		arg_field_obj			field definition attributes
		 * @param {string}		arg_previous_value		previous field value
		 * @param {string}		arg_new_value			new field value
		 * @return {nothing}
		 */
		on_input_changed: function(arg_field_obj, arg_previous_value, arg_new_value)
		{
			var self = this;
			var context = 'on_input_changed(field, prev value, new value)';
			self.push_trace(self.trace, DevaptMixinInput.mixin_input_trace);
			self.enter(context, '');
			
			
			// VALUE IS NOT CHANGED
			if (arg_previous_value === arg_new_value)
			{
				self.leave(context, 'nothing to do');
				self.pop_trace();
				return;
			}
			
			var promise = self.view_model_promise.then(
				function(arg_view_model)
				{
					return arg_view_model.ready_promise.spread(
						function(arg_model, arg_view)
						{
							self.assert_not_empty_string(context, 'arg_view.items_iterator', arg_view.items_iterator);
							
							switch(arg_view.items_iterator)
							{
								case 'records':
								{
									self.step(context, 'records iterator');
									
									// TODO ?
		//							items = arg_view_model.get_recordset().get_records();
									
									self.step(context, Devapt.msg_default_implementation);
									self.pop_trace();
									return;
								}
								
								case 'fields':
								{
									self.step(context, 'fields iterator');
									
									// GET FIRST RECORD
									var records = arg_view_model.get_recordset().get_records();
									var record = records.length > 0 ? records[0] : null;
									
									if ( ! DevaptTypes.is_object(record) )
									{
										self.step(context, 'current record is not found');
										self.pop_trace();
										return;
									}
									
									record.set(arg_field_obj.name, arg_new_value);
									record.save();
									
									self.record_updated(record);
									
									break;
								}
								
								case 'field_editor':
								{
									self.step(context, 'field_editor iterator');
									
		//							self.assert_not_empty_array(context, 'arg_view.items_fields', arg_view.items_fields);
		//							self.assert_object(context, 'self.edited_field', self.edited_field);
									
									// TODO ?
									
									self.step(context, Devapt.msg_default_implementation);
									self.pop_trace();
									return;
								}
							}
						}
					);
				}
			);
			promise = null; // UNUSED VARIABLE
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinInput
		 * @desc				Get an input tag for the given field
		 * @param {object}		arg_deferred			deferred object
		 * @param {object}		arg_field_orig			field definition attributes
		 * @param {object}		arg_field_custom		custom field attributes
		 * @param {string}		arg_value				field value
		 * @param {boolean}		arg_render_label		should render an input label?
		 * @param {object}		arg_access				access object: {create:bool,read:bool,update:bool,delete:bool}
		 * @return {object}		jQuery node object
		 */
		get_input: function(arg_deferred, arg_field_orig, arg_field_custom, arg_value, arg_render_label, arg_access)
		{
			var self = this;
			var context = 'get_input(field, value)';
			self.push_trace(self.trace, DevaptMixinInput.mixin_input_trace);
			self.enter(context, '');
			
			
			// INIT HAS LABEL
			arg_render_label = !! (arg_render_label ? arg_render_label : false);
			
			// TEST ENABLED
			if ( ! self.mixin_input_enabled )
			{
				self.leave(context, Devapt.msg_success);
				self.pop_trace();
				return null;
			}
			
			
			// INIT INPUT VALUE
			var value_str = DevaptTypes.to_string(arg_value, '');
			var node_jqo = null;
			
			
			// GET FIELD ATTRIBUTES OBJECT
			self.assert_object(context, 'field definition', arg_field_orig);
			var field_obj = arg_field_orig;
			if ( DevaptTypes.is_object(arg_field_custom) )
			{
				field_obj = window.$.extend(true, self.clone_object(arg_field_orig), arg_field_custom);
			}
			
			
			// GET BACKEND INPUT
			var backend_input_jqo = Devapt.has_current_backend() ? Devapt.get_current_backend().get_input(self, field_obj, value_str) : null;
			if (backend_input_jqo)
			{
				self.step(context, 'input is found in current backend');
				
				self.leave(context, Devapt.msg_success);
				self.pop_trace();
				return backend_input_jqo;
			}
			
			
			// GET JOINED INPUT
			if ( field_obj.has_association() )
			{
				self.step(context, 'input field has foreign or join link');
				
				node_jqo = self.get_association_input(arg_deferred, field_obj, value_str, arg_access);
				
				self.leave(context, Devapt.msg_success);
				self.pop_trace();
				return node_jqo; 
			}
			
			
			// GET STANDARD INPUT
			var type_str = DevaptTypes.to_string(field_obj.field_value.type, 'string').toLocaleLowerCase();
			switch(type_str)
			{
				case 'password':
					self.step(context, 'switch password field case');
					node_jqo = self.get_password_input(field_obj, value_str);
					break;
				default:
					self.step(context, 'switch default field case');
					self.step(context, 'input field has foreign or join link');
					node_jqo = self.get_simple_input(field_obj, value_str);
					break;
			}
			
			
			// SET LABEL
			if ( arg_render_label && node_jqo && DevaptTypes.is_not_empty_str(field_obj.label) )
			{
				self.step(context, 'field has label');
				
				var div_jqo = window.$('<div>');
				if ( ! DevaptTypes.is_not_empty_str( node_jqo.attr('id') ) )
				{
					self.step(context, 'set node id');
					node_jqo.attr('id', field_obj.name + '_input_' + self.get_view_id());
				}
				
				var label_jqo = window.$('<label for="' + node_jqo.attr('id') + '">');
				label_jqo.text(field_obj.label);
				div_jqo.append(label_jqo);
				div_jqo.append(node_jqo);
				
				self.leave(context, Devapt.msg_success);
				self.pop_trace();
				return div_jqo;
			}
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
			return node_jqo;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-08-23',
			'updated':'2015-05-08',
			'description':'Mixin methods for datas form feature for containers.'
		}
	};
	
	
	/**
	 * @mixin				DevaptMixinInputClass
	 * @public
	 * @desc				Mixin of methods for datas form feature for containers
	 */
	var DevaptMixinInputClass = new DevaptClass('DevaptMixinInput', null, class_settings);
	
	// METHODS
	DevaptMixinInputClass.infos.ctor = DevaptMixinInput.mixin_input_init;
	DevaptMixinInputClass.add_public_method('has_input', {}, DevaptMixinInput.has_input);
	DevaptMixinInputClass.add_public_method('on_input_changed', {}, DevaptMixinInput.on_input_changed);
	DevaptMixinInputClass.add_public_method('get_input', {}, DevaptMixinInput.get_input);
	
	// MIXINS
	DevaptMixinInputClass.add_public_mixin(DevaptMixinInputSimple);
	DevaptMixinInputClass.add_public_mixin(DevaptMixinInputValidation);
	DevaptMixinInputClass.add_public_mixin(DevaptMixinInputAssociation);
	
	// BUILD MIXIN CLASS
	DevaptMixinInputClass.build_class();
	
	
	return DevaptMixinInputClass;
}
);
/**
 * @file        views/container/container-mixin-items.js
 * @desc        Mixin for container items operations
 * 				API
 * 					->mixin_item_init(self): init mixin attributes (nothing)
 * 					->new_item(settings): Create an empty container item or an item with given attributes (plain object)
 * 					->update_item_type(arg_container_item): Update a container item type and content with predefined values (boolean)
 * 					
 * 					->append_item(arg_container_item): Append a container item to the container collection (boolean)
 * 					->insert_item(arg_container_item): Insert a container item into the container collection at the given index (boolean)
 * 					->remove_item(arg_container_item): Remove a container item from the container collection (boolean)
 * 					->render_item(arg_container_item): Render the container item content into the view for the first time (promise object)
 * 					->update_item(arg_container_item): Update the view with the container item content (boolean)
 * 					
 * 					->get_item_by_index(arg_index): Get an existing container item with its index (plain object)
 * 					->get_item_by_id(arg_id): Get an existing container item with its id (plain object)
 * @see			DevaptContainers
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-06-23
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/container-mixin-items',['Devapt', 'core/types', 'object/class'],
function(Devapt, DevaptTypes, DevaptClass)
{
	/**
	 * @mixin				DevaptMixinItems
	 * @public
	 * @desc				Mixin for container items operations
	 */
	var DevaptMixinItems = 
	{
		/**
		 * @public
		 * @memberof			DevaptMixinItems
		 * @desc				Init mixin
		 * @param {object}		self		Container instance
		 * @return {nothing}
		 */
		mixin_items_init: function(self)
		{
			var context = 'mixin_items_init(self)';
			self.enter(context, '');
			
			
			self.mixin_items_collection_by_index = [];
			self.mixin_items_collection_by_id = {};
			
			
			self.leave(context, Devapt.msg_success);
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinItems
		 * @desc				Create an empty container item or an item with given attributes
		 * @param {object}		arg_settings		A plain object of item attributes (optional)
		 * @return {object}		A plain object
		 */
		new_item: function(arg_settings)
		{
			var self = this;
			var context = 'new_item(settings)';
			self.enter(context, '');
			
			
			var container_item = {
				is_container_item:true,
				
				id:null,
				index: null,
				item_type: null,
				
				is_active:false,
				is_selected:false,
				
				position: false, // UNUSED
				width: false, // UNUSED
				heigth: false, // UNUSED
				
				node: null,
				content: null
			};
			
			if (DevaptTypes.is_plain_object(arg_settings))
			{
				container_item = window.$.extend({}, container_item, arg_settings);
			}
			
			
			self.leave(context, Devapt.msg_success);
			return container_item;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinItems
		 * @desc				Update a container item type and content with predefined values
		 * @param {object}		arg_container_item		A plain object of a container item
		 * @return {boolean}
		 */
		update_item_type: function(arg_container_item)
		{
			var self = this;
			var context = 'update_item_type(item)';
			self.enter(context, '');
			
			
			// CHECK ARGS
			self.assert_object(context, 'item', arg_container_item);
			self.assert_true(context, 'item.is_container_item', arg_container_item.is_container_item);
			
			// DIVIDER
			if (arg_container_item.content === 'divider')
			{
				arg_container_item.item_type = 'divider';
			}
			
			// VIEW
			else if ( arg_container_item.item_type === 'view' && DevaptTypes.is_object(arg_container_item.content) && arg_container_item.content.value )
			{
				arg_container_item.content = arg_container_item.content.value;
			}
			
			// NO GIVEN TYPES
			else if ( DevaptTypes.is_null(arg_container_item.item_type) )
			{
				if ( DevaptTypes.is_array(arg_container_item.content) )
				{
					arg_container_item.item_type = 'array';
				}
				else if ( DevaptTypes.is_plain_object(arg_container_item.content) )
				{
					arg_container_item.item_type = 'plain_object';
				}
				else if ( DevaptTypes.is_object(arg_container_item.content) && arg_container_item.content.is_record )
				{
					arg_container_item.item_type = 'DevaptRecord';
				}
				else
				{
					self.leave(context, Devapt.msg_failure);
					return false;
				}
			}
			
			
			self.leave(context, Devapt.msg_success);
			return true;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinItems
		 * @desc				Append a container item to the container collection
		 * @param {object}		arg_container_item		A plain object of a container item
		 * @return {boolean}
		 */
		append_item: function(arg_container_item)
		{
			var self = this;
			var context = 'append_item(item)';
			self.enter(context, '');
			
			
			// CHECK ARGS
			self.assert_object(context, 'item', arg_container_item);
			self.assert_true(context, 'item.is_container_item', arg_container_item.is_container_item);
			
			// UPDATE TYPE
			if (! self.update_item_type(arg_container_item) )
			{
				self.leave(context, Devapt.msg_failure);
				return false;
			}
			
			// CHECK AND UPDATE ID
			if (! arg_container_item.id)
			{
				arg_container_item.id = 'id_' + Devapt.uid();
			}
			if (arg_container_item.id in self.mixin_items_collection_by_id)
			{
				self.leave(context, Devapt.msg_failure);
				return false;
			}
			
			// CHECK AND UPDATE INDEX
			arg_container_item.index = self.mixin_items_collection_by_index.length;
			self.assert_true(context, 'array.length === map.length', self.mixin_items_collection_by_index.length === self.mixin_items_collection_by_index.length);
			
			// APPEND ITEM IN ITEMS COLLECTION
			self.mixin_items_collection_by_index.push(arg_container_item);
			// self.items_records_count = self.items_records.length;
			self.mixin_items_collection_by_id[arg_container_item.id] = arg_container_item;
			
			
			self.leave(context, Devapt.msg_success);
			return true;
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinItems
		 * @desc				Insert a container item into the container collection at the given index
		 * @param {object}		arg_container_item		A plain object of a container item
		 * @return {boolean}
		 */
		insert_item: function(arg_container_item)
		{
			var self = this;
			var context = 'insert_item(item)';
			self.enter(context, '');
			
			
			// CHECK ARGS
			self.assert_object(context, 'item', arg_container_item);
			self.assert_true(context, 'item.is_container_item', arg_container_item.is_container_item);
			self.assert_not_empty_string(context, 'item.id', arg_container_item.id);
			self.assert_integer(context, 'item.index', arg_container_item.index);
			self.assert_true(context, 'item index >= 0', arg_container_item.index >= 0);
			
			// APPEND AT END
			if (arg_container_item.index >= self.mixin_items_collection_by_index.length)
			{
				self.leave(context, Devapt.msg_success);
				return self.append_item(arg_container_item);
			}
			
			// UPDATE TYPE
			if (! self.update_item_type(arg_container_item) )
			{
				self.leave(context, Devapt.msg_failure);
				return false;
			}
			
			// CHECK AND UPDATE ID
			if (! arg_container_item.id)
			{
				arg_container_item.id = 'id_' + Devapt.uid();
			}
			if (arg_container_item.id in self.mixin_items_collection_by_id)
			{
				self.leave(context, Devapt.msg_failure);
				return false;
			}
			
			// INSERT ITEM INTO ITEMS COLLECTION
			var split_index = arg_container_item.index -1;
			var begin = self.mixin_items_collection_by_index.slice(0, split_index);
			var end = self.mixin_items_collection_by_index.slice(split_index);
			begin.push(arg_container_item);
			self.mixin_items_collection_by_index = begin.concat(end);
			self.mixin_items_collection_by_id[arg_container_item.id] = arg_container_item;
			
			// UPDATE ITEM INDEX
			var loop_index = split_index;
			while(loop_index < self.mixin_items_collection_by_index.length)
			{
				self.mixin_items_collection_by_index[loop_index].index = loop_index;
				++loop_index;
			}
			
			
			self.leave(context, Devapt.msg_success);
			return true;
		},
		
		
		
		/**
		 * @public
		 * @memberof				DevaptMixinItems
		 * @desc					Render the container item content into the view for the first time
		 * @param {plain object}	arg_container_item		A plain object of a container item
		 * @return {promise object}
		 */
		render_item: function(arg_container_item)
		{
			var self = this;
			var context = 'render_item(item)';
			self.enter(context, '');
			
			
			// CHECK ARGS
			// console.debug(arg_container_item, context + '.arg_container_item');
			// console.debug(arg_container_item.index, context + '.arg_container_item.index');
			self.assert_object(context, 'item', arg_container_item);
			self.assert_true(context, 'item.is_container_item', arg_container_item.is_container_item);
			self.assert_not_empty_string(context, 'item.id', arg_container_item.id);
			self.assert_integer(context, 'item.index', arg_container_item.index);
			self.assert_true(context, 'item index >= 0', arg_container_item.index >= 0);
			
			var arg_deferred = Devapt.defer();
			var node_jqo = arg_container_item.node;
			var arg_item_content = arg_container_item.content;
			
			// FILL ITEM NODE
			switch(arg_container_item.item_type)
			{
				case 'divider':
				{
					if ( ! self.has_divider )
					{
						self.leave(context, 'bad divider item');
						return false;
					}
					self.assert_function(context, 'self.render_item_divider', self.render_item_divider);
					node_jqo = self.render_item_divider(arg_deferred, node_jqo, arg_item_content);
					break;
				}
				case 'html':
				{
					self.assert_function(context, 'self.render_item_html', self.render_item_html);
					node_jqo = self.render_item_html(arg_deferred, node_jqo, arg_item_content);
					break;
				}
				case 'text':
				{
					self.assert_function(context, 'self.render_item_text', self.render_item_text);
					// console.log(node_jqo, context + ':node_jqo text before:' + self.name + ' for ' + arg_item_content);
					node_jqo = self.render_item_text(arg_deferred, node_jqo, arg_item_content);
					// console.log(node_jqo, context + ':node_jqo text after:' + self.name + ' for ' + arg_item_content);
					break;
				}
				case 'view':
				{
					self.step(context, 'render a view');
					self.value(context, 'arg_item_content', arg_item_content);
					
					try
					{
						self.assert_function(context, 'self.render_item_view', self.render_item_view);
						
						var view_promise = self.render_item_view(arg_deferred, node_jqo, arg_item_content);
						// console.log(node_jqo, context + ':node_jqo view after:' + self.name + ' for ' + arg_item_content);
					}
					catch(e)
					{
						console.error(e, context + ':view');
					}
					
					break;
				}
				case 'record':
				case 'object':
				{
					self.assert_function(context, 'self.render_item_object', self.render_item_object);
					arg_item_content.container_item_index = arg_container_item.index;
					node_jqo = self.render_item_object(arg_deferred, node_jqo, arg_item_content);
					break;
				}
				case 'array':
				{
					self.assert_function(context, 'self.render_item_array', self.render_item_array);
					
					// ITEM RECORD
					var values_array = arg_item_content;
					if ( DevaptTypes.is_string(arg_item_content) )
					{
						values_array = arg_item_content.split('|', arg_item_content);
					}
					
					if ( ! DevaptTypes.is_array(values_array) )
					{
						break;
					}
					
					node_jqo = self.render_item_array(arg_deferred, node_jqo, values_array);
					break;
				}
				case 'callback':
				{
					self.assert_function(context, 'self.render_item_callback', self.render_item_callback);
					node_jqo = self.render_item_callback(arg_deferred, node_jqo, arg_item_content);
					break;
				}
				default:
				{
					self.error('bad item type [' + arg_container_item.item_type + '] for [' + self.name + ']');
					self.leave(context, Devapt.msg_failure);
					return Devapt.promise_rejected();
				}
			}
			
			arg_container_item.node = node_jqo;
			
			self.leave(context, Devapt.msg_success);
			return Devapt.promise_resolved();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinItems
		 * @desc				Remove a container item from the container collection
		 * @param {object}		arg_container_item		A plain object of a container item
		 * @return {boolean}
		 */
		remove_item: function(arg_container_item)
		{
			var self = this;
			var context = 'remove_item(item)';
			self.enter(context, '');
			// TODO
			self.leave(context, Devapt.msg_success);
			return true;
		},
		
		
		
		/* --------------------------------------------- LOOKUP OPERATIONS ------------------------------------------------ */
		
		/**
		 * @public
		 * @memberof			DevaptMixinItems
		 * @desc				Get an existing container item with its index
		 * @param {integer}		arg_index		A container index
		 * @return {plain object}
		 */
		get_item_by_index: function(arg_index)
		{
			var self = this;
			var context = 'get_item_by_index(index)';
			self.enter(context, '');
			
			
			// CHECK ARGS
			self.assert_integer(context, 'arg_index', arg_index);
			self.assert_true(context, 'arg_index >= 0', arg_index >= 0);
			self.assert_true(context, 'arg_index < length', arg_index < self.mixin_items_collection_by_index.length);
			
			// LOOKUP ITEM IN ITEMS COLLECTION
			var container_item = self.mixin_items_collection_by_index[arg_index];
			
			
			self.leave(context, Devapt.msg_found);
			return container_item;
		},
		
		/**
		 * @public
		 * @memberof			DevaptMixinItems
		 * @desc				Get an existing container item with its id
		 * @param {string}		arg_id		A container item unique identifier
		 * @return {plain object}
		 */
		get_item_by_id: function(arg_id)
		{
			var self = this;
			var context = 'get_item_by_id(id)';
			self.enter(context, '');
			
			
			// CHECK ARGS
			self.assert_not_empty_string(context, 'arg_id', arg_id);
			self.assert_true(context, 'arg_id is map key', arg_id in self.mixin_items_collection_by_id);
			
			// LOOKUP ITEM IN ITEMS COLLECTION
			var container_item = self.mixin_items_collection_by_id[arg_id];
			
			
			self.leave(context, Devapt.msg_found);
			return container_item;
		},
		
		/**
		 * @public
		 * @memberof			DevaptMixinItems
		 * @desc				Get an existing container item with its id
		 * @param {string}		arg_id		A container item unique identifier
		 * @return {plain object}
		 */
		get_item_by_label: function(arg_label)
		{
			var self = this;
			var context = 'get_item_by_id(label)';
			self.enter(context, '');
			
			
			// CHECK ARGS
			self.assert_not_empty_string(context, 'arg_label', arg_label);
			
			// LOOKUP ITEM IN ITEMS COLLECTION
			var loop_index = 0;
			var loop_item = null;
			var loop_label = null;
			while(loop_index < self.mixin_items_collection_by_index.length)
			{
				loop_item = self.mixin_items_collection_by_index[loop_index];
				loop_label = self.get_item_node_text(loop_item.node);
				if (arg_label === loop_label)
				{
					self.leave(context, Devapt.msg_found);
					return loop_item;
				}
				++loop_index;
			}
			
			
			self.leave(context, Devapt.msg_not_found);
			return null;
		}
	};
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-06-23',
			'updated':'2015-06-23',
			'description':'Mixin for container items operations.'
		}
	};
	var DevaptMixinItemsClass = new DevaptClass('DevaptMixinItems', null, class_settings);
	
	// METHODS
	DevaptMixinItemsClass.infos.ctor = DevaptMixinItems.mixin_items_init;
	DevaptMixinItemsClass.add_public_method('new_item', {}, DevaptMixinItems.new_item);
	DevaptMixinItemsClass.add_public_method('update_item_type', {}, DevaptMixinItems.update_item_type);
	
	DevaptMixinItemsClass.add_public_method('append_item', {}, DevaptMixinItems.append_item);
	DevaptMixinItemsClass.add_public_method('insert_item', {}, DevaptMixinItems.insert_item);
	DevaptMixinItemsClass.add_public_method('render_item', {}, DevaptMixinItems.render_item);
	DevaptMixinItemsClass.add_public_method('remove_item', {}, DevaptMixinItems.remove_item);
	
	DevaptMixinItemsClass.add_public_method('get_item_by_index', {}, DevaptMixinItems.get_item_by_index);
	DevaptMixinItemsClass.add_public_method('get_item_by_id', {}, DevaptMixinItems.get_item_by_id);
	DevaptMixinItemsClass.add_public_method('get_item_by_label', {}, DevaptMixinItems.get_item_by_label);
	
	// PROPERTIES
	
	// BUILD MIXIN CLASS
	DevaptMixinItemsClass.build_class();
	
	
	return DevaptMixinItemsClass;
}
);
/**
 * @file        views/mixin-crud.js
 * @desc        Mixin for container CRUD operations
 *				API
 * 					->mixin_init_crud(self): mixin constructor, nothing to do (nothing)
 * 					
 * 					->record_created(record): A record is created and the view should be created (nothing)
 * 					->record_updated(record): A record is updated and the view should be updated (nothing)
 * 					->record_deleted(record): A record is deleted and the view should be deleted (nothing)
 * 					
 * @see			DevaptContainer
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-06-20
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/container/container-mixin-crud',['Devapt', 'core/types', 'object/class'],
function(Devapt, DevaptTypes, DevaptClass)
{
	/**
	 * @mixin				DevaptMixinCrud
	 * @public
	 * @desc				Mixin of methods for container get nodes features
	 */
	var DevaptMixinCrud = 
	{
		/**
		 * @memberof			DevaptMixinCrud
		 * @public
		 * @desc				Enable/disable trace for mixin operations
		 */
		mixin_trace_crud: false,
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinCrud
		 * @desc				Init mixin
		 * @return {nothing}
		 */
		mixin_init_crud: function(self)
		{
			self.push_trace(self.trace, DevaptMixinCrud.mixin_trace_crud);
			var context = 'mixin_init_crud()';
			self.enter(context, '');
			
			
			
			
			self.leave(context, '');
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinCrud
		 * @desc				A record is created and the view should be updated
		 * @param {object}		arg_record	Record object
		 * @return {nothing}
		 */
		record_created: function(arg_record)
		{
			var self = this;
			var context = 'record_created(record)';
			self.push_trace(self.trace, DevaptMixinCrud.mixin_trace_crud);
			self.enter(context, '');
			
			
			// FIRE EVENT
			self.fire_event('devapt.container.record_created', [arg_record]);
			
			// NOTIFY USER
			if (self.notify_on_record_created && DevaptTypes.is_not_empty_string(self.notify_on_record_created_msg))
			{
				Devapt.get_current_backend().notify_info(self.notify_on_record_created_msg);
			}
			
			// APPEND RECORD TO THE CONTAINER
			self.append_item(arg_record.datas, 'object');
			var item_index = self.items_records.length - 1;
			var item_jqo = self.items_objects[item_index];
			
			// SELECT NEW RECORD
			self.view_model_promise.then(
				function(arg_view_model)
				{
					var selected_item = { index:item_index, record:arg_record, node_jqo:item_jqo };
					arg_view_model.set_selected_records([selected_item]);
				}
			);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinCrud
		 * @desc				A record is updated and the view should be updated
		 * @return {nothing}
		 */
		record_updated: function(arg_record)
		{
			var self = this;
			var context = 'record_updated(record)';
			self.push_trace(self.trace, DevaptMixinCrud.mixin_trace_crud);
			self.enter(context, '');
			
			
			// FIRE EVENT
			self.fire_event('devapt.container.record_updated', [arg_record]);
			
			// NOTIFY USER
			if (self.notify_on_record_updated && DevaptTypes.is_not_empty_string(self.notify_on_record_updated_msg))
			{
				Devapt.get_current_backend().notify_info(self.notify_on_record_updated_msg);
			}
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinCrud
		 * @desc				A record is deleted and the view should be updated
		 * @return {nothing}
		 */
		record_deleted: function(arg_record)
		{
			var self = this;
			var context = 'record_deleted(record)';
			self.push_trace(self.trace, DevaptMixinCrud.mixin_trace_crud);
			self.enter(context, '');
			
			
			// FIRE EVENT
			self.fire_event('devapt.container.record_deleted', [arg_record]);
			
			// NOTIFY USER
			if (self.notify_on_record_deleted && DevaptTypes.is_not_empty_string(self.notify_on_record_deleted_msg))
			{
				Devapt.get_current_backend().notify_info(self.notify_on_record_deleted_msg);
			}
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinCrud
		 * @desc				A record is created and the view should be updated
		 * @return {nothing}
		 */
		on_record_created: function(arg_record)
		{
			var self = this;
			var context = 'on_record_created(record)';
			self.push_trace(self.trace, DevaptMixinCrud.mixin_trace_crud);
			self.enter(context, '');
			
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinCrud
		 * @desc				A record is updated and the view should be updated
		 * @return {nothing}
		 */
		on_record_updated: function(arg_record)
		{
			var self = this;
			var context = 'on_record_updated(record)';
			self.push_trace(self.trace, DevaptMixinCrud.mixin_trace_crud);
			self.enter(context, '');
			
			
			// CHECK ARGS
			if ( DevaptTypes.is_array(arg_record) )
			{
				if (arg_record.length > 0)
				{
					arg_record = arg_record[0];
				}
				else
				{
					arg_record = null;
				}
			}
			
			
			// UPDATE ITEM
			var defer = Devapt.defer();
			var item_jqo = self.get_node_by_record(arg_record);
			var datas_object = arg_record.is_record ? arg_record.datas : arg_record;
			
			self.render_item_object(defer, item_jqo, datas_object, true);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinCrud
		 * @desc				A record is deleted and the view should be updated
		 * @return {nothing}
		 */
		on_record_deleted: function(arg_record)
		{
			var self = this;
			var context = 'on_record_deleted(record)';
			self.push_trace(self.trace, DevaptMixinCrud.mixin_trace_crud);
			self.enter(context, '');
			
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinCrud
		 * @desc				A request is received about a record creation
		 * @return {nothing}
		 */
		on_create_request: function()
		{
			var self = this;
			var context = 'on_create_request()';
			self.push_trace(self.trace, DevaptMixinCrud.mixin_trace_crud);
			self.enter(context, '');
			
			
			console.info(self.name + '.' + context);
			
			var record_promise = self.view_model_promise.then(
				function(arg_view_model)
				{
					self.step(context, 'view_model is found and create record');
					
					var recordset = arg_view_model.get_recordset()
					var record = recordset.new_record();
					record = recordset.init_record(record);
					return record;
				}
			);
			
			record_promise.then(
				function(record)
				{
					self.record_created(record);
				}
			);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
		},
		
		
		
		/**
		 * @public
		 * @memberof			DevaptMixinCrud
		 * @desc				A request is received about a record deletion
		 * @return {nothing}
		 */
		on_delete_request: function()
		{
			var self = this;
			var context = 'on_delete_request()';
			self.push_trace(self.trace, DevaptMixinCrud.mixin_trace_crud);
			self.enter(context, '');
			
			
			console.info(self.name + '.' + context);
			
			// // UPDATE ITEM
			// var defer = Devapt.defer();
			// var item_jqo = self.get_node_by_record(arg_record);
			// var datas_object = arg_record.is_record ? arg_record.datas : arg_record;
			
			// self.render_item_object(defer, item_jqo, datas_object, true);
			
			
			self.leave(context, Devapt.msg_success);
			self.pop_trace();
		}
	};
	
	
	
	/* --------------------------------------------- CREATE MIXIN CLASS ------------------------------------------------ */
	
	// MIXIN CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-06-20',
			'updated':'2015-06-20',
			'description':'Mixin methods for container CRUD operations.'
		}
	};
	
	
	/**
	 * @mixin				DevaptMixinCrudClass
	 * @public
	 * @desc				Mixin methods for container CRUD operations
	 */
	var DevaptMixinCrudClass = new DevaptClass('DevaptMixinCrud', null, class_settings);
	
	// METHODS
	DevaptMixinCrudClass.infos.ctor = DevaptMixinCrud.mixin_init_crud;
	DevaptMixinCrudClass.add_public_method('record_created', {}, DevaptMixinCrud.record_created);
	DevaptMixinCrudClass.add_public_method('record_updated', {}, DevaptMixinCrud.record_updated);
	DevaptMixinCrudClass.add_public_method('record_deleted', {}, DevaptMixinCrud.record_deleted);
	
	DevaptMixinCrudClass.add_public_method('on_record_created', {}, DevaptMixinCrud.on_record_created);
	DevaptMixinCrudClass.add_public_method('on_record_updated', {}, DevaptMixinCrud.on_record_updated);
	DevaptMixinCrudClass.add_public_method('on_record_deleted', {}, DevaptMixinCrud.on_record_deleted);
	
	DevaptMixinCrudClass.add_public_method('on_create_request', {}, DevaptMixinCrud.on_create_request);
	DevaptMixinCrudClass.add_public_method('on_delete_request', {}, DevaptMixinCrud.on_delete_request);
	
	// PROPERTIES
	DevaptMixinCrudClass.add_public_bool_property('notify_on_record_created',	'Enable or disable user notification on record creation.',	true, false, false, []);
	DevaptMixinCrudClass.add_public_bool_property('notify_on_record_updated',	'Enable or disable user notification on record update',		true, false, false, []);
	DevaptMixinCrudClass.add_public_bool_property('notify_on_record_deleted',	'Enable or disable user notification on record delete.',	true, false, false, []);
	
	DevaptMixinCrudClass.add_public_str_property('notify_on_record_created_msg',	'User notification message on record creation.',	'A record is created.', false, false, []);
	DevaptMixinCrudClass.add_public_str_property('notify_on_record_updated_msg',	'User notification message on record update',		'A record is updated.', false, false, []);
	DevaptMixinCrudClass.add_public_str_property('notify_on_record_deleted_msg',	'User notification message on record delete.',		'A record is deleted.', false, false, []);
	
	DevaptMixinCrudClass.build_class();
	
	
	return DevaptMixinCrudClass;
}
);
/**
 * @file        views/container.js
 * @desc        Container view base class (rendering, selection, view model, pagination, filtering, crud, input)
 *				API:
 *					INHERITS: View
 * 
 *					SETTINGS:
 *						SOURCE OF DATAS
 *							items_source: select the source of the datas ("inline", "model")
 *							items_source_format: select the format of the datas ("json", "array")
 *						INLINE DATA SOURCE SETTINGS:
 *							items_inline: set the items datas
 *						DATAS COMMON SETTINGS
 *							items_options: set the items options (item1_opt1=...|item1_opt2=...,item2_opt1=...|item2_opt2=...)
 *							items_labels: set the items labels as a string "item1_label,item2_label,item3_label)
 *							items_types: set the items types as a string "item1_type,item2_type,item3_type)
 *						RECORDS DATA SETTINGS
 *							items_records_fields_names:
 *							items_records_fields_types:
 *						MODEL DATA SOURCE SETTINGS:
 *							items_model_obj
 *							items_query_json
 *							items_query_filters
 *							items_query_slice
 * 
 *					EVENTS:
 *						    devapt.container.refresh.begin: emitted on container refresh processing start
 *						    devapt.container.refresh.items_removed: emitted on items removed on container refresh
 *						    devapt.container.refresh.items_rendered: emitted on items rendered on container refresh
 *						    devapt.container.refresh.end: emitted on container render processing end
 * 
 *						    devapt.container.render.begin: emitted on container render processing start items_rendered
 *						    devapt.container.render.item: emitted on item render processing
 *						    devapt.container.render.end: emitted on container render processing end
 * 
 * 					METHODS:
 * 						->get_item_node(index): Look up a container item node by its index (jQuery node or null if not found)
 * 						->constructor(self): Build the class instance attributes (nothing)
 * 						->refresh(): Update container items (promise)
 * 						->render_end(): End the render of the container (nothing)
 * 						->render_content_self(): Render view self content (promise)
 * 						->render_items(): Render view items (promise)
 * 						->fill_items(): Fill view items for fields iterator (promise)
 * 						->to_string_self(): Dump the object to a string (string)
 * 
 * @ingroup     DEVAPT_VIEWS
 * @date        2014-05-10
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define( 'views/container',[
	'Devapt', 'core/types', 'object/class',
	'views/view', 'views/view/view-mixin-bind',
	'datas/model/view_model',
	'views/container/container-mixin-selectable',
	'views/container/container-mixin-filtered', 'views/container/container-mixin-pagination',
	'views/container/container-mixin-render-item', 'views/container/container-mixin-get-nodes',
	'views/container/container-mixin-utils',
	'views/container/container-mixin-input', 'views/container/container-mixin-items', /*'views/container/container-mixin-model-crud',*/ 'views/container/container-mixin-crud'],
function(
	Devapt, DevaptTypes, DevaptClass,
	DevaptView, DevaptMixinBind,
	DevaptViewModel,
	DevaptContainerMixinSelectable,
	DevaptMixinFiltered, DevaptMixinPagination,
	DevaptMixinRenderItem, DevaptMixinGetNodes,
	DevaptMixinContainerUtils,
	DevaptMixinInput, DevaptMixinItems, /*DevaptMixinModelCrud,*/ DevaptMixinCrud)
{
	/**
	 * @public
	 * @class				DevaptContainer
	 * @desc				Container view base class (rendering, selection, view model, pagination, filtering, crud, input)
	 */
	
	
	var $ = window.$;
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @desc				Look up a container item node by its index and returns a jQuery node or null if not found
	 * @param {integer}		arg_item_index		item index
	 * @return {object}		jQuery node object
	 */
	var cb_get_item_node = function(arg_item_index)
	{
		var self = this;
		var context = 'get_item_node(' + arg_item_index + ')';
		self.enter(context, '');
		
		
		var items_count = $(self.items_jquery_filter, self.items_jquery_parent).length;
		if (arg_item_index < 0 || arg_item_index >= items_count)
		{
			self.leave(context, Devapt.msg_failure);
			return null;
		}
		
		var node_jqo = $(self.items_jquery_filter, self.items_jquery_parent).eq(arg_item_index);
		// console.log(node_jqo, 'cb_get_item_node at [' + arg_item_index + ']');
		
		self.leave(context, Devapt.msg_success);
		return node_jqo;
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// DEBUG
//		self.trace = true;
		
		// CONSTRUCTOR BEGIN
		var context = 'DevaptContainer.contructor(' + self.name + ')';
		self.enter(context, '');
		
		
		// INIT CONTAINER ATTRIBUTES
		self.is_container			= true;
		self.items_objects			= [];
		self.has_divider			= true;
		self.is_rendering			= false;
		self.renders_count			= 0;
		self.items_jquery_parent	= null;
		self.items_jquery_filter	= null;
		
		
		// SET VIEW MODEL
		if ( ! DevaptTypes.is_object(self.view_model_promise) || ! (Devapt.is_promise(self.view_model_promise) || self.view_model_promise.is_view_model) )
		{
			self.step(context, 'set view model');
			var view_model_settings = {
				name:self.name + '_view_model',
				model_name:self.items_model_name,
				view:self,
				source:self.items_source,
				source_format:self.items_source_format};
			self.view_model_promise = Devapt.create('ViewModel', view_model_settings);
			self.view_model_promise.get('ready_promise').spread(
				function(arg_model, arg_view)
				{
					self.items_model_obj = arg_model;
				}
			);
		}
		
		
		// CONSTRUCTOR END
		self.leave(context, Devapt.msg_success);
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @desc				Refresh of the container
	 * @return {object}		rendering promise
	 */
	var cb_refresh = function()
	{
		var self = this;
		var context = 'refresh()';
		self.enter(context, '');
		
		
		// NOTHING TO DO : ALREADY IN RENDERING PROCESS
		if ( self.is_render_state_rendering() )
		{
			self.leave(context, 'already in rendering mode');
			return Devapt.promise_resolved();
		}
		
		
		// BEGIN REFRESH PROCESS
		self.fire_event('devapt.container.refresh.begin');
		
		
		// TEST IF WE NEED TO REMOVE EXISTING ITEMS
		if (self.items_refresh.mode !== 'append')
		{
			self.remove_items();
			self.fire_event('devapt.container.refresh.items_removed');
		}
		
		
		// GET CURRENT ITEMS COUNT
		var items_count_before = $(self.items_jquery_filter, self.items_jquery_parent).length;
		
		
		// UPDATE QUERY SLICE TO QUERY NEW ITEMS TO APPEND
		var slice_promise = Devapt.promise_resolved();
		if (self.items_refresh.mode === 'append')
		{
			slice_promise = self.view_model_promise.then(
				function(view_model)
				{
					self.step(context, 'view_model is found');
					
					return view_model.ready_promise.then(
						function()
						{
							view_model.recordset.query.slice = {};
							view_model.recordset.query.slice.offset = items_count_before + 1;
							view_model.recordset.query.slice.length = 999999999;
							
//							console.log(view_model.recordset.query, self.name + '.' + context + '.view_model update slice');
							
							return view_model;
						}
					);
				}
			);
		}
		
		
		// READ AND RENDER ITEMS
		var promise = slice_promise.then(
			function()
			{
				// console.log('refresh:READ AND RENDER ITEMS');
				
				return self.render_items();
			}
		);
		
		// SET REFRESH TIMER AND UPDATE PAGER
		promise = promise.then(
			function()
			{
				console.log('refresh:SET REFRESH TIMER AND UPDATE PAGER');
				
				self.fire_event('devapt.container.refresh.items_rendered');
				
				// SET REFRESH TIMER
				if ( DevaptTypes.is_integer(self.items_refresh.frequency) )
				{
					var refresh_cb = function ()
					{
						return self.refresh();
					};
					
					setTimeout(refresh_cb, self.items_refresh.frequency*1000);
				}
				
				// UPDATE PAGER
				var items_count = window.$(self.items_jquery_filter, self.items_jquery_parent).filter('.devapt-container-visible').length;
				if (self.mixin_pagination_apply_count === 0 || items_count_before !== items_count)
				{
					self.fire_event('devapt.pagination.update_pagination', [ {'begin':0, 'end':items_count} ]);
					
					// END REFRESH PROCESS
					// console.log('refresh:END REFRESH PROCESS');
					self.fire_event('devapt.container.refresh.end');
				}
				else
				{
					// END REFRESH PROCESS
					// console.log('refresh:END REFRESH PROCESS');
					self.fire_event('devapt.container.refresh.end');
				}
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @desc				End the render of the container
	 * @return {nothing}
	 */
	var cb_render_end = function()
	{
		var self = this;
		var context = 'render_end()';
		self.enter(context, '');
		
		
		// CHILD CLASS RENEDRING
		if ( DevaptTypes.is_function(self.render_end_self) )
		{
			self.step(context, 'render_end_self');
			self.render_end_self();
		}
		
		
		// SELECT CURRENT RECORD
		if ( DevaptTypes.is_object(self.items_current_record) )
		{
			self.step(context, 'items_current_record is an object');
			
			// SELECT RECORD BY INDEX
			if ( DevaptTypes.is_integer(self.items_current_record.index) )
			{
				self.step(context, 'items_current_record.index is an integer');
				self.select(self.items_current_record.index);
			}
			else if ( DevaptTypes.is_string(self.items_current_record.index) )
			{
				self.step(context, 'items_current_record.index is a string');
				switch(self.items_current_record.index)
				{
					case 'first':
						self.step(context, 'select first item');
						// self.select_item_node(0);
						// console.log(self.view_model_promise, 'select() self.view_model_promise');
						// console.log(self.view_model_promise.select, 'select() self.view_model_promise.select');
						self.select(0);
						break;
					case 'last':
						self.step(context, 'select last item');
						var last_index = self.items_records_count > 0 ? self.items_records_count - 1 : 0;
						// self.select_item_node(last_index);
						self.select(last_index);
						break;
				}
			}
		}
		
		// AUTO REFRESH ITEMS
		if (self.items_refresh && self.items_refresh.mode && self.items_refresh.frequency && DevaptTypes.is_integer(self.items_refresh.frequency) )
		{
			self.step(context, 'auto refresh is enabled');
			
			var refresh_cb = function ()
			{
				return self.refresh();
			};
			
			setTimeout(refresh_cb, self.items_refresh.frequency*1000);
		}
		
		
		// UPDATE PAGINATION FOR THE FIRST RENDERING
		if (self.renders_count === 1)
		{
			self.step(context, 'update pagination');
			
			var update_pagination_cb = function()
			{
				var items_count = $(self.items_jquery_filter, self.items_jquery_parent).filter('.devapt-container-visible').length;
				self.fire_event('devapt.pagination.update_pagination', [ { 'begin':0, 'end':items_count} ]);
			};
			update_pagination_cb();
		}
		
		
		// FIRE EVENT
		self.fire_event('devapt.container.render.end');
		
		
		self.leave(context, Devapt.msg_success);
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @desc				Render view self content
	 * @return {object}		deferred promise object
	 */
	var cb_render_content_self = function()
	{
		var self = this;
		var context = 'render_content_self()';
		self.enter(context, '');
		
		
		// CHECK PARENT NODE
		self.assert_not_null(context, 'parent_jqo', self.parent_jqo);
		
		// SEND EVENT
		self.step(context, 'fire:devapt.container.render.begin');
		self.fire_event('devapt.container.render.begin');
		
		// RENDER BEGIN
		self.step(context, 'render begin');
		self.render_begin();
		
		// RENDER ITEMS AT FIRST TIME WITH AUTOLOAD FALSE
		self.renders_count++;
		self.value(context, 'renders_count', self.renders_count);
		self.value(context, 'items_autoload', self.items_autoload);
		if (self.renders_count === 1 && ! self.items_autoload)
		{
			self.step(context, 'renders_count=1 && autoload=false');
			
			// RENDER END
			self.render_end();
			
			self.leave(context, Devapt.msg_success_promise);
			return Devapt.promise_resolved();
		}
		
		self.step(context, 'not(renders_count=1 && autoload=false)');
		
		// RENDER ITEMS
		var items_promise = self.render_items();
		// console.log(items_promise, self.name + '.' + context + ':items_promise');
		items_promise.then(
			function()
			{
				// RENDER END
				self.render_end();
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return items_promise;
	};
	
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @desc				Render view items
	 * @return {object}		deferred promise object
	 */
	var cb_render_items = function()
	{
		var self = this;
		var context = 'render_items()';
		self.enter(context, '');
		
		
		var promise = self.render_items_self();
		
		promise = promise.then(
			function()
			{
				self.step(context, 'render items promise');
				// console.log('render items promise', self.name + ':' + context);
				
				// INIT CONTAINER BINDINGS
				if (! self.mixin_bind_initialized)
				{
					return self.enable_bindings();
				}
			},
			function()
			{
				console.error(self, context + ':render_items failure');
			}
		);
		
		promise = promise.then(
			function()
			{
				// UPDATE PAGINATION
				self.step(context, 'fire:devapt.pagination.update_pagination');
				
				var items_count = $(self.items_jquery_filter, self.items_jquery_parent).filter('.devapt-container-visible').length;
				
				self.fire_event('devapt.render.content', [items_count]);
				self.fire_event('devapt.pagination.update_pagination', [ {'begin':0, 'end':items_count} ]);
			},
			function()
			{
				console.error(self, context + ':enable_bindings failure');
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return promise;
	};
	
	
	
	/**
	 * @private
	 * @memberof			DevaptContainer
	 * @desc				Render view items (internal)
	 * @return {object}		deferred promise object
	 */
	var cb_render_items_self = function()
	{
		var self = this;
		var context = 'render_items_self()';
		self.enter(context, '');
		
		
		// GET ITEMS
		var items_promise = self.view_model_promise.then(
			function(view_model)
			{
				self.step(context, 'view_model get items');
//				console.log(view_model, self.name + '.' + context + '.view_model');
				
				return view_model.ready_promise.then(
					function()
					{
						self.step(context, 'view_model is ready');
						
						return view_model.reload().then(
							function(recordset)
							{
								// console.log(recordset, context + ':recordset');
								
								var items = view_model.get_values();
								
								// console.log(items, self.name + '.' + context + ':items');
								
								return items;
							},
							function()
							{
								console.error(self, self.name + '.' + context + ':reload failure');
							}
						);
					},
					function()
					{
						console.error(self, self.name + '.' + context + ':view_model ready failure');
					}
				);
			},
			function()
			{
				console.error(self, self.name + '.' + context + ':view_model failure');
			}
		);
		
		// GET ITEMS TYPES
		var types_promise = self.view_model_promise.then(
			function(view_model)
			{
				self.step(context, 'view_model get types');
				
				return view_model.ready_promise.then(
					function()
					{
						self.step(context, 'view_model get types array');
						
						return view_model.get_items_types();
					},
					function()
					{
						console.error(self, self.name + '.' + context + ':view_model ready failure');
					}
				);
			}
		);
		
		// WAITING FOR ITEMS AND TYPES
		var all_promise = Devapt.promise_all([items_promise, types_promise]);
		var trace= self.trace;
		
		// PROCESS ITEMS
		var render_promise = all_promise.spread(
			function(arg_items, arg_types)
			{
				self.trace = trace;
				self.step(context, 'get items and types promise done');
				// console.log(recordset, self.name + '.' + context + '.recordset');
				// console.log(arg_items, self.name + '.' + context + '.items');
				// console.log(arg_types, self.name + '.' + context + '.types');
				
				try
				{
					// INIT ITEMS
					var items_count = arg_items.length;
					var index_start = 0;
					
					// INIT TYPES
					var types_count = arg_types.length;
					var default_type = null;
					self.value(context, 'types', arg_types);
					
					
					// LOOP ON ITEMS
					self.step(context, 'loop on items');
					
					var loop_item_index = index_start;
					var loop_container_item = null;
					var loop_item_content = null;
					var loop_item_jqo = null;
					var loop_item_type = null;
					var loop_item_render_promise = null;
					var loop_item_render_success_cb = function(arg_self, arg_context, arg_index)
					{
						return function()
						{
							// SEND EVENT
							arg_self.step(context, 'fire event: devapt.container.render.item');
							arg_self.fire_event('devapt.container.render.item', [arg_index]);
						};
					};
					var loop_item_render_failure_cb = function(arg_self, arg_context, arg_index)
					{
						return function()
						{
							arg_self.error(arg_context, 'item render failure');
						};
					};
					
					for( ; loop_item_index < items_count ; ++loop_item_index)
					{
						self.step(context, 'loop on item at [' + loop_item_index + ']');
						
						// GET CURRENT ITEM CONTENT
						loop_item_content = arg_items[loop_item_index - index_start];
						loop_item_content = loop_item_content.is_record ? loop_item_content.get_datas() : loop_item_content;
						// self.value(context, 'item at [' + loop_item_index + ']', loop_item_content);
						// console.debug(loop_item_content, self.name + '.' + context + ':item');
						
						// GET CURRENT ITEM TYPE
						loop_item_type = default_type;
						if ( DevaptTypes.is_array(arg_types) && types_count > loop_item_index )
						{
							loop_item_type = arg_types[loop_item_index];
							default_type = loop_item_type;
						}
						
						// RENDER EMPTY CONTAINER ITEM NODE
						loop_item_jqo = self.render_item_node(loop_item_index);
						loop_item_jqo.addClass('devapt-container-visible');
						
						// CREATE NEW CONTAINER ITEM
						loop_container_item = self.new_item( {item_type:loop_item_type, content:loop_item_content, index:loop_item_index, node:loop_item_jqo} );
						self.assert_true(context, 'update_item_type at[' + loop_item_index + ']', self.update_item_type(loop_container_item) );
						self.assert_true(context, 'append_item_type at[' + loop_item_index + ']', self.append_item(loop_container_item) );
						self.assert_true(context, 'append_item_node at[' + loop_item_index + ']', self.append_item_node(loop_container_item) );
						
						// RENDER CURRENT ITEM
						loop_item_render_promise = self.render_item(loop_container_item);
						console.debug(loop_item_render_promise, 'loop_item_render_promise');
						loop_item_render_promise.then(
							loop_item_render_success_cb(self, context, loop_item_index),
							loop_item_render_failure_cb(self, context, loop_item_index)
						);
					}
					
					
					// SEND EVENT
					self.step(context, 'fire event: rendered.items');
					self.fire_event('rendered.items');
					
					
					// RENDER IS RESOLVED
					if (loop_item_index === items_count)
					{
						self.step(context, 'get items and types promise done (END): render is resolved');
						return Devapt.promise_resolved();
					}
				}
				catch(e)
				{
					console.error(e, self.name + '.' + context + ':PROCESS ITEMS');
				}
				
				
				// RENDER IS REJECTED: BAD ITEMS COUNT
				self.step(context, 'deferred.reject(): bad items count');
				self.step(context, 'get items and types promise done (END): render is rejected');
				return Devapt.promise_rejected();
			},
			function()
			{
				console.error(self, self.name + '.' + context + ':spread items/types failure');
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return render_promise;
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @desc				Append an item into the container and render it
	 * @param {anything}	arg_item	item to append
	 * @param {string}		arg_type	item type to append
	 * @return {object}		deferred promise object
	 */
/*	var cb_append_item = function(arg_item, arg_type)
	{
		var self = this;
		var context = 'append_item(item,type)';
		self.enter(context, '');
		
		
		// APPEND ITEM IN ITEMS COLLECTION
		var item_index = self.items_records_count;
		self.items_records.push(arg_item);
		self.items_records_count = self.items_records.length;
		
		// GET ITEM TYPE
		if (arg_item === 'divider')
		{
			arg_type = 'divider';
		}
		if ( DevaptTypes.is_null(arg_type) )
		{
			if ( DevaptTypes.is_array(item) )
			{
				arg_type = 'record';
			}
			else if ( DevaptTypes.is_object(item) )
			{
				arg_type = 'object';
			}
		}
		
		// RENDER CURRENT ITEM
		// TODO REMOVE DEFERRED
		var arg_deferred = Devapt.defer();
		// items_defers.push(item_defer); // TODO
		if ( ! self.render_item(arg_deferred, arg_item, item_index, arg_type) )
		{
			self.error(context, 'get items and types promise done (END): render is rejected');
			return Devapt.promise_rejected();
		}
		
		// SEND EVENT
		self.step(context, 'fire event: devapt.container.render.item');
		self.fire_event('devapt.container.render.item', [item_index]);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return Devapt.promise_resolved();
	};*/
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @desc				Fill view items for fields iterator
	 * @return {object}		deferred promise object
	 */
	var cb_fill_items = function()
	{
		var self = this;
		var context = 'fill_items()';
		self.enter(context, '');
		
		
		self.assert_true(context, 'item_iterator is fields', self.items_iterator === 'fields');
		
		var items_promise = self.view_model_promise.then(
			function(view_model)
			{
				self.step(context, 'view_model is found');
				
				return view_model.ready_promise.then(
					function()
					{
						self.step(context, 'view_model is ready');
						
						self.assert_not_empty_array(context, 'selection', view_model.selection);
						
						// TODO FILL ITEMS
					}
				);
			}
		);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return items_promise;
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @method				to_string_self()
	 * @desc				Get a string dump of the object
	 * @return {string}		String dump
	 */
	var cb_to_string_self = function()
	{
		// var self = this;
		return 'container view class';
	};
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2014-05-10',
			updated:'2015-05-24',
			description:' Container view base class (rendering, selection, view model, pagination, filtering, crud, input).'
		},
		properties:{
		},
		mixins:[DevaptContainerMixinSelectable, /*DevaptMixinModelCrud,*/ DevaptMixinFiltered, DevaptMixinPagination,
			DevaptMixinRenderItem, DevaptMixinGetNodes, DevaptMixinContainerUtils, DevaptMixinInput, DevaptMixinItems, DevaptMixinCrud]
	};
	var parent_class = DevaptView;
	var DevaptContainerClass = new DevaptClass('DevaptContainer', parent_class, class_settings);
	
	
	// METHODS
	DevaptContainerClass.infos.ctor = cb_constructor;
	
	DevaptContainerClass.add_public_method('get_item_node', {
		description:'Look up a container item node by its index and returns a jQuery node or null if not found',
		operands:[{type:'integer',default:null,mutable:false}],
		result:{type:'jQuery object',default_value:null,failure_value:null}
	}, cb_get_item_node);
	
	DevaptContainerClass.add_public_method('refresh', {
		description:'Update container items',
		operands:[],
		result:{type:'promise object',default_value:'rejected promise',failure_value:'rejected promise'}
	}, cb_refresh);
	
	DevaptContainerClass.add_public_method('render_end', {
		description:'End the render of the container',
		operands:[],
		result:{type:'nothing',default_value:'nothing',failure_value:'nothing'}
	}, cb_render_end);
	
	DevaptContainerClass.add_public_method('render_content_self', {}, cb_render_content_self);
	DevaptContainerClass.add_public_method('render_items', {}, cb_render_items);
	DevaptContainerClass.add_public_method('render_items_self', {}, cb_render_items_self);
	
	// DevaptContainerClass.add_public_method('append_item', {}, cb_append_item);
	DevaptContainerClass.add_public_method('fill_items', {}, cb_fill_items);
	
	DevaptContainerClass.add_public_method('to_string_self', {}, cb_to_string_self);
	
	
	// PROPERTIES
	DevaptContainerClass.add_public_obj_property('view_model_promise',	'view model', null, false, true, []);
	
	DevaptContainerClass.add_public_bool_property('selection_enabled',	'', false, false, false, []);
	DevaptContainerClass.add_public_bool_property('has_multiple_selection',	'', false, false, false, []);
	DevaptContainerClass.add_public_int_property('items_visible_count',	'', null, false, false, []);
	DevaptContainerClass.add_public_array_property('items_input_fields',	'', null, false, false, [], 'string', ',');
	DevaptContainerClass.add_public_object_property('filtered',	'', null, false, false, []);
	
	
	DevaptContainerClass.add_public_obj_property('items_model_obj',			'',	null, false, false, ['model']);
	DevaptContainerClass.add_public_str_property('items_model_name',		'', null, true, false, ['model_name']);
	
	DevaptContainerClass.add_public_bool_property('items_autoload',			'',	true, false, false, ['view_items_autoload']);
	DevaptContainerClass.add_public_str_property('items_source',			'', 'inline', false, false, ['view_items_source']); // inline / model / events / resources
	DevaptContainerClass.add_public_str_property('items_source_format',		'',	'array', false, false, ['view_items_source_format']); // json / array

	DevaptContainerClass.add_public_bool_property('items_distinct',			'',	false, false, false, []); // items are distinct ?
	DevaptContainerClass.add_public_str_property('items_distinct_field',	'',	null, false, false, []); // items are distinct with given field name
	DevaptContainerClass.add_public_str_property('items_iterator',			'', 'records', false, false, []); // items iterator : records / fields / field_editor
	DevaptContainerClass.add_public_array_property('items_fields',			'', [], false, false, [], 'string', ','); // item fields
	
	DevaptContainerClass.add_public_str_property('items_format',			'', null, false, false, []); // item format
	DevaptContainerClass.add_public_array_property('items_formats',			'', null, false, false, [], 'string', ','); // item format
	
	DevaptContainerClass.add_public_obj_property('items_current_record',	'Current record index as { index:12 } or { index:"first|last" }', null, false, false, []);
	DevaptContainerClass.add_public_obj_property('items_refresh',			'', null, false, false, []);
	
	DevaptContainerClass.add_public_array_property('items_records',			'',	[], false, false, [], 'object', ','); // items records
	DevaptContainerClass.add_public_int_property('items_records_count',		'',	0, false, false, []); // items records count
	
	DevaptContainerClass.add_public_array_property('items_inline',			'',	[], false, false, [], 'string', ',');
	DevaptContainerClass.add_public_array_property('items_options',			'',	[], false, false, [], 'string', ',');
	
	DevaptContainerClass.add_public_array_property('items_labels',			'',	[], false, false, [], 'string', ',');
	DevaptContainerClass.add_public_array_property('items_types',			'',	['view'], false, false, ['view_items_types'], 'string', ',');
	
	
	return DevaptContainerClass;
} );
/**
 * @file        plugins/backend-foundation5/containers/accordion.js
 * @desc        Foundation 5 list class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-07-27
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/containers/accordion',['Devapt', 'core/types', 'object/class', 'views/container', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptContainer, undefined)
{
	/**
	 * @public
	 * @class				DevaptAccordion
	 * @desc				Accordion panel view class
	 * @param {string}		arg_name			View name (string)
	 * @param {object}		arg_parent_jqo		jQuery object to attach the view to
	 * @param {object|null}	arg_options			Associative array of options
	 * @return {nothing}
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptAccordion
	 * @desc				Begin the render of the container
	 * @return {nothing}
	 */
	var cb_render_begin = function()
	{
		var self = this;
		var context = 'render_begin()';
		self.enter(context, '');
		
		
		self.content_jqo = $('<ul>');
		self.parent_jqo.append(self.content_jqo);
		self.content_jqo.addClass('accordion');
		self.content_jqo.attr('data-accordion', '');
		
		
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @desc				End the render of the container
	 * @return {nothing}
	 */
	var cb_render_end_self = function()
	{
		var self = this;
		var context = 'render_end_self()';
		self.enter(context, '');
		
		
		// INIT FOUNDATION
		self.content_jqo.parent().foundation();
		
		// HANulE EVENT
		if ( DevaptTypes.is_function(self.on_accordion_changed) )
		{
			// self.content_jqo.on('toggled', [self, self.on_accordion_changed] );
			self.content_jqo.on('toggled',
				function(event, accordion)
				{
					// SEND EVENT
					self.fire_event('devapt.accordion.changed', [event, accordion]);
				}
			);
		}
		
		// ENABLE ACTIVE CONTENT
		if ( ! $('.content.active', self.content_jqo) && $('.content', self.content_jqo) )
		{
			$('.content', self.content_jqo)[0].addClass('active');
		}
		
		
		self.leave(context, Devapt.msg_success);
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptAccordion
	 * @desc				Render an empty item node
	 * @param {integer} 	arg_item_index		item index
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_node = function(arg_item_index)
	{
		var self = this;
		var context = 'render_item_node(index)';
		self.enter(context, '');
		
		
		var id = self.name + '_content_' + arg_item_index + '_id';
		var node_jqo = $('<div>');
		node_jqo.addClass('content');
		node_jqo.attr('id', id);
		// console.log(node_jqo, context + ':node_jqo:' + self.name);
		
		
		self.leave(context, 'success');
		return node_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptAccordion
	 * @desc				Render an item TEXT content
	 * @param {object}		arg_deferred		deferred object
	 * @param {object}		arg_item_jqo		
	 * @param {string}		arg_item_content
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_text = function(arg_deferred, arg_item_jqo, arg_item_content)
	{
		var self = this;
		var context = 'render_item_text(deferred,jqo,content)';
		self.enter(context, '');
		
		var p_jqo = $('<p>');
		p_jqo.html(arg_item_content);
		arg_item_jqo.append(p_jqo);
		
		self.leave(context, Devapt.msg_success);
		return arg_item_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @desc				Append an item to the view
	 * @param {object}		arg_container_item		A plain object of a container item
	 * @return {nothing}
	 */
	var cb_append_item_node = function(arg_container_item)
	{
		var self = this;
		var context = 'append_item_node(item)';
		self.enter(context, '');
		self.assert_object(context, 'item', arg_container_item);
		
		
		// GET ITEM OPTIONS
		self.step(context, 'get item options');
		var item_options = self.get_item_options(arg_container_item.index, { label:'accordion ' + arg_container_item.index, active:false });
		
		// ACCORDION CONTENT
		self.step(context, 'get id and label');
		var id = self.name + '_content_' + arg_container_item.index + '_id';
		var item_label = item_options.label;
		
		self.step(context, 'init node');
		var node_jqo = $('<li>');
		node_jqo.addClass('accordion-navigation');
		if (item_options.active)
		{
			arg_container_item.node.addClass('active');
		}
		
		var a_jqo = $('<a>');
		a_jqo.attr('href', '#' + id);
		a_jqo.html(item_label);
		node_jqo.append(a_jqo);
		
		var div_jqo = $('<div>');
		div_jqo.addClass('content');
		div_jqo.append(arg_container_item.node);
		
		node_jqo.append(div_jqo);
		self.content_jqo.append(node_jqo);
		
		
		self.leave(context, 'success');
		return true;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-07-27',
			'updated':'2015-03-28',
			'description':'Accordion view class.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptContainer;
	var DevaptAccordionClass = new DevaptClass('DevaptAccordion', parent_class, class_settings);
	
	// METHODS
	DevaptAccordionClass.add_public_method('render_begin', {}, cb_render_begin);
	DevaptAccordionClass.add_public_method('render_end_self', {}, cb_render_end_self);
	DevaptAccordionClass.add_public_method('render_item_node', {}, cb_render_item_node);
	DevaptAccordionClass.add_public_method('render_item_text', {}, cb_render_item_text);
	DevaptAccordionClass.add_public_method('append_item_node', {}, cb_append_item_node);
	
	// PROPERTIES
	
	
	return DevaptAccordionClass;
} );
/**
 * @file        worker/worker.js
 * @desc        Worker Class
 * 		API
 * 			Task record :
 * 			{
 * 				id: string
 * 				callback: fn()
 * 				once: boolean
 * 				delay: boolean
 * 				cumul_delay: boolean
 * 				state: string (RUNNING, READY)
 * 				counter: integer
 * 			}
 * @ingroup     DEVAPT_WORKER
 * @date        2015-02-01
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'worker/worker',['Devapt', 'core/types', 'object/class', 'object/object'],
function(Devapt, DevaptTypes, DevaptClass, DevaptObject)
{
	/**
	 * @public
	 * @class				DevaptWorker
	 * @desc				Worker class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptWorker
	 * @desc				Constructor
	 * @param {object}		self	object
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		var context = 'constructor(self)';
		self.enter(context, '');
		
		
		// DEBUG
		// self.trace=true;
		
		// UPDATE STATE
		self.worker_state = Devapt.STATE_CREATED;
		
		
		self.leave(context, '');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptWorker
	 * @desc				Destroy
	 * @return {nothing}
	 */
	var cb_destroy_worker = function()
	{
		var self = this;
		var context = 'destroy_worker()';
		self.enter(context, '');
		
		
		self.leave(context, Devapt.msg_default_empty_implementation);
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptWorker
	 * @desc				Destroy
	 * @return {nothing}
	 */
	var cb_destroy = function()
	{
		var self = this;
		var context = 'destroy()';
		self.enter(context, '');
		
		
		// UPDATE STATE
		self.worker_state = Devapt.STATE_DESTROYED;
		
		// DESTROY WORKER
		self.destroy_worker();
		
		// DESTROY TASKS
		for(var task_id in self.worker_tasks)
		{
			delete self.worker_tasks[task_id];
		}
		delete self.worker_tasks;
		
		// DESTROY OTHERS
		delete self.worker_state;
		
		
		self.leave(context, '');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptWorker
	 * @param {function}	arg_worker_cb	worker function
	 * @return {nothing}
	 */
	var cb_start_worker = function(arg_worker_cb)
	{
		var self = this;
		var context = 'start_worker(cb)';
		self.enter(context, '');
		
		
		self.leave(context, Devapt.msg_default_empty_implementation);
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptWorker
	 * @desc				Start the worker
	 * @return {nothing}
	 */
	var cb_start = function()
	{
		var self = this;
		var context = 'start()';
		self.enter(context, '');
		
		
		// CREATE WORKER CB
		var worker_cb = function(arg_delay)
			{
				var context = 'start() callback';
				// self.step(context, 'worker run');
				// console.info(self.worker_state, 'worker run');
				
				try
				{
					arg_delay = arg_delay ? arg_delay : 0;
					
					if (self.worker_state === Devapt.STATE_STARTED || self.worker_state === Devapt.STATE_READY)
					{
						self.worker_state = Devapt.STATE_RUNNING;
						
						// LOOP ON TASKS
						var tasks_to_remove = [];
						for(var task_id in self.worker_tasks)
						{
							var task = self.worker_tasks[task_id];
							
							if (task.delay > 0)
							{
								if (task.cumul_delay < task.delay)
								{
									task.cumul_delay += arg_delay;
									continue;
								}
								task.cumul_delay = 0;
							}
							
							task.state = Devapt.RUNNING;
							task.callback.call();
							task.state = Devapt.READY;
							task.counter++;
							if (task.once && task.counter >= 1)
							{
								tasks_to_remove.push(task);
							}
						}
						
						// REMOVE TASKS
						if (tasks_to_remove.length > 0)
						{
							for(var task_index in tasks_to_remove)
							{
								var task = tasks_to_remove[task_index];
								self.remove_task(task.id);
							}
						}
						
						self.worker_state = Devapt.STATE_READY;
					}
				}
				catch(e)
				{
					console.error(e, context);
				}
			};
		
		// CREATE TIMER
		self.start_worker(worker_cb);
		
		// UPDATE STATE
		self.worker_state = Devapt.STATE_STARTED;
		
		
		self.leave(context, '');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptWorker
	 * @desc				Stop the worker
	 * @return {nothing}
	 */
	var cb_stop_worker = function()
	{
		var self = this;
		var context = 'stop_worker()';
		self.enter(context, '');
		
		
		self.leave(context, Devapt.msg_default_empty_implementation);
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptWorker
	 * @desc				Stop the worker
	 * @return {nothing}
	 */
	var cb_stop = function()
	{
		var self = this;
		var context = 'stop()';
		self.enter(context, '');
		
		
		// UPDATE STATE
		self.worker_state = Devapt.STATE_STOPPED;
		
		// STOP WORKER
		self.stop_worker();
		
		
		self.leave(context, '');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptWorker
	 * @desc				Suspend the worker
	 * @return {nothing}
	 */
	var cb_suspend = function()
	{
		var self = this;
		var context = 'suspend()';
		self.enter(context, '');
		
		
		// UPDATE STATE
		if (self.worker_state === Devapt.STATE_STARTED)
		{
			self.worker_state = Devapt.STATE_SUSPENDED;
		}
		
		
		self.leave(context, '');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptWorker
	 * @desc				Resume the worker
	 * @return {nothing}
	 */
	var cb_resume = function()
	{
		var self = this;
		var context = 'resume()';
		self.enter(context, '');
		
		
		// UPDATE STATE
		if (self.worker_state === Devapt.STATE_SUSPENDED)
		{
			self.worker_state = Devapt.STATE_STARTED;
		}
		
		
		self.leave(context, '');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptWorker
	 * @desc				Add a worker task
	 * @param {string}		arg_task_id			task id
	 * @param {function}	arg_task_callback	task callback
	 * @param {object}		arg_task_settings	task settings
	 * @return {nothing}
	 */
	var cb_add_task = function(arg_task_id, arg_task_callback, arg_task_settings)
	{
		var self = this;
		var context = 'add_task(id,cb,settings)';
		self.enter(context, '');
		
		
		var task = {
			id: DevaptTypes.is_not_empty_str(arg_task_id) ? arg_task_id : ('task_' + self.worker_tasks.length),
			callback: DevaptTypes.is_function(arg_task_callback) ? arg_task_callback : function() {},
			once: (arg_task_settings && arg_task_settings.once) ? DevaptTypes.to_boolean(arg_task_settings.once, false) : false,
			counter: 0,
			state: Devapt.STATE_READY
			};
		self.worker_tasks[task.id] = task;
		
		
		self.leave(context, '');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptWorker
	 * @desc				Remove a worker task
	 * @param {string}		arg_task_id			task id
	 * @return {nothing}
	 */
	var cb_remove_task = function(arg_task_id)
	{
		var self = this;
		var context = 'remove_task(id)';
		self.enter(context, '');
		
		
		if (self.worker_tasks[arg_task_id])
		{
			delete self.worker_tasks[arg_task_id];
		}
		
		
		self.leave(context, '');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptWorker
	 * @desc				Add a worker task which should be run one time
	 * @param {function}	arg_task_callback	task callback
	 * @return {nothing}
	 */
	var cb_once = function(arg_task_callback)
	{
		var self = this;
		var context = 'once(cb)';
		self.enter(context, '');
		
		
		var settings = {
			once: true
			};
		self.add_task(null, arg_task_callback, settings);
		
		
		self.leave(context, '');
	}
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-02-01',
			updated:'2015-02-01',
			description:'Worker class.'
		},
		properties:{
			
		}
	};
	var parent_class = DevaptObject;
	var DevaptWorkerClass = new DevaptClass('DevaptWorker', parent_class, class_settings);
	
	// METHODS
	DevaptWorkerClass.infos.ctor = cb_constructor;
	DevaptWorkerClass.add_public_method('destroy_worker', {}, cb_destroy_worker);
	DevaptWorkerClass.add_public_method('destroy', {}, cb_destroy);
	DevaptWorkerClass.add_public_method('start_worker', {}, cb_start_worker);
	DevaptWorkerClass.add_public_method('start', {}, cb_start);
	DevaptWorkerClass.add_public_method('stop_worker', {}, cb_stop_worker);
	DevaptWorkerClass.add_public_method('stop', {}, cb_stop);
	DevaptWorkerClass.add_public_method('suspend', {}, cb_suspend);
	DevaptWorkerClass.add_public_method('resume', {}, cb_resume);
	DevaptWorkerClass.add_public_method('add_task', {}, cb_add_task);
	DevaptWorkerClass.add_public_method('remove_task', {}, cb_remove_task);
	DevaptWorkerClass.add_public_method('once', {}, cb_once);
	
	// PROPERTIES
	DevaptWorkerClass.add_public_obj_property('worker_state',		'worker state (created,started,ready,suspended,running,destroyed)', [], false, false, []);
	DevaptWorkerClass.add_public_obj_property('worker_tasks',		'worker tasks', {}, false, false, []);
	
	
	return DevaptWorkerClass;
} );
/**
 * @file        worker/timer.js
 * @desc        Timer Class
 * 		API
 * 			Task record :
 * 			{
 * 				id: string
 * 				callback: fn()
 * 				once: boolean
 * 				state: string (RUNNING, READY)
 * 				counter: integer
 * 			}
 * @ingroup     DEVAPT_WORKER
 * @date        2015-02-01
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'worker/timer',['Devapt', 'core/types', 'object/class', 'worker/worker'],
function(Devapt, DevaptTypes, DevaptClass, DevaptWorker)
{
	/**
	 * @public
	 * @class				DevaptTimer
	 * @desc				Timer class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptTimer
	 * @desc				Constructor
	 * @param {object}		self	object
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		var context = 'constructor(self)';
		self.enter(context, '');
		
		
		// DEBUG
		// self.trace = true;
		
		// UPDATE STATE
		self.worker_state = Devapt.STATE_CREATED;
		
		// INIT TIMER OBJECT
		self.timer_object = null;
		
		
		self.leave(context, '');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptTimer
	 * @desc				Destroy
	 * @return {nothing}
	 */
	var cb_destroy_worker = function()
	{
		var self = this;
		var context = 'destroy_worker()';
		self.enter(context, '');
		
		
		// DESTROY TIMER
		if (self.timer_object)
		{
			window.clearTimeout(self.timer_object);
			delete self.timer_object;
		}
		delete self.timer_delay;
		delete self.timer_default_delay;
		
		
		self.leave(context, '');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptTimer
	 * @param {function}	arg_worker_cb	worker function
	 * @return {nothing}
	 */
	var cb_start_worker = function(arg_worker_cb)
	{
		var self = this;
		var context = 'start_worker(cb)';
		self.enter(context, '');
		
		
		// CREATE TIMER
		var timer_cb = function()
			{
				// self.step(context, 'timer callback');
				arg_worker_cb(self.timer_delay);
				self.timer_object = window.setTimeout(timer_cb, self.timer_delay);
			};
		self.timer_object = window.setTimeout(timer_cb, self.timer_delay);
		
		
		self.leave(context, '');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptTimer
	 * @desc				Stop the worker
	 * @return {nothing}
	 */
	var cb_stop_worker = function()
	{
		var self = this;
		var context = 'stop_worker()';
		self.enter(context, '');
		
		
		// DESTROY TIMER
		if (self.timer_object)
		{
			window.clearTimeout(self.timer_object);
			delete self.timer_object;
		}
		
		
		self.leave(context, '');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptTimer
	 * @desc				Get the timer delay
	 * @return {integer}
	 */
	var cb_get_delay = function()
	{
		var self = this;
		var context = 'get_delay()';
		self.enter(context, '');
		
		self.timer_delay = DevaptTypes.is_integer(self.timer_delay) ? self.timer_delay : self.timer_default_delay;
		
		self.leave(context, '');
		return self.timer_delay;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptTimer
	 * @desc				Set the timer delay
	 * @param {integer}		arg_delay	timer delay
	 * @return {nothing}
	 */
	var cb_set_delay = function(arg_delay)
	{
		var self = this;
		var context = 'set_delay(delay)';
		self.enter(context, '');
		
		self.timer_delay = DevaptTypes.is_integer(arg_delay) ? arg_delay : self.timer_default_delay;
		
		self.leave(context, '');
	}
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2015-02-01',
			updated:'2015-02-01',
			description:'Timer class.'
		},
		properties:{
			
		}
	};
	var parent_class = DevaptWorker;
	var DevaptTimerClass = new DevaptClass('DevaptTimer', parent_class, class_settings);
	
	// METHODS
	DevaptTimerClass.infos.ctor = cb_constructor;
	DevaptTimerClass.add_public_method('destroy_worker', {}, cb_destroy_worker);
	DevaptTimerClass.add_public_method('start_worker', {}, cb_start_worker);
	DevaptTimerClass.add_public_method('stop_worker', {}, cb_stop_worker);
	DevaptTimerClass.add_public_method('get_delay', {}, cb_get_delay);
	DevaptTimerClass.add_public_method('set_delay', {}, cb_set_delay);
	
	// PROPERTIES
	DevaptTimerClass.add_public_obj_property('timer_object',		'timer object', null, false, false, []);
	DevaptTimerClass.add_public_int_property('timer_delay',			'timer delay in milliseconds (100ms)', 100, true, false, []);
	DevaptTimerClass.add_public_int_property('timer_default_delay',	'timer default delay in milliseconds (100ms)', 100, true, false, []);
	
	
	return DevaptTimerClass;
} );
/**
 * @file        plugins/backend-foundation5/containers/dropdown.js
 * @desc        Foundation 5 dropdown class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-08-05
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/containers/dropdown',['Devapt', 'core/types', 'object/class', 'views/container', 'worker/timer', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptContainer, DevaptTimerWorker, undefined)
{
	/**
	 * @public
	 * @class				DevaptDropdown
	 * @desc				Dropdown view class
	 * @param {string}		arg_name			View name (string)
	 * @param {object}		arg_parent_jqo		jQuery object to attach the view to
	 * @param {object|null}	arg_options			Associative array of options
	 * @return {nothing}
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptDropdown
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = 'constructor(' + self.name + ')';
		self.enter(context, '');
		
		
		// CALL SUPER CLASS CONSTRUCTOR
		// self._parent_class.infos.ctor(self);
		
		self.items_jquery_parent = null;
		self.items_jquery_filter = 'li';
		
		self.add_event_callback('devapt.events.container.selected', [self, self.on_selected_item_event], false);
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptDropdown
	 * @desc				Get a container item node by the node item text
	 * @param {string}		arg_node_item_text		node item text
	 * @return {object}		node jQuery object
	 */
	var cb_get_node_by_content = function(arg_node_item_text)
	{
		var self = this;
		var context = 'get_node_by_content(text)';
		self.enter(context, '');
		
		
		var node_jqo = null;
		
		// SELECT ANCHOR BY CONTENT
		var a_jqo = $('li>a:contains("' + arg_node_item_text + '"):eq(0)', self.items_jquery_parent);
		if ( ! a_jqo)
		{
			self.leave(context, Devapt.msg_failure);
			return null;
		}
		
		// GET ANCHOR PARENT
		node_jqo = a_jqo.parent();
		
		
		self.leave(context, Devapt.msg_success);
		return node_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptDropdown
	 * @desc				Begin the render of the container
	 * @return {nothing}
	 */
	var cb_render_begin = function()
	{
		var self = this;
		var context = 'render_begin()';
		self.enter(context, '');
		
		
		// CHECK CONTENT NODE
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		
		var ul_id = self.name + '_dropdown_ul_id';
		var direction = self.direction ? self.direction : 'bottom';
		
		self.a_jqo = $('<a>');
		self.content_jqo.append(self.a_jqo);
		// self.a_jqo.attr('href', '#');
		self.a_jqo.html(self.label);
		self.a_jqo.attr('data-dropdown', ul_id);
		self.a_jqo.attr('data-options', 'align:' + direction);
		self.a_jqo.addClass('button dropdown');
		
		self.ul_jqo = $('<ul>');
		self.content_jqo.append(self.ul_jqo);
		self.ul_jqo.attr('id', ul_id);
		self.ul_jqo.attr('aria-autoclose', true);
		self.ul_jqo.attr('data-dropdown-content', '');
		self.ul_jqo.addClass('f-dropdown');
		
		self.items_jquery_parent = self.ul_jqo;
		
		
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptDropdown
	 * @desc				End the render of the container
	 * @return {nothing}
	 */
	var cb_render_end_self = function()
	{
		var self = this;
		var context = 'render_end_self()';
		self.enter(context, '');
		
		
		// INIT FOUNDATION DROPDONW PLUGIN
		self.content_jqo.foundation();
		
		
		self.leave(context, Devapt.msg_success);
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptDropdown
	 * @desc				Render an empty item node
	 * @param {integer} 	arg_item_index		item index
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_node = function(arg_item_index)
	{
		var self = this;
		var context = 'render_item_node(index)';
		self.enter(context, '');
		
		
		var node_jqo = $('<li>');
		
		// HANDLE CLICK
		node_jqo.click(
			function()
			{
				self.step(context, 'on click');
				
				var onclick = function()
				{
					self.step(context, 'on click callback');
					console.log('on click callback');
					try
					{
						var node_index = parseInt( node_jqo.index() );
						self.value(context, 'node_index', node_index);
						
						self.select(node_index);
						
						var current_label = node_jqo.text();
						var new_label = node_jqo.attr('devapt-label');
						if ( DevaptTypes.is_not_empty_str(new_label) && ! DevaptTypes.is_not_empty_str(current_label) )
						{
							self.a_jqo.text(new_label);
						}
					}
					catch(e)
					{
						console.error(e, context);
					}
				};
				
				try
				{
					var worker_promise = self.get_worker('default');
					worker_promise.then(
						function(worker)
						{
							// console.log(worker, 'worker');
							worker.once(onclick);
						}
					);
					
					// onclick();
				}
				catch(e)
				{
					console.error(e, context);
				}
				
				return true;
			}
		);
		
		
		self.leave(context, 'success');
		return node_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptDropdown
	 * @desc				Render an divider item content
	 * @param {object}		arg_deferred		deferred object
	 * @param {object}		arg_item_jqo		
	 * @param {string}		arg_item_content
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_divider = function(arg_deferred, arg_item_jqo, arg_item_content)
	{
		var self = this;
		var context = 'render_item_divider(deferred,jqo,content)';
		self.enter(context, '');
		
		
		self.leave(context, Devapt.msg_success);
		return arg_item_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptDropdown
	 * @desc				Render an item TEXT content
	 * @param {object}		arg_deferred		deferred object
	 * @param {object}		arg_item_jqo		
	 * @param {string}		arg_item_content
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_text = function(arg_deferred, arg_item_jqo, arg_item_content)
	{
		var self = this;
		var context = 'render_item_text(deferred,jqo,content)';
		self.enter(context, '');
		
		var a_jqo = $('<a>');
		a_jqo.html(arg_item_content);
		arg_item_jqo.append(a_jqo);
		
		self.leave(context, Devapt.msg_success);
		return arg_item_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptDropdown
	 * @desc				Process event selected
	 * @param {array}		arg_event_operands		event operands array
	 * @return {nothing}
	 */
	var cb_on_selected_item_event = function(arg_event_operands)
	{
		var self = this;
		var context = 'on_selected_item_event(opds)';
		self.enter(context, '');
		
		
		// GET LABEL
		var selected_map = arg_event_operands[2];
		self.a_jqo.html(selected_map.label);
		
		
		self.leave(context, Devapt.msg_success);
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-05-09',
			'updated':'2014-12-13',
			'description':'Container view class to display a dropdown menu of items.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptContainer;
	var DevaptDropdownClass = new DevaptClass('DevaptDropdown', parent_class, class_settings);
	
	// METHODS
	DevaptDropdownClass.infos.ctor = cb_constructor;
	DevaptDropdownClass.add_public_method('get_node_by_content', {}, cb_get_node_by_content);
	DevaptDropdownClass.add_public_method('render_begin', {}, cb_render_begin);
	DevaptDropdownClass.add_public_method('render_end_self', {}, cb_render_end_self);
	DevaptDropdownClass.add_public_method('render_item_node', {}, cb_render_item_node);
	DevaptDropdownClass.add_public_method('render_item_divider', {}, cb_render_item_divider);
	DevaptDropdownClass.add_public_method('render_item_text', {}, cb_render_item_text);
	DevaptDropdownClass.add_public_method('on_selected_item_event', {}, cb_on_selected_item_event);
	
	// PROPERTIES
	DevaptDropdownClass.add_public_str_property('direction',			'',	'bottom', false, false, ['view_direction']); // down, top, left, rigth
	
	
	return DevaptDropdownClass;
} );
/**
 * @file        plugins/backend-foundation5/containers/hbox.js
 * @desc        Foundation 5 HBox class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-06-28
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/containers/hbox',['Devapt', 'core/types', 'object/class', 'views/container', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptContainer, undefined)
{
	/**
	 * @public
	 * @class				DevaptHBox
	 * @desc				Horizontal Box view class
	 * @param {string}		arg_name			View name (string)
	 * @param {object}		arg_parent_jqo		jQuery object to attach the view to
	 * @param {object|null}	arg_options			Associative array of options
	 * @return {nothing}
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptHBox
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = 'constructor(' + self.name + ')';
		self.enter(context, '');
		
		
		self.items_jquery_parent = null;
		self.items_jquery_filter = 'li';
		
		// self.add_event_callback('devapt.events.container.selected', [self, self.on_selected_item_event], false);
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptHBox
	 * @desc				Begin the render of the container
	 * @return {nothing}
	 */
	var cb_render_begin = function()
	{
		var self = this;
		var context = 'render_begin()';
		self.enter(context, '');
		
		
		// CHECK CONTENT NODE
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		
		// GET BLOCKS COUNT
		var small_blocks  = Math.max( Math.min(self.small_device_blocks, 12), 1);
		var medium_blocks = Math.max( Math.min(self.medium_device_blocks, 12), 1);
		var large_blocks  = Math.max( Math.min(self.large_device_blocks, 12), 1);
		
		// CREATE MAIN NODE
		self.ul_jqo = $('<ul>');
		self.ul_jqo.addClass('small-block-grid-' + small_blocks);
		self.ul_jqo.addClass('medium-block-grid-' + medium_blocks);
		self.ul_jqo.addClass('large-block-grid-' + large_blocks);
		self.content_jqo.append(self.ul_jqo);
		
		self.items_jquery_parent = self.ul_jqo;
		
		
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptHBox
	 * @desc				Render an empty item node
	 * @param {integer} 	arg_item_index		item index
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_node = function(arg_item_index)
	{
		var self = this;
		var context = 'render_item_node(index)';
		self.enter(context, '');
		
		var li_jqo = $('<li>');
		
		self.leave(context, 'success');
		return li_jqo;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-05-09',
			'updated':'2014-12-13',
			'description':'Container view class to display an horizontal box of items.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptContainer;
	var DevaptHBoxClass = new DevaptClass('DevaptHBox', parent_class, class_settings);
	
	// METHODS
	DevaptHBoxClass.infos.ctor = cb_constructor;
	DevaptHBoxClass.add_public_method('render_begin', {}, cb_render_begin);
	DevaptHBoxClass.add_public_method('render_item_node', {}, cb_render_item_node);
	
	// PROPERTIES
	DevaptHBoxClass.add_public_int_property('small_device_blocks',	'',	2, false, false, []);
	DevaptHBoxClass.add_public_int_property('medium_device_blocks',	'',	4, false, false, []);
	DevaptHBoxClass.add_public_int_property('large_device_blocks',	'',	6, false, false, []);
	
	
	return DevaptHBoxClass;
} );
/**
 * @file        plugins/backend-foundation5/containers/list.js
 * @desc        Foundation 5 list class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-06-28
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/containers/list',['Devapt', 'core/types', 'object/class', 'views/container', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptContainer, undefined)
{
	/**
	 * @public
	 * @class				DevaptList
	 * @desc				List view class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptList
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = 'constructor';
		self.enter(context, '');
		
		
		self.items_jquery_parent = null;
		self.items_jquery_filter = 'li';
		
		// self.add_event_callback('devapt.events.container.selected', [self, self.on_selected_item_event], false);
		
		
		// CONSTRUCTOR END
		self.leave(context, Devapt.msg_success);
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptList
	 * @desc				Get a container item node by the node item text
	 * @param {string}		arg_node_item_text		node item text
	 * @return {object}		node jQuery object
	 */
	var cb_get_node_by_content = function(arg_node_item_text)
	{
		var self = this;
		var context = 'get_node_by_content(text)';
		self.enter(context, '');
		
		
		// SELECT ANCHOR BY CONTENT
		var a_jqo = null;
		try
		{
			a_jqo = $('li>a:contains("' + arg_node_item_text + '"):eq(0)', self.items_jquery_parent);
		}
		catch(e)
		{
			self.error(context + 'jquery select failed for [' + 'li>a:contains("' + arg_node_item_text + '"):eq(0)' + ']');
		}
		
		if ( ! a_jqo)
		{
			console.error(arg_node_item_text, context + ':arg_node_item_text');
			console.error(self.items_jquery_parent, context + ':items_jquery_parent');
			self.leave(context, Devapt.msg_failure);
			return null;
		}
		
		// GET ANCHOR PARENT
		var node_jqo = a_jqo.parent();
		
		
		self.leave(context, Devapt.msg_success);
		return node_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptList
	 * @desc				Begin the render of the container
	 * @return {nothing}
	 */
	var cb_render_begin = function()
	{
		var self = this;
		// self.trace=true;
		
		var context = 'render_begin()';
		self.enter(context, '');
		
		
		// CHECK CONTENT NODE
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		
		self.ul_jqo = $('<ul>');
		self.content_jqo.append(self.ul_jqo);
		self.ul_jqo.addClass('side-nav');
		
		self.items_jquery_parent = self.ul_jqo;
		
		
		self.leave(context, Devapt.msg_success);
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptList
	 * @desc				Render an empty item node
	 * @param {integer} 	arg_item_index		item index
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_node = function(arg_item_index)
	{
		var self = this;
		var context = 'render_item_node(index)';
		self.enter(context, '');
		
		
		var node_jqo = $('<li>');
		node_jqo.click(
			function()
			{
				var node_index = parseInt( node_jqo.index() );
				self.select(node_index);
			}
		);
		
		
		self.leave(context, Devapt.msg_success);
		return node_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptList
	 * @desc				Render an divider item content
	 * @param {object}		arg_deferred		deferred object
	 * @param {object}		arg_item_jqo		
	 * @param {string}		arg_item_content
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_divider = function(arg_deferred, arg_item_jqo, arg_item_content)
	{
		var self = this;
		var context = 'render_item_divider(deferred,jqo,content)';
		self.enter(context, '');
		
		arg_item_jqo.addClass('divider');
		
		self.leave(context, Devapt.msg_success);
		return arg_item_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptList
	 * @desc				Render an item TEXT content
	 * @param {object}		arg_deferred		deferred object
	 * @param {object}		arg_item_jqo		
	 * @param {string}		arg_item_content
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_text = function(arg_deferred, arg_item_jqo, arg_item_content)
	{
		var self = this;
		var context = 'render_item_text(deferred,jqo,content)';
		self.enter(context, '');
		self.value(context, 'arg_item_content', arg_item_content);
		
		var a_jqo = $('<a>');
		a_jqo.html(arg_item_content);
		arg_item_jqo.append(a_jqo);
		
		self.leave(context, Devapt.msg_success);
		return arg_item_jqo;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-05-09',
			'updated':'2014-12-13',
			'description':'Container view class to display a list of items.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptContainer;
	var DevaptListClass = new DevaptClass('DevaptList', parent_class, class_settings);
	
	// METHODS
	DevaptListClass.infos.ctor = cb_constructor;
	DevaptListClass.add_public_method('get_node_by_content', {}, cb_get_node_by_content);
	DevaptListClass.add_public_method('render_begin', {}, cb_render_begin);
	DevaptListClass.add_public_method('render_item_node', {}, cb_render_item_node);
	DevaptListClass.add_public_method('render_item_divider', {}, cb_render_item_divider);
	DevaptListClass.add_public_method('render_item_text', {}, cb_render_item_text);
	
	// PROPERTIES
	
	
	return DevaptListClass;
} );
/**
 * @file        plugins/backend-foundation5/containers/pgrid.js
 * @desc        Foundation 5 Position Grid class
 *				API:
 *					EVENTS:
 *						top-left-clicked
 *						top-center-clicked
 *						top-right-clicked
 *						center-left-clicked
 *						center-center-clicked
 *						center-right-clicked
 *						bottom-left-clicked
 *						bottom-center-clicked
 *						bottom-right-clicked
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-08-01
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/containers/pgrid',['Devapt', 'core/types', 'object/class', 'views/container', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptContainer, undefined)
{
	/**
	 * @public
	 * @class				DevaptPGrid
	 * @desc				Position Grid view class
	 * @param {string}		arg_name			View name (string)
	 * @param {object}		arg_parent_jqo		jQuery object to attach the view to
	 * @param {object|null}	arg_options			Associative array of options
	 * @return {nothing}
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptPGrid
	 * @desc				Begin the render of the container
	 * @return {nothing}
	 */
	var cb_render_begin = function()
	{
		var self = this;
		var context = 'render_begin()';
		self.enter(context, '');
		
		
		// CREATE DIV ROW
		self.content_jqo = $('<div>');
		self.parent_jqo.append(self.content_jqo);
		self.content_jqo.addClass('row');
		self.content_jqo.addClass('devapt_row');
		
		// CREATE TOP ROW
		self.row_top_jqo = $('<div>');
		self.content_jqo.append(self.row_top_jqo);
		self.row_top_jqo.addClass('row');
		self.row_top_jqo.addClass('devapt_row');
		self.row_top_jqo.css('min-height', self.top_min_height);
		self.row_top_jqo.css('max-height', self.top_max_height);
		self.row_top_jqo.css('height', self.top_prefered_height);
		
		// CREATE TOP ROW
		self.row_center_jqo = $('<div>');
		self.content_jqo.append(self.row_center_jqo);
		self.row_center_jqo.addClass('row');
		self.row_center_jqo.addClass('devapt_row');
		self.row_center_jqo.css('min-height', self.center_min_height);
		self.row_center_jqo.css('max-height', self.center_max_height);
		self.row_center_jqo.css('height', self.center_prefered_height);
		
		// CREATE TOP ROW
		self.row_bottom_jqo = $('<div>');
		self.content_jqo.append(self.row_bottom_jqo);
		self.row_bottom_jqo.addClass('row');
		self.row_bottom_jqo.addClass('devapt_row');
		self.row_bottom_jqo.css('min-height', self.bottom_min_height);
		self.row_bottom_jqo.css('max-height', self.bottom_max_height);
		self.row_bottom_jqo.css('height', self.bottom_prefered_height);
		
		
		// INIT BLOCK WIDTHS
		var cols = null;
		var small_cols = null;
		var medium_cols = null;
		var large_cols = null;
		
		// ROW TOP CONTENT
		cols = self.top_left_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.top_left_jqo = $('<div top_left_jqo="">');
		self.row_top_jqo.append(self.top_left_jqo);
		self.top_left_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('top-left-clicked'); } );
		
		cols = self.top_center_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.top_center_jqo = $('<div top_center_jqo="">');
		self.row_top_jqo.append(self.top_center_jqo);
		self.top_center_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('top-center-clicked'); } );
		
		cols = self.top_right_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.top_right_jqo = $('<div top_right_jqo="">');
		self.row_top_jqo.append(self.top_right_jqo);
		self.top_right_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('top-right-clicked'); } );
		
		
		// ROW CENTER CONTENT
		cols = self.center_left_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.center_left_jqo = $('<div center_left_jqo="">');
		self.row_center_jqo.append(self.center_left_jqo);
		self.center_left_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('center-left-clicked'); } );
		
		cols = self.center_center_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.center_center_jqo = $('<div center_center_jqo="">');
		self.row_center_jqo.append(self.center_center_jqo);
		self.center_center_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('center-center-clicked'); } );
		
		cols = self.center_right_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.center_right_jqo = $('<div center_right_jqo="">');
		self.row_center_jqo.append(self.center_right_jqo);
		self.center_right_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('center-right-clicked'); } );
		
		
		// ROW BOTTOM CONTENT
		cols = self.bottom_left_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.bottom_left_jqo = $('<div bottom_left_jqo="">');
		self.row_bottom_jqo.append(self.bottom_left_jqo);
		self.bottom_left_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('bottom-left-clicked'); } );
		
		cols = self.bottom_center_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.bottom_center_jqo = $('<div bottom_center_jqo="">');
		self.row_bottom_jqo.append(self.bottom_center_jqo);
		self.bottom_center_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('bottom-center-clicked'); } );
		
		cols = self.bottom_right_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.bottom_right_jqo = $('<div bottom_right_jqo="">');
		self.row_bottom_jqo.append(self.bottom_right_jqo);
		self.bottom_right_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('bottom-right-clicked'); } );
		
		
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPGrid
	 * @desc				Render an empty item node
	 * @param {integer} 	arg_item_index		item index
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_node = function(arg_item_index)
	{
		var self = this;
		var context = 'render_item_node(index)';
		self.enter(context, '');
		
		
		var new_item = $('<div>');
		
		
		self.leave(context, 'success');
		return new_item;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPGrid
	 * @desc				Append an item to the view
	 * @param {object}		arg_container_item		A plain object of a container item
	 * @return {nothing}
	 */
	var cb_append_item_node = function(arg_container_item)
	{
		var self = this;
		var context = 'append_item_node(item)';
		self.enter(context, '');
		
		
		var arg_item_index = arg_container_item.index;
		var position = self.items_positions[self.items_positions.length - 1];
		if (self.items_positions.length > arg_item_index)
		{
			position = self.items_positions[arg_item_index];
		}
		
		var node_jqo = null;
		switch(position)
		{
			// TOP ROW POSITIONS
			case 'top-left':
			case 'tl':
				node_jqo = self.top_left_jqo;
				break;
			case 'top-center':
			case 'tc':
				node_jqo = self.top_center_jqo;
				break;
			case 'top-right':
			case 'tr':
				node_jqo = self.top_right_jqo;
				break;
			
			// CENTER ROW POSITIONS
			case 'center-left':
			case 'cl':
				node_jqo = self.center_left_jqo;
				break;
			case 'center-center':
			case 'cc':
				node_jqo = self.center_center_jqo;
				break;
			case 'center-right':
			case 'cr':
				node_jqo = self.center_right_jqo;
				break;
			
			// BOTTOM ROW POSITIONS
			case 'bottom-left':
			case 'bl':
				node_jqo = self.bottom_left_jqo;
				break;
			case 'bottom-center':
			case 'bc':
				node_jqo = self.bottom_center_jqo;
				break;
			case 'bottom-right':
			case 'br':
				node_jqo = self.bottom_right_jqo;
				break;
			
			// DEFAULT POSITION
			default:
				node_jqo = self.center_center_jqo;
				break;
		}
		
		node_jqo.append(arg_container_item.node);
		
		
		self.leave(context, Devapt.msg_success);
		return true;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-05-09',
			'updated':'2014-12-13',
			'description':'Container view class to display a positional grid of items.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptContainer;
	var DevaptPGridClass = new DevaptClass('DevaptPGrid', parent_class, class_settings);
	
	// METHODS
	// DevaptPGridClass.infos.ctor = cb_constructor;
	DevaptPGridClass.add_public_method('render_begin', {}, cb_render_begin);
	DevaptPGridClass.add_public_method('render_item_node', {}, cb_render_item_node);
	DevaptPGridClass.add_public_method('append_item_node', {}, cb_append_item_node);
	
	// PROPERTIES
	DevaptPGridClass.add_public_int_property('top_left_columns',		'',	4, false, false, []);
	DevaptPGridClass.add_public_int_property('center_left_columns',		'',	4, false, false, []);
	DevaptPGridClass.add_public_int_property('bottom_left_columns',		'',	4, false, false, []);
	
	DevaptPGridClass.add_public_int_property('top_center_columns',		'',	4, false, false, []);
	DevaptPGridClass.add_public_int_property('center_center_columns',	'',	4, false, false, []);
	DevaptPGridClass.add_public_int_property('bottom_center_columns',	'',	4, false, false, []);
	
	DevaptPGridClass.add_public_int_property('top_right_columns',		'',	4, false, false, []);
	DevaptPGridClass.add_public_int_property('center_right_columns',	'',	4, false, false, []);
	DevaptPGridClass.add_public_int_property('bottom_right_columns',	'',	4, false, false, []);
	
	DevaptPGridClass.add_public_int_property('top_min_height',			'',	100, false, false, []);
	DevaptPGridClass.add_public_int_property('center_min_height',		'',	100, false, false, []);
	DevaptPGridClass.add_public_int_property('bottom_min_height',		'',	100, false, false, []);
	
	DevaptPGridClass.add_public_int_property('top_prefered_height',		'',	100, false, false, []);
	DevaptPGridClass.add_public_int_property('center_prefered_height',	'',	100, false, false, []);
	DevaptPGridClass.add_public_int_property('bottom_prefered_height',	'',	100, false, false, []);
	
	DevaptPGridClass.add_public_int_property('top_max_height',			'',	200, false, false, []);
	DevaptPGridClass.add_public_int_property('center_max_height',		'',	200, false, false, []);
	DevaptPGridClass.add_public_int_property('bottom_max_height',		'',	200, false, false, []);
	
	DevaptPGridClass.add_public_array_property('items_positions',		'',	['center'], false, false, ['view_items_positions'], 'string', ',');
		// top-left/tl, top-center/tc, top-right/tr, center-left/cl, center-center/cc, center-right/cr, bottom-left/bl, bottom-center/bc, bottom-right/br
	
	
	return DevaptPGridClass;
} );
/**
 * @file        plugins/backend-foundation5/containers/rcgrid.js
 * @desc        Foundation 5 Row Column  Grid class
 *				API:
 *					EVENTS:
 *						cell-clicked
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2015-01-01
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/containers/rcgrid',['Devapt', 'core/types', 'object/class', 'views/container', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptContainer, undefined)
{
	/**
	 * @public
	 * @class				DevaptPGrid
	 * @desc				Position Grid view class
	 * @param {string}		arg_name			View name (string)
	 * @param {object}		arg_parent_jqo		jQuery object to attach the view to
	 * @param {object|null}	arg_options			Associative array of options
	 * @return {nothing}
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptPGrid
	 * @desc				Begin the render of the container
	 * @return {nothing}
	 */
	var cb_render_begin = function()
	{
		var self = this;
		var context = 'render_begin()';
		self.enter(context, '');
		
		
		// CREATE DIV ROW
		self.content_jqo = $('<div>');
		self.parent_jqo.append(self.content_jqo);
		self.content_jqo.addClass('row');
		self.content_jqo.addClass('devapt_row');
		
		// CREATE TOP ROW
		self.row_top_jqo = $('<div>');
		self.content_jqo.append(self.row_top_jqo);
		self.row_top_jqo.addClass('row');
		self.row_top_jqo.addClass('devapt_row');
		self.row_top_jqo.css('min-height', self.top_min_height);
		self.row_top_jqo.css('max-height', self.top_max_height);
		self.row_top_jqo.css('height', self.top_prefered_height);
		
		// CREATE TOP ROW
		self.row_center_jqo = $('<div>');
		self.content_jqo.append(self.row_center_jqo);
		self.row_center_jqo.addClass('row');
		self.row_center_jqo.addClass('devapt_row');
		self.row_center_jqo.css('min-height', self.center_min_height);
		self.row_center_jqo.css('max-height', self.center_max_height);
		self.row_center_jqo.css('height', self.center_prefered_height);
		
		// CREATE TOP ROW
		self.row_bottom_jqo = $('<div>');
		self.content_jqo.append(self.row_bottom_jqo);
		self.row_bottom_jqo.addClass('row');
		self.row_bottom_jqo.addClass('devapt_row');
		self.row_bottom_jqo.css('min-height', self.bottom_min_height);
		self.row_bottom_jqo.css('max-height', self.bottom_max_height);
		self.row_bottom_jqo.css('height', self.bottom_prefered_height);
		
		
		// INIT BLOCK WIDTHS
		var cols = null;
		var small_cols = null;
		var medium_cols = null;
		var large_cols = null;
		
		// ROW TOP CONTENT
		cols = self.top_left_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.top_left_jqo = $('<div top_left_jqo="">');
		self.row_top_jqo.append(self.top_left_jqo);
		self.top_left_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('top-left-clicked'); } );
		
		cols = self.top_center_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.top_center_jqo = $('<div top_center_jqo="">');
		self.row_top_jqo.append(self.top_center_jqo);
		self.top_center_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('top-center-clicked'); } );
		
		cols = self.top_right_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.top_right_jqo = $('<div top_right_jqo="">');
		self.row_top_jqo.append(self.top_right_jqo);
		self.top_right_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('top-right-clicked'); } );
		
		
		// ROW CENTER CONTENT
		cols = self.center_left_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.center_left_jqo = $('<div center_left_jqo="">');
		self.row_center_jqo.append(self.center_left_jqo);
		self.center_left_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('center-left-clicked'); } );
		
		cols = self.center_center_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.center_center_jqo = $('<div center_center_jqo="">');
		self.row_center_jqo.append(self.center_center_jqo);
		self.center_center_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('center-center-clicked'); } );
		
		cols = self.center_right_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.center_right_jqo = $('<div center_right_jqo="">');
		self.row_center_jqo.append(self.center_right_jqo);
		self.center_right_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('center-right-clicked'); } );
		
		
		// ROW BOTTOM CONTENT
		cols = self.bottom_left_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.bottom_left_jqo = $('<div bottom_left_jqo="">');
		self.row_bottom_jqo.append(self.bottom_left_jqo);
		self.bottom_left_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('bottom-left-clicked'); } );
		
		cols = self.bottom_center_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.bottom_center_jqo = $('<div bottom_center_jqo="">');
		self.row_bottom_jqo.append(self.bottom_center_jqo);
		self.bottom_center_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('bottom-center-clicked'); } );
		
		cols = self.bottom_right_columns;
		small_cols = cols;
		medium_cols = cols;
		large_cols = cols;
		self.bottom_right_jqo = $('<div bottom_right_jqo="">');
		self.row_bottom_jqo.append(self.bottom_right_jqo);
		self.bottom_right_jqo.addClass('small-' + small_cols + ' medium-' + medium_cols + ' large-' + large_cols + ' columns');
		self.top_left_jqo.click( function(event) { self.fire_event('bottom-right-clicked'); } );
		
		
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPGrid
	 * @desc				Render an empty item node
	 * @param {integer} 	arg_item_index		item index
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_node = function(arg_item_index)
	{
		var self = this;
		var context = 'render_item_node(index)';
		self.enter(context, '');
		
		
		var new_item = $('<div>');
		
		
		self.leave(context, 'success');
		return new_item;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptPGrid
	 * @desc				Append an item to the view
	 * @param {object}		arg_container_item		A plain object of a container item
	 * @return {nothing}
	 */
	var cb_append_item_node = function(arg_container_item)
	{
		var self = this;
		var context = 'append_item_node(item)';
		self.enter(context, '');
		
		
		var arg_item_index = arg_container_item.index;
		var position = self.items_positions[self.items_positions.length - 1];
		if (self.items_positions.length > arg_item_index)
		{
			position = self.items_positions[arg_item_index];
		}
		
		var node_jqo = null;
		switch(position)
		{
			// TOP ROW POSITIONS
			case 'top-left':
			case 'tl':
				node_jqo = self.top_left_jqo;
				break;
			case 'top-center':
			case 'tc':
				node_jqo = self.top_center_jqo;
				break;
			case 'top-right':
			case 'tr':
				node_jqo = self.top_right_jqo;
				break;
			
			// CENTER ROW POSITIONS
			case 'center-left':
			case 'cl':
				node_jqo = self.center_left_jqo;
				break;
			case 'center-center':
			case 'cc':
				node_jqo = self.center_center_jqo;
				break;
			case 'center-right':
			case 'cr':
				node_jqo = self.center_right_jqo;
				break;
			
			// BOTTOM ROW POSITIONS
			case 'bottom-left':
			case 'bl':
				node_jqo = self.bottom_left_jqo;
				break;
			case 'bottom-center':
			case 'bc':
				node_jqo = self.bottom_center_jqo;
				break;
			case 'bottom-right':
			case 'br':
				node_jqo = self.bottom_right_jqo;
				break;
			
			// DEFAULT POSITION
			default:
				node_jqo = self.center_center_jqo;
				break;
		}
		
		node_jqo.append(arg_container_item.node);
		
		
		self.leave(context, Devapt.msg_success);
		return true;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-05-09',
			'updated':'2014-12-13',
			'description':'Container view class to display a positional grid of items.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptContainer;
	var DevaptPGridClass = new DevaptClass('DevaptPGrid', parent_class, class_settings);
	
	// METHODS
	// DevaptPGridClass.infos.ctor = cb_constructor;
	DevaptPGridClass.add_public_method('render_begin', {}, cb_render_begin);
	DevaptPGridClass.add_public_method('render_item_node', {}, cb_render_item_node);
	DevaptPGridClass.add_public_method('append_item_node', {}, cb_append_item_node);
	
	// PROPERTIES
	DevaptPGridClass.add_public_int_property('top_left_columns',		'',	4, false, false, []);
	DevaptPGridClass.add_public_int_property('center_left_columns',		'',	4, false, false, []);
	DevaptPGridClass.add_public_int_property('bottom_left_columns',		'',	4, false, false, []);
	
	DevaptPGridClass.add_public_int_property('top_center_columns',		'',	4, false, false, []);
	DevaptPGridClass.add_public_int_property('center_center_columns',	'',	4, false, false, []);
	DevaptPGridClass.add_public_int_property('bottom_center_columns',	'',	4, false, false, []);
	
	DevaptPGridClass.add_public_int_property('top_right_columns',		'',	4, false, false, []);
	DevaptPGridClass.add_public_int_property('center_right_columns',	'',	4, false, false, []);
	DevaptPGridClass.add_public_int_property('bottom_right_columns',	'',	4, false, false, []);
	
	DevaptPGridClass.add_public_int_property('top_min_height',			'',	100, false, false, []);
	DevaptPGridClass.add_public_int_property('center_min_height',		'',	100, false, false, []);
	DevaptPGridClass.add_public_int_property('bottom_min_height',		'',	100, false, false, []);
	
	DevaptPGridClass.add_public_int_property('top_prefered_height',		'',	100, false, false, []);
	DevaptPGridClass.add_public_int_property('center_prefered_height',	'',	100, false, false, []);
	DevaptPGridClass.add_public_int_property('bottom_prefered_height',	'',	100, false, false, []);
	
	DevaptPGridClass.add_public_int_property('top_max_height',			'',	200, false, false, []);
	DevaptPGridClass.add_public_int_property('center_max_height',		'',	200, false, false, []);
	DevaptPGridClass.add_public_int_property('bottom_max_height',		'',	200, false, false, []);
	
	DevaptPGridClass.add_public_array_property('items_positions',		'',	['center'], false, false, ['view_items_positions'], 'string', ',');
		// top-left/tl, top-center/tc, top-right/tr, center-left/cl, center-center/cc, center-right/cr, bottom-left/bl, bottom-center/bc, bottom-right/br
	
	
	return DevaptPGridClass;
} );
/**
 * @file        plugins/backend-foundation5/views/row.js
 * @desc        Foundation 5 row class
 *				API:
 *					EVENTS:
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-05-09
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/containers/row',['Devapt', 'core/types', 'object/class', 'views/container', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptContainer, undefined)
{
	/**
	 * @public
	 * @class				DevaptRow
	 * @desc				Row view class
	 */
	
	var $ = window.$;
	
	/**
	 * @public
	 * @memberof			DevaptRow
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = 'constructor(' + self.name + ')';
		self.enter(context, '');
		
		
		self.items_jquery_parent = null;
		self.items_jquery_filter = 'li';
		
		// self.add_event_callback('devapt.events.container.selected', [self, self.on_selected_item_event], false);
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptList
	 * @desc				Begin the render of the container
	 * @return {nothing}
	 */
	var cb_render_begin = function()
	{
		var self = this;
		var context = 'render_begin()';
		self.enter(context, '');
		
		
		// CHECK CONTENT NODE
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		
		// self.content_jqo = $('<div>');
		self.content_jqo.addClass('row');
		self.content_jqo.addClass('devapt_row');
		// self.parent_jqo.append(self.content_jqo);
		
		self.items_jquery_parent = self.content_jqo;
		
		
		self.leave(context, 'success');
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptList
	 * @desc				Render an empty item node
	 * @param {integer} 	arg_item_index		item index
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_node = function(arg_item_index)
	{
		var self = this;
		var context = 'render_item_node(index)';
		self.enter(context, '');
		
		
		var node_jqo = $('<div>');
		var item_options = self.get_item_options(arg_item_index, { columns:1, small_columns:null, medium_columns:null, large_columns:null, centered:false });
		
		var item_columns		= DevaptTypes.to_integer(item_options.columns, 1);
		var item_small_columns	= DevaptTypes.to_integer(item_options.small_columns, item_columns);
		var item_medium_columns	= DevaptTypes.to_integer(item_options.medium_columns, item_columns);
		var item_large_columns	= DevaptTypes.to_integer(item_options.large_columns, item_columns);
		
		node_jqo.addClass('small-' + item_small_columns + ' medium-' + item_medium_columns + ' large-' + item_large_columns + ' columns');
		
		
		self.leave(context, 'success');
		return node_jqo;
	};
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-07-26',
			'updated':'2014-12-13',
			'description':'Container view class to display a row of items in columns (max=12).'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptContainer;
	var DevaptRowClass = new DevaptClass('DevaptRow', parent_class, class_settings);
	
	// METHODS
	DevaptRowClass.infos.ctor = cb_constructor;
	DevaptRowClass.add_public_method('render_begin', {}, cb_render_begin);
	DevaptRowClass.add_public_method('render_item_node', {}, cb_render_item_node);
	
	// PROPERTIES
	
	
	
	return DevaptRowClass;
} );
/**
 * @file        plugins/backend-foundation5/containers/table.js
 * @desc        Foundation 5 list class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-07-27
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/containers/table',['Devapt', 'core/types', 'object/class', 'views/container', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptContainer, undefined)
{
	/**
	 * @public
	 * @class				DevaptTable
	 * @desc				Table view class
	 * @param {string}		arg_name			View name (string)
	 * @param {object}		arg_parent_jqo		jQuery object to attach the view to
	 * @param {object|null}	arg_options			Associative array of options
	 * @return {nothing}
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptTable
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = 'DevaptTable.constructor(' + self.name + ')';
		self.enter(context, '');
		
		
		// DEBUG
		// self.trace = true;
		// console.log(self.parent_jqo === null, 'parent is null?');
		
		self.table_header_jqo	= null;
		self.table_body_jqo		= null;
		self.has_divider		= false;
		
		self.items_jquery_parent = null;
		self.items_jquery_filter = 'tr';
		
		// self.add_event_callback('devapt.events.container.selected', [self, self.on_selected_item_event], false);
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptTable
	 * @desc				Get a container item node by the node item text
	 * @param {string}		arg_node_item_text		node item text
	 * @return {object}		node jQuery object
	 */
	var cb_get_node_by_content = function(arg_node_item_text)
	{
		var self = this;
		var context = 'get_node_by_content(text)';
		self.enter(context, '');
		
		
		// SELECT ANCHOR BY CONTENT
		var node_jqo = $('tr:contains("' + arg_node_item_text + '"):eq(0)', self.items_jquery_parent);
		if ( ! node_jqo)
		{
			self.leave(context, Devapt.msg_failure);
			return null;
		}
		
		
		self.leave(context, Devapt.msg_success);
		return node_jqo;
	}
	
	
	
	/**
	 * @public
	 * @memberof			DevaptTable
	 * @desc				Begin the render of the container
	 * @return {nothing}
	 */
	var cb_render_begin = function()
	{
		var self = this;
		var context = 'render_begin()';
		self.enter(context, '');
		
		
		// CHECK CONTENT NODE
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		
		self.table_jqo = $('<table>');
		self.content_jqo.append(self.table_jqo);
		
		self.table_header_jqo = $('<thead>');
		self.table_jqo.append(self.table_header_jqo);
		
		self.table_body_jqo = $('<tbody>');
		self.table_jqo.append(self.table_body_jqo);
		
		self.table_footer_jqo = $('<tfoot>');
		self.table_jqo.append(self.table_footer_jqo);
		
		// HEADERS
		if ( DevaptTypes.is_array(self.items_labels) )
		{
			var tr_jqo = $('<tr>');
			self.table_header_jqo.append(tr_jqo);
			
			var col_index = 0;
			for(;col_index < self.items_labels.length ; ++col_index)
			{
				var th_jqo = $('<th>');
				var col_label = self.items_labels[col_index];
				th_jqo.html(col_label);
				tr_jqo.append(th_jqo);
			}
		}
		
		self.items_jquery_parent = self.table_body_jqo;
		
		
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptTable
	 * @desc				Render an empty item node
	 * @param {integer} 	arg_item_index		item index
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_node = function(arg_item_index)
	{
		var self = this;
		var context = 'render_item_node(index)';
		self.enter(context, '');
		
		
		var node_jqo = $('<tr>');
		node_jqo.click(
			function()
			{
				var node_index = parseInt( node_jqo.index() );
				
				// TODO
				self.select(node_index);
			}
		);
		
		
		self.leave(context, 'success');
		return node_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptMixinRenderItems
	 * @desc				Render an empty record node for the container item
	 * @param {object}		arg_item_jqo		item node
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_record_node = function(arg_item_jqo)
	{
		var self = this;
		var context = 'render_item_record_node(item node)';
		self.enter(context, '');
		
		// NOTHING TO DO
		
		self.leave(context, Devapt.msg_success);
		return arg_item_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptMixinRenderItems
	 * @desc				Render an empty record field node for the container item
	 * @param {object}		arg_item_jqo		item node
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_field_node = function(arg_item_jqo)
	{
		var self = this;
		var context = 'render_item_field_node(item node)';
		self.enter(context, '');
		
		var td_jqo = $('<td>');
		arg_item_jqo.append(td_jqo);
		
		self.leave(context, Devapt.msg_success);
		return td_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptTable
	 * @desc				Render an item RECORD content
	 * @param {object}		arg_deferred		deferred object
	 * @param {object}		arg_item_jqo		item jQuery object node
	 * @param {array}		arg_item_object		item object content
	 * @return {object}		jQuery object node
	 */
/*	var cb_render_item_object = function(arg_deferred, arg_item_jqo, arg_item_object)
	{
		var self = this;
		var context = 'render_item_object(deferred,jqo,content)';
		self.enter(context, '');
		
		
		// CHECK RECORD
		var record = arg_item_object;
		self.assert_not_null(context, 'record', record);
		self.value(context, 'record', record);
		
		// ASSERT NODE
		var tr_jqo = arg_item_jqo;
		self.assert_not_null(context, 'tr_jqo', tr_jqo);
		
		
		// LOOP ON FIELDS
		for(var field_index in self.items_fields)
		{
			var field_name = self.items_fields[field_index];
			var field_value = record[field_name];
			var field_jqo = $('<td>');
			field_jqo.html(field_value);
			tr_jqo.append(field_jqo);
		}
		
		// ATTACH RECORD
		arg_item_jqo.data('record', arg_item_object);
		
		
		self.leave(context, Devapt.msg_success);
		return arg_item_jqo;
	}*/
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-07-27',
			'updated':'2015-03-28',
			'description':'Container view class to display a table of items.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptContainer;
	var DevaptTableClass = new DevaptClass('DevaptTable', parent_class, class_settings);
	
	// METHODS
	DevaptTableClass.infos.ctor = cb_constructor;
	DevaptTableClass.add_public_method('get_node_by_content', {}, cb_get_node_by_content);
	DevaptTableClass.add_public_method('render_begin', {}, cb_render_begin);
	DevaptTableClass.add_public_method('render_item_node', {}, cb_render_item_node);
	DevaptTableClass.add_public_method('render_item_record_node', {}, cb_render_item_record_node);
	DevaptTableClass.add_public_method('render_item_field_node', {}, cb_render_item_field_node);
	// DevaptTableClass.add_public_method('render_item_object', {}, cb_render_item_object);
	
	// PROPERTIES
	
	
	return DevaptTableClass;
} );
/**
 * @file        plugins/backend-foundation5/containers/tabs.js
 * @desc        Foundation 5 list class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-07-27
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/containers/tabs',['Devapt', 'core/types', 'object/class', 'views/container', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptContainer, undefined)
{
	/**
	 * @public
	 * @class				DevaptTabs
	 * @desc				Tabs panel view class
	 * @param {string}		arg_name			View name (string)
	 * @param {object}		arg_parent_jqo		jQuery object to attach the view to
	 * @param {object|null}	arg_options			Associative array of options
	 * @return {nothing}
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptTabs
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = 'constructor(' + self.name + ')';
		self.enter(context, '');
		
		
		self.tabs_jqo			= null;
		self.tabs_content_jqo	= null;
		self.has_divider		= false;
		
		// self.add_event_callback('devapt.events.container.selected', [self, self.on_selected_item_event], false);
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptTabs
	 * @desc				Begin the render of the container
	 * @return {nothing}
	 */
	var cb_render_begin = function()
	{
		var self = this;
		var context = 'render_begin()';
		self.enter(context, '');
		
		
		// CHECK CONTENT NODE
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		
		self.tabs_jqo = $('<dl>');
		self.tabs_jqo.addClass('tabs');
		self.tabs_jqo.attr('data-tab', '');
		
		self.tabs_content_jqo = $('<div>');
		self.tabs_content_jqo.addClass('tabs-content');
		
		self.content_jqo.append(self.tabs_jqo);
		self.content_jqo.append(self.tabs_content_jqo);
		self.content_jqo.append( $('<div class="clearfix">') );
		
		if (self.is_vertical)
		{
			self.tabs_jqo.addClass('vertical');
			self.tabs_content_jqo.addClass('vertical');
		}
		
		
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @desc				End the render of the container
	 * @return {nothing}
	 */
	var cb_render_end = function()
	{
		var self = this;
		var context = 'render_end()';
		self.enter(context, '');
		
		
		// INIT FOUNDATION
		self.content_jqo.foundation();
		
		// HANDLE EVENT
		self.tabs_jqo.on('toggled', 
			function (event, tabs)
			{
				// SEND EVENT
				self.fire_event('devapt.tabs.changed', [event, tabs]);
			}
		);
		
		// ENABLE ACTIVE TAB
		if ( ! $('.content.active', self.content_jqo) )
		{
			$('.content', self.content_jqo)[0].addClass('active');
		}
		
		
		self.leave(context, Devapt.msg_success);
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptTabs
	 * @desc				Render an empty item node
	 * @param {integer} 	arg_item_index		item index
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_node = function(arg_item_index)
	{
		var self = this;
		var context = 'render_item_node(index)';
		self.enter(context, '');
		
		var node_jqo = $('<div>');
		node_jqo.addClass('content');
		node_jqo.attr('id', self.name + '_content_' + arg_item_index + '_id');
		
		self.leave(context, 'success');
		return node_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptTabs
	 * @desc				Render an item TEXT content
	 * @param {object}		arg_deferred		deferred object
	 * @param {object}		arg_item_jqo		
	 * @param {string}		arg_item_content
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_text = function(arg_deferred, arg_item_jqo, arg_item_content)
	{
		var self = this;
		var context = 'render_item_text(deferred,jqo,content)';
		self.enter(context, '');
		
		var p_jqo = $('<p>');
		p_jqo.html(arg_item_content);
		arg_item_jqo.append(p_jqo);
		
		self.leave(context, Devapt.msg_success);
		return arg_item_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptContainer
	 * @desc				Append an item to the view
	 * @param {object}		arg_container_item		A plain object of a container item
	 * @return {nothing}
	 */
	var cb_append_item_node = function(arg_container_item)
	{
		var self = this;
		var context = 'append_item_node(item)';
		self.enter(context, '');
		
		
		// GET ITEM OPTIONS
		var item_options = self.get_item_options(arg_container_item.index, { label:'tab ' + arg_container_item.index, active:false });
		
		
		// TABS CONTENT
		self.tabs_content_jqo.append(arg_container_item.node);
		
		
		// TABS MENU
		var li_jqo = $('<dd>');
		li_jqo.addClass('tab-title');
		self.tabs_jqo.append(li_jqo);
		
		var a_jqo = $('<a href="#">');
		var item_content_id = '#' + self.name + '_content_' + arg_item_record.index + '_id';
		var item_label = item_options.label;
		if (item_options.active)
		{
			li_jqo.addClass('active');
			arg_item_jqo.addClass('active');
		}
		
		a_jqo.html(item_label);
		a_jqo.attr('href', item_content_id);
		li_jqo.append(a_jqo);
		
		
		self.leave(context, 'success');
		return true;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-07-27',
			'updated':'2014-12-13',
			'description':'Container view class to display a panel of tabs of items, horizontally (default), vertically (is_vertical:true).'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptContainer;
	var DevaptTabsClass = new DevaptClass('DevaptTabs', parent_class, class_settings);
	
	// METHODS
	DevaptTabsClass.infos.ctor = cb_constructor;
	DevaptTabsClass.add_public_method('render_begin', {}, cb_render_begin);
	DevaptTabsClass.add_public_method('render_end', {}, cb_render_end);
	DevaptTabsClass.add_public_method('render_item_node', {}, cb_render_item_node);
	DevaptTabsClass.add_public_method('render_item_text', {}, cb_render_item_text);
	DevaptTabsClass.add_public_method('append_item_node', {}, cb_append_item_node);
	
	// PROPERTIES
	DevaptTabsClass.add_public_bool_property('is_vertical',	'',	false, false, false, []);
	
	
	return DevaptTabsClass;
} );
/**
 * @file        plugins/backend-foundation5/containers/vbox.js
 * @desc        Foundation 5 VBox class
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2014-06-28
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-foundation5/containers/vbox',['Devapt', 'core/types', 'object/class', 'views/container', 'plugins/backend-foundation5/foundation-init'],
function(Devapt, DevaptTypes, DevaptClass, DevaptContainer, undefined)
{
	/**
	 * @public
	 * @class				DevaptVBox
	 * @desc				Vertical Box view class
	 * @param {string}		arg_name			View name (string)
	 * @param {object}		arg_parent_jqo		jQuery object to attach the view to
	 * @param {object|null}	arg_options			Associative array of options
	 * @return {nothing}
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptVBox
	 * @desc				Constructor
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = 'constructor(' + self.name + ')';
		self.enter(context, '');
		
		
		self.items_jquery_parent = null;
		self.items_jquery_filter = 'div.row';
		
		// self.add_event_callback('devapt.events.container.selected', [self, self.on_selected_item_event], false);
		
		
		// CONSTRUCTOR END
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptVBox
	 * @desc				Begin the render of the container
	 * @return {nothing}
	 */
	var cb_render_begin = function()
	{
		var self = this;
		var context = 'render_begin()';
		self.enter(context, '');
		
		
		// CHECK CONTENT NODE
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		
		// CREATE MAIN NODE
		self.content_jqo.addClass('row');
		
		self.items_jquery_parent = self.content_jqo;
		
		
		self.leave(context, 'success');
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptList
	 * @desc				Render an empty item node
	 * @param {integer} 	arg_item_index		item index
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_node = function(arg_item_index)
	{
		var self = this;
		var context = 'render_item_node(index)';
		self.enter(context, '');
		
		var node_jqo = $('<div>');
		node_jqo.addClass('row');
		
		self.leave(context, 'success');
		return node_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptList
	 * @desc				Render an divider item content
	 * @param {object}		arg_deferred		deferred object
	 * @param {object}		arg_item_jqo		
	 * @param {string}		arg_item_content
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_divider = function(arg_deferred, arg_item_jqo, arg_item_content)
	{
		var self = this;
		var context = 'render_item_divider(deferred,jqo,content)';
		self.enter(context, '');
		
		if ( ! arg_item_jqo.hasClass('row') )
		{
			arg_item_jqo.addClass('row');
		}
		
		self.leave(context, Devapt.msg_success);
		return arg_item_jqo;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-05-09',
			'updated':'2014-12-13',
			'description':'Container view class to display a list of items.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptContainer;
	var DevaptVBoxClass = new DevaptClass('DevaptVBox', parent_class, class_settings);
	
	// METHODS
	DevaptVBoxClass.infos.ctor = cb_constructor;
	DevaptVBoxClass.add_public_method('render_begin', {}, cb_render_begin);
	DevaptVBoxClass.add_public_method('render_item_node', {}, cb_render_item_node);
	DevaptVBoxClass.add_public_method('render_item_divider', {}, cb_render_item_divider);
	
	// PROPERTIES
	DevaptVBoxClass.add_public_int_property('small_device_blocks',	'',	2, false, false, []);
	DevaptVBoxClass.add_public_int_property('medium_device_blocks',	'',	4, false, false, []);
	DevaptVBoxClass.add_public_int_property('large_device_blocks',	'',	6, false, false, []);
	
	
	
	return DevaptVBoxClass;
} );
/**
 * @file        plugins/backend-foundation5/containers/all.js
 * @desc        Load all Devapt plugin classes
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2015-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
	'plugins/backend-foundation5/containers/all',[	'plugins/backend-foundation5/containers/accordion',
		'plugins/backend-foundation5/containers/dropdown',
		'plugins/backend-foundation5/containers/hbox',
		'plugins/backend-foundation5/containers/list',
		'plugins/backend-foundation5/containers/pgrid',
		'plugins/backend-foundation5/containers/rcgrid',
		'plugins/backend-foundation5/containers/row',
		'plugins/backend-foundation5/containers/table',
		'plugins/backend-foundation5/containers/tabs',
		'plugins/backend-foundation5/containers/vbox'
	],
	function()
	{
	}
);
/**
 * @file        plugins/backend-foundation5/all.js
 * @desc        Load all Devapt plugin classes
 * @ingroup     DEVAPT_FOUNDATION5
 * @date        2015-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
	'plugins/backend-foundation5/all',[
		'plugins/backend-foundation5/backend',
		'plugins/backend-foundation5/views/all',
		'plugins/backend-foundation5/containers/all'
	],
	function()
	{
	}
);
/*! jQuery UI - v1.11.4 - 2015-03-11
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, position.js, accordion.js, autocomplete.js, button.js, datepicker.js, dialog.js, draggable.js, droppable.js, effect.js, effect-blind.js, effect-bounce.js, effect-clip.js, effect-drop.js, effect-explode.js, effect-fade.js, effect-fold.js, effect-highlight.js, effect-puff.js, effect-pulsate.js, effect-scale.js, effect-shake.js, effect-size.js, effect-slide.js, effect-transfer.js, menu.js, progressbar.js, resizable.js, selectable.js, selectmenu.js, slider.js, sortable.js, spinner.js, tabs.js, tooltip.js
* Copyright 2015 jQuery Foundation and other contributors; Licensed MIT */

(function(e){"function"==typeof define&&define.amd?define('jquery-ui',["jquery"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}function s(e){for(var t,i;e.length&&e[0]!==document;){if(t=e.css("position"),("absolute"===t||"relative"===t||"fixed"===t)&&(i=parseInt(e.css("zIndex"),10),!isNaN(i)&&0!==i))return i;e=e.parent()}return 0}function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=a(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function a(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",o)}function o(){e.datepicker._isDisabledDatepicker(v.inline?v.dpDiv.parent()[0]:v.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function r(t,i){e.extend(t,i);for(var s in i)null==i[s]&&(t[s]=i[s]);return t}function h(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var l=0,u=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,n=u.call(arguments,1),a=0,o=n.length;o>a;a++)for(i in n[a])s=n[a][i],n[a].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(n){var a="string"==typeof n,o=u.call(arguments,1),r=this;return a?this.each(function(){var i,a=e.data(this,s);return"instance"===n?(r=a,!1):a?e.isFunction(a[n])&&"_"!==n.charAt(0)?(i=a[n].apply(a,o),i!==a&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+n+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+n+"'")}):(o.length&&(n=e.widget.extend.apply(null,[n].concat(o))),this.each(function(){var t=e.data(this,s);t?(t.option(n||{}),t._init&&t._init()):e.data(this,s,new i(n,this))})),r}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=l++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var d=!1;e(document).mouseup(function(){d=!1}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!d){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),d=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),d=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function t(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}function s(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var n,a,o=Math.max,r=Math.abs,h=Math.round,l=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==n)return n;var t,i,s=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=s.children()[0];return e("body").append(s),t=a.offsetWidth,s.css("overflow","scroll"),i=a.offsetWidth,t===i&&(i=s[0].clientWidth),s.remove(),n=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),s=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,a="scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight;return{width:a?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||n?i.width():i.outerWidth(),height:s||n?i.height():i.outerHeight()}}},e.fn.position=function(n){if(!n||!n.of)return f.apply(this,arguments);n=e.extend({},n);var p,m,g,v,y,b,_=e(n.of),x=e.position.getWithinInfo(n.within),w=e.position.getScrollInfo(x),k=(n.collision||"flip").split(" "),T={};return b=s(_),_[0].preventDefault&&(n.at="left top"),m=b.width,g=b.height,v=b.offset,y=e.extend({},v),e.each(["my","at"],function(){var e,t,i=(n[this]||"").split(" ");1===i.length&&(i=l.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=l.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=d.exec(i[0]),t=d.exec(i[1]),T[this]=[e?e[0]:0,t?t[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===k.length&&(k[1]=k[0]),"right"===n.at[0]?y.left+=m:"center"===n.at[0]&&(y.left+=m/2),"bottom"===n.at[1]?y.top+=g:"center"===n.at[1]&&(y.top+=g/2),p=t(T.at,m,g),y.left+=p[0],y.top+=p[1],this.each(function(){var s,l,u=e(this),d=u.outerWidth(),c=u.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),D=d+f+i(this,"marginRight")+w.width,S=c+b+i(this,"marginBottom")+w.height,M=e.extend({},y),C=t(T.my,u.outerWidth(),u.outerHeight());"right"===n.my[0]?M.left-=d:"center"===n.my[0]&&(M.left-=d/2),"bottom"===n.my[1]?M.top-=c:"center"===n.my[1]&&(M.top-=c/2),M.left+=C[0],M.top+=C[1],a||(M.left=h(M.left),M.top=h(M.top)),s={marginLeft:f,marginTop:b},e.each(["left","top"],function(t,i){e.ui.position[k[t]]&&e.ui.position[k[t]][i](M,{targetWidth:m,targetHeight:g,elemWidth:d,elemHeight:c,collisionPosition:s,collisionWidth:D,collisionHeight:S,offset:[p[0]+C[0],p[1]+C[1]],my:n.my,at:n.at,within:x,elem:u})}),n.using&&(l=function(e){var t=v.left-M.left,i=t+m-d,s=v.top-M.top,a=s+g-c,h={target:{element:_,left:v.left,top:v.top,width:m,height:g},element:{element:u,left:M.left,top:M.top,width:d,height:c},horizontal:0>i?"left":t>0?"right":"center",vertical:0>a?"top":s>0?"bottom":"middle"};d>m&&m>r(t+i)&&(h.horizontal="center"),c>g&&g>r(s+a)&&(h.vertical="middle"),h.important=o(r(t),r(i))>o(r(s),r(a))?"horizontal":"vertical",n.using.call(this,e,h)}),u.offset(e.extend(M,{using:l}))})},e.ui.position={fit:{left:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=e.left-t.collisionPosition.marginLeft,h=n-r,l=r+t.collisionWidth-a-n;t.collisionWidth>a?h>0&&0>=l?(i=e.left+h+t.collisionWidth-a-n,e.left+=h-i):e.left=l>0&&0>=h?n:h>l?n+a-t.collisionWidth:n:h>0?e.left+=h:l>0?e.left-=l:e.left=o(e.left-r,e.left)},top:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollTop:s.offset.top,a=t.within.height,r=e.top-t.collisionPosition.marginTop,h=n-r,l=r+t.collisionHeight-a-n;t.collisionHeight>a?h>0&&0>=l?(i=e.top+h+t.collisionHeight-a-n,e.top+=h-i):e.top=l>0&&0>=h?n:h>l?n+a-t.collisionHeight:n:h>0?e.top+=h:l>0?e.top-=l:e.top=o(e.top-r,e.top)}},flip:{left:function(e,t){var i,s,n=t.within,a=n.offset.left+n.scrollLeft,o=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=e.left-t.collisionPosition.marginLeft,u=l-h,d=l+t.collisionWidth-o-h,c="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>u?(i=e.left+c+p+f+t.collisionWidth-o-a,(0>i||r(u)>i)&&(e.left+=c+p+f)):d>0&&(s=e.left-t.collisionPosition.marginLeft+c+p+f-h,(s>0||d>r(s))&&(e.left+=c+p+f))},top:function(e,t){var i,s,n=t.within,a=n.offset.top+n.scrollTop,o=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=e.top-t.collisionPosition.marginTop,u=l-h,d=l+t.collisionHeight-o-h,c="top"===t.my[1],p=c?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>u?(s=e.top+p+f+m+t.collisionHeight-o-a,(0>s||r(u)>s)&&(e.top+=p+f+m)):d>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-h,(i>0||d>r(i))&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,s,n,o,r=document.getElementsByTagName("body")[0],h=document.createElement("div");t=document.createElement(r?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},r&&e.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in s)t.style[o]=s[o];t.appendChild(h),i=r||document.documentElement,i.insertBefore(t,i.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",n=e(h).offset().left,a=n>10&&11>n,t.innerHTML="",i.removeChild(t)}()}(),e.ui.position,e.widget("ui.accordion",{version:"1.11.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||t.active!==!1&&null!=t.active||(t.active=0),this._processPanels(),0>t.active&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),e=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){return"active"===e?(this._activate(t),void 0):("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||this.options.active!==!1||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),"disabled"===e&&(this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)),void 0)},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,s=this.headers.length,n=this.headers.index(t.target),a=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:a=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:a=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:a=this.headers[0];break;case i.END:a=this.headers[s-1]}a&&(e(t.target).attr("tabIndex",-1),e(a).attr("tabIndex",0),a.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),t.active===!1&&t.collapsible===!0||!this.headers.length?(t.active=!1,this.active=e()):t.active===!1?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var e=this.headers,t=this.panels;this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.panels=this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(),t&&(this._off(e.not(this.headers)),this._off(t.not(this.panels)))},_refresh:function(){var t,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var t=e(this),i=t.uniqueId().attr("id"),s=t.next(),n=s.uniqueId().attr("id");t.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(t=n.height(),this.element.siblings(":visible").each(function(){var i=e(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(t-=i.outerHeight(!0))}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===s&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css("height","").height())}).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n[0]===s[0],o=a&&i.collapsible,r=o?e():n.next(),h=s.next(),l={oldHeader:s,oldPanel:h,newHeader:o?e():n,newPanel:r};t.preventDefault(),a&&!i.collapsible||this._trigger("beforeActivate",t,l)===!1||(i.active=o?!1:this.headers.index(n),this.active=a?e():n,this._toggle(l),s.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&s.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),a||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass("ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,s=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,t):(s.hide(),i.show(),this._toggleComplete(t)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(e(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(e,t,i){var s,n,a,o=this,r=0,h=e.css("box-sizing"),l=e.length&&(!t.length||e.index()<t.index()),u=this.options.animate||{},d=l&&u.down||u,c=function(){o._toggleComplete(i)};return"number"==typeof d&&(a=d),"string"==typeof d&&(n=d),n=n||d.easing||u.easing,a=a||d.duration||u.duration,t.length?e.length?(s=e.show().outerHeight(),t.animate(this.hideProps,{duration:a,easing:n,step:function(e,t){t.now=Math.round(e)}}),e.hide().animate(this.showProps,{duration:a,easing:n,complete:c,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?"content-box"===h&&(r+=i.now):"content"!==o.options.heightStyle&&(i.now=Math.round(s-t.outerHeight()-r),r=0)}}),void 0):t.animate(this.hideProps,a,n,c):e.animate(this.showProps,a,n,c)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}}),e.widget("ui.menu",{version:"1.11.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(t){var i=e(t.target);!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var i=e(t.currentTarget);
i.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){var i,s,n,a,o=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:o=!1,s=this.previousFilter||"",n=String.fromCharCode(t.keyCode),a=!1,clearTimeout(this.filterTimer),n===s?a=!0:n=s+n,i=this._filterMenuItems(n),i=a&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(t.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(t,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}o&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(e):this.select(e))},refresh:function(){var t,i,s=this,n=this.options.icons.submenu,a=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),a.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.parent(),s=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(s),t.attr("aria-labelledby",i.attr("id"))}),t=a.add(this.element),i=t.find(this.options.items),i.not(".ui-menu-item").each(function(){var t=e(this);s._isDivider(t)&&t.addClass("ui-widget-content ui-menu-divider")}),i.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},focus:function(e,t){var i,s;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),s=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=t.children(".ui-menu"),i.length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,s,n,a,o,r;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,n=t.offset().top-this.activeMenu.offset().top-i-s,a=this.activeMenu.scrollTop(),o=this.activeMenu.height(),r=t.outerHeight(),0>n?this.activeMenu.scrollTop(a+n):n+r>o&&this.activeMenu.scrollTop(a+n-o+r))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(t),this.activeMenu=s},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var s;this.active&&(s="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[t]()),this.focus(i,s)},nextPage:function(t){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=e(this),0>i.offset().top-s-n}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(t),void 0)},previousPage:function(t){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-s+n>0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first())),void 0):(this.next(t),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(e.trim(e(this).text()))})}}),e.widget("ui.autocomplete",{version:"1.11.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,s,n=this.element[0].nodeName.toLowerCase(),a="textarea"===n,o="input"===n;this.isMultiLine=a?!0:o?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[a||o?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,s=!0,i=!0,void 0;t=!1,s=!1,i=!1;var a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:t=!0,this._move("previousPage",n);break;case a.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case a.UP:t=!0,this._keyEvent("previous",n);break;case a.DOWN:t=!0,this._keyEvent("next",n);break;case a.ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case a.TAB:this.menu.active&&this.menu.select(n);break;case a.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(t)return t=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if(!i){var n=e.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(e){return s?(s=!1,e.preventDefault(),void 0):(this._searchTimeout(e),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(e),this._change(e),void 0)}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(s){s.target===t.element[0]||s.target===i||e.contains(i,s.target)||t.close()})})},menufocus:function(t,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:n})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&e.trim(s).length&&(this.liveRegion.children().hide(),e("<div>").text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),s=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,s=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,s){s(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,n){s.xhr&&s.xhr.abort(),s.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),i=this.menu.element.is(":visible"),s=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;(!t||t&&!i&&!s)&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var s=this;e.each(i,function(e,i){s._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").text(i.label).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[e](t),void 0):(this.search(null,t),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var s=RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return s.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(i).appendTo(this.liveRegion))}}),e.ui.autocomplete;var c,p="ui-button ui-widget ui-state-default ui-corner-all",f="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",m=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},g=function(t){var i=t.name,s=t.form,n=e([]);return i&&(i=i.replace(/'/g,"\\'"),n=s?e(s).find("[name='"+i+"'][type=radio]"):e("[name='"+i+"'][type=radio]",t.ownerDocument).filter(function(){return!this.form})),n};e.widget("ui.button",{version:"1.11.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,m),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,i=this.options,s="checkbox"===this.type||"radio"===this.type,n=s?"":"ui-state-active";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(p).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){i.disabled||this===c&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){i.disabled||e(this).removeClass(n)}).bind("click"+this.eventNamespace,function(e){i.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),s&&this.element.bind("change"+this.eventNamespace,function(){t.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return i.disabled?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var s=t.element[0];g(s).not(s).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return i.disabled?!1:(e(this).addClass("ui-state-active"),c=this,t.document.one("mouseup",function(){c=null}),void 0)}).bind("mouseup"+this.eventNamespace,function(){return i.disabled?!1:(e(this).removeClass("ui-state-active"),void 0)}).bind("keydown"+this.eventNamespace,function(t){return i.disabled?!1:((t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active"),void 0)}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(p+" ui-state-active "+f).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){return this._super(e,t),"disabled"===e?(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),t&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")),void 0):(this._resetButton(),void 0)},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?g(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return this.options.label&&this.element.val(this.options.label),void 0;var t=this.buttonElement.removeClass(f),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),s=this.options.icons,n=s.primary&&s.secondary,a=[];s.primary||s.secondary?(this.options.text&&a.push("ui-button-text-icon"+(n?"s":s.primary?"-primary":"-secondary")),s.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+s.primary+"'></span>"),s.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+s.secondary+"'></span>"),this.options.text||(a.push(n?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):a.push("ui-button-text-only"),t.addClass(a.join(" "))}}),e.widget("ui.buttonset",{version:"1.11.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction"),i=this.element.find(this.options.items),s=i.filter(":ui-button");i.not(":ui-button").button(),s.button("refresh"),this.buttons=i.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}}),e.ui.button,e.extend(e.ui,{datepicker:{version:"1.11.4"}});var v;e.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return r(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var s,n,a;s=t.nodeName.toLowerCase(),n="div"===s||"span"===s,t.id||(this.uuid+=1,t.id="dp"+this.uuid),a=this._newInst(e(t),n),a.settings=e.extend({},i||{}),"input"===s?this._connectDatepicker(t,a):n&&this._inlineDatepicker(t,a)},_newInst:function(t,i){var s=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?a(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var s=e(t);i.append=e([]),i.trigger=e([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,"datepicker",i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var s,n,a,o=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),o&&(i.append=e("<span class='"+this._appendClass+"'>"+o+"</span>"),t[r?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&t.focus(this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),a=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:a,alt:n,title:n}):e("<button type='button'></button>").addClass(this._triggerClass).html(a?e("<img/>").attr({src:a,alt:n,title:n}):n)),t[r?"before":"after"](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,s,n,a=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function(e){for(i=0,s=0,n=0;e.length>n;n++)e[n].length>i&&(i=e[n].length,s=n);return s},a.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),a.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-a.getDay())),e.input.attr("size",this._formatDate(e,a).length)}},_inlineDatepicker:function(t,i){var s=e(t);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),e.data(t,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,s,n,a){var o,h,l,u,d,c=this._dialogInst;return c||(this.uuid+=1,o="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+o+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),c=this._dialogInst=this._newInst(this._dialogInput,!1),c.settings={},e.data(this._dialogInput[0],"datepicker",c)),r(c.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(c,i):i,this._dialogInput.val(i),this._pos=a?a.length?a:[a.pageX,a.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+u,l/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),c.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",c),this},_destroyDatepicker:function(t){var i,s=e(t),n=e.data(t,"datepicker");s.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),v===n&&(v=null))},_enableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!1,a.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!0,a.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;this._disabledInputs.length>t;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,i,s){var n,a,o,h,l=this._getInst(t);return 2===arguments.length&&"string"==typeof i?"defaults"===i?e.extend({},e.datepicker._defaults):l?"all"===i?e.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),a=this._getDateDatepicker(t,!0),o=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),r(l.settings,n),null!==o&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,o)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),l),this._autoSize(l),this._setDate(l,a),this._updateAlternate(l),this._updateDatepicker(l)),void 0)},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,s,n,a=e.datepicker._getInst(t.target),o=!0,r=a.dpDiv.is(".ui-datepicker-rtl");if(a._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return n=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",a.dpDiv),n[0]&&e.datepicker._selectDay(t.target,a.selectedMonth,a.selectedYear,n[0]),i=e.datepicker._get(a,"onSelect"),i?(s=e.datepicker._formatDate(a),i.apply(a.input?a.input[0]:null,[s,a])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?1:-1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?-1:1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),o=t.ctrlKey||t.metaKey;break;default:o=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,s,n=e.datepicker._getInst(t.target);
return e.datepicker._get(n,"constrainInput")?(i=e.datepicker._possibleChars(e.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(t){var i,s=e.datepicker._getInst(t.target);if(s.input.val()!==s.lastVal)try{i=e.datepicker.parseDate(e.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,e.datepicker._getFormatConfig(s)),i&&(e.datepicker._setDateFromField(s),e.datepicker._updateAlternate(s),e.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(t){if(t=t.target||t,"input"!==t.nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),!e.datepicker._isDisabledDatepicker(t)&&e.datepicker._lastInput!==t){var i,n,a,o,h,l,u;i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),n=e.datepicker._get(i,"beforeShow"),a=n?n.apply(t,[t,i]):{},a!==!1&&(r(i.settings,a),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each(function(){return o|="fixed"===e(this).css("position"),!o}),h={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),h=e.datepicker._checkOffset(i,h,o),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":o?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),u=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",s(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),u):i.dpDiv[l||"show"](l?u:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i))}},_updateDatepicker:function(t){this.maxRows=4,v=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var i,s=this._getNumberOfMonths(t),n=s[1],a=17,r=t.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),t.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,s){var n=t.dpDiv.outerWidth(),a=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,r=t.input?t.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:e(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?n-o:0,i.left-=s&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=s&&i.top===t.input.offset().top+r?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+a>l&&l>a?Math.abs(a+r):0),i},_findPos:function(t){for(var i,s=this._getInst(t),n=this._get(s,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[n?"previousSibling":"nextSibling"];return i=e(t).offset(),[i.left,i.top]},_hideDatepicker:function(t){var i,s,n,a,o=this._curInst;!o||t&&o!==e.data(t,"datepicker")||this._datepickerShowing&&(i=this._get(o,"showAnim"),s=this._get(o,"duration"),n=function(){e.datepicker._tidyDialog(o)},e.effects&&(e.effects.effect[i]||e.effects[i])?o.dpDiv.hide(i,e.datepicker._get(o,"showOptions"),s,n):o.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,a=this._get(o,"onClose"),a&&a.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),s=e.datepicker._getInst(i[0]);(i[0].id!==e.datepicker._mainDivId&&0===i.parents("#"+e.datepicker._mainDivId).length&&!i.hasClass(e.datepicker.markerClassName)&&!i.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||i.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==s)&&e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,s){var n=e(t),a=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(a,i+("M"===s?this._get(a,"showCurrentAtPos"):0),s),this._updateDatepicker(a))},_gotoToday:function(t){var i,s=e(t),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(t,i,s){var n=e(t),a=this._getInst(n[0]);a["selected"+("M"===s?"Month":"Year")]=a["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(a),this._adjustDate(n)},_selectDay:function(t,i,s,n){var a,o=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||(a=this._getInst(o[0]),a.selectedDay=a.currentDay=e("a",n).html(),a.selectedMonth=a.currentMonth=i,a.selectedYear=a.currentYear=s,this._selectDate(t,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var s,n=e(t),a=this._getInst(n[0]);i=null!=i?i:this._formatDate(a),a.input&&a.input.val(i),this._updateAlternate(a),s=this._get(a,"onSelect"),s?s.apply(a.input?a.input[0]:null,[i,a]):a.input&&a.input.trigger("change"),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,s,n,a=this._get(t,"altField");a&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),s=this._getDate(t),n=this.formatDate(i,s,this._getFormatConfig(t)),e(a).each(function(){e(this).val(n)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,s){if(null==t||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,a,o,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),d=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,c=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,m=-1,g=-1,v=-1,y=-1,b=!1,_=function(e){var i=t.length>n+1&&t.charAt(n+1)===e;return i&&n++,i},x=function(e){var t=_(e),s="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,n="y"===e?s:1,a=RegExp("^\\d{"+n+","+s+"}"),o=i.substring(h).match(a);if(!o)throw"Missing number at position "+h;return h+=o[0].length,parseInt(o[0],10)},w=function(t,s,n){var a=-1,o=e.map(_(t)?n:s,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(o,function(e,t){var s=t[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(a=t[0],h+=s.length,!1):void 0}),-1!==a)return a+1;throw"Unknown name at position "+h},k=function(){if(i.charAt(h)!==t.charAt(n))throw"Unexpected literal at position "+h;h++};for(n=0;t.length>n;n++)if(b)"'"!==t.charAt(n)||_("'")?k():b=!1;else switch(t.charAt(n)){case"d":v=x("d");break;case"D":w("D",d,c);break;case"o":y=x("o");break;case"m":g=x("m");break;case"M":g=w("M",p,f);break;case"y":m=x("y");break;case"@":r=new Date(x("@")),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"!":r=new Date((x("!")-this._ticksTo1970)/1e4),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"'":_("'")?k():b=!0;break;default:k()}if(i.length>h&&(o=i.substr(h),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===m?m=(new Date).getFullYear():100>m&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=m?0:-100)),y>-1)for(g=1,v=y;;){if(a=this._getDaysInMonth(m,g-1),a>=v)break;g++,v-=a}if(r=this._daylightSavingAdjust(new Date(m,g-1,v)),r.getFullYear()!==m||r.getMonth()+1!==g||r.getDate()!==v)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,i){if(!t)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,a=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(t){var i=e.length>s+1&&e.charAt(s+1)===t;return i&&s++,i},l=function(e,t,i){var s=""+t;if(h(e))for(;i>s.length;)s="0"+s;return s},u=function(e,t,i,s){return h(e)?s[t]:i[t]},d="",c=!1;if(t)for(s=0;e.length>s;s++)if(c)"'"!==e.charAt(s)||h("'")?d+=e.charAt(s):c=!1;else switch(e.charAt(s)){case"d":d+=l("d",t.getDate(),2);break;case"D":d+=u("D",t.getDay(),n,a);break;case"o":d+=l("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":d+=l("m",t.getMonth()+1,2);break;case"M":d+=u("M",t.getMonth(),o,r);break;case"y":d+=h("y")?t.getFullYear():(10>t.getYear()%100?"0":"")+t.getYear()%100;break;case"@":d+=t.getTime();break;case"!":d+=1e4*t.getTime()+this._ticksTo1970;break;case"'":h("'")?d+="'":c=!0;break;default:d+=e.charAt(s)}return d},_possibleChars:function(e){var t,i="",s=!1,n=function(i){var s=e.length>t+1&&e.charAt(t+1)===i;return s&&t++,s};for(t=0;e.length>t;t++)if(s)"'"!==e.charAt(t)||n("'")?i+=e.charAt(t):s=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),s=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),a=n,o=this._getFormatConfig(e);try{a=this.parseDate(i,s,o)||n}catch(r){s=t?"":s}e.selectedDay=a.getDate(),e.drawMonth=e.selectedMonth=a.getMonth(),e.drawYear=e.selectedYear=a.getFullYear(),e.currentDay=s?a.getDate():0,e.currentMonth=s?a.getMonth():0,e.currentYear=s?a.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,s){var n=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},a=function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,a=n.getFullYear(),o=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o));break;case"y":case"Y":a+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o))}l=h.exec(i)}return new Date(a,o,r)},o=null==i||""===i?s:"string"==typeof i?a(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return o=o&&"Invalid Date"==""+o?s:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var s=!t,n=e.selectedMonth,a=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),n===e.selectedMonth&&a===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(s?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),s="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(s,-i,"M")},next:function(){e.datepicker._adjustDate(s,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(s)},selectDay:function(){return e.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(s,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,s,n,a,o,r,h,l,u,d,c,p,f,m,g,v,y,b,_,x,w,k,T,D,S,M,C,N,A,P,I,H,z,F,E,O,j,W,L=new Date,R=this._daylightSavingAdjust(new Date(L.getFullYear(),L.getMonth(),L.getDate())),Y=this._get(e,"isRTL"),B=this._get(e,"showButtonPanel"),J=this._get(e,"hideIfNoPrevNext"),q=this._get(e,"navigationAsDateFormat"),K=this._getNumberOfMonths(e),V=this._get(e,"showCurrentAtPos"),U=this._get(e,"stepMonths"),Q=1!==K[0]||1!==K[1],G=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),X=this._getMinMaxDate(e,"min"),$=this._getMinMaxDate(e,"max"),Z=e.drawMonth-V,et=e.drawYear;if(0>Z&&(Z+=12,et--),$)for(t=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth()-K[0]*K[1]+1,$.getDate())),t=X&&X>t?X:t;this._daylightSavingAdjust(new Date(et,Z,1))>t;)Z--,0>Z&&(Z=11,et--);for(e.drawMonth=Z,e.drawYear=et,i=this._get(e,"prevText"),i=q?this.formatDate(i,this._daylightSavingAdjust(new Date(et,Z-U,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,-1,et,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":J?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(e,"nextText"),n=q?this.formatDate(n,this._daylightSavingAdjust(new Date(et,Z+U,1)),this._getFormatConfig(e)):n,a=this._canAdjustMonth(e,1,et,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":J?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",o=this._get(e,"currentText"),r=this._get(e,"gotoCurrent")&&e.currentDay?G:R,o=q?this.formatDate(o,r,this._getFormatConfig(e)):o,h=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",l=B?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(e,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(Y?"":h)+"</div>":"",u=parseInt(this._get(e,"firstDay"),10),u=isNaN(u)?0:u,d=this._get(e,"showWeek"),c=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),m=this._get(e,"monthNamesShort"),g=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),b=this._getDefaultDate(e),_="",w=0;K[0]>w;w++){for(k="",this.maxRows=4,T=0;K[1]>T;T++){if(D=this._daylightSavingAdjust(new Date(et,Z,e.selectedDay)),S=" ui-corner-all",M="",Q){if(M+="<div class='ui-datepicker-group",K[1]>1)switch(T){case 0:M+=" ui-datepicker-group-first",S=" ui-corner-"+(Y?"right":"left");break;case K[1]-1:M+=" ui-datepicker-group-last",S=" ui-corner-"+(Y?"left":"right");break;default:M+=" ui-datepicker-group-middle",S=""}M+="'>"}for(M+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+S+"'>"+(/all|left/.test(S)&&0===w?Y?a:s:"")+(/all|right/.test(S)&&0===w?Y?s:a:"")+this._generateMonthYearHeader(e,Z,et,X,$,w>0||T>0,f,m)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",C=d?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",x=0;7>x;x++)N=(x+u)%7,C+="<th scope='col'"+((x+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+c[N]+"'>"+p[N]+"</span></th>";for(M+=C+"</tr></thead><tbody>",A=this._getDaysInMonth(et,Z),et===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,A)),P=(this._getFirstDayOfMonth(et,Z)-u+7)%7,I=Math.ceil((P+A)/7),H=Q?this.maxRows>I?this.maxRows:I:I,this.maxRows=H,z=this._daylightSavingAdjust(new Date(et,Z,1-P)),F=0;H>F;F++){for(M+="<tr>",E=d?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(z)+"</td>":"",x=0;7>x;x++)O=g?g.apply(e.input?e.input[0]:null,[z]):[!0,""],j=z.getMonth()!==Z,W=j&&!y||!O[0]||X&&X>z||$&&z>$,E+="<td class='"+((x+u+6)%7>=5?" ui-datepicker-week-end":"")+(j?" ui-datepicker-other-month":"")+(z.getTime()===D.getTime()&&Z===e.selectedMonth&&e._keyEvent||b.getTime()===z.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(W?" "+this._unselectableClass+" ui-state-disabled":"")+(j&&!v?"":" "+O[1]+(z.getTime()===G.getTime()?" "+this._currentClass:"")+(z.getTime()===R.getTime()?" ui-datepicker-today":""))+"'"+(j&&!v||!O[2]?"":" title='"+O[2].replace(/'/g,"&#39;")+"'")+(W?"":" data-handler='selectDay' data-event='click' data-month='"+z.getMonth()+"' data-year='"+z.getFullYear()+"'")+">"+(j&&!v?"&#xa0;":W?"<span class='ui-state-default'>"+z.getDate()+"</span>":"<a class='ui-state-default"+(z.getTime()===R.getTime()?" ui-state-highlight":"")+(z.getTime()===G.getTime()?" ui-state-active":"")+(j?" ui-priority-secondary":"")+"' href='#'>"+z.getDate()+"</a>")+"</td>",z.setDate(z.getDate()+1),z=this._daylightSavingAdjust(z);M+=E+"</tr>"}Z++,Z>11&&(Z=0,et++),M+="</tbody></table>"+(Q?"</div>"+(K[0]>0&&T===K[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),k+=M}_+=k}return _+=l,e._keyEvent=!1,_},_generateMonthYearHeader:function(e,t,i,s,n,a,o,r){var h,l,u,d,c,p,f,m,g=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",_="";if(a||!g)_+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,_+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;12>u;u++)(!h||u>=s.getMonth())&&(!l||n.getMonth()>=u)&&(_+="<option value='"+u+"'"+(u===t?" selected='selected'":"")+">"+r[u]+"</option>");_+="</select>"}if(y||(b+=_+(!a&&g&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",a||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(d=this._get(e,"yearRange").split(":"),c=(new Date).getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?c+parseInt(e,10):parseInt(e,10);return isNaN(t)?c:t},f=p(d[0]),m=Math.max(f,p(d[1]||"")),f=s?Math.max(f,s.getFullYear()):f,m=n?Math.min(m,n.getFullYear()):m,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";m>=f;f++)e.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",b+=e.yearshtml,e.yearshtml=null}return b+=this._get(e,"yearSuffix"),y&&(b+=(!a&&g&&v?"":"&#xa0;")+_),b+="</div>"},_adjustInstDate:function(e,t,i){var s=e.drawYear+("Y"===i?t:0),n=e.drawMonth+("M"===i?t:0),a=Math.min(e.selectedDay,this._getDaysInMonth(s,n))+("D"===i?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(s,n,a)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),n=i&&i>t?i:t;return s&&n>s?s:n},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,s){var n=this._getNumberOfMonths(e),a=this._daylightSavingAdjust(new Date(i,s+(0>t?t:n[0]*n[1]),1));return 0>t&&a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(e,a)},_isInRange:function(e,t){var i,s,n=this._getMinMaxDate(e,"min"),a=this._getMinMaxDate(e,"max"),o=null,r=null,h=this._get(e,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),o=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||t.getTime()>=n.getTime())&&(!a||t.getTime()<=a.getTime())&&(!o||t.getFullYear()>=o)&&(!r||r>=t.getFullYear())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,s){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(s,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new n,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.11.4",e.datepicker,e.widget("ui.draggable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(s){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options,a=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,e(a).width()-this.helperProportions.width-this.margins.left,(e(a).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),s=i[0],s&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)
},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,n,a,o=this.options,r=this._isRootNode(this.scrollParent[0]),h=e.pageX,l=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a),"y"===o.axis&&(h=this.originalPageX),"x"===o.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,n))})},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,n))})},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,a=this;a.positionAbs=s.positionAbs,a.helperProportions=s.helperProportions,a.offset.click=s.offset.click,a._intersectsWith(a.containerCache)&&(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==a&&this._intersectsWith(this.containerCache)&&e.contains(a.element[0],this.element[0])&&(n=!1),n})),n?(a.isOver||(a.isOver=1,s._parent=i.helper.parent(),a.currentItem=i.helper.appendTo(a.element).data("ui-sortable-item",!0),a.options._helper=a.options.helper,a.options.helper=function(){return i.helper[0]},t.target=a.currentItem[0],a._mouseCapture(t,!0),a._mouseStart(t,!0,!0),a.offset.click.top=s.offset.click.top,a.offset.click.left=s.offset.click.left,a.offset.parent.left-=s.offset.parent.left-a.offset.parent.left,a.offset.parent.top-=s.offset.parent.top-a.offset.parent.top,s._trigger("toSortable",t),s.dropped=a.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,a.fromOutside=s),a.currentItem&&(a._mouseDrag(t),i.position=a.position)):a.isOver&&(a.isOver=0,a.cancelHelperRemoval=!0,a.options._revert=a.options.revert,a.options.revert=!1,a._trigger("out",t,a._uiHash(a)),a._mouseStop(t,!0),a.options.revert=a.options._revert,a.options.helper=a.options._helper,a.placeholder&&a.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var n=e("body"),a=s.options;n.css("cursor")&&(a._cursor=n.css("cursor")),n.css("cursor",a.cursor)},stop:function(t,i,s){var n=s.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("opacity")&&(a._opacity=n.css("opacity")),n.css("opacity",a.opacity)},stop:function(t,i,s){var n=s.options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var n=s.options,a=!1,o=s.scrollParentNotHidden[0],r=s.document[0];o!==r&&"HTML"!==o.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+o.offsetHeight-t.pageY<n.scrollSensitivity?o.scrollTop=a=o.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top<n.scrollSensitivity&&(o.scrollTop=a=o.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+o.offsetWidth-t.pageX<n.scrollSensitivity?o.scrollLeft=a=o.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left<n.scrollSensitivity&&(o.scrollLeft=a=o.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(r).scrollTop()<n.scrollSensitivity?a=e(r).scrollTop(e(r).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<n.scrollSensitivity&&(a=e(r).scrollTop(e(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(r).scrollLeft()<n.scrollSensitivity?a=e(r).scrollLeft(e(r).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<n.scrollSensitivity&&(a=e(r).scrollLeft(e(r).scrollLeft()+n.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var n,a,o,r,h,l,u,d,c,p,f=s.options,m=f.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,y=i.offset.top,b=y+s.helperProportions.height;for(c=s.snapElements.length-1;c>=0;c--)h=s.snapElements[c].left-s.margins.left,l=h+s.snapElements[c].width,u=s.snapElements[c].top-s.margins.top,d=u+s.snapElements[c].height,h-m>v||g>l+m||u-m>b||y>d+m||!e.contains(s.snapElements[c].item.ownerDocument,s.snapElements[c].item)?(s.snapElements[c].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(n=m>=Math.abs(u-b),a=m>=Math.abs(d-y),o=m>=Math.abs(h-v),r=m>=Math.abs(l-g),n&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||a||o||r,"outer"!==f.snapMode&&(n=m>=Math.abs(u-y),a=m>=Math.abs(d-b),o=m>=Math.abs(h-g),r=m>=Math.abs(l-v),n&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[c].snapping&&(n||a||o||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=n||a||o||r||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var n,a=s.options,o=e.makeArray(e(a.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});o.length&&(n=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",n+t)}),this.css("zIndex",n+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("zIndex")&&(a._zIndex=n.css("zIndex")),n.css("zIndex",a.zIndex)},stop:function(t,i,s){var n=s.options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}}),e.ui.draggable,e.widget("ui.resizable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[s]>0?!0:(t[s]=1,n=t[s]>0,t[s]=0,n)},_create:function(){var t,i,s,n,a,o=this,r=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;t.length>i;i++)s=e.trim(t[i]),a="ui-resizable-"+s,n=e("<div class='ui-resizable-handle "+a+"'></div>"),n.css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(t){var i,s,n,a;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:o._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=e(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(n,a),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){r.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,s,n=!1;for(i in this.handles)s=e(this.handles[i])[0],(s===t.target||e.contains(s,t.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var i,s,n,a=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),a.containment&&(i+=e(a.containment).scrollLeft()||0,s+=e(a.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),o.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,s,n=this.originalMousePosition,a=this.axis,o=t.pageX-n.left||0,r=t.pageY-n.top||0,h=this._change[a];return this._updatePrevProperties(),h?(i=h.apply(this,[t,o,r]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(t){this.resizing=!1;var i,s,n,a,o,r,h,l=this.options,u=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:u.sizeDiff.height,a=s?0:u.sizeDiff.width,o={width:u.helper.width()-a,height:u.helper.height()-n},r=parseInt(u.element.css("left"),10)+(u.position.left-u.originalPosition.left)||null,h=parseInt(u.element.css("top"),10)+(u.position.top-u.originalPosition.top)||null,l.animate||this.element.css(e.extend(o,{top:h,left:r})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!l.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,s,n,a,o=this.options;a={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=a.minHeight*this.aspectRatio,s=a.minWidth/this.aspectRatio,i=a.maxHeight*this.aspectRatio,n=a.maxWidth/this.aspectRatio,t>a.minWidth&&(a.minWidth=t),s>a.minHeight&&(a.minHeight=s),a.maxWidth>i&&(a.maxWidth=i),a.maxHeight>n&&(a.maxHeight=n)),this._vBoundaries=a},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,a=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,o=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,r=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,l=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return a&&(e.width=t.minWidth),o&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),a&&l&&(e.left=r-t.minWidth),s&&l&&(e.left=r-t.maxWidth),o&&u&&(e.top=h-t.minHeight),n&&u&&(e.top=h-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseInt(s[t],10)||0,i[t]+=parseInt(n[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),o=a&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(h,u&&l?{top:u,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&e(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,s,n,a,o,r,h=e(this).resizable("instance"),l=h.options,u=h.element,d=l.containment,c=d instanceof e?d.get(0):/parent/.test(d)?u.parent().get(0):d;c&&(h.containerElement=e(c),/document/.test(d)||d===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(c),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,s){i[e]=h._num(t.css("padding"+s))}),h.containerOffset=t.offset(),h.containerPosition=t.position(),h.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,a=h.containerSize.width,o=h._hasScroll(c,"left")?c.scrollWidth:a,r=h._hasScroll(c)?c.scrollHeight:n,h.parentData={element:c,left:s.left,top:s.top,width:o,height:r}))},resize:function(t){var i,s,n,a,o=e(this).resizable("instance"),r=o.options,h=o.containerOffset,l=o.position,u=o._aspectRatio||t.shiftKey,d={top:0,left:0},c=o.containerElement,p=!0;c[0]!==document&&/static/.test(c.css("position"))&&(d=h),l.left<(o._helper?h.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-h.left:o.position.left-d.left),u&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=r.helper?h.left:0),l.top<(o._helper?h.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-h.top:o.position.top),u&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?h.top:0),n=o.containerElement.get(0)===o.element.parent().get(0),a=/relative|absolute/.test(o.containerElement.css("position")),n&&a?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),i=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-d.left:o.offset.left-h.left)),s=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-d.top:o.offset.top-h.top)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,u&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),s+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-s,u&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,s=t.containerOffset,n=t.containerPosition,a=t.containerElement,o=e(t.helper),r=o.offset(),h=o.outerWidth()-t.sizeDiff.width,l=o.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l}),t._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options;e(i.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})},resize:function(t,i){var s=e(this).resizable("instance"),n=s.options,a=s.originalSize,o=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0};e(n.alsoResize).each(function(){var t=e(this),s=e(this).data("ui-resizable-alsoresize"),n={},a=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(a,function(e,t){var i=(s[t]||0)+(r[t]||0);i&&i>=0&&(n[t]=i||null)}),t.css(n)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),s=i.options,n=i.size,a=i.originalSize,o=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,u=h[1]||1,d=Math.round((n.width-a.width)/l)*l,c=Math.round((n.height-a.height)/u)*u,p=a.width+d,f=a.height+c,m=s.maxWidth&&p>s.maxWidth,g=s.maxHeight&&f>s.maxHeight,v=s.minWidth&&s.minWidth>p,y=s.minHeight&&s.minHeight>f;s.grid=h,v&&(p+=l),y&&(f+=u),m&&(p-=l),g&&(f-=u),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=o.top-c):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=o.left-d):((0>=f-u||0>=p-l)&&(t=i._getPaddingPlusBorderDimensions(this)),f-u>0?(i.size.height=f,i.position.top=o.top-c):(f=u-t.height,i.size.height=f,i.position.top=o.top+a.height-f),p-l>0?(i.size.width=p,i.position.left=o.left-d):(p=l-t.width,i.size.width=p,i.position.left=o.left+a.width-p))}}),e.ui.resizable,e.widget("ui.dialog",{version:"1.11.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i,s=this;if(this._isOpen&&this._trigger("beforeClose",t)!==!1){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{i=this.document[0].activeElement,i&&"body"!==i.nodeName.toLowerCase()&&e(i).blur()}catch(n){}this._hide(this.uiDialog,this.options.hide,function(){s._trigger("close",t)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index")}).get(),a=Math.max.apply(null,n);return a>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",a+1),s=!0),s&&!i&&this._trigger("focus",t),s},open:function(){var t=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"),void 0)},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function i(){var t=this.document[0].activeElement,i=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);i||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),this.close(t),void 0;
if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");t.target!==n[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==s[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){n.focus()}),t.preventDefault()):(this._delay(function(){s.focus()}),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?(this.uiDialog.removeClass("ui-dialog-buttons"),void 0):(e.each(i,function(i,s){var n,a;s=e.isFunction(s)?{click:s,text:i}:s,s=e.extend({type:"button"},s),n=s.click,s.click=function(){n.apply(t.element[0],arguments)},a={icons:s.icons,text:s.showText},delete s.icons,delete s.showText,e("<button></button>",s).button(a).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){e(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,t(n))},drag:function(e,s){i._trigger("drag",e,t(s))},stop:function(n,a){var o=a.offset.left-i.document.scrollLeft(),r=a.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" "+"top"+(r>=0?"+":"")+r,of:i.window},e(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,t(a))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var i=this,s=this.options,n=s.resizable,a=this.uiDialog.css("position"),o="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:o,start:function(s,n){e(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,t(n))},resize:function(e,s){i._trigger("resize",e,t(s))},stop:function(n,a){var o=i.uiDialog.offset(),r=o.left-i.document.scrollLeft(),h=o.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" "+"top"+(h>=0?"+":"")+h,of:i.window},e(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,t(a))}}).css("position",a)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),i=e.inArray(this,t);-1!==i&&t.splice(i,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||(e=[],this.document.data("ui-dialog-instances",e)),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,s=!1,n={};e.each(t,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&&(s=!0),e in i.resizableRelatedOptions&&(n[e]=t)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,t){var i,s,n=this.uiDialog;"dialogClass"===e&&n.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&(i=n.is(":data(ui-draggable)"),i&&!t&&n.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(s=n.is(":data(ui-resizable)"),s&&!t&&n.resizable("destroy"),s&&"string"==typeof t&&n.resizable("option","handles",t),s||t===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),e=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),t=Math.max(0,s.minHeight-e),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-e):"none","auto"===s.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return e(t.target).closest(".ui-dialog").length?!0:!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}}),e.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){return arguments.length?(t=arguments[0],void 0):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;e.length>t;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){if("accept"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if("scope"===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(s)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function e(e,t,i){return e>=t&&t+i>e}return function(t,i,s,n){if(!i.offset)return!1;var a=(t.positionAbs||t.position.absolute).left+t.margins.left,o=(t.positionAbs||t.position.absolute).top+t.margins.top,r=a+t.helperProportions.width,h=o+t.helperProportions.height,l=i.offset.left,u=i.offset.top,d=l+i.proportions().width,c=u+i.proportions().height;switch(s){case"fit":return a>=l&&d>=r&&o>=u&&c>=h;case"intersect":return a+t.helperProportions.width/2>l&&d>r-t.helperProportions.width/2&&o+t.helperProportions.height/2>u&&c>h-t.helperProportions.height/2;case"pointer":return e(n.pageY,u,i.proportions().height)&&e(n.pageX,l,i.proportions().width);case"touch":return(o>=u&&c>=o||h>=u&&c>=h||u>o&&h>c)&&(a>=l&&d>=a||r>=l&&d>=r||l>a&&r>d);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var s,n,a=e.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,r=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(s=0;a.length>s;s++)if(!(a[s].options.disabled||t&&!a[s].accept.call(a[s].element[0],t.currentItem||t.element))){for(n=0;r.length>n;n++)if(r[n]===a[s].element[0]){a[s].proportions().height=0;continue e}a[s].visible="none"!==a[s].element.css("display"),a[s].visible&&("mousedown"===o&&a[s]._activate.call(a[s],i),a[s].offset=a[s].element.offset(),a[s].proportions({width:a[s].element[0].offsetWidth,height:a[s].element[0].offsetHeight}))}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,a,o=e.ui.intersect(t,this,this.options.tolerance,i),r=!o&&this.isover?"isout":o&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===n}),a.length&&(s=e(a[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},e.ui.droppable;var y="ui-effects-",b=e;e.effects={effect:{}},function(e,t){function i(e,t,i){var s=d[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:e>s.max?s.max:e)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(e,a){var o,r=a.re.exec(i),h=r&&a.parse(r),l=a.space||"rgba";return h?(o=s[l](h),s[u[l].cache]=o[u[l].cache],n=s._rgba=o._rgba,!1):t}),n.length?("0,0,0,0"===n.join()&&e.extend(n,a.transparent),s):a[i]}function n(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var a,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=e.Color=function(t,i,s,n){return new e.Color.fn.parse(t,i,s,n)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},c=l.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",c.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),l.fn=e.extend(l.prototype,{parse:function(n,o,r,h){if(n===t)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=e(n).css(o),o=t);var d=this,c=e.type(n),p=this._rgba=[];return o!==t&&(n=[n,o,r,h],c="array"),"string"===c?this.parse(s(n)||a._default):"array"===c?(f(u.rgba.props,function(e,t){p[t.idx]=i(n[t.idx],t)}),this):"object"===c?(n instanceof l?f(u,function(e,t){n[t.cache]&&(d[t.cache]=n[t.cache].slice())}):f(u,function(t,s){var a=s.cache;f(s.props,function(e,t){if(!d[a]&&s.to){if("alpha"===e||null==n[e])return;d[a]=s.to(d._rgba)}d[a][t.idx]=i(n[e],t,!0)}),d[a]&&0>e.inArray(null,d[a].slice(0,3))&&(d[a][3]=1,s.from&&(d._rgba=s.from(d[a])))}),this):t},is:function(e){var i=l(e),s=!0,n=this;return f(u,function(e,a){var o,r=i[a.cache];return r&&(o=n[a.cache]||a.to&&a.to(n._rgba)||[],f(a.props,function(e,i){return null!=r[i.idx]?s=r[i.idx]===o[i.idx]:t})),s}),s},_space:function(){var e=[],t=this;return f(u,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var s=l(e),n=s._space(),a=u[n],o=0===this.alpha()?l("transparent"):this,r=o[a.cache]||a.to(o._rgba),h=r.slice();return s=s[a.cache],f(a.props,function(e,n){var a=n.idx,o=r[a],l=s[a],u=d[n.type]||{};null!==l&&(null===o?h[a]=l:(u.mod&&(l-o>u.mod/2?o+=u.mod:o-l>u.mod/2&&(o-=u.mod)),h[a]=i((l-o)*t+o,n)))}),this[n](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(t)._rgba;return l(e.map(i,function(e,t){return(1-s)*n[t]+s*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,n=e[1]/255,a=e[2]/255,o=e[3],r=Math.max(s,n,a),h=Math.min(s,n,a),l=r-h,u=r+h,d=.5*u;return t=h===r?0:s===r?60*(n-a)/l+360:n===r?60*(a-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=d?l/u:l/(2-u),[Math.round(t)%360,i,d,null==o?1:o]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],a=e[3],o=.5>=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*n(r,o,t+1/3)),Math.round(255*n(r,o,t)),Math.round(255*n(r,o,t-1/3)),a]},f(u,function(s,n){var a=n.props,o=n.cache,h=n.to,u=n.from;l.fn[s]=function(s){if(h&&!this[o]&&(this[o]=h(this._rgba)),s===t)return this[o].slice();var n,r=e.type(s),d="array"===r||"object"===r?s:arguments,c=this[o].slice();return f(a,function(e,t){var s=d["object"===r?e:t.idx];null==s&&(s=c[t.idx]),c[t.idx]=i(s,t)}),u?(n=l(u(c)),n[o]=c,n):l(c)},f(a,function(t,i){l.fn[t]||(l.fn[t]=function(n){var a,o=e.type(n),h="alpha"===t?this._hsla?"hsla":"rgba":s,l=this[h](),u=l[i.idx];return"undefined"===o?u:("function"===o&&(n=n.call(this,u),o=e.type(n)),null==n&&i.empty?this:("string"===o&&(a=r.exec(n),a&&(n=u+parseFloat(a[2])*("+"===a[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,n){var a,o,r="";if("transparent"!==n&&("string"!==e.type(n)||(a=s(n)))){if(n=l(a||n),!c.rgba&&1!==n._rgba[3]){for(o="backgroundColor"===i?t.parentNode:t;(""===r||"transparent"===r)&&o&&o.style;)try{r=e.css(o,"backgroundColor"),o=o.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{t.style[i]=n}catch(h){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},l.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e}),t}},a=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(b),function(){function t(t){var i,s,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,a={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(a[e.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(a[i]=n[i]);return a}function i(t,i){var s,a,o={};for(s in i)a=i[s],t[s]!==a&&(n[s]||(e.fx.step[s]||!isNaN(parseFloat(a)))&&(o[s]=a));return o}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(b.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(n,a,o,r){var h=e.speed(a,o,r);return this.queue(function(){var a,o=e(this),r=o.attr("class")||"",l=h.children?o.find("*").addBack():o;l=l.map(function(){var i=e(this);return{el:i,start:t(this)}}),a=function(){e.each(s,function(e,t){n[t]&&o[t+"Class"](n[t])})},a(),l=l.map(function(){return this.end=t(this.el[0]),this.diff=i(this.start,this.end),this}),o.attr("class",r),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},h,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){a(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),h.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(i,s,n,a){return s?e.effects.animateClass.call(this,{add:i},s,n,a):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,s,n,a){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,n,a):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,s,n,a,o){return"boolean"==typeof s||void 0===s?n?e.effects.animateClass.call(this,s?{add:i}:{remove:i},n,a,o):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},s,n,a)}}(e.fn.toggleClass),switchClass:function(t,i,s,n,a){return e.effects.animateClass.call(this,{add:i,remove:t},s,n,a)}})}(),function(){function t(t,i,s,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(n=s,s=i,i={}),e.isFunction(s)&&(n=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=n||i.complete,t}function i(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.11.4",save:function(e,t){for(var i=0;t.length>i;i++)null!==t[i]&&e.data(y+t[i],e[0].style[t[i]])},restore:function(e,t){var i,s;for(s=0;t.length>s;s++)null!==t[s]&&(i=e.data(y+t[s]),void 0===i&&(i=""),e.css(t[s],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},a=document.activeElement;try{a.id}catch(o){a=document.body}return t.wrap(s),(t[0]===a||e.contains(t[0],a))&&e(a).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,n){return n=n||{},e.each(i,function(e,i){var a=t.cssUnit(i);a[0]>0&&(n[i]=a[0]*s+a[1])}),n}}),e.fn.extend({effect:function(){function i(t){function i(){e.isFunction(a)&&a.call(n[0]),e.isFunction(t)&&t()}var n=e(this),a=s.complete,r=s.mode;(n.is(":hidden")?"hide"===r:"show"===r)?(n[r](),i()):o.call(n[0],s,i)}var s=t.apply(this,arguments),n=s.mode,a=s.queue,o=e.effects.effect[s.effect];return e.fx.off||!o?n?this[n](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)}):a===!1?this.each(i):this.queue(a||"fx",i)},show:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(s){if(i(s)||"boolean"==typeof s)return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}(),e.effects,e.effects.effect.blind=function(t,i){var s,n,a,o=e(this),r=/up|down|vertical/,h=/up|left|vertical|horizontal/,l=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(o,t.mode||"hide"),d=t.direction||"up",c=r.test(d),p=c?"height":"width",f=c?"top":"left",m=h.test(d),g={},v="show"===u;o.parent().is(".ui-effects-wrapper")?e.effects.save(o.parent(),l):e.effects.save(o,l),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n=s[p](),a=parseFloat(s.css(f))||0,g[p]=v?n:0,m||(o.css(c?"bottom":"right",0).css(c?"top":"left","auto").css({position:"absolute"}),g[f]=v?a:n+a),v&&(s.css(p,0),m||s.css(f,a+n)),s.animate(g,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===u&&o.hide(),e.effects.restore(o,l),e.effects.removeWrapper(o),i()}})},e.effects.effect.bounce=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"effect"),l="hide"===h,u="show"===h,d=t.direction||"up",c=t.distance,p=t.times||5,f=2*p+(u||l?1:0),m=t.duration/f,g=t.easing,v="up"===d||"down"===d?"top":"left",y="up"===d||"left"===d,b=o.queue(),_=b.length;for((u||l)&&r.push("opacity"),e.effects.save(o,r),o.show(),e.effects.createWrapper(o),c||(c=o["top"===v?"outerHeight":"outerWidth"]()/3),u&&(a={opacity:1},a[v]=0,o.css("opacity",0).css(v,y?2*-c:2*c).animate(a,m,g)),l&&(c/=Math.pow(2,p-1)),a={},a[v]=0,s=0;p>s;s++)n={},n[v]=(y?"-=":"+=")+c,o.animate(n,m,g).animate(a,m,g),c=l?2*c:c/2;l&&(n={opacity:0},n[v]=(y?"-=":"+=")+c,o.animate(n,m,g)),o.queue(function(){l&&o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}),_>1&&b.splice.apply(b,[1,0].concat(b.splice(_,f+1))),o.dequeue()},e.effects.effect.clip=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"hide"),l="show"===h,u=t.direction||"vertical",d="vertical"===u,c=d?"height":"width",p=d?"top":"left",f={};e.effects.save(o,r),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n="IMG"===o[0].tagName?s:o,a=n[c](),l&&(n.css(c,0),n.css(p,a/2)),f[c]=l?a:0,f[p]=l?0:a/2,n.animate(f,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){l||o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}})},e.effects.effect.drop=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","opacity","height","width"],o=e.effects.setMode(n,t.mode||"hide"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h?"pos":"neg",d={opacity:r?1:0};e.effects.save(n,a),n.show(),e.effects.createWrapper(n),s=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0)/2,r&&n.css("opacity",0).css(l,"pos"===u?-s:s),d[l]=(r?"pos"===u?"+=":"-=":"pos"===u?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})},e.effects.effect.explode=function(t,i){function s(){b.push(this),b.length===d*c&&n()}function n(){p.css({visibility:"visible"}),e(b).remove(),m||p.hide(),i()}var a,o,r,h,l,u,d=t.pieces?Math.round(Math.sqrt(t.pieces)):3,c=d,p=e(this),f=e.effects.setMode(p,t.mode||"hide"),m="show"===f,g=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/c),y=Math.ceil(p.outerHeight()/d),b=[];for(a=0;d>a;a++)for(h=g.top+a*y,u=a-(d-1)/2,o=0;c>o;o++)r=g.left+o*v,l=o-(c-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*v,top:-a*y}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:y,left:r+(m?l*v:0),top:h+(m?u*y:0),opacity:m?0:1}).animate({left:r+(m?0:l*v),top:h+(m?0:u*y),opacity:m?1:0},t.duration||500,t.easing,s)},e.effects.effect.fade=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"toggle");s.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.easing,complete:i})},e.effects.effect.fold=function(t,i){var s,n,a=e(this),o=["position","top","bottom","left","right","height","width"],r=e.effects.setMode(a,t.mode||"hide"),h="show"===r,l="hide"===r,u=t.size||15,d=/([0-9]+)%/.exec(u),c=!!t.horizFirst,p=h!==c,f=p?["width","height"]:["height","width"],m=t.duration/2,g={},v={};e.effects.save(a,o),a.show(),s=e.effects.createWrapper(a).css({overflow:"hidden"}),n=p?[s.width(),s.height()]:[s.height(),s.width()],d&&(u=parseInt(d[1],10)/100*n[l?0:1]),h&&s.css(c?{height:0,width:u}:{height:u,width:0}),g[f[0]]=h?n[0]:u,v[f[1]]=h?n[1]:0,s.animate(g,m,t.easing).animate(v,m,t.easing,function(){l&&a.hide(),e.effects.restore(a,o),e.effects.removeWrapper(a),i()})},e.effects.effect.highlight=function(t,i){var s=e(this),n=["backgroundImage","backgroundColor","opacity"],a=e.effects.setMode(s,t.mode||"show"),o={backgroundColor:s.css("backgroundColor")};"hide"===a&&(o.opacity=0),e.effects.save(s,n),s.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===a&&s.hide(),e.effects.restore(s,n),i()}})},e.effects.effect.size=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],h=["position","top","bottom","left","right","overflow","opacity"],l=["width","height","overflow"],u=["fontSize"],d=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],c=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(o,t.mode||"effect"),f=t.restore||"effect"!==p,m=t.scale||"both",g=t.origin||["middle","center"],v=o.css("position"),y=f?r:h,b={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&o.show(),s={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},"toggle"===t.mode&&"show"===p?(o.from=t.to||b,o.to=t.from||s):(o.from=t.from||("show"===p?b:s),o.to=t.to||("hide"===p?b:s)),a={from:{y:o.from.height/s.height,x:o.from.width/s.width},to:{y:o.to.height/s.height,x:o.to.width/s.width}},("box"===m||"both"===m)&&(a.from.y!==a.to.y&&(y=y.concat(d),o.from=e.effects.setTransition(o,d,a.from.y,o.from),o.to=e.effects.setTransition(o,d,a.to.y,o.to)),a.from.x!==a.to.x&&(y=y.concat(c),o.from=e.effects.setTransition(o,c,a.from.x,o.from),o.to=e.effects.setTransition(o,c,a.to.x,o.to))),("content"===m||"both"===m)&&a.from.y!==a.to.y&&(y=y.concat(u).concat(l),o.from=e.effects.setTransition(o,u,a.from.y,o.from),o.to=e.effects.setTransition(o,u,a.to.y,o.to)),e.effects.save(o,y),o.show(),e.effects.createWrapper(o),o.css("overflow","hidden").css(o.from),g&&(n=e.effects.getBaseline(g,s),o.from.top=(s.outerHeight-o.outerHeight())*n.y,o.from.left=(s.outerWidth-o.outerWidth())*n.x,o.to.top=(s.outerHeight-o.to.outerHeight)*n.y,o.to.left=(s.outerWidth-o.to.outerWidth)*n.x),o.css(o.from),("content"===m||"both"===m)&&(d=d.concat(["marginTop","marginBottom"]).concat(u),c=c.concat(["marginLeft","marginRight"]),l=r.concat(d).concat(c),o.find("*[width]").each(function(){var i=e(this),s={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};
f&&e.effects.save(i,l),i.from={height:s.height*a.from.y,width:s.width*a.from.x,outerHeight:s.outerHeight*a.from.y,outerWidth:s.outerWidth*a.from.x},i.to={height:s.height*a.to.y,width:s.width*a.to.x,outerHeight:s.height*a.to.y,outerWidth:s.width*a.to.x},a.from.y!==a.to.y&&(i.from=e.effects.setTransition(i,d,a.from.y,i.from),i.to=e.effects.setTransition(i,d,a.to.y,i.to)),a.from.x!==a.to.x&&(i.from=e.effects.setTransition(i,c,a.from.x,i.from),i.to=e.effects.setTransition(i,c,a.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){f&&e.effects.restore(i,l)})})),o.animate(o.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===o.to.opacity&&o.css("opacity",o.from.opacity),"hide"===p&&o.hide(),e.effects.restore(o,y),f||("static"===v?o.css({position:"relative",top:o.to.top,left:o.to.left}):e.each(["top","left"],function(e,t){o.css(t,function(t,i){var s=parseInt(i,10),n=e?o.to.left:o.to.top;return"auto"===i?n+"px":s+n+"px"})})),e.effects.removeWrapper(o),i()}})},e.effects.effect.scale=function(t,i){var s=e(this),n=e.extend(!0,{},t),a=e.effects.setMode(s,t.mode||"effect"),o=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===a?0:100),r=t.direction||"both",h=t.origin,l={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},u={y:"horizontal"!==r?o/100:1,x:"vertical"!==r?o/100:1};n.effect="size",n.queue=!1,n.complete=i,"effect"!==a&&(n.origin=h||["middle","center"],n.restore=!0),n.from=t.from||("show"===a?{height:0,width:0,outerHeight:0,outerWidth:0}:l),n.to={height:l.height*u.y,width:l.width*u.x,outerHeight:l.outerHeight*u.y,outerWidth:l.outerWidth*u.x},n.fade&&("show"===a&&(n.from.opacity=0,n.to.opacity=1),"hide"===a&&(n.from.opacity=1,n.to.opacity=0)),s.effect(n)},e.effects.effect.puff=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"hide"),a="hide"===n,o=parseInt(t.percent,10)||150,r=o/100,h={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:a?o:100,from:a?h:{height:h.height*r,width:h.width*r,outerHeight:h.outerHeight*r,outerWidth:h.outerWidth*r}}),s.effect(t)},e.effects.effect.pulsate=function(t,i){var s,n=e(this),a=e.effects.setMode(n,t.mode||"show"),o="show"===a,r="hide"===a,h=o||"hide"===a,l=2*(t.times||5)+(h?1:0),u=t.duration/l,d=0,c=n.queue(),p=c.length;for((o||!n.is(":visible"))&&(n.css("opacity",0).show(),d=1),s=1;l>s;s++)n.animate({opacity:d},u,t.easing),d=1-d;n.animate({opacity:d},u,t.easing),n.queue(function(){r&&n.hide(),i()}),p>1&&c.splice.apply(c,[1,0].concat(c.splice(p,l+1))),n.dequeue()},e.effects.effect.shake=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","height","width"],o=e.effects.setMode(n,t.mode||"effect"),r=t.direction||"left",h=t.distance||20,l=t.times||3,u=2*l+1,d=Math.round(t.duration/u),c="up"===r||"down"===r?"top":"left",p="up"===r||"left"===r,f={},m={},g={},v=n.queue(),y=v.length;for(e.effects.save(n,a),n.show(),e.effects.createWrapper(n),f[c]=(p?"-=":"+=")+h,m[c]=(p?"+=":"-=")+2*h,g[c]=(p?"-=":"+=")+2*h,n.animate(f,d,t.easing),s=1;l>s;s++)n.animate(m,d,t.easing).animate(g,d,t.easing);n.animate(m,d,t.easing).animate(f,d/2,t.easing).queue(function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,u+1))),n.dequeue()},e.effects.effect.slide=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","width","height"],o=e.effects.setMode(n,t.mode||"show"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h,d={};e.effects.save(n,a),n.show(),s=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(n).css({overflow:"hidden"}),r&&n.css(l,u?isNaN(s)?"-"+s:-s:s),d[l]=(r?u?"+=":"-=":u?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})},e.effects.effect.transfer=function(t,i){var s=e(this),n=e(t.to),a="fixed"===n.css("position"),o=e("body"),r=a?o.scrollTop():0,h=a?o.scrollLeft():0,l=n.offset(),u={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},d=s.offset(),c=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:d.top-r,left:d.left-h,height:s.innerHeight(),width:s.innerWidth(),position:a?"fixed":"absolute"}).animate(u,t.duration,t.easing,function(){c.remove(),i()})},e.widget("ui.progressbar",{version:"1.11.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){return void 0===e?this.options.value:(this.options.value=this._constrainedValue(e),this._refreshValue(),void 0)},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=e===!1,"number"!=typeof e&&(e=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}}),e.widget("ui.selectable",e.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(i.options.filter,i.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,s=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(s.filter,this.element[0]),this._trigger("start",t),e(s.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=e.data(this,"selectable-item");s.startselected=!0,t.metaKey||t.ctrlKey||(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",t,{unselecting:s.element}))}),e(t.target).parents().addBack().each(function(){var s,n=e.data(this,"selectable-item");return n?(s=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(s?"ui-unselecting":"ui-selected").addClass(s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,a=this.opos[0],o=this.opos[1],r=t.pageX,h=t.pageY;return a>r&&(i=r,r=a,a=i),o>h&&(i=h,h=o,o=i),this.helper.css({left:a,top:o,width:r-a,height:h-o}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),l=!1;i&&i.element!==s.element[0]&&("touch"===n.tolerance?l=!(i.left>r||a>i.right||i.top>h||o>i.bottom):"fit"===n.tolerance&&(l=i.left>a&&r>i.right&&i.top>o&&h>i.bottom),l?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,s._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",t,{unselected:s.element})}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",t,{selected:s.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.widget("ui.selectmenu",{version:"1.11.4",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable()},_drawButton:function(){var t=this;this.label=e("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(e){this.button.focus(),e.preventDefault()}}),this.element.hide(),this.button=e("<span>",{"class":"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),e("<span>",{"class":"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=e("<span>",{"class":"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){t.menuItems||t._refreshMenu()}),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var t=this;this.menu=e("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=e("<div>",{"class":"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(e,i){e.preventDefault(),t._setSelection(),t._select(i.item.data("ui-selectmenu-item"),e)},focus:function(e,i){var s=i.item.data("ui-selectmenu-item");null!=t.focusIndex&&s.index!==t.focusIndex&&(t._trigger("focus",e,{item:s}),t.isOpen||t._select(s,e)),t.focusIndex=s.index,t.button.attr("aria-activedescendant",t.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var e,t=this.element.find("option");t.length&&(this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),e=this._getSelectedItem(),this.menuInstance.focus(null,e),this._setAria(e.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(e){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",e))},_position:function(){this.menuWrap.position(e.extend({of:this.button},this.options.position))},close:function(e){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",e))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(t,i){var s=this,n="";e.each(i,function(i,a){a.optgroup!==n&&(e("<li>",{"class":"ui-selectmenu-optgroup ui-menu-divider"+(a.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:a.optgroup}).appendTo(t),n=a.optgroup),s._renderItemData(t,a)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-selectmenu-item",t)},_renderItem:function(t,i){var s=e("<li>");return i.disabled&&s.addClass("ui-state-disabled"),this._setText(s,i.label),s.appendTo(t)},_setText:function(e,t){t?e.text(t):e.html("&#160;")},_move:function(e,t){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex):(i=this.menuItems.eq(this.element[0].selectedIndex),n+=":not(.ui-state-disabled)"),s="first"===e||"last"===e?i["first"===e?"prevAll":"nextAll"](n).eq(-1):i[e+"All"](n).eq(0),s.length&&this.menuInstance.focus(t,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(e){this[this.isOpen?"close":"open"](e)},_setSelection:function(){var e;this.range&&(window.getSelection?(e=window.getSelection(),e.removeAllRanges(),e.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(t){this.isOpen&&(e(t.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(t))}},_buttonEvents:{mousedown:function(){var e;window.getSelection?(e=window.getSelection(),e.rangeCount&&(this.range=e.getRangeAt(0))):this.range=document.selection.createRange()},click:function(e){this._setSelection(),this._toggle(e)},keydown:function(t){var i=!0;switch(t.keyCode){case e.ui.keyCode.TAB:case e.ui.keyCode.ESCAPE:this.close(t),i=!1;break;case e.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(t);break;case e.ui.keyCode.UP:t.altKey?this._toggle(t):this._move("prev",t);break;case e.ui.keyCode.DOWN:t.altKey?this._toggle(t):this._move("next",t);break;case e.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(t):this._toggle(t);break;case e.ui.keyCode.LEFT:this._move("prev",t);break;case e.ui.keyCode.RIGHT:this._move("next",t);break;case e.ui.keyCode.HOME:case e.ui.keyCode.PAGE_UP:this._move("first",t);break;case e.ui.keyCode.END:case e.ui.keyCode.PAGE_DOWN:this._move("last",t);break;default:this.menu.trigger(t),i=!1}i&&t.preventDefault()}},_selectFocusedItem:function(e){var t=this.menuItems.eq(this.focusIndex);t.hasClass("ui-state-disabled")||this._select(t.data("ui-selectmenu-item"),e)},_select:function(e,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=e.index,this._setText(this.buttonText,e.label),this._setAria(e),this._trigger("select",t,{item:e}),e.index!==i&&this._trigger("change",t,{item:e}),this.close(t)},_setAria:function(e){var t=this.menuItems.eq(e.index).attr("id");this.button.attr({"aria-labelledby":t,"aria-activedescendant":t}),this.menu.attr("aria-activedescendant",t)},_setOption:function(e,t){"icons"===e&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(t.button),this._super(e,t),"appendTo"===e&&this.menuWrap.appendTo(this._appendTo()),"disabled"===e&&(this.menuInstance.option("disabled",t),this.button.toggleClass("ui-state-disabled",t).attr("aria-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===e&&this._resizeButton()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var e=this.options.width;e||(e=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(e)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")}},_parseOptions:function(t){var i=[];t.each(function(t,s){var n=e(s),a=n.parent("optgroup");i.push({element:n,index:t,value:n.val(),label:n.text(),optgroup:a.attr("label")||"",disabled:a.prop("disabled")||n.prop("disabled")})}),this.items=i},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element)}}),e.widget("ui.slider",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,s=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>",o=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),t=n.length;i>t;t++)o.push(a);this.handles=n.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,i="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,s,n,a,o,r,h,l,u=this,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(s-u.values(t));(n>i||n===i&&(t===u._lastChangedValue||u.values(t)===d.min))&&(n=i,a=e(this),o=t)}),r=this._start(t,o),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,a.addClass("ui-state-active").focus(),h=a.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-h.left-a.width()/2,top:t.pageY-h.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,s,n,a;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/t,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),a=this._valueMin()+s*n,this._trimAlignValue(a)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var s,n,a;this.options.values&&this.options.values.length?(s=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>s||1===t&&s>i)&&(i=s),i!==this.values(t)&&(n=this.values(),n[t]=i,a=this._trigger("slide",e,{handle:this.handles[t],value:i,values:n}),s=this.values(t?0:1),a!==!1&&this.values(t,i))):i!==this.value()&&(a=this._trigger("slide",e,{handle:this.handles[t],value:i}),a!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,i){var s,n,a;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(s=this.options.values,n=arguments[0],a=0;s.length>a;a+=1)s[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue()},_setOption:function(t,i){var s,n=0;switch("range"===t&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(n=this.options.values.length),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!i),this._super(t,i),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;n>s;s+=1)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,s;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)>=t&&(s+=i>0?t:-t),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),i=this.options.step,s=Math.floor(+(e-t).toFixed(this._precision())/i)*i;e=s+t,this.max=parseFloat(e.toFixed(this._precision()))},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var t,i,s,n,a,o=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),u["horizontal"===h.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[l?"animate":"css"](u,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:r.animate}))),t=i}):(s=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?100*((s-n)/(a-n)):0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](u,r.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===o&&"horizontal"===this.orientation&&this.range[l?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===o&&"vertical"===this.orientation&&this.range[l?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(t){var i,s,n,a,o=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),i=this._start(t,o),i===!1))return}switch(a=this.options.step,s=n=this.options.values&&this.options.values.length?this.values(o):this.value(),t.keyCode){case e.ui.keyCode.HOME:n=this._valueMin();break;case e.ui.keyCode.END:n=this._valueMax();break;case e.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-a)}this._slide(t,o,n)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,n=!1,a=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,a.widgetName+"-item")===a?(s=e(this),!1):void 0}),e.data(t.target,a.widgetName+"-item")===a&&(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,s){var n,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(a)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));
return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,n,a,o=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-this.document.scrollTop()<o.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<o.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)),t.pageX-this.document.scrollLeft()<o.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<o.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],a=this._intersectsWithPointer(s),a&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==n&&!e.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],n):!0)){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),a=this.options.axis,o={};a&&"x"!==a||(o.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(o.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,a=e.left,o=a+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||s+l>r&&h>s+l,c="y"===this.options.axis||t+u>a&&o>t+u,p=d&&c;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&&"right"===a||"down"===n?2:1:n&&("down"===n?2:1):!1},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){r.push(this)}var s,n,a,o,r=[],h=[],l=this._connectWith();if(l&&t)for(s=l.length-1;s>=0;s--)for(a=e(l[s],this.document[0]),n=a.length-1;n>=0;n--)o=e.data(a[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&h.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(h.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,a,o,r,h,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(i=c.length-1;i>=0;i--)for(n=e(c[i],this.document[0]),s=n.length-1;s>=0;s--)a=e.data(n[s],this.widgetFullName),a&&a!==this&&!a.options.disabled&&(d.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(i=d.length-1;i>=0;i--)for(o=d[i][1],r=d[i][0],s=0,l=r.length;l>s;s++)h=e(r[s]),h.data(this.widgetName+"-item",o),u.push({item:h,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,a;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),a=n.offset(),s.left=a.left,s.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===s?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(n)):"tr"===s?t._createTrPlaceholder(t.currentItem,n):"img"===s&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var s=this;t.children().each(function(){e("<td>&#160;</td>",s.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){var i,s,n,a,o,r,h,l,u,d,c=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(c&&e.contains(this.containers[i].element[0],c.element[0]))continue;c=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,a=null,u=c.floating||this._isFloating(this.currentItem),o=u?"left":"top",r=u?"width":"height",d=u?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[o],l=!1,t[d]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(t[d]-h)&&(n=Math.abs(t[d]-h),a=this.items[s],this.direction=l?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,a=t.pageX,o=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)t||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(s=0;n.length>s;s++)n[s].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.widget("ui.spinner",{version:"1.11.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},i=this.element;return e.each(["min","max","step"],function(e,s){var n=i.attr(s);void 0!==n&&n.length&&(t[s]=n)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e),void 0)},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){function i(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(t)!==!1&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){return e(t.currentTarget).hasClass("ui-state-active")?this._start(t)===!1?!1:(this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t),void 0):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var i=this.options,s=e.ui.keyCode;switch(t.keyCode){case s.UP:return this._repeat(null,1,t),!0;case s.DOWN:return this._repeat(null,-1,t),!0;case s.PAGE_UP:return this._repeat(null,i.page,t),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon "+this.options.icons.down+"'>&#9660;</span>"+"</a>"},_start:function(e){return this.spinning||this._trigger("start",e)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&this._trigger("spin",t,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,s=this.options;return t=null!==s.min?s.min:0,i=e-t,i=Math.round(i/s.step)*s.step,e=t+i,e=parseFloat(e.toFixed(this._precision())),null!==s.max&&e>s.max?s.max:null!==s.min&&s.min>e?s.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,this.element.val(this._format(i)),void 0}("max"===e||"min"===e||"step"===e)&&"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable"))},_setOptions:h(function(e){this._super(e)}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var e=this.value();return null===e?!1:e===this._adjustValue(e)},_value:function(e,t){var i;""!==e&&(i=this._parse(e),null!==i&&(t||(i=this._adjustValue(i)),e=this._format(i))),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:h(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:h(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:h(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:h(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){return arguments.length?(h(this._value).call(this,e),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),e.widget("ui.tabs",{version:"1.11.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var e=/#.*$/;return function(t){var i,s;t=t.cloneNode(!1),i=t.href.replace(e,""),s=location.href.replace(e,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return t.hash.length>1&&i===s}}(),_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===t&&(s&&this.tabs.each(function(i,n){return e(n).attr("aria-controls")===s?(t=i,!1):void 0}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=this.tabs.length?0:!1)),t!==!1&&(t=this.tabs.index(this.tabs.eq(t)),-1===t&&(t=i?!1:0)),!i&&t===!1&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:s++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:n=!1,s--;break;case e.ui.keyCode.END:s=this.anchors.length-1;break;case e.ui.keyCode.HOME:s=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),this._activate(s),void 0;case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),void 0;default:return}t.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),t.ctrlKey||t.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){function s(){return t>n&&(t=0),0>t&&(t=n),t}for(var n=this.tabs.length-1;-1!==e.inArray(s(),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){return"active"===e?(this._activate(t),void 0):"disabled"===e?(this._setupDisabled(t),void 0):(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||this.options.active!==!1||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t),void 0)},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),function(e){return i.index(e)}),this._processTabs(),t.active!==!1&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this,i=this.tabs,s=this.anchors,n=this.panels;
this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(i,s){var n,a,o,r=e(s).uniqueId().attr("id"),h=e(s).closest("li"),l=h.attr("aria-controls");t._isLocal(s)?(n=s.hash,o=n.substring(1),a=t.element.find(t._sanitizeSelector(n))):(o=h.attr("aria-controls")||e({}).uniqueId()[0].id,n="#"+o,a=t.element.find(n),a.length||(a=t._createPanel(o),a.insertAfter(t.panels[i-1]||t.tablist)),a.attr("aria-live","polite")),a.length&&(t.panels=t.panels.add(a)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":o,"aria-labelledby":r}),a.attr("aria-labelledby",r)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,s=0;i=this.tabs[s];s++)t===!0||-1!==e.inArray(s,t)?e(i).addClass("ui-state-disabled").attr("aria-disabled","true"):e(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var i={};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,s=this.element.parent();"fill"===t?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),s=t.css("position");"absolute"!==s&&"fixed"!==s&&(i-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height("").height())}).height(i))},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n.closest("li"),o=a[0]===s[0],r=o&&i.collapsible,h=r?e():this._getPanelForTab(a),l=s.length?this._getPanelForTab(s):e(),u={oldTab:s,oldPanel:l,newTab:r?e():a,newPanel:h};t.preventDefault(),a.hasClass("ui-state-disabled")||a.hasClass("ui-tabs-loading")||this.running||o&&!i.collapsible||this._trigger("beforeActivate",t,u)===!1||(i.active=r?!1:this.tabs.index(a),this.active=o?e():a,this.xhr&&this.xhr.abort(),l.length||h.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(a),t),this._toggle(t,u))},_toggle:function(t,i){function s(){a.running=!1,a._trigger("activate",t,i)}function n(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),o.length&&a.options.show?a._show(o,a.options.show,s):(o.show(),s())}var a=this,o=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),o.length&&r.length?i.oldTab.attr("tabIndex",-1):o.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),o.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(t){var i,s=this._findActive(t);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(t){var i=this.options.disabled;i!==!1&&(void 0===t?i=!1:(t=this._getIndex(t),i=e.isArray(i)?e.map(i,function(e){return e!==t?e:null}):e.map(this.tabs,function(e,i){return i!==t?i:null})),this._setupDisabled(i))},disable:function(t){var i=this.options.disabled;if(i!==!0){if(void 0===t)i=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,i))return;i=e.isArray(i)?e.merge([t],i).sort():[t]}this._setupDisabled(i)}},load:function(t,i){t=this._getIndex(t);var s=this,n=this.tabs.eq(t),a=n.find(".ui-tabs-anchor"),o=this._getPanelForTab(n),r={tab:n,panel:o},h=function(e,t){"abort"===t&&s.panels.stop(!1,!0),n.removeClass("ui-tabs-loading"),o.removeAttr("aria-busy"),e===s.xhr&&delete s.xhr};this._isLocal(a[0])||(this.xhr=e.ajax(this._ajaxSettings(a,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(n.addClass("ui-tabs-loading"),o.attr("aria-busy","true"),this.xhr.done(function(e,t,n){setTimeout(function(){o.html(e),s._trigger("load",i,r),h(n,t)},1)}).fail(function(e,t){setTimeout(function(){h(e,t)},1)})))},_ajaxSettings:function(t,i,s){var n=this;return{url:t.attr("href"),beforeSend:function(t,a){return n._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:a},s))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),e.widget("ui.tooltip",{version:"1.11.4",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(t,i){var s=(t.attr("aria-describedby")||"").split(/\s+/);s.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(s.join(" ")))},_removeDescribedBy:function(t){var i=t.data("ui-tooltip-id"),s=(t.attr("aria-describedby")||"").split(/\s+/),n=e.inArray(i,s);-1!==n&&s.splice(n,1),t.removeData("ui-tooltip-id"),s=e.trim(s.join(" ")),s?t.attr("aria-describedby",s):t.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(t,i){var s=this;return"disabled"===t?(this[i?"_disable":"_enable"](),this.options[t]=i,void 0):(this._super(t,i),"content"===t&&e.each(this.tooltips,function(e,t){s._updateContent(t.element)}),void 0)},_disable:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur");n.target=n.currentTarget=s.element[0],t.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).removeAttr("title")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,s=e(t?t.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&s.parents().each(function(){var t,s=e(this);s.data("ui-tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(t,s),this._updateContent(s,t))},_updateContent:function(e,t){var i,s=this.options.content,n=this,a=t?t.type:null;return"string"==typeof s?this._open(t,e,s):(i=s.call(e[0],function(i){n._delay(function(){e.data("ui-tooltip-open")&&(t&&(t.type=a),this._open(t,e,i))})}),i&&this._open(t,e,i),void 0)},_open:function(t,i,s){function n(e){l.of=e,o.is(":hidden")||o.position(l)}var a,o,r,h,l=e.extend({},this.options.position);if(s){if(a=this._find(i))return a.tooltip.find(".ui-tooltip-content").html(s),void 0;i.is("[title]")&&(t&&"mouseover"===t.type?i.attr("title",""):i.removeAttr("title")),a=this._tooltip(i),o=a.tooltip,this._addDescribedBy(i,o.attr("id")),o.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),s.clone?(h=s.clone(),h.removeAttr("id").find("[id]").removeAttr("id")):h=s,e("<div>").html(h).appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:n}),n(t)):o.position(e.extend({of:i},this.options.position)),o.hide(),this._show(o,this.options.show),this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){o.is(":visible")&&(n(l.of),clearInterval(r))},e.fx.interval)),this._trigger("open",t,{tooltip:o})}},_registerCloseHandlers:function(t,i){var s={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var s=e.Event(t);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),t&&"mouseover"!==t.type||(s.mouseleave="close"),t&&"focusin"!==t.type||(s.focusout="close"),this._on(!0,i,s)},close:function(t){var i,s=this,n=e(t?t.currentTarget:this.element),a=this._find(n);return a?(i=a.tooltip,a.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),a.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(e(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete s.parents[t]}),a.closing=!0,this._trigger("close",t,{tooltip:i}),a.hiding||(a.closing=!1)),void 0):(n.removeData("ui-tooltip-open"),void 0)},_tooltip:function(t){var i=e("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),s=i.uniqueId().attr("id");return e("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[s]={element:t,tooltip:i}},_find:function(e){var t=e.data("ui-tooltip-id");return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur"),a=s.element;n.target=n.currentTarget=a[0],t.close(n,!0),e("#"+i).remove(),a.data("ui-tooltip-title")&&(a.attr("title")||a.attr("title",a.data("ui-tooltip-title")),a.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}})});
/**
 * @file        plugins/backend-jquery-ui/plugin.js
 * @desc        JQUERY UI plugin class
 * @ingroup     DEVAPT_JQUERY_UI
 * @date        2015-02-23
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-jquery-ui/plugin',['Devapt', 'core/types', 'object/class', 'object/plugin',
	'jquery-ui'],
function(Devapt, DevaptTypes, DevaptClass, DevaptPlugin,
	undefined)
{
	/**
	 * @public
	 * @class				DevapJQueryUIPlugin
	 * @desc				Devapt jQuery UI Plugin class
	 */
	
	
	var classes_map = {
		'Window':['plugins/backend-jquery-ui/views/window']/*,
		'JsonTree':['plugins/backend-jquery-ui/views/jsontree']*/
	};
	
	
	/**
	 * @public
	 * @memberof			DevapJQueryUIPlugin
	 * @desc				Has class dependancies ?
	 * @param {string}		arg_class_name	class name
	 * @return {boolean}
	 */
	var cb_has_class_depds = function(arg_class_name)
	{
		var self = this;
		var context = 'has_class_depds(class name)';
		self.enter(context, arg_class_name);
		
		var found = arg_class_name in classes_map;
		
		self.leave(context, Devapt.msg_success + '[' + found + ']');
		return found;
	}
	
	
	/**
	 * @public
	 * @memberof			DevapJQueryUIPlugin
	 * @desc				Get plugin classes dependancies
	 * @param {string}		arg_class_name	class name
	 * @return {array}		Requires urls strings
	 */
	var cb_get_class_depds = function(arg_class_name)
	{
		var self = this;
		var context = 'get_class_depds(class name)';
		self.enter(context, arg_class_name);
		
		var depds = arg_class_name in classes_map ? classes_map[arg_class_name] : [];
		
		self.leave(context, Devapt.msg_success + ' count[' + depds.length + ']');
		return depds;
	}
	
	/**
	 * @public
	 * @memberof			DevapJQueryUIPlugin
	 * @desc				Get plugin backend
	 * @return {object}		A backend object
	 */
	var cb_get_backend = function()
	{
		var self = this;
		var context = 'get_backend()';
		self.enter(context, '');
		
		// console.log(DevaptFoundation5Backend, context);
		
		self.leave(context, Devapt.msg_success);
		return DevaptFoundation5Backend;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-04-04',
			'updated':'2015-04-04',
			'description':'jQuery UI features for Devapt applications.',
			'is_singleton':true
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptPlugin;
	var DevapJQueryUIPluginClass = new DevaptClass('DevapJQueryUIPlugin', parent_class, class_settings);
	
	// METHODS
	DevapJQueryUIPluginClass.add_public_method('has_class_depds', {}, cb_has_class_depds);
	DevapJQueryUIPluginClass.add_public_method('get_class_depds', {}, cb_get_class_depds);
	DevapJQueryUIPluginClass.add_public_method('get_backend', {}, cb_get_backend);
	
	// PROPERTIES
	
	
	return DevapJQueryUIPluginClass;
} );
/**
 * @file        plugins/backend-jquery-ui/views/window.js
 * @desc        JQuery UI window class
 * @ingroup     DEVAPT_JQUERY_UI
 * @date        2015-04-04
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-jquery-ui/views/window',['Devapt', 'core/types', 'object/class', 'views/view', 'jquery-ui'],
function(Devapt, DevaptTypes, DevaptClass, DevaptView, undefined)
{
	/**
	 * @public
	 * @class				DevaptWindow
	 * @desc				Label view class
	 */
	
	var $ = window.$;
	
	/**
	 * @public
	 * @memberof			DevaptWindow
	 * @desc				Render view
	 * @param {object}		arg_deferred	deferred object
	 * @return {object}		deferred promise object
	 */
	var cb_render_self = function(arg_deferred)
	{
		var self = this;
		var context = 'render_self(deferred)';
		self.enter(context, '');
		
		
		// CHECK DEFEREED
		self.assert_not_null(context, 'arg_deferred', arg_deferred);
		
		var style_jqo = $('<link rel="stylesheet" href="/devapt-tutorial-1/public/../../devapt-client/lib/jquery-ui-1.11.4/jquery-ui.min.css">');
		$('head').append(style_jqo);
		
		// GET NODES
		// self.assert_not_null(context, 'parent_jqo', self.parent_jqo);
		self.content_jqo = $('<div>');
		// self.parent_jqo.append(self.content_jqo);
		self.content_jqo.attr('id', self.get_view_id());
		
		
		// GET CURRENT BACKEND
		var backend = Devapt.get_current_backend();
		self.assert_not_null(context, 'backend', backend);
		
		// GET WINDOW VIEW CONTENT
		self.assert_not_empty_value(context, 'self.content', self.content);
		var body_jqo = $('<div>');
		
		// RENDER CONTENT VIEW
		var content_promise = backend.render_view(body_jqo, self.content);
		content_promise.then(
			function()
			{
				self.content_jqo.dialog(
					{
						resize: function(event,ui){ console.log(ui, context + ':on resize'); },
						close: function() { self.on_close(); }
					}
				);
				
				// UPDATE SIZE
				var win_jqo = $(window);
				// console.log(win_jqo.height(), context + ':win_height');
				// console.log(win_jqo.width(), context + ':win_width');
				
				var height = DevaptTypes.is_integer(self.height) ? self.height : win_jqo.height() * self.height_percent;
				var width = DevaptTypes.is_integer(self.width) ? self.width : win_jqo.width() * self.width_percent;
				self.content_jqo.dialog('option', 'width', width);
				self.content_jqo.dialog('option', 'height', height);
				// console.log(height, context + ':height');
				// console.log(width, context + ':width');
				
				var min_height = DevaptTypes.is_integer(self.min_height) ? self.min_height : win_jqo.height() * self.min_height_percent;
				var min_width = DevaptTypes.is_integer(self.min_width) ? self.min_width : win_jqo.width() * self.min_width_percent;
				self.content_jqo.dialog('option', 'minWidth', min_width);
				self.content_jqo.dialog('option', 'minHeight', min_height);
				// console.log(min_height, context + ':min_height');
				// console.log(min_width, context + ':min_width');
				
				var max_height = DevaptTypes.is_integer(self.max_height) ? self.max_height : win_jqo.height() * self.max_height_percent;
				var max_width = DevaptTypes.is_integer(self.max_width) ? self.max_width : win_jqo.width() * self.max_width_percent;
				self.content_jqo.dialog('option', 'maxWidth', max_width);
				self.content_jqo.dialog('option', 'maxHeight', max_height);
				// console.log(max_height, context + ':max_height');
				// console.log(max_width, context + ':max_width');
			}
		);
		
		// body_jqo.html(self.content);
		self.content_jqo.append(body_jqo);
		
		
		self.leave(context, Devapt.msg_success_promise);
		return content_promise;
	};
	
	
	/**
	 * @public
	 * @memberof			DevaptWindow
	 * @desc				Handle Close event
	 * @return {boolean}
	 */
	var cb_on_close = function()
	{
		var self = this;
		// self.trace=true;
		var context = 'on_close()';
		self.enter(context, '');
		
		
		
		self.leave(context, Devapt.msg_success_promise);
		return true;
	};
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2015-04-04',
			'updated':'2015-04-04',
			'description':'A window view class with jQuery UI backend.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptView;
	var DevaptWindowClass = new DevaptClass('DevaptWindow', parent_class, class_settings);
	
	// METHODS
	DevaptWindowClass.add_public_method('render_self', {}, cb_render_self);
	DevaptWindowClass.add_public_method('on_close', {}, cb_on_close);
	
	// PROPERTIES
	DevaptWindowClass.add_public_str_property('content',	'',					null, false, false, []);
	
	DevaptWindowClass.add_public_int_property('min_height',	'',					null, false, false, []);
	DevaptWindowClass.add_public_int_property('min_width',	'',					null, false, false, []);
	DevaptWindowClass.add_public_float_property('min_height_percent',	'',		0.5, false, false, []);
	DevaptWindowClass.add_public_float_property('min_width_percent',	'',		0.5, false, false, []);
	
	DevaptWindowClass.add_public_int_property('max_height',	'',					null, false, false, []);
	DevaptWindowClass.add_public_int_property('max_width',	'',					null, false, false, []);
	DevaptWindowClass.add_public_float_property('max_height_percent',	'',		0.9, false, false, []);
	DevaptWindowClass.add_public_float_property('max_width_percent',	'',		0.9, false, false, []);
	
	DevaptWindowClass.add_public_int_property('height',	'',						null, false, false, []);
	DevaptWindowClass.add_public_int_property('width',	'',						null, false, false, []);
	DevaptWindowClass.add_public_float_property('height_percent',	'',			0.8, false, false, []);
	DevaptWindowClass.add_public_float_property('width_percent',	'',			0.8, false, false, []);
	
	
	return DevaptWindowClass;
} );
/**
 * @file        plugins/backend-jquery-ui/all.js
 * @desc        Load all Devapt plugin classes
 * @ingroup     DEVAPT_JQUERYUI
 * @date        2015-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'plugins/backend-jquery-ui/all',['plugins/backend-jquery-ui/plugin', 'plugins/backend-jquery-ui/views/window'],
function()
{
}
);
/**
 * @file        plugins/all.js
 * @desc        Load all Devapt worker classes
 * @ingroup     DEVAPT_PLUGINS
 * @date        2015-08-15
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
	'plugins/all',[
		'plugins/plugins',
		'plugins/backend-foundation5/all',
		'plugins/backend-jquery-ui/all'
	],
	function()
	{
	}
);
/**
 * @file        views/input.js
 * @desc        Input Class
 * @ingroup     DEVAPT_VIEWS
 * @date        2014-05-09
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/input',['Devapt', 'core/types', 'object/class', 'views/view'],
function(Devapt, DevaptTypes, DevaptClass, DevaptView)
{
	/**
	 * @public
	 * @class				DevaptInput
	 * @desc				Input view class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptInput
	 * @desc				Render view
	 * @param {object}		arg_deferred	deferred object
	 * @return {object}		deferred promise object
	 */
	var cb_render_self = function(arg_deferred)
	{
		var self = this;
		var context = 'render_self(deferred)';
		self.enter(context, '');
		
		
		// CHECK DEFEREED
		self.assert_not_null(context, 'arg_deferred', arg_deferred);
		
		// GET NODES
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		self.input_jqo = $('<input type="text">');
		self.input_jqo.attr('id', self.get_view_id() + '_input');
		
		// SET LABEL
		var label = DevaptTypes.is_not_empty_str(self.label) ? self.label : null;
		if (label)
		{
			var label_jqo = $('<label>');
			label_jqo.text(label);
			label_jqo.attr('for', self.get_view_id() + '_input');
			self.content_jqo.append(label_jqo);
		}
		self.content_jqo.append(self.input_jqo);
		
		// SET PLACEHOLDER
		var placeholder = DevaptTypes.is_not_empty_str(self.placeholder) ? self.placeholder : null;
		if (placeholder)
		{
			self.input_jqo.attr('placeholder', self.placeholder);
		}
		
		// SET INPUT CONTENT
		var input_value = DevaptTypes.is_not_empty_str(self.input_value) ? self.input_value : null;
		if (input_value)
		{
			self.input_jqo.val(input_value);
		}
		
		// EVENTS CALLBACK
		var fire_cb = function(arg_event)
		{
			var value = self.input_jqo ? self.input_jqo.val() : '';
			var devapt_event = arg_event.data.name;
			console.log(devapt_event, 'input.event for [' + value + ']');
			
			self.fire_event(devapt_event, [{ 'input': value}]);
		};
		
		// TRIGGER MOUSE EVENTS
		if (self.events_click_enabled)
		{
			self.input_jqo.on('click',	{ name: 'devapt.input.click' }, fire_cb);
		}
		
		// TRIGGER KEYS EVENTS
		if (self.events_keydown_enabled)
		{
			self.input_jqo.on('keydown',	{ name: 'devapt.input.keydown' }, fire_cb);
		}
		if (self.events_keyup_enabled)
		{
			self.input_jqo.on('keyup',	{ name: 'devapt.input.changed' }, fire_cb);
			self.input_jqo.on('keypress',	{ name: 'devapt.input.changed' }, fire_cb);
		}
		if (self.events_keypress_enabled)
		{
			self.input_jqo.on('keypress',	{ name: 'devapt.input.keypress' }, fire_cb);
		}
		
		// TRIGGER CLIPBOARD EVENTS
		if (self.events_cut_enabled)
		{
			self.input_jqo.on('cut',		{ name: 'devapt.input.changed' }, fire_cb);
		}
		if (self.events_copy_enabled)
		{
			self.input_jqo.on('copy',	{ name: 'devapt.input.copy' }, fire_cb);
		}
		if (self.events_paste_enabled)
		{
			self.input_jqo.on('paste',	{ name: 'devapt.input.changed' }, fire_cb);
		}
		
		// RESOLVE AND GET PROMISE
		arg_deferred.resolve();
		
		
		self.leave(context, 'success: promise is resolved');
		return Devapt.promise(arg_deferred);
	}
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2014-05-09',
			updated:'2014-12-06',
			description:'Input view class.'
		},
		properties:{
			
		}
	};
	var parent_class = DevaptView;
	var DevaptInputClass = new DevaptClass('DevaptInput', parent_class, class_settings);
	
	// METHODS
	DevaptInputClass.add_public_method('render_self', {}, cb_render_self);
	
	// PROPERTIES
		// PLACEHOLDER
	DevaptInputClass.add_public_str_property('placeholder',					'input placeholder string', null, false, false, []);
	
		// MOUSE EVENTS
	DevaptInputClass.add_public_bool_property('events_click_enabled',		'', false, false, false, []);
	
		// KEY EVENTS
	DevaptInputClass.add_public_bool_property('events_keydown_enabled',		'', false, false, false, []);
	DevaptInputClass.add_public_bool_property('events_keyup_enabled',		'', false, false, false, []);
	DevaptInputClass.add_public_bool_property('events_keypress_enabled',	'', false, false, false, []);
	
		// CLIPBOARD EVENTS
	DevaptInputClass.add_public_bool_property('events_cut_enabled',			'', false, false, false, []);
	DevaptInputClass.add_public_bool_property('events_copy_enabled',		'', false, false, false, []);
	DevaptInputClass.add_public_bool_property('events_paste_enabled',		'', false, false, false, []);
	
	
	return DevaptInputClass;
} );
/**
 * @file        views/remote.js
 * @desc        Remote view class
 * @ingroup     DEVAPT_VIEWS
 * @date        2014-06-24
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/remote',['Devapt', 'object/class', 'views/view', 'core/application'],
function(Devapt, DevaptClass, DevaptView, DevaptApplication)
{
	/**
	 * @public
	 * @class				DevaptRemote
	 * @desc				Remote view view class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptRemote
	 * @desc				Render view
	 * @param {object}		arg_deferred	deferred object
	 * @return {object}		deferred promise object
	 */
	var cb_render_self = function(arg_deferred)
	{
		var self = this;
		var context = 'render_self(deferred)';
		self.enter(context, '');
		
		
		// CHECK CONTAINER NODE
		self.assert_not_null(context, 'arg_deferred', arg_deferred);
		self.assert_not_null(context, 'parent_jqo', self.parent_jqo);
		
		// GET APP BASE URL
		var url_base = DevaptApplication.get_url_base();
		
		// GET VIEW CONTENT URL
		var view_content_url = url_base + 'views/' + self.name + '/html_view' + '?security_token=' + DevaptApplication.get_security_token();
		
		
		// GET AND RENDER VIEW CONTENT
		var jq_promise = $.get(view_content_url);
		var promise = Devapt.defer(jq_promise);
		promise.then(
			function(arg_html)
			{
				self.content_jqo.html(arg_html);
			}
		);
		
		// RESOLVE DEFERRED
		arg_deferred.resolve(promise);
		
		
		self.leave(context, 'success: promise is resolved: async render');
		return arg_deferred.promise;
	}
	
	
	
	/* --------------------------------------------- CREATE CLASS ------------------------------------------------ */
	
	// CLASS DEFINITION
	var class_settings= {
		'infos':{
			'author':'Luc BORIES',
			'created':'2014-06-24',
			'updated':'2014-12-06',
			'description':'Remote view class.'
		}
	};
	
	// CLASS CREATION
	var parent_class = DevaptView;
	var DevaptRemoteClass = new DevaptClass('DevaptRemote', parent_class, class_settings);
	
	// METHODS
	DevaptRemoteClass.add_public_method('render_self', {}, cb_render_self);
	
	// PROPERTIES
	DevaptRemoteClass.add_public_str_property('include_file_path_name',	'',		null, false, false, []);
	
	
	return DevaptRemoteClass;
} );
/**
 * @file        views/select.js
 * @desc        Select HTML tag Class
 * @ingroup     DEVAPT_VIEWS
 * @date        2015-01-16
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'views/select',['Devapt', 'core/types', 'object/class', 'views/container'],
function(Devapt, DevaptTypes, DevaptClass, DevaptContainer)
{
	/**
	 * @public
	 * @class				DevaptSelect
	 * @desc				Select view class
	 */
	
	
	/**
	 * @public
	 * @memberof			DevaptSelect
	 * @desc				Constructor
	 * @param {object}		instance object
	 * @return {nothing}
	 */
	var cb_constructor = function(self)
	{
		// CONSTRUCTOR BEGIN
		var context = 'constructor(' + self.name + ')';
		self.enter(context, '');
		
		
		self.items_jquery_parent = null;
		self.items_jquery_filter = 'option';
		
		
		// CONSTRUCTOR END
		self.leave(context, Devapt.msg_success);
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptSelect
	 * @desc				Get a container item node by the node item text
	 * @param {string}		arg_node_item_text		node item text
	 * @return {object}		node jQuery object
	 */
	var cb_get_node_by_content = function(arg_node_item_text)
	{
		var self = this;
		var context = 'get_node_by_content(text)';
		self.enter(context, '');
		
		
		// SELECT OPTION BY CONTENT
		var item_jqo = $('option:contains("' + arg_node_item_text + '"):eq(0)', self.items_jquery_parent);
		if ( ! item_jqo)
		{
			self.leave(context, Devapt.msg_failure);
			return null;
		}
		
		// GET ANCHOR PARENT
		var node_jqo = item_jqo.parent();
		
		
		self.leave(context, Devapt.msg_success);
		return node_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptSelect
	 * @desc				Begin the render of the container
	 * @return {nothing}
	 */
	var cb_render_begin = function()
	{
		var self = this;
		var context = 'render_begin()';
		self.enter(context, '');
		
		
		// CHECK CONTENT NODE
		self.assert_not_null(context, 'content_jqo', self.content_jqo);
		
		self.items_jquery_parent = $('<select>');
		self.content_jqo.append(self.items_jquery_parent);
		
		// MULTIPLE SELECTION ?
		if (self.has_multiple_selection)
		{
			self.items_jquery_parent.attr('multiple', '');
		}
		
		// VISIBLE ITEMS
		if (self.items_visible_count)
		{
			self.items_jquery_parent.attr('size', self.items_visible_count);
		}
		
		
		self.leave(context, Devapt.msg_success);
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptSelect
	 * @desc				Render an empty item node
	 * @param {integer} 	arg_item_index		item index (ignored)
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_node = function(arg_item_index)
	{
		var self = this;
		var context = 'render_item_node(index)';
		self.enter(context, '');
		
		
		var node_jqo = $('<option>');
		node_jqo.click(
			function()
			{
				var node_index = parseInt( node_jqo.index() );
				self.select_item_node(node_index);
			}
		);
		
		
		self.leave(context, Devapt.msg_success);
		return node_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptSelect
	 * @desc				Render an divider item content
	 * @param {object}		arg_deferred		deferred object
	 * @param {object}		arg_item_jqo		
	 * @param {string}		arg_item_content
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_divider = function(arg_deferred, arg_item_jqo, arg_item_content)
	{
		var self = this;
		var context = 'render_item_divider(deferred,jqo,content)';
		self.enter(context, '');
		
		arg_item_jqo.attr('disabled', '');
		
		self.leave(context, Devapt.msg_success);
		return arg_item_jqo;
	}
	
	
	/**
	 * @public
	 * @memberof			DevaptSelect
	 * @desc				Render an item TEXT content
	 * @param {object}		arg_deferred		deferred object
	 * @param {object}		arg_item_jqo		
	 * @param {string}		arg_item_content
	 * @return {object}		jQuery object node
	 */
	var cb_render_item_text = function(arg_deferred, arg_item_jqo, arg_item_content)
	{
		var self = this;
		var context = 'render_item_text(deferred,jqo,content)';
		self.enter(context, '');
		self.value(context, 'arg_item_content', arg_item_content);
		
		
		arg_item_jqo.text(arg_item_content);
		
		
		self.leave(context, Devapt.msg_success);
		return arg_item_jqo;
	}
	
	
	
	/* --------------------------------------------- CREATE OBJECT CLASS ------------------------------------------------ */
	
	// CREATE AND REGISTER CLASS
	var class_settings = {
		infos:{
			author:'Luc BORIES',
			created:'2014-05-09',
			updated:'2014-12-06',
			description:'Select view class.'
		},
		properties:{
			
		}
	};
	var parent_class = DevaptContainer;
	var DevaptSelectClass = new DevaptClass('DevaptSelect', parent_class, class_settings);
	
	// METHODS
	DevaptSelectClass.infos.ctor = cb_constructor;
	DevaptSelectClass.add_public_method('get_node_by_content', {}, cb_get_node_by_content);
	DevaptSelectClass.add_public_method('render_begin', {}, cb_render_begin);
	DevaptSelectClass.add_public_method('render_item_node', {}, cb_render_item_node);
	DevaptSelectClass.add_public_method('render_item_divider', {}, cb_render_item_divider);
	DevaptSelectClass.add_public_method('render_item_text', {}, cb_render_item_text);
	
	// PROPERTIES
	
	
	return DevaptSelectClass;
} );
/**
 * @file        views/view/all.js
 * @desc        Load all Devapt view classes
 * @ingroup     DEVAPT_CORE
 * @date        2014-12-26
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */

define(
'views/view/all',['views/view/view-mixin-renderable', 'views/view/view-mixin-bind',
'views/view/view-mixin-options-css', 'views/view/view-mixin-template'],
function()
{
} );
/**
 * @file        views/container/all.js
 * @desc        Load all Devapt container classes
 * @ingroup     DEVAPT_CORE
 * @date        2014-12-26
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */

define(
'views/container/all',['views/container/container-mixin-render-item',
'views/container/container-mixin-render-node',
'views/container/container-mixin-render-object',
'views/container/container-mixin-render-view',
'views/container/container-mixin-selectable',
'views/container/container-mixin-utils',
'views/container/container-mixin-filtered',
'views/container/container-mixin-input',
'views/container/container-mixin-get-nodes',
'views/container/mixin-input-association',
'views/container/mixin-input-simple',
'views/container/mixin-input-validate',
/*'views/container/container-mixin-model-crud',*/
'views/container/container-mixin-pagination'
],
function()
{
} );
/**
 * @file        views/all.js
 * @desc        Load all Devapt view classes
 * @ingroup     DEVAPT_CORE
 * @date        2014-12-26
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */

define(
'views/all',['views/container', 'views/input', 'views/remote', 'views/select', 'views/view',
	'views/view/all', 'views/container/all'
],
function()
{
} );
/**
 * @file        object/all.js
 * @desc        Load all Devapt worker classes
 * @ingroup     DEVAPT_WORKER
 * @date        2014-12-26
 * @version		1.0.x
 * @author      Luc BORIES
 * @copyright	Copyright (C) 2011 Luc BORIES All rights reserved.
 * @license		Apache License Version 2.0, January 2004; see LICENSE.txt or http://www.apache.org/licenses/
 */


define(
'worker/all',['worker/worker', 'worker/timer'],
function()
{
}
);
require(
	[
		'core/all',
		'datas/all',
		'object/all',
		'plugins/all',
		'views/all',
		'worker/all',
		'Devapt',
		'factory'
	],
	function()
	{
		// DevaptApplication.set_config(json_app_cfg);
		// DevaptApplication.run();
	}
);
define("all", function(){});

